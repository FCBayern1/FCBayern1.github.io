<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Sparse skills</title>
    <url>/2023/02/12/First-blog/</url>
    <content><![CDATA[<h2 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h2><p>1a</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"></span><br><span class="line"><span class="comment"># Task 1a: Data Loading and Preprocessing</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. Load the Data: Load the CSV file into a Pandas DataFrame</span></span><br><span class="line">file_path = <span class="string">&quot;data.csv&quot;</span>  <span class="comment"># Replace with your file path</span></span><br><span class="line">df = pd.read_csv(file_path)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Data loaded successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Data Cleaning: Check for missing values and fill them appropriately</span></span><br><span class="line"><span class="keyword">if</span> df.isnull().<span class="built_in">sum</span>().<span class="built_in">sum</span>() &gt; <span class="number">0</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Missing values found. Filling with appropriate values...&quot;</span>)</span><br><span class="line">    <span class="comment"># Assuming numeric columns are filled with 0 and categorical with &#x27;Unknown&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> column <span class="keyword">in</span> df.columns:</span><br><span class="line">        <span class="keyword">if</span> df[column].dtype == <span class="string">&#x27;object&#x27;</span>:</span><br><span class="line">            df[column].fillna(<span class="string">&#x27;Unknown&#x27;</span>, inplace=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            df[column].fillna(<span class="number">0</span>, inplace=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;No missing values found.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. Convert the Date column to a datetime object</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;Date&#x27;</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">    df[<span class="string">&#x27;Date&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;Date&#x27;</span>], errors=<span class="string">&#x27;coerce&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> df[<span class="string">&#x27;Date&#x27;</span>].isnull().<span class="built_in">sum</span>() &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Some dates were invalid. Converting invalid dates to a default value (e.g., today&#x27;s date).&quot;</span>)</span><br><span class="line">        df[<span class="string">&#x27;Date&#x27;</span>].fillna(pd.Timestamp.today(), inplace=<span class="literal">True</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Date column converted to datetime successfully.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. Ensure the Total column correctly represents the product of Quantity and Price</span></span><br><span class="line"><span class="keyword">if</span> <span class="string">&#x27;Total&#x27;</span> <span class="keyword">in</span> df.columns <span class="keyword">and</span> <span class="string">&#x27;Quantity&#x27;</span> <span class="keyword">in</span> df.columns <span class="keyword">and</span> <span class="string">&#x27;Price&#x27;</span> <span class="keyword">in</span> df.columns:</span><br><span class="line">    df[<span class="string">&#x27;Calculated_Total&#x27;</span>] = df[<span class="string">&#x27;Quantity&#x27;</span>] * df[<span class="string">&#x27;Price&#x27;</span>]</span><br><span class="line">    discrepancy = df[df[<span class="string">&#x27;Total&#x27;</span>] != df[<span class="string">&#x27;Calculated_Total&#x27;</span>]]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> discrepancy.empty:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Discrepancies found in the Total column. Correcting them...&quot;</span>)</span><br><span class="line">        df[<span class="string">&#x27;Total&#x27;</span>] = df[<span class="string">&#x27;Calculated_Total&#x27;</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Total column verified and corrected if necessary.&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Required columns (Total, Quantity, or Price) not found.&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Display the cleaned DataFrame (Optional)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Cleaned DataFrame:&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(df.head())</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save the cleaned data (Optional)</span></span><br><span class="line">df.to_csv(<span class="string">&quot;cleaned_data.csv&quot;</span>, index=<span class="literal">False</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Cleaned data saved to &#x27;cleaned_data.csv&#x27;.&quot;</span>)</span><br></pre></td></tr></table></figure>
<p>1b</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">&#x27;Product&#x27;</span>: [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;C&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;Quantity&#x27;</span>: [<span class="number">10</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">20</span>, <span class="number">25</span>, <span class="number">10</span>, <span class="number">30</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">5</span>],</span><br><span class="line">    <span class="string">&#x27;Date&#x27;</span>: [</span><br><span class="line">        <span class="string">&#x27;2023-01-15&#x27;</span>, <span class="string">&#x27;2023-01-20&#x27;</span>, <span class="string">&#x27;2023-02-10&#x27;</span>, <span class="string">&#x27;2023-02-18&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;2023-03-05&#x27;</span>, <span class="string">&#x27;2023-03-12&#x27;</span>, <span class="string">&#x27;2023-04-07&#x27;</span>, <span class="string">&#x27;2023-04-15&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;2023-05-01&#x27;</span>, <span class="string">&#x27;2023-05-10&#x27;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">df = pd.DataFrame(data)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ensure &#x27;Date&#x27; is a datetime type</span></span><br><span class="line">df[<span class="string">&#x27;Date&#x27;</span>] = pd.to_datetime(df[<span class="string">&#x27;Date&#x27;</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. Product Sales Distribution (Bar Chart)</span></span><br><span class="line">product_sales = df.groupby(<span class="string">&#x27;Product&#x27;</span>)[<span class="string">&#x27;Quantity&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">product_sales.plot(kind=<span class="string">&#x27;bar&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Total Quantity Sold for Each Product&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Product&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Total Quantity Sold&#x27;</span>)</span><br><span class="line">plt.xticks(rotation=<span class="number">0</span>)</span><br><span class="line">plt.grid(axis=<span class="string">&#x27;y&#x27;</span>, linestyle=<span class="string">&#x27;--&#x27;</span>, alpha=<span class="number">0.7</span>)</span><br><span class="line">plt.show()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. Sales Over Time (Line Plot)</span></span><br><span class="line">df[<span class="string">&#x27;Month&#x27;</span>] = df[<span class="string">&#x27;Date&#x27;</span>].dt.to_period(<span class="string">&#x27;M&#x27;</span>)  <span class="comment"># Extract month and year</span></span><br><span class="line">monthly_sales = df.groupby(<span class="string">&#x27;Month&#x27;</span>)[<span class="string">&#x27;Quantity&#x27;</span>].<span class="built_in">sum</span>()</span><br><span class="line"></span><br><span class="line">plt.figure(figsize=(<span class="number">10</span>, <span class="number">6</span>))</span><br><span class="line">monthly_sales.plot(kind=<span class="string">&#x27;line&#x27;</span>, marker=<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Total Sales Over the Months of 2023&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Month&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Total Sales&#x27;</span>)</span><br><span class="line">plt.grid(axis=<span class="string">&#x27;both&#x27;</span>, linestyle=<span class="string">&#x27;--&#x27;</span>, alpha=<span class="number">0.7</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>

<p>2a</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 2a: Database Creation, Table Creation, and Data Insertion</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line"><span class="comment"># Connect to (or create) the SQLite database named SalesDB</span></span><br><span class="line">conn = sqlite3.connect(<span class="string">&#x27;SalesDB.db&#x27;</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the Sales table with appropriate columns</span></span><br><span class="line"><span class="comment"># Ensuring no duplicate entries can be done by setting a UNIQUE constraint on (Date, Product)</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">CREATE TABLE IF NOT EXISTS Sales (</span></span><br><span class="line"><span class="string">    Date TEXT,</span></span><br><span class="line"><span class="string">    Product TEXT,</span></span><br><span class="line"><span class="string">    Quantity INTEGER,</span></span><br><span class="line"><span class="string">    Price REAL,</span></span><br><span class="line"><span class="string">    Total REAL,</span></span><br><span class="line"><span class="string">    UNIQUE(Date, Product)</span></span><br><span class="line"><span class="string">)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Insert cleaned and processed data from Part 1</span></span><br><span class="line"><span class="comment"># Assuming we have a list of tuples as our cleaned data, for example:</span></span><br><span class="line"><span class="comment"># cleaned_data = [</span></span><br><span class="line"><span class="comment">#     (&quot;2023-01-01&quot;, &quot;Widget A&quot;, 10, 9.99, 99.90),</span></span><br><span class="line"><span class="comment">#     (&quot;2023-01-01&quot;, &quot;Widget B&quot;, 5, 19.99, 99.95),</span></span><br><span class="line"><span class="comment">#     (&quot;2023-01-02&quot;, &quot;Widget A&quot;, 8, 9.99, 79.92),</span></span><br><span class="line"><span class="comment">#     ...</span></span><br><span class="line"><span class="comment"># ]</span></span><br><span class="line"><span class="comment"># Replace the above with your actual cleaned data list</span></span><br><span class="line"></span><br><span class="line">cleaned_data = [</span><br><span class="line">    (<span class="string">&quot;2023-01-01&quot;</span>, <span class="string">&quot;Widget A&quot;</span>, <span class="number">10</span>, <span class="number">9.99</span>, <span class="number">99.90</span>),</span><br><span class="line">    (<span class="string">&quot;2023-01-01&quot;</span>, <span class="string">&quot;Widget B&quot;</span>, <span class="number">5</span>, <span class="number">19.99</span>, <span class="number">99.95</span>),</span><br><span class="line">    (<span class="string">&quot;2023-02-10&quot;</span>, <span class="string">&quot;Widget A&quot;</span>, <span class="number">20</span>, <span class="number">9.99</span>, <span class="number">199.80</span>),</span><br><span class="line">    (<span class="string">&quot;2023-03-15&quot;</span>, <span class="string">&quot;Widget C&quot;</span>, <span class="number">3</span>, <span class="number">29.99</span>, <span class="number">89.97</span>),</span><br><span class="line">    (<span class="string">&quot;2023-03-15&quot;</span>, <span class="string">&quot;Widget B&quot;</span>, <span class="number">2</span>, <span class="number">19.99</span>, <span class="number">39.98</span>),</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment"># Insert data using &quot;INSERT OR IGNORE&quot; to avoid duplicates</span></span><br><span class="line"><span class="keyword">for</span> record <span class="keyword">in</span> cleaned_data:</span><br><span class="line">    cursor.execute(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    INSERT OR IGNORE INTO Sales (Date, Product, Quantity, Price, Total)</span></span><br><span class="line"><span class="string">    VALUES (?, ?, ?, ?, ?)</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span>, record)</span><br><span class="line"></span><br><span class="line">conn.commit()</span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<p>2b</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 2b: Querying the Database</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sqlite3</span><br><span class="line"></span><br><span class="line">conn = sqlite3.connect(<span class="string">&#x27;SalesDB.db&#x27;</span>)</span><br><span class="line">cursor = conn.cursor()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Query 1: Total Sales for the year 2023</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">SELECT SUM(Total) AS total_sales_2023</span></span><br><span class="line"><span class="string">FROM Sales</span></span><br><span class="line"><span class="string">WHERE Date LIKE &#x27;2023-%&#x27;;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">total_sales_2023 = cursor.fetchone()[<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Total Sales in 2023:&quot;</span>, total_sales_2023)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Query 2: Product Sales Summary for 2023 (total quantity sold per product, descending order)</span></span><br><span class="line">cursor.execute(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">SELECT Product, SUM(Quantity) as total_quantity</span></span><br><span class="line"><span class="string">FROM Sales</span></span><br><span class="line"><span class="string">WHERE Date LIKE &#x27;2023-%&#x27;</span></span><br><span class="line"><span class="string">GROUP BY Product</span></span><br><span class="line"><span class="string">ORDER BY total_quantity DESC;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span>)</span><br><span class="line">product_sales_summary = cursor.fetchall()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Product Sales Summary for 2023:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> row <span class="keyword">in</span> product_sales_summary:</span><br><span class="line">    <span class="built_in">print</span>(row)  <span class="comment"># (Product, total_quantity)</span></span><br><span class="line"></span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>

<p>3a:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="keyword">import</span> torch.nn <span class="keyword">as</span> nn</span><br><span class="line"><span class="keyword">import</span> torch.optim <span class="keyword">as</span> optim</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="comment"># Task 3a: Model Initialization</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleNN</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, input_size</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleNN, self).__init__()</span><br><span class="line">        self.linear = nn.Linear(input_size, <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> self.linear(x)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Instantiate the m</span></span><br><span class="line">input_size = <span class="number">10</span></span><br><span class="line">model = SimpleNN(input_size)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Define loss function and optimizer</span></span><br><span class="line">loss_function = nn.MSELoss()</span><br><span class="line">optimizer = optim.SGD(model.parameters(), lr=<span class="number">0.01</span>)</span><br></pre></td></tr></table></figure>

<p>3b</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Generate synthetic data</span></span><br><span class="line">num_samples = <span class="number">100</span></span><br><span class="line">num_features = <span class="number">10</span></span><br><span class="line"></span><br><span class="line">data = torch.randn(num_samples, num_features)</span><br><span class="line">target = torch.randn(num_samples, <span class="number">1</span>)  <span class="comment"># 100 target values reshaped for MSE</span></span><br></pre></td></tr></table></figure>

<p>3c</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">num_epochs = <span class="number">20</span></span><br><span class="line">losses = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> epoch <span class="keyword">in</span> <span class="built_in">range</span>(num_epochs):</span><br><span class="line">    <span class="comment"># Forward pass</span></span><br><span class="line">    predictions = model(data)</span><br><span class="line">    loss = loss_function(predictions, target)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Backward pass and optimization</span></span><br><span class="line">    optimizer.zero_grad()</span><br><span class="line">    loss.backward()</span><br><span class="line">    optimizer.step()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Record loss</span></span><br><span class="line">    losses.append(loss.item())</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;Epoch <span class="subst">&#123;epoch + <span class="number">1</span>&#125;</span>/<span class="subst">&#123;num_epochs&#125;</span>, Loss: <span class="subst">&#123;loss.item():<span class="number">.4</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>3d</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">plt.plot(<span class="built_in">range</span>(<span class="number">1</span>, num_epochs + <span class="number">1</span>), losses, marker=<span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">plt.xlabel(<span class="string">&#x27;Epoch&#x27;</span>)</span><br><span class="line">plt.ylabel(<span class="string">&#x27;Training Loss&#x27;</span>)</span><br><span class="line">plt.title(<span class="string">&#x27;Training Loss Over Epochs&#x27;</span>)</span><br><span class="line">plt.grid(<span class="literal">True</span>)</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>



<h1 id="CS-skills"><a href="#CS-skills" class="headerlink" title="CS skills"></a>CS skills</h1><h2 id="Git-study"><a href="#Git-study" class="headerlink" title="Git study"></a>Git study</h2><p><img src="/../images/WeChatb22903d041669c31bc759fe2fce96683.png"></p>
<h2 id="Knapsack-Problem"><a href="#Knapsack-Problem" class="headerlink" title="Knapsack Problem"></a>Knapsack Problem</h2><p>你有一个容量为 W&#x3D;10 的背包，以及以下物品：</p>
<table>
<thead>
<tr>
<th>物品</th>
<th>重量（kg）</th>
<th>价值（元）</th>
</tr>
</thead>
<tbody><tr>
<td>物品 1</td>
<td>2</td>
<td>6</td>
</tr>
<tr>
<td>物品 2</td>
<td>3</td>
<td>10</td>
</tr>
<tr>
<td>物品 3</td>
<td>4</td>
<td>12</td>
</tr>
</tbody></table>
<p>目标是选择物品装入背包，使得总价值最大，同时不超过背包容量。</p>
<p>动态规划：</p>
<p>步骤:</p>
<ol>
<li><strong>定义状态</strong></li>
</ol>
<p>用 dp[i][w]表示在前 i 个物品中，容量不超过 w 时的最大价值。</p>
<ol start="2">
<li><strong>状态转移方程</strong></li>
</ol>
<p>如果不选择第i个物品: dp[i][w] &#x3D; dp[i-1][w]</p>
<p>如果选择第i个物品: dp[i][w] &#x3D; dp[i-1][w-weight[i]]+value[i]</p>
<ol start="3">
<li><strong>初始化</strong></li>
</ol>
<p>当i &#x3D; 0 或 w &#x3D; 0, 即没有物品或背包容量为 0 时: dp[i][w]&#x3D;0</p>
<ol start="4">
<li><strong>最终结果</strong></li>
</ol>
<p>dp[n][W] 表示在前 n 个物品中，容量不超过 W 时的最大价值。</p>
<p>![image-20241202125650466](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:image-20241202125650466.png)</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">knapsack</span>(<span class="params">weights, values, W</span>):</span><br><span class="line">    n = <span class="built_in">len</span>(weights)</span><br><span class="line">    dp = [[<span class="number">0</span>] * (W + <span class="number">1</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(n + <span class="number">1</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, n + <span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> w <span class="keyword">in</span> <span class="built_in">range</span>(W + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> weights[i-<span class="number">1</span>] &lt;= w:</span><br><span class="line">                dp[i][w] = <span class="built_in">max</span>(dp[i-<span class="number">1</span>][w], dp[i-<span class="number">1</span>][w-weights[i-<span class="number">1</span>]] + values[i-<span class="number">1</span>])</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dp[i][w] = dp[i-<span class="number">1</span>][w]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> dp[n][W]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 示例数据</span></span><br><span class="line">weights = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>]</span><br><span class="line">values = [<span class="number">6</span>, <span class="number">10</span>, <span class="number">12</span>]</span><br><span class="line">W = <span class="number">10</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;最大价值为:&quot;</span>, knapsack(weights, values, W))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>如果背包问题变成连续空间呢？</p>
<h2 id="YARN"><a href="#YARN" class="headerlink" title="YARN"></a>YARN</h2><p>Yet Another Resource Negotiator</p>
<h3 id="YARN-的核心组件"><a href="#YARN-的核心组件" class="headerlink" title="YARN 的核心组件"></a>YARN 的核心组件</h3><ol>
<li><strong>ResourceManager (RM)</strong><ul>
<li>集群范围的资源管理器，负责协调整个集群的资源分配。</li>
<li>包含两个主要模块：<ul>
<li><strong>Scheduler</strong>：根据调度策略为应用程序分配资源。</li>
<li><strong>ApplicationsManager</strong>：负责应用程序的生命周期管理，比如启动 ApplicationMaster。</li>
</ul>
</li>
</ul>
</li>
<li><strong>NodeManager (NM)</strong><ul>
<li>每个节点上的代理，负责单节点资源的管理和任务的执行。</li>
<li>监控容器（Container）的资源使用（CPU、内存等）并报告给 ResourceManager。</li>
</ul>
</li>
<li><strong>ApplicationMaster (AM)</strong><ul>
<li>每个应用程序的具体作业管理器，负责作业的调度和任务执行的管理。</li>
<li>通过与 ResourceManager 和 NodeManager 通信来请求资源和启动任务。</li>
</ul>
</li>
<li><strong>Container</strong><ul>
<li>YARN 中的最小资源分配单元，包含一定数量的 CPU 核心和内存。</li>
<li>每个任务运行在一个或多个 Container 中。</li>
</ul>
</li>
</ol>
<h3 id="工作原理"><a href="#工作原理" class="headerlink" title="工作原理"></a>工作原理</h3><p><strong>应用提交</strong></p>
<ul>
<li>客户端向 ResourceManager 提交一个应用请求。</li>
<li>ResourceManager 启动 ApplicationMaster 来管理该应用。</li>
</ul>
<p><strong>资源分配</strong></p>
<ul>
<li>ApplicationMaster 与 ResourceManager 协商资源需求。</li>
<li>ResourceManager 根据当前的资源调度策略分配容器。</li>
</ul>
<p><strong>任务执行</strong></p>
<ul>
<li>ApplicationMaster 请求 NodeManager 启动 Container 并运行任务。</li>
<li>NodeManager 在分配的容器中执行任务，并将状态返回给 ApplicationMaster。</li>
</ul>
<p><strong>任务完成</strong></p>
<ul>
<li>ApplicationMaster 汇总任务执行结果并向 ResourceManager 汇报应用完成状态。</li>
</ul>
]]></content>
      <tags>
        <tag>First blog</tag>
      </tags>
  </entry>
  <entry>
    <title>Csharp</title>
    <url>/2023/04/15/Csharp/</url>
    <content><![CDATA[<h1 id="C-Get-started"><a href="#C-Get-started" class="headerlink" title="C# Get started"></a>C# Get started</h1><p>hello guys, follow me and let’s studying the C#.</p>
<ul>
<li>Commercial experience of software development in C#</li>
<li>Experience with source code version control such as Git</li>
<li>Experience with software development tools such as Visual Studio, JIRA, MSBuild, Jenkins</li>
<li>Experience with unit test frameworks such as NUnit or MSTest</li>
<li>Experience designing user interfaces. (Exposure to DevExpress an advantage).</li>
<li>Exposure to Iterative or Agile development methodologies (Scrum &#x2F; Kanban)</li>
<li>Understanding of OOP</li>
<li>Understanding of SOLID</li>
</ul>
<h2 id="Chapter1-Basic"><a href="#Chapter1-Basic" class="headerlink" title="Chapter1: Basic"></a>Chapter1: Basic</h2><ul>
<li><strong>using</strong>: The keyword is used to include the <strong>System</strong> namespace in the program. A program usually has multiple using <strong>statements</strong>.</li>
<li><strong>namespace</strong>: which contains different classes.</li>
<li><strong>class</strong>: declariation of the class.</li>
<li><strong>Main</strong>: Is the entry point for all C# programs. What does the class do when executed</li>
<li><strong>Formatted</strong> <strong>output aka interpolation</strong>：Console.WriteLine(<strong>$</strong>“Hello World! The counter is <strong>{counter}</strong>“); By using $ dollar symbol.</li>
</ul>
<hr>
<p><strong>Here are a few things to note:</strong></p>
<ul>
<li>C# is case sensitive.</li>
<li>All statements and expressions must start with a semicolon (;). The end.</li>
<li>Execution of the program starts with the Main method.</li>
<li>Unlike Java, the file name can be different from the name of the class.</li>
</ul>
<p><strong>Numbers and Math in C#: Int,float,double,decimal,string..</strong></p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> minVal = <span class="built_in">int</span>.MinValue; <span class="comment">// -2147483648</span></span><br><span class="line"><span class="built_in">int</span> maxVal = <span class="built_in">int</span>.MaxValue; <span class="comment">// 2147483647</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">double</span> min = <span class="built_in">double</span>.MinValue <span class="comment">// -1.79769313486232E+308</span></span><br><span class="line"><span class="built_in">double</span> max = <span class="built_in">double</span>.MaxValue <span class="comment">// 1.79769313486232E+308</span></span><br><span class="line">  </span><br><span class="line"><span class="built_in">decimal</span> min = <span class="built_in">decimal</span>.MinValue; <span class="comment">//-79228162514264337593543950335</span></span><br><span class="line"><span class="built_in">decimal</span> max = <span class="built_in">decimal</span>.MaxValue; <span class="comment">// 79228162514264337593543950335</span></span><br></pre></td></tr></table></figure>

<p>The <code>decimal</code> type has a smaller range but greater precision than <code>double</code>. </p>
<p>The <code>M</code> suffix on the numbers is how you indicate that a constant should use the <code>decimal</code> type. For example:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="built_in">decimal</span> c = <span class="number">1.0</span>M;</span><br><span class="line"><span class="built_in">decimal</span> d = <span class="number">3.0</span>M;</span><br><span class="line">Console.WriteLine(c / d);</span><br></pre></td></tr></table></figure>

<p><strong>Arrays</strong>:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 定义一个整型数组，长度为3</span></span><br><span class="line"><span class="built_in">int</span>[] nums = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义一个字符串数组，长度为4，初始化数组元素</span></span><br><span class="line"><span class="built_in">string</span>[] names = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;Tom&quot;</span>, <span class="string">&quot;Jerry&quot;</span>, <span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;Bob&quot;</span> &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 var 关键字定义数组</span></span><br><span class="line"><span class="keyword">var</span> scores = <span class="keyword">new</span> <span class="built_in">int</span>[] &#123; <span class="number">90</span>, <span class="number">80</span>, <span class="number">95</span>, <span class="number">85</span>, <span class="number">70</span> &#125;;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>以上示例中，第一个定义创建了一个长度为 3 的整型数组，数组中的元素初始值为 0；第二个定义创建了一个长度为 4 的字符串数组，并初始化了每个元素的值；第三个定义使用 var 关键字根据初始化值推断出数组的类型，并创建了一个长度为 5 的整型数组</p>
<p>　<strong>Common Math function</strong></p>
<ul>
<li>Math.Abs: Returns the absolute value of a number.</li>
<li>Math.Ceiling: Rounds up a number and returns the smallest integer greater than or equal to that number.</li>
<li>Math.Floor: Rounds down a number and returns the largest integer less than or equal to the number.</li>
<li>Math.Max: Returns the maximum of two numbers.</li>
<li>Math.Min: Returns the minimum of two numbers.</li>
<li>Math.Pow: Returns the specified power of a number.</li>
<li>Math.Round: Round to the nearest whole number or number of specified decimal places.</li>
<li>Math.Sqrt: Returns the square root of a number.</li>
<li>Math.Log: Returns the natural log base e of a number.</li>
<li>Math.Exp: Returns e to the specified power.</li>
<li>Math.Truncate: Truncates a number into its integer part.</li>
</ul>
<h2 id="Chapter2-if-x2F-else-x2F-loop"><a href="#Chapter2-if-x2F-else-x2F-loop" class="headerlink" title="Chapter2. if&#x2F;else&#x2F;loop"></a>Chapter2. if&#x2F;else&#x2F;loop</h2><h3 id="1-if-statement"><a href="#1-if-statement" class="headerlink" title="1. if statement"></a>1. if statement</h3><p><strong>bool</strong> carries true and false. which is different from java</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(condition)&#123;</span><br><span class="line">execution <span class="keyword">when</span> condition <span class="keyword">is</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">execution <span class="keyword">when</span> condition <span class="keyword">is</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Logical AND Operator:<strong>&amp;&amp;</strong> </p>
<p>Logical OR Operator:<strong>||</strong> </p>
<p>Logical NOT Operator: <strong>!</strong></p>
<p>Equality Operator: <strong>&#x3D;&#x3D;</strong></p>
<h3 id="2-loop"><a href="#2-loop" class="headerlink" title="2. loop"></a>2. loop</h3><ol>
<li><p><strong>while loop</strong></p>
<p>same with java</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> counter = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (counter &lt; <span class="number">10</span>)</span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Hello World! The counter is <span class="subst">&#123;counter&#125;</span>&quot;</span>);</span><br><span class="line">  counter++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>do while</strong></p>
<p>same with java</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="built_in">int</span> counter = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Hello World! The counter is <span class="subst">&#123;counter&#125;</span>&quot;</span>);</span><br><span class="line">  counter++;</span><br><span class="line">&#125; <span class="keyword">while</span> (counter &lt; <span class="number">10</span>);</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>for loop</strong></p>
</li>
</ol>
<p>​	Same with java</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> counter = <span class="number">0</span>; counter &lt; <span class="number">10</span>; counter++)</span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Hello World! The counter is <span class="subst">&#123;counter&#125;</span>&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>(for initializer;for condition;for iterator)</strong> same with java</p>
<p><strong>Nested for loop</strong> which can be used to create matrix, e.g:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> row = <span class="number">1</span>; row &lt; <span class="number">11</span>; row++)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">char</span> column = <span class="string">&#x27;a&#x27;</span>; column &lt; <span class="string">&#x27;k&#x27;</span>; column++)</span><br><span class="line">  &#123;</span><br><span class="line">    Console.WriteLine(<span class="string">$&quot;The cell is (<span class="subst">&#123;row&#125;</span>, <span class="subst">&#123;column&#125;</span>)&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Chapter3-Lists-collection"><a href="#Chapter3-Lists-collection" class="headerlink" title="Chapter3. Lists collection"></a>Chapter3. Lists collection</h2><p>Example:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> names = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;Joshua&quot;</span>, <span class="string">&quot;Ana&quot;</span>, <span class="string">&quot;Felipe&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> name <span class="keyword">in</span> names)</span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Hello <span class="subst">&#123;name.ToUpper()&#125;</span>!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>You specify the type of the elements between the angle brackets, &lt;&gt;.</li>
<li>One important aspect of this <a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1">List</a> type is that it can grow or shrink, enabling you to add or remove elements.</li>
</ul>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> names = <span class="keyword">new</span> List&lt;<span class="built_in">string</span>&gt; &#123; <span class="string">&quot;Joshua&quot;</span>, <span class="string">&quot;Ana&quot;</span>, <span class="string">&quot;Felipe&quot;</span> &#125;;</span><br><span class="line">Console.WriteLine();</span><br><span class="line">names.Add(<span class="string">&quot;Joshua&quot;</span>);</span><br><span class="line">names.Add(<span class="string">&quot;Bill&quot;</span>);</span><br><span class="line">names.RemoveAll(name=&gt;name==<span class="string">&quot;Joshua&quot;</span>);</span><br><span class="line"><span class="keyword">foreach</span> (<span class="keyword">var</span> name <span class="keyword">in</span> names)</span><br><span class="line">&#123;</span><br><span class="line">  Console.WriteLine(<span class="string">$&quot;Hello <span class="subst">&#123;name.ToUpper()&#125;</span>!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>RemoveAll method is different from that in Java. It is provided by list<T></T></p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">int</span> <span class="title">RemoveAll</span>(<span class="params">Predicate&lt;T&gt; match</span>)</span>;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>list<T> allows you reference the individual items by <strong>index</strong> directly which is different from java&#x3D;&gt;”list.get()”.</T></p>
</li>
<li><p>list<T> also provides <strong>Count</strong> method which allows you to count the numbers of elements in the list. <strong>xxx.Count</strong></T></p>
</li>
<li><p>list<T> provides you a IndexOf method which allows you to find the index of the specific element.</T></p>
</li>
<li><p>The items in your list can be sorted as well. The <a href="https://learn.microsoft.com/en-us/dotnet/api/system.collections.generic.list-1.sort">Sort</a> method sorts all the items in the list in their normal order (alphabetically for strings). Add this code and run again: Quite similar with the Collection.sort();</p>
</li>
</ul>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">//print fibonacci numbers</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> fibonacciNumbers = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt; &#123;<span class="number">1</span>, <span class="number">1</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (fibonacciNumbers.Count &lt; <span class="number">20</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">var</span> previous = fibonacciNumbers[fibonacciNumbers.Count - <span class="number">1</span>];</span><br><span class="line">    <span class="keyword">var</span> previous2 = fibonacciNumbers[fibonacciNumbers.Count - <span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    fibonacciNumbers.Add(previous + previous2);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>(<span class="keyword">var</span> item <span class="keyword">in</span> fibonacciNumbers)</span><br><span class="line">&#123;</span><br><span class="line">    Console.WriteLine(item);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Fundamentals"><a href="#Fundamentals" class="headerlink" title="Fundamentals."></a>Fundamentals.</h2><h3 id="1-Program-Structure"><a href="#1-Program-Structure" class="headerlink" title="1. Program Structure."></a>1. Program Structure.</h3><h4 id="1-Overview"><a href="#1-Overview" class="headerlink" title="1. Overview"></a>1. Overview</h4><figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// A skeleton of a C# program</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Your program starts here:</span></span><br><span class="line">Console.WriteLine(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">YourNamespace</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">YourClass</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> YourStruct</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title">IYourInterface</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">YourDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">enum</span> YourEnum</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">YourNestedNamespace</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">struct</span> YourStruct</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>The preceding example uses <em>top-level statements</em> for the program’s entry point. This feature was added in C# 9. Prior to C# 9, the entry point was a static method named <code>Main</code>, as shown in the following example:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// A skeleton of a C# program</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">YourNamespace</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title">YourClass</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">struct</span> YourStruct</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">interface</span> <span class="title">IYourInterface</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="built_in">delegate</span> <span class="built_in">int</span> <span class="title">YourDelegate</span>()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">enum</span> YourEnum</span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">namespace</span> <span class="title">YourNestedNamespace</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">struct</span> YourStruct</span><br><span class="line">        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title">Program</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//Your program starts here...</span></span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Hello world!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Prefix of the c# file is .cs.</strong></p>
<h4 id="2-Main-method"><a href="#2-Main-method" class="headerlink" title="2. Main method"></a>2. Main method</h4><p>The <code>Main</code> method is the entry point of a C# application. (Libraries and services do not require a <code>Main</code> method as an entry point.) When the application is started, the <code>Main</code> method is the first method that is invoked.</p>
<p>There can only be one entry point in a C# program. If you have more than one class that has a <code>Main</code> method, you must compile your program with the <strong>StartupObject</strong> compiler option to specify which <code>Main</code> method to use as the entry point. For more information, see <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/compiler-options/advanced#mainentrypoint-or-startupobject"><strong>StartupObject</strong> (C# Compiler Options)</a>.</p>
<p>Starting in C# 9, you can omit the <code>Main</code> method, and write C# statements as if they were in the <code>Main</code> method (<strong>this is similar with Python</strong>), as in the following example:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line">StringBuilder builder = <span class="keyword">new</span>();</span><br><span class="line">builder.AppendLine(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">builder.AppendLine(<span class="string">&quot;World!&quot;</span>);</span><br><span class="line"></span><br><span class="line">Console.WriteLine(builder.ToString());</span><br></pre></td></tr></table></figure>

<p>For information about how to write application code with an implicit entry point method, see <a href="https://learn.microsoft.com/en-us/dotnet/csharp/fundamentals/program-structure/top-level-statements">Top-level statements</a>.</p>
<ul>
<li>The <code>Main</code> method is the entry point of an executable program; it is where the program control starts and ends.</li>
<li><code>Main</code> is declared inside a class or struct. <code>Main</code> must be <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/static"><code>static</code></a> and it need not be <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/public"><code>public</code></a>. (In the earlier example, it receives the default access of <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/private"><code>private</code></a>.) The enclosing class or struct is not required to be static.</li>
<li><code>Main</code> can either have a <code>void</code>, <code>int</code>, <code>Task</code>, or <code>Task&lt;int&gt;</code> return type.</li>
<li>If and only if <code>Main</code> returns a <code>Task</code> or <code>Task&lt;int&gt;</code>, the declaration of <code>Main</code> may include the <a href="https://learn.microsoft.com/en-us/dotnet/csharp/language-reference/keywords/async"><code>async</code></a> modifier. This specifically excludes an <code>async void Main</code> method.</li>
<li>The <code>Main</code> method can be declared with or without a <code>string[]</code> parameter that contains command-line arguments. When using Visual Studio to create Windows applications, you can add the parameter manually or else use the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.environment.getcommandlineargs#system-environment-getcommandlineargs">GetCommandLineArgs()</a> method to obtain the command-line arguments. Parameters are read as zero-indexed command-line arguments. Unlike C and C++, the name of the program is not treated as the first command-line argument in the <code>args</code> array, but it is the first element of the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.environment.getcommandlineargs#system-environment-getcommandlineargs">GetCommandLineArgs()</a> method.</li>
</ul>
<p><strong>Valid main declariation:</strong></p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span> &#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">Main</span>()</span> &#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span> &#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span> &#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>()</span> &#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task&lt;<span class="built_in">int</span>&gt; <span class="title">Main</span>()</span> &#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span> &#123; &#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">async</span> Task&lt;<span class="built_in">int</span>&gt; <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span> &#123; &#125;</span><br></pre></td></tr></table></figure>

<p>The preceding examples all use the <code>public</code> accessor modifier. That’s typical, but not required. (which means they can be <strong>private</strong>).</p>
<p>The addition of <code>async</code> and <code>Task</code>, <code>Task&lt;int&gt;</code> return types simplifies program code when console applications need to start and <code>await</code> asynchronous operations in <code>Main</code></p>
<p><strong>Main() return values:</strong></p>
<p>You can return an <code>int</code> from the <code>Main</code> method by defining the method in one of the following ways:</p>
<table>
<thead>
<tr>
<th align="left"><code>Main</code> method code</th>
<th align="left"><code>Main</code> signature</th>
</tr>
</thead>
<tbody><tr>
<td align="left">No use of <code>args</code> or <code>await</code></td>
<td align="left"><code>static int Main()</code></td>
</tr>
<tr>
<td align="left">Uses <code>args</code>, no use of <code>await</code></td>
<td align="left"><code>static int Main(string[] args)</code></td>
</tr>
<tr>
<td align="left">No use of <code>args</code>, uses <code>await</code></td>
<td align="left"><code>static async Task&lt;int&gt; Main()</code></td>
</tr>
<tr>
<td align="left">Uses <code>args</code> and <code>await</code></td>
<td align="left"><code>static async Task&lt;int&gt; Main(string[] args)</code></td>
</tr>
</tbody></table>
<p>If the return value from <code>Main</code> is not used, returning <code>void</code> or <code>Task</code> allows for slightly simpler code.</p>
<table>
<thead>
<tr>
<th align="left"><code>Main</code> method code</th>
<th align="left"><code>Main</code> signature</th>
</tr>
</thead>
<tbody><tr>
<td align="left">No use of <code>args</code> or <code>await</code></td>
<td align="left"><code>static void Main()</code></td>
</tr>
<tr>
<td align="left">Uses <code>args</code>, no use of <code>await</code></td>
<td align="left"><code>static void Main(string[] args)</code></td>
</tr>
<tr>
<td align="left">No use of <code>args</code>, uses <code>await</code></td>
<td align="left"><code>static async Task Main()</code></td>
</tr>
<tr>
<td align="left">Uses <code>args</code> and <code>await</code></td>
<td align="left"><code>static async Task Main(string[] args)</code></td>
</tr>
</tbody></table>
<p>However, returning <code>int</code> or <code>Task&lt;int&gt;</code> enables the program to communicate status information to other programs or scripts that invoke the executable file.</p>
<p>The following example shows how the exit code for the process can be accessed.</p>
<p>This example uses <a href="https://learn.microsoft.com/en-us/dotnet/core/introduction">.NET Core</a> command-line tools. If you are unfamiliar with .NET Core command-line tools, you can learn about them in this <a href="https://learn.microsoft.com/en-us/dotnet/core/tutorials/with-visual-studio-code">get-started article</a>.</p>
<p>Create a new application by running <code>dotnet new console</code>. Modify the <code>Main</code> method in <em>Program.cs</em> as follows:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Save this program as MainReturnValTest.cs.</span></span><br><span class="line"><span class="keyword">class</span> <span class="title">MainReturnValTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="built_in">int</span> <span class="title">Main</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>When a program is executed in Windows OS, <strong>any value returned</strong> from the <code>Main</code> function is stored in an <strong>environment variable</strong>. This environment variable can be retrieved using <code>ERRORLEVEL</code> from a batch file, or <code>$LastExitCode</code> from PowerShell. </p>
<p>You can build the application using the <a href="https://learn.microsoft.com/en-us/dotnet/core/tools/dotnet">dotnet CLI</a> <code>dotnet build</code> command.</p>
<p>Next, create a PowerShell script to run the application and display the result. Paste the following code into a text file and save it as <code>test.ps1</code> in the folder that contains the project. Run the PowerShell script by typing <code>test.ps1</code> at the PowerShell prompt.</p>
<p>Because the code returns zero, the batch file will report success. However, if you change MainReturnValTest.cs to return a non-zero value and then recompile the program, subsequent execution of the PowerShell script will report failure.</p>
<figure class="highlight powershell"><table><tr><td class="code"><pre><span class="line">dotnet run</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$LastExitCode</span> <span class="operator">-eq</span> <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Execution succeeded&quot;</span></span><br><span class="line">&#125; <span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">Write-Host</span> <span class="string">&quot;Execution Failed&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;Return value = &quot;</span> <span class="variable">$LastExitCode</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Execution succeeded</span><br><span class="line">Return value = 0</span><br></pre></td></tr></table></figure>

<p><strong>Async Main return values</strong></p>
<p>When you declare an <code>async</code> return value for <code>Main</code>, the compiler generates the boilerplate code for calling asynchronous methods in <code>Main</code>. If you don’t specify the <code>async</code> keyword, you need to write that code yourself, as shown in the following example. The code in the example ensures that your program runs until the asynchronous operation is completed:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">Main</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    AsyncConsoleWork().GetAwaiter().GetResult();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">async</span> Task&lt;<span class="built_in">int</span>&gt; <span class="title">AsyncConsoleWork</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Main body here</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>This boilerplate code can be replaced by:</p>
<figure class="highlight c#"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">async</span> Task&lt;<span class="built_in">int</span>&gt; <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">await</span> AsyncConsoleWork();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>An advantage of declaring <code>Main</code> as <code>async</code> is that the compiler always generates the correct code.	</p>
<p>When the application entry point returns a <code>Task</code> or <code>Task&lt;int&gt;</code>, the compiler generates a new entry point that calls the entry point method declared in the application code. Assuming that this entry point is called <code>$GeneratedMain</code>, the compiler generates the following code for these entry points:</p>
<ul>
<li><code>static Task Main()</code> results in the compiler emitting the equivalent of <code>private static void $GeneratedMain() =&gt; Main().GetAwaiter().GetResult();</code></li>
<li><code>static Task Main(string[])</code> results in the compiler emitting the equivalent of <code>private static void $GeneratedMain(string[] args) =&gt; Main(args).GetAwaiter().GetResult();</code></li>
<li><code>static Task&lt;int&gt; Main()</code> results in the compiler emitting the equivalent of <code>private static int $GeneratedMain() =&gt; Main().GetAwaiter().GetResult();</code></li>
<li><code>static Task&lt;int&gt; Main(string[])</code> results in the compiler emitting the equivalent of <code>private static int $GeneratedMain(string[] args) =&gt; Main(args).GetAwaiter().GetResult();</code></li>
</ul>
<p><strong>Noted: If the examples used <code>async</code> modifier on the <code>Main</code> method, the compiler would generate the same code.</strong></p>
<p><strong>Command-Line Arguments</strong></p>
<p>You can send arguments to the <code>Main</code> method by defining the method in one of the following ways:</p>
<table>
<thead>
<tr>
<th align="left"><code>Main</code> method code</th>
<th align="left"><code>Main</code> signature</th>
</tr>
</thead>
<tbody><tr>
<td align="left">No return value, no use of <code>await</code></td>
<td align="left"><code>static void Main(string[] args)</code></td>
</tr>
<tr>
<td align="left">Return value, no use of <code>await</code></td>
<td align="left"><code>static int Main(string[] args)</code></td>
</tr>
<tr>
<td align="left">No return value, uses <code>await</code></td>
<td align="left"><code>static async Task Main(string[] args)</code></td>
</tr>
<tr>
<td align="left">Return value, uses <code>await</code></td>
<td align="left"><code>static async Task&lt;int&gt; Main(string[] args)</code></td>
</tr>
</tbody></table>
<p>If the arguments are not used, you can omit <code>args</code> from the method signature for slightly simpler code:</p>
<table>
<thead>
<tr>
<th align="left"><code>Main</code> method code</th>
<th align="left"><code>Main</code> signature</th>
</tr>
</thead>
<tbody><tr>
<td align="left">No return value, no use of <code>await</code></td>
<td align="left"><code>static void Main()</code></td>
</tr>
<tr>
<td align="left">Return value, no use of <code>await</code></td>
<td align="left"><code>static int Main()</code></td>
</tr>
<tr>
<td align="left">No return value, uses <code>await</code></td>
<td align="left"><code>static async Task Main()</code></td>
</tr>
<tr>
<td align="left">Return value, uses <code>await</code></td>
<td align="left"><code>static async Task&lt;int&gt; Main()</code></td>
</tr>
</tbody></table>
<p> Note</p>
<p>You can also use <a href="https://learn.microsoft.com/en-us/dotnet/api/system.environment.commandline">Environment.CommandLine</a> or <a href="https://learn.microsoft.com/en-us/dotnet/api/system.environment.getcommandlineargs">Environment.GetCommandLineArgs</a> to access the command-line arguments from any point in a console or Windows Forms application. To enable command-line arguments in the <code>Main</code> method signature in a Windows Forms application, you must manually modify the signature of <code>Main</code>. The code generated by the Windows Forms designer creates <code>Main</code> without an input parameter.</p>
<p>The parameter of the <code>Main</code> method is a <a href="https://learn.microsoft.com/en-us/dotnet/api/system.string">String</a> array that represents the command-line arguments. Usually you determine whether arguments exist by testing the <code>Length</code> property, for example:</p>
<p>C#Copy</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (args.Length == <span class="number">0</span>)</span><br><span class="line">&#123;</span><br><span class="line">    System.Console.WriteLine(<span class="string">&quot;Please enter a numeric argument.&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> Tip</p>
<p>The <code>args</code> array can’t be null. So, it’s safe to access the <code>Length</code> property without null checking.</p>
<p>You can also convert the string arguments to numeric types by using the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.convert">Convert</a> class or the <code>Parse</code> method. For example, the following statement converts the <code>string</code> to a <code>long</code> number by using the <a href="https://learn.microsoft.com/en-us/dotnet/api/system.int64.parse">Parse</a> method:</p>
<p>C#Copy</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">long</span> num = Int64.Parse(args[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<p>It is also possible to use the C# type <code>long</code>, which aliases <code>Int64</code>:</p>
<p>C#Copy</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">long</span> num = <span class="built_in">long</span>.Parse(args[<span class="number">0</span>]);</span><br></pre></td></tr></table></figure>

<p>You can also use the <code>Convert</code> class method <code>ToInt64</code> to do the same thing:</p>
<p>C#Copy</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="built_in">long</span> num = Convert.ToInt64(s);</span><br></pre></td></tr></table></figure>

<p>For more information, see <a href="https://learn.microsoft.com/en-us/dotnet/api/system.int64.parse">Parse</a> and <a href="https://learn.microsoft.com/en-us/dotnet/api/system.convert">Convert</a>.</p>
<p>The following example shows how to use command-line arguments in a console application. The application takes one argument at run time, converts the argument to an integer, and calculates the factorial of the number. If no arguments are supplied, the application issues a message that explains the correct usage of the program.</p>
<p>To compile and run the application from a command prompt, follow these steps:</p>
<ol>
<li><p>Paste the following code into any text editor, and then save the file as a text file with the name <em>Factorial.cs</em>.</p>
<p>C#Copy</p>
<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Functions</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">long</span> <span class="title">Factorial</span>(<span class="params"><span class="built_in">int</span> n</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Test for invalid input.</span></span><br><span class="line">        <span class="keyword">if</span> ((n &lt; <span class="number">0</span>) || (n &gt; <span class="number">20</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calculate the factorial iteratively rather than recursively.</span></span><br><span class="line">        <span class="built_in">long</span> tempResult = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            tempResult *= i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> tempResult;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title">MainClass</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="built_in">int</span> <span class="title">Main</span>(<span class="params"><span class="built_in">string</span>[] args</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// Test if input arguments were supplied.</span></span><br><span class="line">        <span class="keyword">if</span> (args.Length == <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Please enter a numeric argument.&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Usage: Factorial &lt;num&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Try to convert the input arguments to numbers. This will throw</span></span><br><span class="line">        <span class="comment">// an exception if the argument is not a number.</span></span><br><span class="line">        <span class="comment">// num = int.Parse(args[0]);</span></span><br><span class="line">        <span class="built_in">int</span> num;</span><br><span class="line">        <span class="built_in">bool</span> test = <span class="built_in">int</span>.TryParse(args[<span class="number">0</span>], <span class="keyword">out</span> num);</span><br><span class="line">        <span class="keyword">if</span> (!test)</span><br><span class="line">        &#123;</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Please enter a numeric argument.&quot;</span>);</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Usage: Factorial &lt;num&gt;&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Calculate factorial.</span></span><br><span class="line">        <span class="built_in">long</span> result = Functions.Factorial(num);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Print result.</span></span><br><span class="line">        <span class="keyword">if</span> (result == <span class="number">-1</span>)</span><br><span class="line">            Console.WriteLine(<span class="string">&quot;Input must be &gt;= 0 and &lt;= 20.&quot;</span>);</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            Console.WriteLine(<span class="string">$&quot;The Factorial of <span class="subst">&#123;num&#125;</span> is <span class="subst">&#123;result&#125;</span>.&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// If 3 is entered on command line, the</span></span><br><span class="line"><span class="comment">// output reads: The factorial of 3 is 6.</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>From the <strong>Start</strong> screen or <strong>Start</strong> menu, open a Visual Studio <strong>Developer Command Prompt</strong> window, and then navigate to the folder that contains the file that you created.</p>
</li>
<li><p>Enter the following command to compile the application.</p>
<p><code>dotnet build</code></p>
<p>If your application has no compilation errors, an executable file that’s named <em>Factorial.exe</em> is created.</p>
</li>
<li><p>Enter the following command to calculate the factorial of 3:</p>
<p><code>dotnet run -- 3</code></p>
</li>
<li><p>The command produces this output: <code>The factorial of 3 is 6.</code></p>
</li>
</ol>
<p> Note</p>
<p>When running an application in Visual Studio, you can specify command-line arguments in the <a href="https://learn.microsoft.com/en-us/visualstudio/ide/reference/debug-page-project-designer">Debug Page, Project Designer</a>.</p>
<h4 id="3-Top-level-statements"><a href="#3-Top-level-statements" class="headerlink" title="3. Top-level statements"></a>3. Top-level statements</h4>]]></content>
      <categories>
        <category>C#</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title></title>
    <url>/2024/02/22/Satellite/</url>
    <content><![CDATA[<h2 id="Communication-Approach"><a href="#Communication-Approach" class="headerlink" title="Communication Approach"></a>Communication Approach</h2><h3 id="Kepler-system"><a href="#Kepler-system" class="headerlink" title="Kepler system"></a><strong>Kepler system</strong></h3><p>Satellite communication system which provides high-capacity satellite data services for IoT and other data backhaul applications.</p>
<h3 id="S-Band-2-4-GHz-LoRa-Edge-LR1110"><a href="#S-Band-2-4-GHz-LoRa-Edge-LR1110" class="headerlink" title="S-Band 2.4 GHz, LoRa Edge LR1110"></a><strong>S-Band</strong> <strong>2.4 GHz</strong>, <strong>LoRa Edge LR1110</strong></h3><h3 id="Microwave-Inter-Satellite-Link-20–300-GHz"><a href="#Microwave-Inter-Satellite-Link-20–300-GHz" class="headerlink" title="Microwave Inter-Satellite Link (20–300 GHz)"></a>Microwave Inter-Satellite Link (20–300 GHz)</h3><p>The microwave inter-satellite link already used by Iridium Next has a frequency of 23 GHz. It is relatively mature, with high reliability and a relatively beam. </p>
<p>Cons: Low data transmission rate and low anti-interference ability</p>
<h3 id="Optical-Inter-Satellite-Link-380–790-THz"><a href="#Optical-Inter-Satellite-Link-380–790-THz" class="headerlink" title="Optical Inter-Satellite Link (380–790 THz)"></a>Optical Inter-Satellite Link (380–790 THz)</h3><p>Optical inter-satellite link which uses the laser as the carrier of information transmission between satellites.</p>
<h2 id="Jargons"><a href="#Jargons" class="headerlink" title="Jargons"></a>Jargons</h2><h3 id="Network-Calculus-Theory"><a href="#Network-Calculus-Theory" class="headerlink" title="Network Calculus Theory"></a>Network Calculus Theory</h3><h3 id="Possion-Distribution-x2F-Process"><a href="#Possion-Distribution-x2F-Process" class="headerlink" title="Possion Distribution&#x2F;Process"></a>Possion Distribution&#x2F;Process</h3><h3 id="Queueing-Theory"><a href="#Queueing-Theory" class="headerlink" title="Queueing Theory"></a>Queueing Theory</h3><h3 id="Space-Communications-Protocol-Specifications-SCPS"><a href="#Space-Communications-Protocol-Specifications-SCPS" class="headerlink" title="Space Communications Protocol Specifications (SCPS)"></a>Space Communications Protocol Specifications (SCPS)</h3><h3 id="Delay-Tolerant-Networks-DTN"><a href="#Delay-Tolerant-Networks-DTN" class="headerlink" title="Delay Tolerant Networks (DTN)"></a><a href="https://www.sciencedirect.com/topics/engineering/delay-tolerant-networks">Delay Tolerant Networks</a> (DTN)</h3>]]></content>
  </entry>
  <entry>
    <title>CyberSecurityFundemental</title>
    <url>/2023/05/11/CyberSecurityFundemental/</url>
    <content><![CDATA[]]></content>
  </entry>
  <entry>
    <title>SDN</title>
    <url>/2023/11/19/SDN/</url>
    <content><![CDATA[<h1 id="SDN-Learning"><a href="#SDN-Learning" class="headerlink" title="SDN Learning"></a>SDN Learning</h1><h2 id="SDN-x2F-VNF-Satellite-Experiment"><a href="#SDN-x2F-VNF-Satellite-Experiment" class="headerlink" title="SDN&#x2F;VNF Satellite Experiment"></a>SDN&#x2F;VNF Satellite Experiment</h2><h3 id="Environment-Set-Up"><a href="#Environment-Set-Up" class="headerlink" title="Environment Set Up"></a>Environment Set Up</h3><p>Ubuntu network bug</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ip <span class="built_in">link</span> <span class="built_in">set</span> enp0s1 up</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo dhclient enp0s1</span><br><span class="line"></span><br><span class="line">sudo ip addr add [Your-IPv4-Address]/[Subnet-Mask] dev enp0s1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo systemctl restart NetworkManager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo systemctl restart networking</span><br></pre></td></tr></table></figure>



<h4 id="Controller-OpenDaylight"><a href="#Controller-OpenDaylight" class="headerlink" title="Controller (OpenDaylight)"></a>Controller (OpenDaylight)</h4><ol>
<li>Prepare the operating system</li>
<li>Install the Java JRE</li>
<li>Set JAVA_HOME</li>
<li>Download the OpenDaylight Zip</li>
<li>Unzip OpenDaylight</li>
<li>Start OpenDaylight</li>
<li>Bonus: Where did DLUX go?</li>
</ol>
<h5 id="1-Prepare-Operating-System"><a href="#1-Prepare-Operating-System" class="headerlink" title="1. Prepare Operating System"></a>1. Prepare Operating System</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y update</span><br><span class="line">sudo apt-get -y install unzip</span><br></pre></td></tr></table></figure>

<h5 id="2-Install-the-Java-JRE"><a href="#2-Install-the-Java-JRE" class="headerlink" title="2. Install the Java JRE"></a>2. Install the Java JRE</h5><p>OpenDaylight runs on Java platform</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get -y install openjdk-11-jre</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo update-alternatives --config java</span><br></pre></td></tr></table></figure>

<p>Please select Java 11 as your default java environment</p>
<h5 id="3-Set-JAVA-HOME"><a href="#3-Set-JAVA-HOME" class="headerlink" title="3. Set JAVA_HOME"></a>3. Set JAVA_HOME</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /etc/alternatives/java</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-arm64&#x27;</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></span><br></pre></td></tr></table></figure>

<p>echo ‘export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-11-openjdk-arm64’ &gt;&gt; ~&#x2F;.bashrc</p>
<h5 id="4-Download-the-OpenDaylight-Zip-Archive"><a href="#4-Download-the-OpenDaylight-Zip-Archive" class="headerlink" title="4. Download the OpenDaylight Zip Archive"></a>4. Download the OpenDaylight Zip Archive</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">curl -XGET -O https://nexus.opendaylight.org/content/repositories/opendaylight.release/org/opendaylight/integration/karaf/0.16.1/karaf-0.16.1.zip</span><br></pre></td></tr></table></figure>



<h5 id="5-Install-OpenDaylight"><a href="#5-Install-OpenDaylight" class="headerlink" title="5. Install OpenDaylight"></a>5. Install OpenDaylight</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ unzip karaf-0.16.1.zip </span><br></pre></td></tr></table></figure>



<h5 id="6-Start-OpenDaylight"><a href="#6-Start-OpenDaylight" class="headerlink" title="6. Start OpenDaylight"></a>6. Start OpenDaylight</h5><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/karaf </span><br></pre></td></tr></table></figure>

<figure class="highlight scss"><table><tr><td class="code"><pre><span class="line">opendaylight-user<span class="keyword">@root</span>&gt;<span class="attribute">feature</span>:list</span><br></pre></td></tr></table></figure>



<h5 id="7-Bonus-What-happened-to-DLUX"><a href="#7-Bonus-What-happened-to-DLUX" class="headerlink" title="7. Bonus: What happened to DLUX?"></a>7. Bonus: What happened to DLUX?</h5><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">curl <span class="operator">-</span>O https:<span class="operator">/</span><span class="operator">/</span>nexus.opendaylight.org<span class="operator">/</span>content<span class="operator">/</span>repositories<span class="operator">/</span>opendaylight.release<span class="operator">/</span>org<span class="operator">/</span>opendaylight<span class="operator">/</span>integration<span class="operator">/</span>karaf<span class="operator">/</span><span class="number">0.8</span><span class="number">.4</span><span class="operator">/</span>karaf<span class="number">-0.8</span><span class="number">.4</span>.zip</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">unzip karaf-<span class="number">0.8</span><span class="number">.4</span>.<span class="built_in">zip</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">./bin/karaf </span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install openjdk<span class="number">-8</span>-jre</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">sudo update-alternatives --config java</span><br></pre></td></tr></table></figure>

<p>select Java 8</p>
<h3 id="RYU-controller"><a href="#RYU-controller" class="headerlink" title="RYU controller"></a>RYU controller</h3><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">ryu-manager simple_switch_13.py</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mn --custom topology.py --topo mytopo --controller=remote,ip=127.0.0.1,port=6653</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mn --topo=single,3 --mac --controller=remote,ip=127.0.0.1,port=6653 --switch ovsk,protocols=OpenFlow13</span><br></pre></td></tr></table></figure>



<p>s1 &#x3D; net.addSwitch(‘s1’, cls &#x3D; OVSKernelSwitch, dpid&#x3D; ‘0000000000000001’)</p>
<p>sh ovs-vsctl show</p>
<p>dpctl dump-flows</p>
<p>dpctl del-flows</p>
<p>dpctl add-flow in_port&#x3D;1,actions&#x3D;output:2</p>
<p>dpctl add-flow in_port&#x3D;2,actions&#x3D;output:1</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">h1 <span class="built_in">cat</span> /tmp/iperf_client_1.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">h1 <span class="built_in">cat</span> /tmp/iperf.log</span><br><span class="line"></span><br><span class="line">h1 scp /tmp/iperf_client_h1.<span class="built_in">log</span> limingwei@192.168.64.5:/home/limingwei/Desktop/mydir/tmp</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">h49 hping3 --flood --syn --rand-source h3</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /tmp/iperf*.<span class="built_in">log</span> /home/limingwei/Desktop/mydir/tmp_flooding/</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>![image-20240110101757590](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20240110101757590.png)</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mn --<span class="built_in">link</span> tc,bw=10,delay=10ms</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">h1 iperf -s</span><br><span class="line"></span><br><span class="line">h2 iperf -c 10.0.0.1 -i 1 -t 10</span><br></pre></td></tr></table></figure>



<p>Add flow rules for based l2 addresses</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=02:89:c4:04:33:36, action=1&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=3a:f4:85:86:30:c3, action=2&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=d2:5e:c6:63:ef:af, action=3&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=ff:ff:ff:ff:ff:ff, action=flood&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="SDN-course"><a href="#SDN-course" class="headerlink" title="SDN course"></a>SDN course</h2><p><strong>ToR Switch:</strong> </p>
<p>Top-of-Rack Switching (ToR) is <strong>a type of network infrastructure that uses network switches to connect servers and other devices in the same rack</strong>. This type of switching allows for faster data transfer between devices and improved performance.</p>
<p>Create a topology with three hosts:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mn --topo single,3 --mac --controller default</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ovs-ofctl dump-flows s1</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mn --topo single,3 --mac --controller remote</span><br><span class="line"></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;in_port=2,ip, nw_dst=192.168.1.0/24,action=output:3&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;in_port=3,ip, nw_dst=192.168.1.0/24,action=output:2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 arp,actions=flood</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..3&#125;; <span class="keyword">do</span> sudo ovs-ofctl add-flow s1 ip,nw_dst=10.0.0.<span class="variable">$i</span>,actions=output:<span class="variable">$i</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3</span></span><br><span class="line">h1 ifconfig |grep -i ether</span><br><span class="line">h2 ifconfig |grep -i ether</span><br><span class="line">h3 ifconfig |grep -i ether</span><br><span class="line"></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=00:00:00:00:00:01, action=1&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=00:00:00:00:00:02, action=2&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=00:00:00:00:00:03, action=3&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=ff:ff:ff:ff:ff:ff, action=flood&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Lab-4"><a href="#Lab-4" class="headerlink" title="Lab 4"></a>Lab 4</h3><h4 id="Create-the-topology"><a href="#Create-the-topology" class="headerlink" title="Create the topology"></a>Create the topology</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mn --topo=single,3 --mac --controller=remote,ip=127.0.0.1,port=6653 --switch ovsk,protocols=OpenFlow13</span><br></pre></td></tr></table></figure>

<p>specify for the ons-ofctl as well which OpenFlow version to use, for instance.</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">mininet&gt; sh sudo ovs−ofctl −O OpenFlow13 dump−flows s1</span><br><span class="line"></span><br><span class="line">sh sudo watch -n1 <span class="string">&#x27;ovs-ofctl -O OpenFlow13 dump-flows s1&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>Learning_switch.py</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event,dpset</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> MAIN_DISPATCHER, CONFIG_DISPATCHER</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet, ethernet, ether_types</span><br><span class="line"><span class="keyword">import</span> logging <span class="keyword">as</span> log</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleSwitch13</span>(app_manager.RyuApp):</span><br><span class="line">    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleSwitch13,self).__init__(*args, **kwargs)</span><br><span class="line">        log.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;%(levelname)s:%(message)s&#x27;</span>,level=log.DEBUG)</span><br><span class="line">        log.info(<span class="string">&quot;Controller is up and running&quot;</span>)</span><br><span class="line">        self.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        datapath = ev.msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        log.info(<span class="string">&quot;Switch connected with datapath ID: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(datapath.<span class="built_in">id</span>))</span><br><span class="line">        <span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line">        actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line">                                          ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line">        self.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,</span><br><span class="line">                                             actions)]</span><br><span class="line">        <span class="keyword">if</span> buffer_id:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line">                                    priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>,</span><br><span class="line">                                    instructions=inst)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line">                                    <span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line">        datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self,ev</span>):</span><br><span class="line">        msg = ev.msg</span><br><span class="line">        datapath = msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        pkt = packet.Packet(msg.data)</span><br><span class="line">        eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;PacketIn received: \n&quot;</span></span><br><span class="line">                         <span class="string">&quot;Switch: &#123;&#125;\n&quot;</span></span><br><span class="line">                         <span class="string">&quot;in_port: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(datapath.<span class="built_in">id</span>,in_port))</span><br><span class="line"></span><br><span class="line">        dst = eth.dst</span><br><span class="line">        src = eth.src</span><br><span class="line"></span><br><span class="line">        dpid = <span class="built_in">format</span>(datapath.<span class="built_in">id</span>, <span class="string">&quot;d&quot;</span>).zfill(<span class="number">16</span>)</span><br><span class="line">        self.mac_to_port.setdefault(dpid,&#123;&#125;)</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;packet in %s %s %s %s&quot;</span>, dpid, src, dst, in_port)</span><br><span class="line"></span><br><span class="line">        self.mac_to_port[dpid][src] = in_port</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> dst <span class="keyword">in</span> self.mac_to_port[dpid]:</span><br><span class="line">            out_port = self.mac_to_port[dpid][dst]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out_port = ofproto.OFPP_FLOOD</span><br><span class="line"></span><br><span class="line">        actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> out_port != ofproto.OFP_NO_BUFFER:</span><br><span class="line">            <span class="keyword">match</span> = parser.OFPMatch(in_port = in_port, eth_dst = dst, eth_src = src)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> msg.buffer_id != ofproto.OFP_NO_BUFFER:</span><br><span class="line">                self.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions, msg.buffer_id)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.add_flow(datapath,<span class="number">1</span>,<span class="keyword">match</span>,actions)</span><br><span class="line">        data = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> msg.buffer_id == ofproto.OFP_NO_BUFFER:</span><br><span class="line">            data = msg.data</span><br><span class="line">        out = parser.OFPPacketOut(datapath = datapath, buffer_id = msg.buffer_id, in_port = in_port, actions = actions, data = data)</span><br><span class="line">        datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Lab-5"><a href="#Lab-5" class="headerlink" title="Lab 5"></a>Lab 5</h3><h4 id="LLDP"><a href="#LLDP" class="headerlink" title="LLDP:"></a><strong>LLDP:</strong></h4><p>Features: Vendor independent&#x2F;agonostic</p>
<p>LLDP messages are periodically sent by <strong>switches</strong> by default. A flow rule should be installed into all switches’ flow tables to match on these specific LLDP packets and send them towards the controller as a Packet-In message.</p>
<p>Insert a matching following flow rule into each switch’s flow table:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ovs-ofctl -O Openflow13 add-flow &lt;switch_name&gt; priority=65535, dl_type=0x88cc, actions=CONTROLLER:65535</span><br></pre></td></tr></table></figure>

<p>Ryu can also do the job for us by starting our controoler application by extending the command with the following argument:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo ryu-manager learning_switch.py --observe-links</span><br></pre></td></tr></table></figure>



<h4 id="Topology-discovery"><a href="#Topology-discovery" class="headerlink" title="Topology discovery"></a><strong>Topology discovery</strong></h4><p>Ryu controller provides ryu.topology, which is a switch and link discovery module providing API calls for accessing host, switch, and link data. In order to access it, import the following libraries into our controller application.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event</span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link, get_host</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">self.topology api app = self <span class="comment"># put this into the constructor of the ryu controller</span></span><br></pre></td></tr></table></figure>

<p>Whenever we want to get the latest topology information, we can use the 3 imported functions:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># get switch list</span></span><br><span class="line">switch_list = get_switch(self.topology_api-app, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#get links and their endpoints</span></span><br><span class="line">link_list = get_link(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#get hosts if there is any</span></span><br><span class="line">hosts_list = get_host(self.topology_api_app, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>In each case, the topology.api returns lists of objects with a variable number of accessible properties:</p>
<p><strong>Link object</strong>: it describes a connection between a given pair of switches. The source and target of a link is a Port object that can be accessed by link.src and link.dst, respectively. A Port object further contains relevant information such as the datapath identifier (dpid), name of the interface (name), MAC address of that interface (hw_addr), port identifier (port_no), etc. For example, the source data path identifier of a link and the port id, where it is connected to, is accessible by link.src.dpid and link.src.port_no, respectively.</p>
<p><strong>Switch</strong> object: it contains the datapath object per second, and as many Port objects as it has.</p>
<p><strong>Host</strong> object: it contains its MAC address (host.mac), IPv4 and IPv6 addresses (host.ipv4 and host.ipv6) and a  Port object, again, describing which switch it is connected to (e.g., host.port.dpid, host.port.port_no)</p>
<h4 id="Lab-5-Task-1"><a href="#Lab-5-Task-1" class="headerlink" title="Lab 5 Task 1"></a><strong>Lab 5 Task 1</strong></h4><p>Modify the controller application (learning_switch) as follows:</p>
<ul>
<li>Create a function called update_topology_data() that prints out the topology information managed by the topology.api (prettify the output for a more comprehensive view)</li>
</ul>
<p>![image-20240214160149193](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20240214160149193.png)</p>
<ul>
<li>Each time a new switch connects to the controller, or a host is discovered call update_topoloy_data().</li>
<li>As LLDP messages are also sent to the controller and they also contain source and destination MAC addresses, modify your Packet-In handler to ignore these LLDP packets!</li>
</ul>
<p>​		Hint: To easily match on LLDP packets import the following libraries</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#for LLDP packet types</span></span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_CFM</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_LLDP</span><br></pre></td></tr></table></figure>

<ul>
<li>At least two switches need to exist in the topology in order to obtain link information from Ryu’s API.</li>
</ul>
<p><strong>Solution</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> lldp</span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event, dpset</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> MAIN_DISPATCHER, CONFIG_DISPATCHER</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event</span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link, get_host</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet, ethernet, ether_types</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_CFM</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_LLDP</span><br><span class="line"><span class="keyword">import</span> logging <span class="keyword">as</span> log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleSwitch13</span>(app_manager.RyuApp):</span><br><span class="line">    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleSwitch13, self).__init__(*args, **kwargs)</span><br><span class="line">        log.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;%(levelname)s:%(message)s&#x27;</span>, level=log.DEBUG)</span><br><span class="line">        log.info(<span class="string">&quot;Controller is up and running&quot;</span>)</span><br><span class="line">        self.topology_api_app = self</span><br><span class="line">        self.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        datapath = ev.msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        log.info(<span class="string">&quot;Switch connected with datapath ID: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(datapath.<span class="built_in">id</span>))</span><br><span class="line">        <span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line">        actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line">                                          ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line">        self.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line">        self.update_topology_data()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,</span><br><span class="line">                                             actions)]</span><br><span class="line">        <span class="keyword">if</span> buffer_id:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line">                                    priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>,</span><br><span class="line">                                    instructions=inst)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line">                                    <span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line">        datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_topology_data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># get switch list</span></span><br><span class="line">        switch_list = get_switch(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># get links and their endpoints</span></span><br><span class="line">        links_list = get_link(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># get hosts if there is any</span></span><br><span class="line">        hosts_list = get_host(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        self.logger.info(<span class="string">&quot;Switches:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> switch <span class="keyword">in</span> switch_list:</span><br><span class="line">            self.logger.info(<span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(switch.dp.<span class="built_in">id</span>))</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;\nLinks:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">            source = <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(link.src.dpid)</span><br><span class="line">            source_port = link.src.port_no</span><br><span class="line">            target = <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(link.dst.dpid)</span><br><span class="line">            target_port = link.dst.port_no</span><br><span class="line">            self.logger.info(<span class="string">&quot;&#123;&#125;(port:&#123;&#125;)&lt;----&gt;(port:&#123;&#125;)&#123;&#125;&quot;</span>.<span class="built_in">format</span>(source, source_port, target_port, target))</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;Hosts:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> hosts_list:</span><br><span class="line">            <span class="keyword">for</span> host <span class="keyword">in</span> hosts_list:</span><br><span class="line">                name = <span class="string">&quot;h&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.mac.replace(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;&#x27;</span>)[-<span class="number">6</span>:])  <span class="comment"># Using part of MAC for host identifier</span></span><br><span class="line">                self.logger.info(<span class="string">&quot;&#123;&#125;:\n\tip4:&#123;&#125;&quot;</span></span><br><span class="line">                                 <span class="string">&quot;\n\tip6:&#123;&#125;&quot;</span></span><br><span class="line">                                 <span class="string">&quot;\n\tmac=&#123;&#125;&quot;</span>  <span class="comment"># Added equal sign here</span></span><br><span class="line">                                 <span class="string">&quot;\n\tconnected to:s&#123;&#125;&quot;</span></span><br><span class="line">                                 <span class="string">&quot;\n\tport_no:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(name,</span><br><span class="line">                                                         host.ipv4 <span class="keyword">if</span> host.ipv4 <span class="keyword">else</span> <span class="string">&quot;None&quot;</span>,</span><br><span class="line">                                                         host.ipv6 <span class="keyword">if</span> host.ipv6 <span class="keyword">else</span> <span class="string">&quot;None&quot;</span>,</span><br><span class="line">                                                         host.mac,</span><br><span class="line">                                                         host.port.dpid,</span><br><span class="line">                                                         host.port.port_no))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        msg = ev.msg</span><br><span class="line">        datapath = msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        pkt = packet.Packet(msg.data)</span><br><span class="line">        eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> eth.ethertype <span class="keyword">in</span> (ETH_TYPE_LLDP, ETH_TYPE_CFM):</span><br><span class="line">            <span class="comment"># Ignore LLDP and CFM packets but update the topology</span></span><br><span class="line">            self.update_topology_data()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;PacketIn received: \n&quot;</span></span><br><span class="line">                     <span class="string">&quot;Switch: &#123;&#125;\n&quot;</span></span><br><span class="line">                     <span class="string">&quot;in_port: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(datapath.<span class="built_in">id</span>, in_port))</span><br><span class="line"></span><br><span class="line">        dst = eth.dst</span><br><span class="line">        src = eth.src</span><br><span class="line"></span><br><span class="line">        dpid = <span class="built_in">format</span>(datapath.<span class="built_in">id</span>, <span class="string">&quot;d&quot;</span>).zfill(<span class="number">16</span>)</span><br><span class="line">        self.mac_to_port.setdefault(dpid, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;packet in %s %s %s %s&quot;</span>, dpid, src, dst, in_port)</span><br><span class="line"></span><br><span class="line">        self.mac_to_port[dpid][src] = in_port</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> dst <span class="keyword">in</span> self.mac_to_port[dpid]:</span><br><span class="line">            out_port = self.mac_to_port[dpid][dst]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out_port = ofproto.OFPP_FLOOD</span><br><span class="line"></span><br><span class="line">        actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> out_port != ofproto.OFP_NO_BUFFER:</span><br><span class="line">            <span class="keyword">match</span> = parser.OFPMatch(in_port=in_port, eth_dst=dst, eth_src=src)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> msg.buffer_id != ofproto.OFP_NO_BUFFER:</span><br><span class="line">                self.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions, msg.buffer_id)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions)</span><br><span class="line">        data = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> msg.buffer_id == ofproto.OFP_NO_BUFFER:</span><br><span class="line">            data = msg.data</span><br><span class="line">        out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id, in_port=in_port, actions=actions, data=data)</span><br><span class="line">        datapath.send_msg(out)</span><br><span class="line">        self.update_topology_data()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>Call this function in the connection and the Packet-In handlers.</p>
</li>
<li><p>In our Packet-In handler we should only execute the learning switch-related code when the packets are not LLDP packets:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> pkt_eth.ethertype <span class="keyword">in</span> (ETH_TYPE_LLDP,ETH_TYPE_CFM):</span><br><span class="line">  <span class="comment"># LLDP packets will not be processed, we just update the topology</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Find-paths-run-algorithms-optimize-routing"><a href="#Find-paths-run-algorithms-optimize-routing" class="headerlink" title="Find paths, run algorithms, optimize routing"></a>Find paths, run algorithms, optimize routing</h4><p>By means of the topology.api, we have become able to query topology-related information, such as switches, hosts and links among them. In order to run graph algorithms, e.g., find shortest paths among nodes, recalculate path in case of failure, we need to create a network graph. The good thing about graphs is that the concepts and terminology are naturally intuitive, basically graphs describe structures that map relations between objects. Obiects are called nodes and the connection among them are termed as edges. A graph can be directed or undirected based on the orientation of the edges. Making an edge undirected also implies that is is bi-directional, i.e., A &lt;-&gt; B &#x3D; B &lt;-&gt; A. If a graph is directed, then the order and direction of edges do matter, ie., A -&gt; B !&#x3D;  B -&gt; A.</p>
<p>The edegs can also have weights indicating, for instance, the distance between two nodes.</p>
<p><strong>NetworkX - Basics</strong></p>
<p>NetworkX is the most popular Python library to create, manipulate and analyse graphs. Some of its features are:</p>
<ul>
<li>Data structures for graphs, digraphs, and multigraphs</li>
<li>Many standard graph algorithms</li>
<li>Nodes can be “anything” (e.g., text, images, XML records)</li>
<li>Edges can hold arbitrary data (e.g., weights, time-series)</li>
<li>Additional benefits from Python include fast prototyping, easy to teach, and multi-platform</li>
</ul>
<p>The provided Mininet VM already has networks installed, however in order to reinstall it issue the following command:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ sudo pip install networkx</span><br></pre></td></tr></table></figure>

<p>Exploring NetworkX library and creating a simple Graph object can be done as follows:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line">G = nx.Graph()</span><br></pre></td></tr></table></figure>

<p>In order to add 2 nodes (identified by Integer numbers) to the graph and connect them with an edge, try the following:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">G.add_node(<span class="number">1</span>)</span><br><span class="line">G.add_node(<span class="number">2</span>)</span><br><span class="line">G.add_edge(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>The following non-comprehensive list summarizeds some fundamental function calls:</p>
<ul>
<li>G.add_nodes_from(list_of_nodes): Add a list of nodes to the graph</li>
<li>G.remove_node(node): Remove node <strong>node</strong> from the graph</li>
<li>G.node[node]: Get node <strong>node</strong> from the graph</li>
<li>G.add_edges_from(lists_of_edges): Add a list of edges (defined by source-destination pairs) to the graph</li>
<li>G.remove_edge(edge): Remove edge <strong>edge</strong> from the graph</li>
<li>G.edge[src] [dst]: Get an edge between nodes src and dst from the graph</li>
</ul>
<p>You might notice that nodes and edges are not spefified as NetworkX objects. This leaves you free to use meaningful items as nodes and edges. The most common choices are numbers or strings, but a node can be any hashable object (except None). Furthermore, we can also add attributes to graphs, nodes and edges, such as weights, labels, colours or whatever Python object you like. For instance, we can define bandwidth and latecncy attributes for the links:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">G.add_edge(<span class="number">1</span>,<span class="number">2</span>, bandwidth=<span class="number">25</span>,latency=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>NetworkX - Algorithms</p>
<p>Network provides many graph algorithms, e.g., connectivity, cliques, clustering, independent set, average node&#x2F;edge degree, however from all of them we will use the simple and shortest path algorithms. The nx. shortest-path (G, src, dst) function computes the shortest path in graph G between source node src and destination node dst. Additionally, we can set a forth parameter weight, where we can indicate to use that edge attribute as the edge weight. The following example prints out the shortest path as a list from node 1 towards node 3 in graph G.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(nx.shortest_path(G, source = <span class="number">0</span>, target = <span class="number">4</span>))</span><br></pre></td></tr></table></figure>



<h2 id="Lab-6"><a href="#Lab-6" class="headerlink" title="Lab 6"></a>Lab 6</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo mn --custom my_topo.py --topo mytopo --controller=remote,ip=127.0.0.1,port=6653 --switch ovsk,protocols=OpenFlow13</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> CONFIG_DISPATCHER, MAIN_DISPATCHER</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> ethernet</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> ether_types</span><br><span class="line"><span class="keyword">import</span> logging <span class="keyword">as</span> log</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_CFM</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_LLDP</span><br><span class="line"></span><br><span class="line"><span class="comment"># Graph manipulation library</span></span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fetch topology information</span></span><br><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event</span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link, get_host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleSwitch13</span>(app_manager.RyuApp):</span><br><span class="line">    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleSwitch13, self).__init__(*args, **kwargs)</span><br><span class="line">        self.mac_to_port = &#123;&#125;</span><br><span class="line">        self.G = nx.Graph()</span><br><span class="line">        self.shortest_paths = <span class="built_in">dict</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># necessary to enable the topology monitoring functionality</span></span><br><span class="line">        self.topology_api_app = self</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        datapath = ev.msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line">        actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line">                                          ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line">        self.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line">        self.update_topology_data()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,</span><br><span class="line">                                             actions)]</span><br><span class="line">        <span class="keyword">if</span> buffer_id:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line">                                    priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>,</span><br><span class="line">                                    instructions=inst)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line">                                    <span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line">        datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        <span class="comment"># If you hit this you might want to increase</span></span><br><span class="line">        <span class="comment"># the &quot;miss_send_length&quot; of your switch</span></span><br><span class="line">        <span class="keyword">if</span> ev.msg.msg_len &lt; ev.msg.total_len:</span><br><span class="line">            self.logger.debug(<span class="string">&quot;packet truncated: only %s of %s bytes&quot;</span>,</span><br><span class="line">                              ev.msg.msg_len, ev.msg.total_len)</span><br><span class="line">        msg = ev.msg</span><br><span class="line">        datapath = msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        pkt = packet.Packet(msg.data)</span><br><span class="line">        eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> eth.ethertype <span class="keyword">in</span> (ETH_TYPE_LLDP, ETH_TYPE_CFM):</span><br><span class="line">            <span class="comment"># ignore lldp packet</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        self.update_topology_data()</span><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_topology_data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Get lists for switches, links, and hosts</span></span><br><span class="line">        switch_list = get_switch(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        links_list = get_link(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        hosts_list = get_host(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        self.logger.info(<span class="string">&quot;Switches:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> switch <span class="keyword">in</span> switch_list:</span><br><span class="line">            <span class="built_in">print</span>(switch)</span><br><span class="line">            switch_name=<span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(switch.dp.<span class="built_in">id</span>)</span><br><span class="line">            self.logger.info(switch_name)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">            <span class="comment"># add switches to graph with preset attribute names</span></span><br><span class="line">            <span class="comment"># define a recent_port data dictionary as an attribute for the</span></span><br><span class="line">            <span class="comment"># swithes - it will be updated in each case</span></span><br><span class="line">            <span class="comment"># a new port comes up</span></span><br><span class="line">            self.G.add_node(</span><br><span class="line">                switch_name,</span><br><span class="line">                name=switch_name,</span><br><span class="line">                dp=switch.dp,</span><br><span class="line">                port=switch.ports</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">        self.logger.info(<span class="string">&quot;\nLinks:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">            <span class="built_in">print</span>(link)</span><br><span class="line">            source = <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(link.src.dpid)</span><br><span class="line">            source_port = link.src.port_no</span><br><span class="line">            target = <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(link.dst.dpid)</span><br><span class="line">            target_port = link.dst.port_no</span><br><span class="line">            self.logger.info(<span class="string">&quot;&#123;&#125;(port:&#123;&#125;) &lt;---&gt; (port:&#123;&#125;)&#123;&#125;&quot;</span>.<span class="built_in">format</span>(source,source_port,target_port,target))</span><br><span class="line">            <span class="comment"># networkx links in Graph() are not differentiated by source and destination, so a link and its data become</span></span><br><span class="line">            <span class="comment"># updated when add_edge is called with the source and destination swapped</span></span><br><span class="line">            self.G.add_edge(source, target,</span><br><span class="line">                                  src_dpid=source, src_port=link.src.port_no,</span><br><span class="line">                                  dst_dpid=target, dst_port=link.dst.port_no)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;Hosts:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> hosts_list:</span><br><span class="line">            <span class="keyword">for</span> host <span class="keyword">in</span> hosts_list:</span><br><span class="line">                <span class="comment"># assemble name according to mac</span></span><br><span class="line">                host_name=<span class="string">&quot;h&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.mac.split(<span class="string">&quot;:&quot;</span>)[<span class="number">5</span>][<span class="number">1</span>])</span><br><span class="line">                <span class="built_in">print</span>(host_name)</span><br><span class="line">                last_byte_hex = host.mac.split(<span class="string">&quot;:&quot;</span>)[<span class="number">5</span>]</span><br><span class="line">                last_byte_int = <span class="built_in">int</span>(last_byte_hex, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> last_byte_int == <span class="number">0</span>:</span><br><span class="line">                  last_byte_int = <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> last_byte_int &gt; <span class="number">254</span>:</span><br><span class="line">                  last_byte_int = <span class="number">254</span></span><br><span class="line"></span><br><span class="line">                host.ipv4 = <span class="string">&quot;10.0.0.&#123;&#125;&quot;</span>.<span class="built_in">format</span>(last_byte_int)</span><br><span class="line">                self.logger.info(<span class="string">&quot;&#123;&#125;:\n\tip4:&#123;&#125;&quot;</span></span><br><span class="line">                        <span class="string">&quot;\n\tip6:&#123;&#125;&quot;</span></span><br><span class="line">                        <span class="string">&quot;\n\tmac:&#123;&#125;&quot;</span></span><br><span class="line">                        <span class="string">&quot;\n\tconnected to:s&#123;&#125;&quot;</span></span><br><span class="line">                        <span class="string">&quot;\n\tport_no:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">                               host_name,</span><br><span class="line">                               host.ipv4,</span><br><span class="line">                               host.ipv6,</span><br><span class="line">                               host.mac,</span><br><span class="line">                               host.port.dpid,</span><br><span class="line">                               host.port.port_no</span><br><span class="line">                           )</span><br><span class="line">                       )</span><br><span class="line">            </span><br><span class="line">                </span><br><span class="line">                self.G.add_node(</span><br><span class="line">                                host_name,</span><br><span class="line">                                name=host_name,</span><br><span class="line">                                ipv4=host.ipv4,</span><br><span class="line">                                ipv6=host.ipv6,</span><br><span class="line">                                mac=host.mac,</span><br><span class="line">                                connected_to=<span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.port.dpid),</span><br><span class="line">                                port_no=host.port.port_no)</span><br><span class="line">                <span class="comment"># add corresponding links to the graph</span></span><br><span class="line">                self.G.add_edge(host_name,</span><br><span class="line">                                <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.port.dpid),</span><br><span class="line">                                dst_port=host.port.port_no,</span><br><span class="line">                                dst_dpid=<span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.port.dpid))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">                </span><br><span class="line">        <span class="comment"># update shortest paths</span></span><br><span class="line">        self.calculate_all_pair_shortest_paths()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Shortest Paths:\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.shortest_paths))</span><br><span class="line">        self.install_shortest_paths_flow_rules()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_shortest_paths</span>(<span class="params">self,src,dst</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        This function returns all shortest paths between the given source and destination node</span></span><br><span class="line"><span class="string">        :param src: String - the source node&#x27;s name</span></span><br><span class="line"><span class="string">        :param dst: String - the destination node&#x27;s name</span></span><br><span class="line"><span class="string">        :return: list of lists</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> src <span class="keyword">not</span> <span class="keyword">in</span> self.G.nodes() <span class="keyword">or</span> dst <span class="keyword">not</span> <span class="keyword">in</span> self.G.nodes():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        paths = <span class="built_in">list</span>()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            all_sp = nx.all_shortest_paths(self.G, src, dst)</span><br><span class="line">            <span class="keyword">for</span> path <span class="keyword">in</span> all_sp:</span><br><span class="line">                paths.append(path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> nx.NetworkXNoPath:  <span class="comment"># no path between src and dst</span></span><br><span class="line">            log.info(<span class="string">&quot;No path between &#123;&#125; and &#123;&#125;&quot;</span>.<span class="built_in">format</span>(src, dst))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> paths</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_all_pair_shortest_paths</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        This function calculates all shortest paths for all source and destinations</span></span><br><span class="line"><span class="string">        Note: NetworkX also have similar function (all_pairs_shortest_path(G[, cutoff])), </span></span><br><span class="line"><span class="string">        however that only gives one shortest path for a given (source,destination) pair</span></span><br><span class="line"><span class="string">        :return: dictionary of dictionary of list of lists, e.g., h1:&#123;h2:[[h1,s1,h2],[h1,s2,h2]]&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        all_paths = <span class="built_in">dict</span>()</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> self.G.nodes():</span><br><span class="line">            <span class="keyword">if</span> n.startswith(<span class="string">&#x27;h&#x27;</span>): <span class="comment">#only hosts are relevant</span></span><br><span class="line">                all_paths[n] = <span class="built_in">dict</span>()</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> self.G.nodes():</span><br><span class="line">                    <span class="keyword">if</span> m.startswith(<span class="string">&#x27;h&#x27;</span>):</span><br><span class="line">                        <span class="keyword">if</span> n == m:</span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                        all_paths[n][m] = self.calculate_shortest_paths(n, m)</span><br><span class="line"></span><br><span class="line">        self.shortest_paths = all_paths</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">install_flow_rule_for_chain_link</span>(<span class="params">self, chain_link, chain_prev, chain_next, source_ip, destination_ip</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        This function installs matching flow rules on source_ip and destination_ip in switch</span></span><br><span class="line"><span class="string">        chain_link and outputs packets on ports that are connected to its upstream (chain_prev)</span></span><br><span class="line"><span class="string">        and downstream (chain_next) nodes, respectively.</span></span><br><span class="line"><span class="string">        According to the chain_prev and chain_next, it gets the link/port number information</span></span><br><span class="line"><span class="string">        from the graph that stores them</span></span><br><span class="line"><span class="string">        :param chain_link: String - the name of the chain_link</span></span><br><span class="line"><span class="string">        :param chain_prev: String - the name of the previous switch</span></span><br><span class="line"><span class="string">        :param chain_next: String - the name of the next switch</span></span><br><span class="line"><span class="string">        :param source_ip: tuple(String,String) - source host IP address and netmask for the upstream</span></span><br><span class="line"><span class="string">        :param destination_ip: tuple(String,String) - the destination IP address and netmask for the downstream</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        datapath = self.G.nodes[chain_link][<span class="string">&#x27;dp&#x27;</span>]</span><br><span class="line">        ofp = datapath.ofproto</span><br><span class="line">        ofp_parser = datapath.ofproto_parser</span><br><span class="line">        match_source_ip = ofp_parser.OFPMatch(eth_type=<span class="number">0x0800</span>, ipv4_dst=source_ip)</span><br><span class="line">        match_destination_ip = ofp_parser.OFPMatch(eth_type=<span class="number">0x0800</span>, ipv4_dst=destination_ip)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- upstream</span></span><br><span class="line">        <span class="comment"># get edge_data</span></span><br><span class="line">        edge = self.G[chain_link][chain_prev]</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;upstream edge: &quot;</span>, edge)</span><br><span class="line">        <span class="keyword">if</span> edge[<span class="string">&#x27;dst_dpid&#x27;</span>] == chain_link:</span><br><span class="line">            <span class="comment"># if prev is a host, then it is always the case that edge[&#x27;dst_port&#x27;] stores the port number</span></span><br><span class="line">            out_port = edge[<span class="string">&#x27;dst_port&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># if prev is a switch, then it might be the src_dpid</span></span><br><span class="line">            out_port = edge[<span class="string">&#x27;src_port&#x27;</span>]</span><br><span class="line">        actions = [ofp_parser.OFPActionOutput(out_port, <span class="number">0</span>)]</span><br><span class="line">        inst = [ofp_parser.OFPInstructionActions(ofp.OFPIT_APPLY_ACTIONS, actions)]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;install flow rule for SIP &#123;&#125; - DIP &#123;&#125; at &#123;&#125; to forward packet on port &#123;&#125;&quot;</span>.</span><br><span class="line">                 <span class="built_in">format</span>(source_ip, destination_ip, chain_link, out_port))</span><br><span class="line">        self.send_flow_mod(datapath, <span class="literal">None</span>, <span class="keyword">match</span>=match_source_ip, inst=inst)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- downstream</span></span><br><span class="line">        <span class="comment"># get edge_data</span></span><br><span class="line">        edge = self.G[chain_link][chain_next]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;downstream edge: &quot;</span>, edge)</span><br><span class="line">        <span class="keyword">if</span> edge[<span class="string">&#x27;dst_dpid&#x27;</span>] == chain_link:</span><br><span class="line">            <span class="comment"># if next is a host, then it is always the case that edge[&#x27;dst_port&#x27;] stores the port number</span></span><br><span class="line">            out_port = edge[<span class="string">&#x27;dst_port&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># if next is a switch, then it might be the src_dpid</span></span><br><span class="line">            out_port = edge[<span class="string">&#x27;src_port&#x27;</span>]</span><br><span class="line">        actions = [ofp_parser.OFPActionOutput(out_port, <span class="number">0</span>)]</span><br><span class="line">        inst = [ofp_parser.OFPInstructionActions(ofp.OFPIT_APPLY_ACTIONS, actions)]</span><br><span class="line">        log.info(<span class="string">&quot;install flow rule for SIP &#123;&#125; - DIP &#123;&#125; at &#123;&#125; to forward packet on port &#123;&#125;&quot;</span>.</span><br><span class="line">                 <span class="built_in">format</span>(source_ip, destination_ip, chain_link, out_port))</span><br><span class="line">        self.send_flow_mod(datapath, <span class="literal">None</span>, <span class="keyword">match</span>=match_destination_ip, inst=inst)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">install_shortest_paths_flow_rules</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        This function will install flow rules according to the shortest paths</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        paths = self.shortest_paths</span><br><span class="line">        <span class="comment"># paths looks like &#123;h1:&#123;h2:[[path1],[path2]]&#125;&#125; &lt;- EXAMPLE</span></span><br><span class="line">        <span class="keyword">if</span> paths:</span><br><span class="line">            <span class="keyword">for</span> source <span class="keyword">in</span> paths:  <span class="comment"># source = h1</span></span><br><span class="line">                source_host = self.G.nodes[source]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Source host: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(source_host))</span><br><span class="line">                source_ip = (source_host[<span class="string">&#x27;ipv4&#x27;</span>], <span class="string">&#x27;255.255.255.255&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Source ip: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(source_ip))</span><br><span class="line"></span><br><span class="line">                <span class="comment"># self.log.info(paths[source])  # paths[source] = &#123;h2: [[path1],[path2]]</span></span><br><span class="line">                <span class="keyword">for</span> p <span class="keyword">in</span> paths[source]:  <span class="comment"># p = h2</span></span><br><span class="line">                    destination_host = self.G.nodes[p]</span><br><span class="line">                    destination_ip = (destination_host[<span class="string">&#x27;ipv4&#x27;</span>], <span class="string">&#x27;255.255.255.255&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> paths[source][p]:</span><br><span class="line">                        <span class="keyword">for</span> path_num, j <span class="keyword">in</span> <span class="built_in">enumerate</span>(</span><br><span class="line">                                paths[source][p]):  <span class="comment"># paths[source][p] = [[path1],[path2]], j = one path from paths</span></span><br><span class="line">                            <span class="comment"># install the first rule always!</span></span><br><span class="line">                            individual_path = j</span><br><span class="line">                            <span class="keyword">if</span> individual_path:</span><br><span class="line">                                <span class="keyword">for</span> num, sw <span class="keyword">in</span> <span class="built_in">enumerate</span>(individual_path):</span><br><span class="line">                                    <span class="comment"># print sw</span></span><br><span class="line">                                    <span class="keyword">if</span> sw.startswith(<span class="string">&#x27;h&#x27;</span>):</span><br><span class="line">                                        <span class="comment"># it&#x27;s a host, skip (this will also prevent running out of indexes in both direction (see below))</span></span><br><span class="line">                                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                                    prev = individual_path[num - <span class="number">1</span>]</span><br><span class="line">                                    current = individual_path[num]</span><br><span class="line">                                    <span class="built_in">next</span> = individual_path[num + <span class="number">1</span>]</span><br><span class="line">                                    self.install_flow_rule_for_chain_link(current, prev, <span class="built_in">next</span>, source_ip, destination_ip)</span><br><span class="line">                                    <span class="comment"># break</span></span><br><span class="line">                                    </span><br><span class="line">                                    </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_flow_mod</span>(<span class="params">self, datapath, msg, **args</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Sending a flow_mod to the given switch</span></span><br><span class="line"><span class="string">        :param datapath: Datapath - datapath of the switch</span></span><br><span class="line"><span class="string">        :param msg: PacketIn message</span></span><br><span class="line"><span class="string">        :param args: cookie=0, table=0, cookie_mask=0,idle_timeout=0,hard_timeout=0,priority=100,buffer_id=OFP_NO_BUFFER,</span></span><br><span class="line"><span class="string">                    mod_type= OFPFC_ADD, match=OFPMatch(in_port=1,broadcast_eth_dst),</span></span><br><span class="line"><span class="string">                    inst=OFPInstructionActions(apply action,OFPActionOutput(2)),</span></span><br><span class="line"><span class="string">        :return: nothing</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        ofp = datapath.ofproto</span><br><span class="line">        ofp_parser = datapath.ofproto_parser</span><br><span class="line">        table_id = args.get(<span class="string">&#x27;table&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">        cookie = args.get(<span class="string">&#x27;cookie&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        cookie_mask = args.get(<span class="string">&#x27;cookie_mask&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">        idle_timeout = args.get(<span class="string">&#x27;idle_timeout&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        hard_timeout = args.get(<span class="string">&#x27;hard_timeout&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        priority = args.get(<span class="string">&#x27;priority&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">if</span> msg:</span><br><span class="line">            buffer_id = args.get(<span class="string">&#x27;buffer_id&#x27;</span>, msg.buffer_id)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            buffer_id=ofp.OFP_NO_BUFFER</span><br><span class="line"></span><br><span class="line">        mod_type = args.get(<span class="string">&#x27;mod_type&#x27;</span>, ofp.OFPFC_ADD)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> = args.get(<span class="string">&#x27;match&#x27;</span>,ofp_parser.OFPMatch(in_port=<span class="number">1</span>, eth_dst=<span class="string">&#x27;ff:ff:ff:ff:ff:ff&#x27;</span>))</span><br><span class="line">        inst = args.get(<span class="string">&#x27;inst&#x27;</span>,</span><br><span class="line">                        [ofp_parser.OFPInstructionActions(</span><br><span class="line">                                ofp.OFPIT_APPLY_ACTIONS,</span><br><span class="line">                                [ofp_parser.OFPActionOutput(<span class="number">2</span>)])])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        flowmod = ofp_parser.OFPFlowMod(datapath, cookie, cookie_mask,</span><br><span class="line">                                    table_id, mod_type,</span><br><span class="line">                                    idle_timeout, hard_timeout,</span><br><span class="line">                                    priority, buffer_id,</span><br><span class="line">                                    ofp.OFPP_ANY, ofp.OFPG_ANY,</span><br><span class="line">                                    ofp.OFPFF_SEND_FLOW_REM,</span><br><span class="line">                                    <span class="keyword">match</span>, inst)</span><br><span class="line"></span><br><span class="line"><span class="comment">#        log.info(&quot;Sending flowmod:\n &#123;&#125;&quot;.format(flowmod))</span></span><br><span class="line">        datapath.send_msg(flowmod)</span><br></pre></td></tr></table></figure>



<h2 id="Lab-7"><a href="#Lab-7" class="headerlink" title="Lab 7"></a>Lab 7</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">python tcp_exp.py -b 1000 -d 7.5ms</span><br><span class="line"></span><br><span class="line">mininet&gt; xterm h1 h2</span><br><span class="line"></span><br><span class="line">h2&gt; iperf -s &amp;</span><br><span class="line"></span><br><span class="line">mininet&gt; h2 wireshark</span><br><span class="line"></span><br><span class="line">h1&gt; iperf -c 10.0.0.2 -i 1 -n 1M</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>Tech</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title>data analyst</title>
    <url>/2023/04/18/data-analyst/</url>
    <content><![CDATA[<ul>
<li>Have completed an undergraduate degree to a (2.1 minimum) with a Mathematical or Scientific background</li>
<li>Knowledge in SQL or Power BI</li>
<li>Strong analytical and numerical skills</li>
<li>Experience preparing, consolidating and normalising data :ETL processes</li>
<li>Experience &#x2F; knowledge of data visualisation and dashboard tools e.g. Qlikview, Tableau or Power BI</li>
<li>Strong communication skills to work comfortable with all levels of users</li>
<li>Be within commuting distance to Croydon</li>
</ul>
]]></content>
      <categories>
        <category>Data Engineering</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title>DSA</title>
    <url>/2023/04/25/DSA/</url>
    <content><![CDATA[<h1 id="DSA"><a href="#DSA" class="headerlink" title="DSA"></a>DSA</h1><h2 id="Concepts"><a href="#Concepts" class="headerlink" title="Concepts"></a>Concepts</h2><h3 id="Time-complexity"><a href="#Time-complexity" class="headerlink" title="Time complexity:"></a>Time complexity:</h3><p>This paper analyzes from the following five points:</p>
<ul>
<li>What is time complexity anyway</li>
<li>What’s a big O</li>
<li>Differences in data sizes</li>
<li>Simplification of complex expressions</li>
<li>What is the base of log in -O (log n)?</li>
</ul>
<h4 id="究竟什么是时间复杂度"><a href="#究竟什么是时间复杂度" class="headerlink" title="究竟什么是时间复杂度"></a>究竟什么是时间复杂度</h4><p><strong>时间复杂度是一个函数，它定性描述该算法的运行时间</strong>。</p>
<p>我们在软件开发中，时间复杂度就是用来方便开发者估算出程序运行的答题时间。</p>
<p>那么该如何估计程序运行时间呢，通常会估算算法的操作单元数量来代表程序消耗的时间，这里默认CPU的每个单元运行消耗的时间都是相同的。</p>
<p>假设算法的问题规模为n，那么操作单元数量便用函数f(n)来表示，随着数据规模n的增大，算法执行时间的增长率和f(n)的增长率相同，这称作为算法的渐近时间复杂度，简称时间复杂度，记为 O(f(n))。</p>
<h4 id="什么是大O"><a href="#什么是大O" class="headerlink" title="什么是大O"></a>什么是大O</h4><p>这里的大O是指什么呢，说到时间复杂度，<strong>大家都知道O(n)，O(n^2)，却说不清什么是大O</strong>。</p>
<p>算法导论给出的解释：<strong>大O用来表示上界的</strong>，当用它作为算法的最坏情况运行时间的上界，就是对任意数据输入的运行时间的上界。</p>
<p>同样算法导论给出了例子：拿插入排序来说，插入排序的时间复杂度我们都说是O(n^2) 。</p>
<p>输入数据的形式对程序运算时间是有很大影响的，在数据本来有序的情况下时间复杂度是O(n)，但如果数据是逆序的话，插入排序的时间复杂度就是O(n^2)，也就对于所有输入情况来说，最坏是O(n^2) 的时间复杂度，所以称插入排序的时间复杂度为O(n^2)。</p>
<p>同样的同理再看一下快速排序，都知道快速排序是O(nlogn)，但是当数据已经有序情况下，快速排序的时间复杂度是O(n^2) 的，**所以严格从大O的定义来讲，快速排序的时间复杂度应该是O(n^2)**。</p>
<p><strong>但是我们依然说快速排序是O(nlogn)的时间复杂度，这个就是业内的一个默认规定，这里说的O代表的就是一般情况，而不是严格的上界</strong>。如图所示： <img src="/../images/20200728185745611-20230310123844306.png" alt="时间复杂度4，一般情况下的时间复杂度"></p>
<p>我们主要关心的还是一般情况下的数据形式。</p>
<p><strong>面试中说道算法的时间复杂度是多少指的都是一般情况</strong>。但是如果面试官和我们深入探讨一个算法的实现以及性能的时候，就要时刻想着数据用例的不一样，时间复杂度也是不同的，这一点是一定要注意的。</p>
<h4 id="不同数据规模的差异"><a href="#不同数据规模的差异" class="headerlink" title="#不同数据规模的差异"></a><a href="https://programmercarl.com/%E5%89%8D%E5%BA%8F/%E5%85%B3%E4%BA%8E%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%EF%BC%8C%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C%EF%BC%81.html#%E4%B8%8D%E5%90%8C%E6%95%B0%E6%8D%AE%E8%A7%84%E6%A8%A1%E7%9A%84%E5%B7%AE%E5%BC%82">#</a>不同数据规模的差异</h4><p>如下图中可以看出不同算法的时间复杂度在不同数据输入规模下的差异。</p>
<p><img src="/../images/20200728191447384-20230310124015324.png" alt="时间复杂度，不同数据规模的差异"></p>
<p>在决定使用哪些算法的时候，不是时间复杂越低的越好（因为简化后的时间复杂度忽略了常数项等等），要考虑数据规模，如果数据规模很小甚至可以用O(n^2)的算法比O(n)的更合适（在有常数项的时候）。</p>
<p>就像上图中 O(5n^2) 和 O(100n) 在n为20之前 很明显 O(5n^2)是更优的，所花费的时间也是最少的。</p>
<p>那为什么在计算时间复杂度的时候要忽略常数项系数呢，也就说O(100n) 就是O(n)的时间复杂度，O(5n^2) 就是O(n^2)的时间复杂度，而且要默认O(n) 优于O(n^2) 呢 ？</p>
<p>这里就又涉及到大O的定义，<strong>因为大O就是数据量级突破一个点且数据量级非常大的情况下所表现出的时间复杂度，这个数据量也就是常数项系数已经不起决定性作用的数据量</strong>。</p>
<p>例如上图中20就是那个点，n只要大于20 常数项系数已经不起决定性作用了。</p>
<p><strong>所以我们说的时间复杂度都是省略常数项系数的，是因为一般情况下都是默认数据规模足够的大，基于这样的事实，给出的算法时间复杂的的一个排行如下所示</strong>：</p>
<p>O(1)常数阶 &lt; O(logn)对数阶 &lt; O(n)线性阶 &lt; O(nlogn)线性对数阶 &lt; O(n^2)平方阶 &lt; O(n^3)立方阶 &lt; O(2^n)指数阶</p>
<p>但是也要注意大常数，如果这个常数非常大，例如10^7 ，10^9 ，那么常数就是不得不考虑的因素了。</p>
<h4 id="复杂表达式的化简"><a href="#复杂表达式的化简" class="headerlink" title="#复杂表达式的化简"></a><a href="https://programmercarl.com/%E5%89%8D%E5%BA%8F/%E5%85%B3%E4%BA%8E%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%EF%BC%8C%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C%EF%BC%81.html#%E5%A4%8D%E6%9D%82%E8%A1%A8%E8%BE%BE%E5%BC%8F%E7%9A%84%E5%8C%96%E7%AE%80">#</a>复杂表达式的化简</h4><p>有时候我们去计算时间复杂度的时候发现不是一个简单的O(n) 或者O(n^2)， 而是一个复杂的表达式，例如：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">O(2*n^2 + 10*n + 1000)</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>那这里如何描述这个算法的时间复杂度呢，一种方法就是简化法。</p>
<p>去掉运行时间中的加法常数项 （因为常数项并不会因为n的增大而增加计算机的操作次数）。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">O(2*n^2 + 10*n)</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>去掉常数系数（上文中已经详细讲过为什么可以去掉常数项的原因）。</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">O(n^2 + n)</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>只保留保留最高项，去掉数量级小一级的n （因为n^2 的数据规模远大于n），最终简化为：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">O(n^2)</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>如果这一步理解有困难，那也可以做提取n的操作，变成O(n(n+1)) ，省略加法常数项后也就别变成了：</p>
<figure class="highlight text"><table><tr><td class="code"><pre><span class="line">O(n^2)</span><br></pre></td></tr></table></figure>

<p>1</p>
<p>所以最后我们说：这个算法的算法时间复杂度是O(n^2) 。</p>
<p>也可以用另一种简化的思路，其实当n大于40的时候， 这个复杂度会恒小于O(3 × n^2)， O(2 × n^2 + 10 × n + 1000) &lt; O(3 × n^2)，所以说最后省略掉常数项系数最终时间复杂度也是O(n^2)。</p>
<h4 id="O-logn-中的log是以什么为底？"><a href="#O-logn-中的log是以什么为底？" class="headerlink" title="#O(logn)中的log是以什么为底？"></a><a href="https://programmercarl.com/%E5%89%8D%E5%BA%8F/%E5%85%B3%E4%BA%8E%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%EF%BC%8C%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C%EF%BC%81.html#o-logn-%E4%B8%AD%E7%9A%84log%E6%98%AF%E4%BB%A5%E4%BB%80%E4%B9%88%E4%B8%BA%E5%BA%95">#</a>O(logn)中的log是以什么为底？</h4><p>平时说这个算法的时间复杂度是logn的，那么一定是log 以2为底n的对数么？</p>
<p>其实不然，也可以是以10为底n的对数，也可以是以20为底n的对数，<strong>但我们统一说 logn，也就是忽略底数的描述</strong>。</p>
<p>为什么可以这么做呢？如下图所示：</p>
<p><img src="/../images/20200728191447349-20230310124032001.png" alt="时间复杂度1.png"></p>
<p>假如有两个算法的时间复杂度，分别是log以2为底n的对数和log以10为底n的对数，那么这里如果还记得高中数学的话，应该不难理解<code>以2为底n的对数 = 以2为底10的对数 * 以10为底n的对数</code>。</p>
<p>而以2为底10的对数是一个常数，在上文已经讲述了我们计算时间复杂度是忽略常数项系数的。</p>
<p>抽象一下就是在时间复杂度的计算过程中，log以i为底n的对数等于log 以j为底n的对数，所以忽略了i，直接说是logn。</p>
<p>这样就应该不难理解为什么忽略底数了。</p>
<h4 id="举一个例子"><a href="#举一个例子" class="headerlink" title="#举一个例子"></a><a href="https://programmercarl.com/%E5%89%8D%E5%BA%8F/%E5%85%B3%E4%BA%8E%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%EF%BC%8C%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C%EF%BC%81.html#%E4%B8%BE%E4%B8%80%E4%B8%AA%E4%BE%8B%E5%AD%90">#</a>举一个例子</h4><p>通过这道面试题目，来分析一下时间复杂度。题目描述：找出n个字符串中相同的两个字符串（假设这里只有两个相同的字符串）。</p>
<p>如果是暴力枚举的话，时间复杂度是多少呢，是O(n^2)么？</p>
<p>这里一些同学会忽略了字符串比较的时间消耗，这里并不像int 型数字做比较那么简单，除了n^2 次的遍历次数外，字符串比较依然要消耗m次操作（m也就是字母串的长度），所以时间复杂度是O(m × n × n)。</p>
<p>接下来再想一下其他解题思路。</p>
<p>先排对n个字符串按字典序来排序，排序后n个字符串就是有序的，意味着两个相同的字符串就是挨在一起，然后在遍历一遍n个字符串，这样就找到两个相同的字符串了。</p>
<p>那看看这种算法的时间复杂度，快速排序时间复杂度为O(nlogn)，依然要考虑字符串的长度是m，那么快速排序每次的比较都要有m次的字符比较的操作，就是O(m × n × log n) 。</p>
<p>之后还要遍历一遍这n个字符串找出两个相同的字符串，别忘了遍历的时候依然要比较字符串，所以总共的时间复杂度是 O(m × n × logn + n × m)。</p>
<p>我们对O(m × n × log n + n × m) 进行简化操作，把m × n提取出来变成 O(m × n × (logn + 1))，再省略常数项最后的时间复杂度是 O(m × n × log n)。</p>
<p>最后很明显O(m × n × logn) 要优于O(m × n × n)！</p>
<p>所以先把字符串集合排序再遍历一遍找到两个相同字符串的方法要比直接暴力枚举的方式更快。</p>
<p>这就是我们通过分析两种算法的时间复杂度得来的。</p>
<p><strong>当然这不是这道题目的最优解，我仅仅是用这道题目来讲解一下时间复杂度</strong>。</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="#总结"></a><a href="https://programmercarl.com/%E5%89%8D%E5%BA%8F/%E5%85%B3%E4%BA%8E%E6%97%B6%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6%EF%BC%8C%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84%E9%83%BD%E5%9C%A8%E8%BF%99%E9%87%8C%EF%BC%81.html#%E6%80%BB%E7%BB%93">#</a>总结</h4><p>本篇讲解了什么是时间复杂度，复杂度是用来干什么，以及数据规模对时间复杂度的影响。</p>
<p>还讲解了被大多数同学忽略的大O的定义以及log究竟是以谁为底的问题。</p>
<p>再分析了如何简化复杂的时间复杂度，最后举一个具体的例子，把本篇的内容串起来。</p>
<p>相信看完本篇，大家对时间复杂度的认识会深刻很多！</p>
<h3 id="各类语言的性能比较，底层"><a href="#各类语言的性能比较，底层" class="headerlink" title="各类语言的性能比较，底层"></a>各类语言的性能比较，底层</h3><p>因为在简历上写了我熟悉C, Python, Java, 所以要了解一下这三种语言的底层实现，逻辑；要会比较三种语言的运行速度。</p>
<p>首先我们从底层实现开始：</p>
<h4 id="底层实现"><a href="#底层实现" class="headerlink" title="底层实现"></a>底层实现</h4><p><strong>JAVA</strong></p>
<h2 id="Questions"><a href="#Questions" class="headerlink" title="Questions"></a>Questions</h2><h3 id="Greedy-algorithm"><a href="#Greedy-algorithm" class="headerlink" title="Greedy algorithm:"></a>Greedy algorithm:</h3><h4 id="1-455-Assign-Cookies-Easy"><a href="#1-455-Assign-Cookies-Easy" class="headerlink" title="1. 455. Assign Cookies (Easy)"></a>1. 455. Assign Cookies (Easy)</h4><p>题目描述：每个孩子都有一个满足度 grid，每个饼干都有一个大小 size，只有饼干的大小大于等于一个孩子的满足度，该孩子才会获得满足。求解最多可以获得满足的孩子数量。</p>
<ol>
<li>给一个孩子的饼干应当尽量小并且又能满足该孩子，这样大饼干才能拿来给满足度比较大的孩子。</li>
<li>因为满足度最小的孩子最容易得到满足，所以先满足满足度最小的孩子。</li>
</ol>
<p>在以上的解法中，我们只在每次分配时饼干时选择一种看起来是当前最优的分配方法，但无法保证这种局部最优的分配方法最后能得到全局最优解。我们假设能得到全局最优解，并使用反证法进行证明，即假设存在一种比我们使用的贪心策略更优的最优策略。如果不存在这种最优策略，表示贪心策略就是最优策略，得到的解也就是全局最优解。</p>
<p>证明：假设在某次选择中，贪心策略选择给当前满足度最小的孩子分配第 m 个饼干，第 m 个饼干为可以满足该孩子的最小饼干。假设存在一种最优策略，可以给该孩子分配第 n 个饼干，并且 m &lt; n。我们可以发现，经过这一轮分配，贪心策略分配后剩下的饼干一定有一个比最优策略来得大。因此在后续的分配中，贪心策略一定能满足更多的孩子。也就是说不存在比贪心策略更优的策略，即贪心策略就是最优策略。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findContentChildren</span><span class="params">(<span class="type">int</span>[] g, <span class="type">int</span>[] s)</span> &#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span>(g==<span class="literal">null</span>||s==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      Arrays.sort(g);</span><br><span class="line"></span><br><span class="line">      Arrays.sort(s);</span><br><span class="line"></span><br><span class="line">      <span class="type">int</span> gi=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">      <span class="type">int</span> si=<span class="number">0</span>;</span><br><span class="line">  </span><br><span class="line">     <span class="keyword">while</span>(gi&lt;g.length&amp;&amp;si&lt;s.length)&#123;</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span>(s[si]&gt;=g[gi])&#123;</span><br><span class="line"></span><br><span class="line">             gi++;</span><br><span class="line"></span><br><span class="line">             si++;</span><br><span class="line"></span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">else</span> si++;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">return</span> gi;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-435-Non-overlapping-Intervals-Medium"><a href="#2-435-Non-overlapping-Intervals-Medium" class="headerlink" title="2. 435. Non-overlapping Intervals (Medium)"></a>2. 435. Non-overlapping Intervals (Medium)</h4><p>给定一个区间的集合 intervals ，其中 intervals[i] &#x3D; [starti, endi] 。返回 需要移除区间的最小数量，使剩余区间互不重叠 。</p>
<p>示例 1:</p>
<p>输入: intervals &#x3D; [[1,2],[2,3],[3,4],[1,3]]<br>输出: 1<br>解释: 移除 [1,3] 后，剩下的区间没有重叠。<br>示例 2:</p>
<p>输入: intervals &#x3D; [ [1,2], [1,2], [1,2] ]<br>输出: 2<br>解释: 你需要移除两个 [1,2] 来使剩下的区间没有重叠。<br>示例 3:</p>
<p>输入: intervals &#x3D; [ [1,2], [2,3] ]<br>输出: 0<br>解释: 你不需要移除任何区间，因为它们已经是无重叠的了。</p>
<p>solution:</p>
<p>先计算最多能组成的不重叠区间个数，然后用区间总个数减去不重叠区间的个数。</p>
<p>在每次选择中，区间的结尾最为重要，选择的区间结尾越小，留给后面的区间的空间越大，那么后面能够选择的区间个数也就越大。</p>
<p>按区间的结尾进行排序，每次选择结尾最小，并且和前一个区间不重叠的区间。结束时间越早越好</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">eraseOverlapIntervals</span><span class="params">(<span class="type">int</span>[][] intervals)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (intervals.length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Arrays.sort(intervals, Comparator.comparingInt(o -&gt; o[<span class="number">1</span>]));</span><br><span class="line">    <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> intervals[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; intervals.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (intervals[i][<span class="number">0</span>] &lt; end) &#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        end = intervals[i][<span class="number">1</span>];</span><br><span class="line">        cnt++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> intervals.length - cnt;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Arrays.sort(intervals, <span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;() &#123;</span><br><span class="line">     <span class="meta">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1, <span class="type">int</span>[] o2)</span> &#123;</span><br><span class="line">         <span class="keyword">return</span> (o1[<span class="number">1</span>] &lt; o2[<span class="number">1</span>]) ? -<span class="number">1</span> : ((o1[<span class="number">1</span>] == o2[<span class="number">1</span>]) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">     &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//这里是让数组中，各个区间的末尾按照正序也就是升序来排序，所以是用o1[1]&lt;o2[1],也可以用return o1[1]-o2[1],但可能会溢出</span></span><br></pre></td></tr></table></figure>



<h4 id="3-452-Minimum-Number-of-Arrows-to-Burst-Balloons"><a href="#3-452-Minimum-Number-of-Arrows-to-Burst-Balloons" class="headerlink" title="3. 452. Minimum Number of Arrows to Burst Balloons"></a>3. 452. Minimum Number of Arrows to Burst Balloons</h4><p>有一些球形气球贴在一堵用 XY 平面表示的墙面上。墙面上的气球记录在整数数组 <code>points</code> ，其中<code>points[i] = [xstart, xend]</code> 表示水平直径在 <code>xstart</code> 和 <code>xend</code>之间的气球。你不知道气球的确切 y 坐标。</p>
<p>一支弓箭可以沿着 x 轴从不同点 <strong>完全垂直</strong> 地射出。在坐标 <code>x</code> 处射出一支箭，若有一个气球的直径的开始和结束坐标为 <code>x``start</code>，<code>x``end</code>， 且满足 <code>xstart ≤ x ≤ xend</code>，则该气球会被 <strong>引爆</strong> 。可以射出的弓箭的数量 <strong>没有限制</strong> 。 弓箭一旦被射出之后，可以无限地前进。</p>
<p>给你一个数组 <code>points</code> ，<em>返回引爆所有气球所必须射出的 <strong>最小</strong> 弓箭数</em> 。</p>
<p><strong>示例 1：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：points = [[10,16],[2,8],[1,6],[7,12]]</span><br><span class="line">输出：2</span><br><span class="line">解释：气球可以用2支箭来爆破:</span><br><span class="line">-在x = 6处射出箭，击破气球[2,8]和[1,6]。</span><br><span class="line">-在x = 11处发射箭，击破气球[10,16]和[7,12]。</span><br></pre></td></tr></table></figure>

<p>该题思路基本和第二题一致，只是要求最多不重叠的区间数，然后射出这么多箭即可。而且注意边界值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">myComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt;&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1,<span class="type">int</span>[] o2)</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> (o1[<span class="number">1</span>] &lt; o2[<span class="number">1</span>]) ? -<span class="number">1</span> : ((o1[<span class="number">1</span>] == o2[<span class="number">1</span>]) ? <span class="number">0</span> : <span class="number">1</span>);</span><br><span class="line">          <span class="comment">//如果使用return o1[1]-o2[1],可能会出现int越界的问题，所以用比较符号来</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findMinArrowShots</span><span class="params">(<span class="type">int</span>[][] points)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(points==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Arrays.sort(points,<span class="keyword">new</span> <span class="title class_">Solution</span>.myComparator());</span><br><span class="line">    <span class="type">int</span> cnt=<span class="number">1</span>;</span><br><span class="line">    <span class="type">int</span> end=points[<span class="number">0</span>][<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;points.length;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(points[i][<span class="number">0</span>]&lt;=end)&#123;</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        cnt++;</span><br><span class="line">        end=points[i][<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> cnt;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="4-406-Queue-Reconstruction-by-Height-Medium"><a href="#4-406-Queue-Reconstruction-by-Height-Medium" class="headerlink" title="4. 406. Queue Reconstruction by Height(Medium)"></a>4. 406. Queue Reconstruction by Height(Medium)</h4><p>假设有打乱顺序的一群人站成一个队列，数组 people 表示队列中一些人的属性（不一定按顺序）。每个 people[i] &#x3D; [hi, ki] 表示第 i 个人的身高为 hi ，前面 正好 有 ki 个身高大于或等于 hi 的人。</p>
<p>请你重新构造并返回输入数组 people 所表示的队列。返回的队列应该格式化为数组 queue ，其中 queue[j] &#x3D; [hj, kj] 是队列中第 j 个人的属性（queue[0] 是排在队列前面的人）。</p>
<p>示例 1：</p>
<p>输入：people &#x3D; [[7,0],[4,4],[7,1],[5,0],[6,1],[5,2]]<br>输出：[[5,0],[7,0],[5,2],[6,1],[4,4],[7,1]]</p>
<p>思路: 为了使插入操作不影响后续的操作，身高较高的学生应该先做插入操作，否则身高较小的学生原先正确插入的第 k 个位置可能会变成第 k+1 个位置。</p>
<p>身高 h 降序、个数 k 值升序，然后将某个学生插入队列的第 k 个位置中。</p>
<p>Solution:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">myComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&lt;<span class="type">int</span>[]&gt; &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(<span class="type">int</span>[] o1,<span class="type">int</span>[] o2)</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>(o1[<span class="number">0</span>]!=o2[<span class="number">0</span>])&#123;</span><br><span class="line">                <span class="keyword">return</span> o2[<span class="number">0</span>]-o1[<span class="number">0</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> o1[<span class="number">1</span>]-o2[<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[][] reconstructQueue(<span class="type">int</span>[][] people) &#123;</span><br><span class="line">        <span class="keyword">if</span> (people == <span class="literal">null</span> || people.length == <span class="number">0</span> || people[<span class="number">0</span>].length == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>][<span class="number">0</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.sort(people,<span class="keyword">new</span> <span class="title class_">myComparator</span>());<span class="comment">// equals to Arrays.sort(people, (a, b) -&gt; (a[0] == b[0] ? a[1] - b[1] : b[0] - a[0]));</span></span><br><span class="line">        List&lt;<span class="type">int</span>[]&gt; queue = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span>[] p:people)&#123;</span><br><span class="line">            queue.add(p[<span class="number">1</span>],p);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> queue.toArray(<span class="keyword">new</span> <span class="title class_">int</span>[queue.size()][]);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="5-121-Best-Time-to-Buy-and-Sell-Stock-Easy"><a href="#5-121-Best-Time-to-Buy-and-Sell-Stock-Easy" class="headerlink" title="5. 121. Best Time to Buy and Sell Stock (Easy)"></a>5. 121. Best Time to Buy and Sell Stock (Easy)</h4><p>给定一个数组 prices ，它的第 i 个元素 prices[i] 表示一支给定股票第 i 天的价格。</p>
<p>你只能选择 某一天 买入这只股票，并选择在 未来的某一个不同的日子 卖出该股票。设计一个算法来计算你所能获取的最大利润。</p>
<p>返回你可以从这笔交易中获取的最大利润。如果你不能获取任何利润，返回 0 。</p>
<p><strong>示例 1：</strong></p>
<p><code>输入：[7,1,5,3,6,4]</code><br><code>输出：5</code><br><code>解释：在第 2 天（股票价格 = 1）的时候买入，在第 5 天（股票价格 = 6）的时候卖出，最大利润 = 6-1 = 5 。      注意利润不能是 7-1 = 6, 因为卖出价格需要大于买入价格；同时，你不能在买入前卖出股票。</code></p>
<p><strong>Idea:</strong></p>
<p>只要记录前面的最小价格，将这个最小价格作为买入价格，然后将当前的价格作为售出价格，查看当前收益是不是最大收益。</p>
<p><strong>Solution:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">   <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> prices.length;</span><br><span class="line">   <span class="keyword">if</span> (n == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">   <span class="type">int</span> <span class="variable">soFarMin</span> <span class="operator">=</span> prices[<span class="number">0</span>];</span><br><span class="line">   <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">   <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">       <span class="keyword">if</span> (soFarMin &gt; prices[i]) soFarMin = prices[i];</span><br><span class="line">       <span class="keyword">else</span> max = Math.max(max, prices[i] - soFarMin);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="keyword">return</span> max;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h4 id="6-122-Best-Time-to-Buy-and-Sell-Stock-II-Easy"><a href="#6-122-Best-Time-to-Buy-and-Sell-Stock-II-Easy" class="headerlink" title="6. 122. Best Time to Buy and Sell Stock II (Easy)"></a>6. 122. Best Time to Buy and Sell Stock II (Easy)</h4><p>给你一个整数数组 prices ，其中 prices[i] 表示某支股票第 i 天的价格。</p>
<p>在每一天，你可以决定是否购买和&#x2F;或出售股票。你在任何时候 最多 只能持有 一股 股票。你也可以先购买，然后在 同一天 出售。</p>
<p>返回 你能获得的 最大 利润 。</p>
<p><code>输入：prices = [7,1,5,3,6,4]</code><br><code>输出：7</code><br><code>解释：在第 2 天（股票价格 = 1）的时候买入，在第 3 天（股票价格 = 5）的时候卖出, 这笔交易所能获得利润 = 5 - 1 = 4。 随后，在第 4 天（股票价格 = 3）的时候买入，在第 5 天（股票价格 = 6）的时候卖出, 这笔交易所能获得利润 = 6 - 3 = 3。总利润为 4 + 3 = 7 。</code></p>
<p><strong>Idea:</strong></p>
<p>题目描述：可以进行多次交易，多次交易之间不能交叉进行，可以进行多次交易。</p>
<p>对于 [a, b, c, d]，如果有 a &lt;&#x3D; b &lt;&#x3D; c &lt;&#x3D; d ，那么最大收益为 d - a。而 d - a &#x3D; (d - c) + (c - b) + (b - a) ，因此当访问到一个 prices[i] 且 prices[i] - prices[i-1] &gt; 0，那么就把 prices[i] - prices[i-1] 添加到收益中。</p>
<p><strong>Solution:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">profit</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; prices.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (prices[i] &gt; prices[i - <span class="number">1</span>]) &#123;</span><br><span class="line">            profit += (prices[i] - prices[i - <span class="number">1</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> profit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Linked-List"><a href="#Linked-List" class="headerlink" title="Linked List"></a>Linked List</h3><p>什么是链表，链表是一种通过指针串联在一起的线性结构，每一个节点由两部分组成，一个是数据域一个是指针域（存放指向下一个节点的指针），最后一个节点的指针域指向null（空指针的意思）。</p>
<p>链表的入口节点称为链表的头结点也就是head。</p>
<p>如图所示： <img src="/../images/20200806194529815.png" alt="链表1"></p>
<p>了解完链表的类型，再来说一说链表在内存中的存储方式。</p>
<p>数组是在内存中是连续分布的，但是链表在内存中可不是连续分布的。</p>
<p>链表是通过指针域的指针链接在内存中各个节点。</p>
<p>所以链表中的节点在内存中不是连续分布的 ，而是散乱分布在内存中的某地址上，分配机制取决于操作系统的内存管理。</p>
<p>如图所示：</p>
<p><img src="/../images/20200806194613920.png" alt="链表3"></p>
<p>这个链表起始节点为2， 终止节点为7， 各个节点分布在内存的不同地址空间上，通过指针串联在一起。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="comment">// 结点的值</span></span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 下一个结点</span></span><br><span class="line">    ListNode next;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 节点的构造函数(无参)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ListNode</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 节点的构造函数(有一个参数)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ListNode</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 节点的构造函数(有两个参数)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ListNode</span><span class="params">(<span class="type">int</span> val, ListNode next)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">        <span class="built_in">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">JavaScript:</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">  val;</span><br><span class="line">  next = <span class="literal">null</span>;</span><br><span class="line">  constructor(value) &#123;</span><br><span class="line">    <span class="built_in">this</span>.val = value;</span><br><span class="line">    <span class="built_in">this</span>.next = <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="203-remove-a-node"><a href="#203-remove-a-node" class="headerlink" title="203. remove a node"></a>203. remove a node</h4><p>给你一个链表的头节点 head 和一个整数 val ，请你删除链表中所有满足 Node.val &#x3D;&#x3D; val 的节点，并返回 新的头节点 。</p>
<p>示例 1：</p>
<p>输入：head &#x3D; [1,2,6,3,4,5,6], val &#x3D; 6<br>输出：[1,2,3,4,5]</p>
<p>Solution1. 使用dummy node. 这样子在移除头节点的时候可以使用虚拟节点将其移出，其他的节点都是依靠后面的节点来进行删除的</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> ListNode <span class="title function_">removeElements</span><span class="params">(ListNode head, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    ListNode dummy= <span class="keyword">new</span> <span class="title class_">ListNode</span>(-<span class="number">1</span>);</span><br><span class="line">    dummy.next=head;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> dummy;</span><br><span class="line">    <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">    <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (cur.val == val) &#123;</span><br><span class="line">            pre.next = cur.next;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pre = cur;</span><br><span class="line">        &#125;</span><br><span class="line">        cur = cur.next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Solution2. 不使用dummy node, 直接将</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> ListNode <span class="title function_">removeElements</span><span class="params">(ListNode head, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (head != <span class="literal">null</span> &amp;&amp; head.val == val) &#123;</span><br><span class="line">            head = head.next;<span class="comment">//如果头为空，则往后移</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(head==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> head;</span><br><span class="line">        &#125;</span><br><span class="line">        ListNode pre=head;</span><br><span class="line">        ListNode cur=head.next;</span><br><span class="line">        <span class="keyword">while</span>(cur!=<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span>(cur.val==val)&#123;</span><br><span class="line">                pre.next = cur.next;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                pre=cur;</span><br><span class="line">            &#125;</span><br><span class="line">            cur=cur.next;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">           <span class="keyword">return</span> head;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="707-design-myLinkedList"><a href="#707-design-myLinkedList" class="headerlink" title="707 design myLinkedList"></a>707 design myLinkedList</h4><p><strong>solution1</strong></p>
<p>单链表</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//单链表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next;</span><br><span class="line">    ListNode()&#123;&#125;</span><br><span class="line">    ListNode(<span class="type">int</span> val) &#123;</span><br><span class="line">        <span class="built_in">this</span>.val=val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLinkedList</span> &#123;</span><br><span class="line">    <span class="comment">//size存储链表元素的个数</span></span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="comment">//虚拟头结点</span></span><br><span class="line">    ListNode head;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化链表</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyLinkedList</span><span class="params">()</span> &#123;</span><br><span class="line">        size = <span class="number">0</span>;</span><br><span class="line">        head = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//获取第index个节点的数值，注意index是从0开始的，第0个节点就是头结点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="comment">//如果index非法，返回-1</span></span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">currentNode</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="comment">//包含一个虚拟头节点，所以查找第 index+1 个节点</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= index; i++) &#123;</span><br><span class="line">            currentNode = currentNode.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> currentNode.val;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//在链表最前面插入一个节点，等价于在第0个元素前添加</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtHead</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        addAtIndex(<span class="number">0</span>, val);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//可以不用addAtIndex方法来实现</span></span><br><span class="line">          <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtHead</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">node</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">        <span class="keyword">if</span> (head.next == <span class="literal">null</span>) &#123;</span><br><span class="line">            head.next = node;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">temp</span> <span class="operator">=</span> head.next;</span><br><span class="line">        head.next = node;</span><br><span class="line">        node.next = temp;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//在链表的最后插入一个节点，等价于在(末尾+1)个元素前添加</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtTail</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        addAtIndex(size, val);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 在第 index 个节点之前插入一个新节点，例如index为0，那么新插入的节点为链表的新头节点。</span></span><br><span class="line">    <span class="comment">// 如果 index 等于链表的长度，则说明是新插入的节点为链表的尾结点</span></span><br><span class="line">    <span class="comment">// 如果 index 大于链表的长度，则返回空</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtIndex</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &gt; size) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="comment">//找到要插入节点的前驱</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pred</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index; i++) &#123;</span><br><span class="line">            pred = pred.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">toAdd</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">        toAdd.next = pred.next;</span><br><span class="line">        pred.next = toAdd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//删除第index个节点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAtIndex</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (index &lt; <span class="number">0</span> || index &gt;= size) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">        <span class="keyword">if</span> (index == <span class="number">0</span>) &#123;</span><br><span class="line">            head = head.next;</span><br><span class="line">	    <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pred</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; index ; i++) &#123;</span><br><span class="line">            pred = pred.next;</span><br><span class="line">        &#125;</span><br><span class="line">        pred.next = pred.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>solution2</strong></p>
<p>双链表</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//双链表</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ListNode</span>&#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    ListNode next,prev;</span><br><span class="line">    ListNode() &#123;&#125;;</span><br><span class="line">    ListNode(<span class="type">int</span> val)&#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLinkedList</span> &#123;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//记录链表中元素的数量</span></span><br><span class="line">    <span class="type">int</span> size;</span><br><span class="line">    <span class="comment">//记录链表的虚拟头结点和尾结点</span></span><br><span class="line">    ListNode head,tail;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyLinkedList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">//初始化操作</span></span><br><span class="line">        <span class="built_in">this</span>.size = <span class="number">0</span>;</span><br><span class="line">        <span class="built_in">this</span>.head = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="built_in">this</span>.tail = <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>);</span><br><span class="line">        <span class="comment">//这一步非常关键，否则在加入头结点的操作中会出现null.next的错误！！！</span></span><br><span class="line">        head.next=tail;</span><br><span class="line">        tail.prev=head;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="comment">//判断index是否有效</span></span><br><span class="line">        <span class="keyword">if</span>(index&lt;<span class="number">0</span> || index&gt;=size)&#123;</span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> <span class="built_in">this</span>.head;</span><br><span class="line">        <span class="comment">//判断是哪一边遍历时间更短</span></span><br><span class="line">        <span class="keyword">if</span>(index &gt;= size / <span class="number">2</span>)&#123;</span><br><span class="line">            <span class="comment">//tail开始</span></span><br><span class="line">            cur = tail;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt; size-index; i++)&#123;</span><br><span class="line">                cur = cur.prev;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;= index; i++)&#123;</span><br><span class="line">                cur = cur.next; </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cur.val;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtHead</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="comment">//等价于在第0个元素前添加</span></span><br><span class="line">        addAtIndex(<span class="number">0</span>,val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtTail</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="comment">//等价于在最后一个元素(null)前添加</span></span><br><span class="line">        addAtIndex(size,val);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addAtIndex</span><span class="params">(<span class="type">int</span> index, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="comment">//index大于链表长度</span></span><br><span class="line">        <span class="keyword">if</span>(index&gt;size)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//index小于0</span></span><br><span class="line">        <span class="keyword">if</span>(index&lt;<span class="number">0</span>)&#123;</span><br><span class="line">            index = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        size++;</span><br><span class="line">        <span class="comment">//找到前驱</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="built_in">this</span>.head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;index; i++)&#123;</span><br><span class="line">            pre = pre.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//新建结点</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">newNode</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(val);</span><br><span class="line">        newNode.next = pre.next;</span><br><span class="line">        pre.next.prev = newNode;</span><br><span class="line">        newNode.prev = pre;</span><br><span class="line">        pre.next = newNode;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteAtIndex</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="comment">//判断索引是否有效</span></span><br><span class="line">        <span class="keyword">if</span>(index&lt;<span class="number">0</span> || index&gt;=size)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//删除操作</span></span><br><span class="line">        size--;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="built_in">this</span>.head;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;index; i++)&#123;</span><br><span class="line">            pre = pre.next;</span><br><span class="line">        &#125;</span><br><span class="line">        pre.next.next.prev = pre;</span><br><span class="line">        pre.next = pre.next.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="160-交叉链表的最简单解法"><a href="#160-交叉链表的最简单解法" class="headerlink" title="160 交叉链表的最简单解法"></a>160 交叉链表的最简单解法</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">getIntersectionNode</span><span class="params">(ListNode headA, ListNode headB)</span> &#123;</span><br><span class="line"><span class="type">ListNode</span> <span class="variable">l1</span> <span class="operator">=</span> headA, l2 = headB;</span><br><span class="line"><span class="keyword">while</span> (l1 != l2) &#123;</span><br><span class="line">    l1 = (l1 == <span class="literal">null</span>) ? headB : l1.next;</span><br><span class="line">    l2 = (l2 == <span class="literal">null</span>) ? headA : l2.next;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> l1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/DSA/Page1.jpg" alt="Page1"></p>
<p><img src="/../images/DSA/Page2.jpg" alt="Page3"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//递归写法    </span></span><br><span class="line"><span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> reverse(<span class="literal">null</span>,head);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> ListNode <span class="title function_">reverse</span><span class="params">(ListNode pre, ListNode cur)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(cur==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> pre;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">temp</span> <span class="operator">=</span> cur.next;</span><br><span class="line">        cur.next=pre;</span><br><span class="line">        <span class="keyword">return</span> reverse(cur,temp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//从后向前的递归</span></span><br><span class="line">ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="comment">// 边缘条件判断</span></span><br><span class="line">        <span class="keyword">if</span>(head == <span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (head.next == <span class="literal">null</span>) <span class="keyword">return</span> head;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 递归调用，翻转第二个节点开始往后的链表</span></span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">last</span> <span class="operator">=</span> reverseList(head.next);</span><br><span class="line">        <span class="comment">// 翻转头节点与第二个节点的指向</span></span><br><span class="line">        head.next.next = head;</span><br><span class="line">        <span class="comment">// 此时的 head 节点为尾节点，next 需要指向 NULL</span></span><br><span class="line">        head.next = <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">return</span> last;</span><br><span class="line">    &#125; </span><br></pre></td></tr></table></figure>

<p><img src="/../images/DSA/Page3.jpg" alt="Page3"></p>
<p><img src="/../images/DSA/Page4.jpg" alt="Page3"><img src="/../images/DSA/Page5.jpg" alt="Page4"><img src="/../images/DSA/Page6.jpg" alt="Page5"><img src="/../images/DSA/Page7.jpg" alt="Page6"><img src="/../images/DSA/Page8.jpg" alt="Page7"><img src="/../images/DSA/Page8.jpg" alt="Page8"><img src="/../images/DSA/Page9.jpg" alt="Page9"><img src="/../images/DSA/Page10.jpg" alt="Page10"><img src="/../images/DSA/Page11.jpg" alt="Page11"><img src="/../images/DSA/Page12.jpg" alt="Page12"></p>
<h3 id="Trees"><a href="#Trees" class="headerlink" title="Trees"></a>Trees</h3><h4 id="leetcode-104"><a href="#leetcode-104" class="headerlink" title="leetcode 104"></a>leetcode 104</h4><p><img src="/../images/DSA/Page13.jpg" alt="Page13"><img src="/../images/DSA/Page14.jpg" alt="Page14"><img src="/../images/DSA/Page15.jpg" alt="Page15"><img src="/../images/DSA/Page16.jpg" alt="Page16"><img src="/../images/DSA/Page17.jpg" alt="Page17"><img src="/../images/DSA/Page18.jpg" alt="Page18"><img src="/../images/DSA/Page19.jpg" alt="Page19"><img src="/../images/DSA/Page20.jpg" alt="Page20"><img src="/../images/DSA/Page21.jpg" alt="Page21"><img src="/../images/DSA/Page22.jpg" alt="Page22"><img src="/../images/DSA/Page23.jpg" alt="Page23"><img src="/../images/DSA/Page24.jpg" alt="Page24"><img src="/../images/DSA/Page25.jpg" alt="Page25"><img src="/../images/DSA/Page26.jpg" alt="Page26"><img src="/../images/DSA/Page27.jpg" alt="Page27"></p>
<h3 id="Double-pointers"><a href="#Double-pointers" class="headerlink" title="Double pointers"></a>Double pointers</h3><h4 id="leetcode-167"><a href="#leetcode-167" class="headerlink" title="leetcode 167"></a>leetcode 167</h4><p><img src="/../images/DSA/p1.jpg" alt="p1"></p>
<p><img src="/../images/DSA/p2.jpg" alt="p2"></p>
<h3 id="Sorting"><a href="#Sorting" class="headerlink" title="Sorting"></a>Sorting</h3><p><img src="/../images/DSA/p3.jpg" alt="p3"></p>
<p><img src="/../images/DSA/p4.jpg" alt="p4"></p>
<p><img src="/../images/DSA/p5.jpg" alt="p5"></p>
<p><img src="/../images/DSA/p6.jpg" alt="p6"></p>
<p><img src="/../images/DSA/p7.jpg" alt="p7"></p>
<p><img src="/../images/DSA/p8.jpg" alt="p8"></p>
<p><img src="/../images/DSA/p9.jpg" alt="p9"></p>
<p><img src="/../images/DSA/p10.jpg" alt="p10"></p>
<p><img src="/../images/DSA/p11.jpg" alt="p11"></p>
<p><img src="/../images/DSA/p12.jpg" alt="p12"></p>
<p><img src="/../images/DSA/p13.jpg" alt="p13"></p>
<p><img src="/../images/DSA/p14.jpg" alt="p14"></p>
<p><img src="/../images/DSA/p15.jpg" alt="p15"></p>
<p><img src="/../images/DSA/p16.jpg" alt="p16"></p>
<p><img src="/../images/DSA/p17.jpg" alt="p17"></p>
<p><img src="/../images/DSA/p18.jpg" alt="p18"></p>
<p><img src="/../images/DSA/p19.jpg" alt="p19"></p>
<p><img src="/../images/DSA/p20.jpg" alt="p20"></p>
<p><img src="/../images/DSA/p21.jpg" alt="p21"></p>
<h3 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h3><h4 id="leetcode-704"><a href="#leetcode-704" class="headerlink" title="leetcode 704"></a>leetcode 704</h4><p>我们定义 target 是在一个在左闭右闭的区间里，<strong>也就是[left, right] （这个很重要非常重要）</strong>。</p>
<p>区间的定义这就决定了二分法的代码应该如何写，<strong>因为定义target在[left, right]区间，所以有如下两点：</strong></p>
<ul>
<li>while (left &lt;&#x3D; right) 要使用 &lt;&#x3D; ，因为left &#x3D;&#x3D; right是有意义的，所以使用 &lt;&#x3D;</li>
<li>if (nums[middle] &gt; target) right 要赋值为 middle - 1，因为当前这个nums[middle]一定不是target，那么接下来要查找的左区间结束下标位置就是 middle - 1</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span> &#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>, right = nums.length-<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">while</span>(left&lt;=right)&#123;</span><br><span class="line">  <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + ((right - left) &gt;&gt; <span class="number">1</span>);</span><br><span class="line">  <span class="keyword">if</span>(target&gt;nums[mid]) left = mid+<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span>(target&lt;nums[mid]) right = mid-<span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">return</span> mid;</span><br><span class="line">	&#125;</span><br><span class="line"><span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<h4 id="leetcode-27"><a href="#leetcode-27" class="headerlink" title="leetcode 27"></a>leetcode 27</h4><p>快慢指针</p>
<p><strong>Brute</strong></p>
<p>0,1,2,3,3,0,4,2</p>
<p>0,1,3,3,0,4,2,[2]</p>
<p>0,1,3,3,0,4,[2,2]</p>
<p>1,3,3,4,5 i&#x3D;1 result &#x3D; 5</p>
<p>1,3,4,5,[5] i&#x3D;1 result &#x3D; 4</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeElement</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">    <span class="type">int</span> result=nums.length;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;result;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(nums[i]==val)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i+<span class="number">1</span>;j&lt;result;j++)&#123;</span><br><span class="line">                nums[j-<span class="number">1</span>]=nums[j];</span><br><span class="line">            &#125;</span><br><span class="line">            result--;</span><br><span class="line">            i--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Fast and slow pointer</strong></p>
<p><img src="/../images/gif0_dsa.gif" alt="gif0_dsa"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeElement</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> val)</span> &#123;</span><br><span class="line"><span class="comment">// 快慢指针</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">slowIndex</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">fastIndex</span> <span class="operator">=</span> <span class="number">0</span>; fastIndex &lt; nums.length; fastIndex++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[fastIndex] != val) &#123;</span><br><span class="line">                nums[slowIndex] = nums[fastIndex];</span><br><span class="line">                slowIndex++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> slowIndex;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//相向双指针法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeElement</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span>(right &gt;= <span class="number">0</span> &amp;&amp; nums[right] == val) right--; <span class="comment">//将right移到从右数第一个值不为val的位置</span></span><br><span class="line">        <span class="keyword">while</span>(left &lt;= right) &#123;</span><br><span class="line">            <span class="keyword">if</span>(nums[left] == val) &#123; <span class="comment">//left位置的元素需要移除</span></span><br><span class="line">                <span class="comment">//将right位置的元素移到left（覆盖），right位置移除</span></span><br><span class="line">                nums[left] = nums[right];</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">            left++;</span><br><span class="line">            <span class="keyword">while</span>(right &gt;= <span class="number">0</span> &amp;&amp; nums[right] == val) right--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Leetcode-977"><a href="#Leetcode-977" class="headerlink" title="Leetcode 977"></a>Leetcode 977</h4><p>给你一个按 <strong>非递减顺序</strong> 排序的整数数组 <code>nums</code>，返回 <strong>每个数字的平方</strong> 组成的新数组，要求也按 <strong>非递减顺序</strong> 排序。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">输入：nums = [-4,-1,0,3,10]</span><br><span class="line">输出：[0,1,9,16,100]</span><br><span class="line">解释：平方后，数组变为 [16,1,0,9,100]</span><br><span class="line">排序后，数组变为 [0,1,9,16,100]</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length-<span class="number">1</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"><span class="comment">//construct a new array to store otherwise it will cause o(n^2) in time complexity</span></span><br><span class="line"><span class="type">int</span>[] result = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> result.length - <span class="number">1</span>;</span><br><span class="line"><span class="keyword">while</span>(left&lt;=right)&#123;</span><br><span class="line"><span class="keyword">if</span>(nums[left]*nums[left]&gt;nums[right]*nums[right])&#123;</span><br><span class="line">    result[index]=nums[left]*nums[left];</span><br><span class="line">    index--;</span><br><span class="line">    left++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    result[index]=nums[right]*nums[right];</span><br><span class="line">    index--;</span><br><span class="line">    right--;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h4 id="Leetcode-209"><a href="#Leetcode-209" class="headerlink" title="Leetcode 209"></a>Leetcode 209</h4><p>给定一个含有 n 个正整数的数组和一个正整数 target 。</p>
<p>找出该数组中满足其和 ≥ target 的长度最小的 连续子数组 [nums_l, nums_l+1, …, nums_r-1, nums_r] ，并返回其长度。如果不存在符合条件的子数组，返回 0 。</p>
<p>示例 1：</p>
<p>输入：target &#x3D; 7, nums &#x3D; [2,3,1,2,4,3]<br>输出：2<br>解释：子数组 [4,3] 是该条件下的长度最小的子数组。<br>示例 2：</p>
<p>输入：target &#x3D; 4, nums &#x3D; [1,4,4]<br>输出：1<br>示例：3</p>
<p>输入：target &#x3D; 11, nums &#x3D; [1,1,1,1,1,1,1,1]<br>输出：0</p>
<p><strong>Brute</strong></p>
<figure class="highlight c++"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">int</span> <span class="title">minSubArrayLen</span><span class="params">(<span class="type">int</span> s, vector&lt;<span class="type">int</span>&gt;&amp; nums)</span> </span>&#123;</span><br><span class="line">        <span class="type">int</span> result = INT32_MAX; <span class="comment">// 最终的结果</span></span><br><span class="line">        <span class="type">int</span> sum = <span class="number">0</span>; <span class="comment">// 子序列的数值之和</span></span><br><span class="line">        <span class="type">int</span> subLength = <span class="number">0</span>; <span class="comment">// 子序列的长度</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; nums.<span class="built_in">size</span>(); i++) &#123; <span class="comment">// 设置子序列起点为i</span></span><br><span class="line">            sum = <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> j = i; j &lt; nums.<span class="built_in">size</span>(); j++) &#123; <span class="comment">// 设置子序列终止位置为j</span></span><br><span class="line">                sum += nums[j];</span><br><span class="line">                <span class="keyword">if</span> (sum &gt;= s) &#123; <span class="comment">// 一旦发现子序列和超过了s，更新result</span></span><br><span class="line">                    subLength = j - i + <span class="number">1</span>; <span class="comment">// 取子序列的长度</span></span><br><span class="line">                    result = result &lt; subLength ? result : subLength;</span><br><span class="line">                    <span class="keyword">break</span>; <span class="comment">// 因为我们是找符合条件最短的子序列，所以一旦符合条件就break</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 如果result没有被赋值的话，就返回0，说明没有符合条件的子序列</span></span><br><span class="line">        <span class="keyword">return</span> result == INT32_MAX ? <span class="number">0</span> : result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>



<p><strong>Sliding Windows&#x2F;滑动窗口:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minSubArrayLen</span><span class="params">(<span class="type">int</span> s, <span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>; right &lt; nums.length; right++) &#123;</span><br><span class="line">        sum += nums[right];</span><br><span class="line">        <span class="keyword">while</span> (sum &gt;= s) &#123;</span><br><span class="line">            result = Math.min(result, right - left + <span class="number">1</span>);</span><br><span class="line">            sum -= nums[left];</span><br><span class="line">          	left++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result == Integer.MAX_VALUE ? <span class="number">0</span> : result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/gif1_dsa.gif" alt="gif1_dsa"></p>
<h4 id="Leetcode-59"><a href="#Leetcode-59" class="headerlink" title="Leetcode 59"></a>Leetcode 59</h4><p>注意边界条件, 坚持左闭右开的原则.</p>
<p>循环的次数等于n&#x2F;2</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[][] generateMatrix(<span class="type">int</span> n) &#123;</span><br><span class="line">        <span class="type">int</span> start=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> count=<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> loop=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span>[][] nums = <span class="keyword">new</span> <span class="title class_">int</span>[n][n]; </span><br><span class="line">        <span class="type">int</span> i,j;</span><br><span class="line">        <span class="keyword">while</span>(loop++&lt;n/<span class="number">2</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(j = start ; j&lt;n-loop ; j++)&#123;</span><br><span class="line">               nums[start][j] = count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(i = start;i&lt;n-loop;i++)&#123;</span><br><span class="line">                nums[i][j]=count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(;j&gt;=loop;j--)&#123;</span><br><span class="line">                nums[i][j]=count++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span>(;i&gt;=loop;i--)&#123;</span><br><span class="line">                nums[i][j]=count++;</span><br><span class="line">            &#125;</span><br><span class="line">            start++;</span><br><span class="line">        &#125;</span><br><span class="line">           <span class="keyword">if</span>(n%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">                nums[n/<span class="number">2</span>][n/<span class="number">2</span>]=n*n;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="Summary-of-Array"><a href="#Summary-of-Array" class="headerlink" title="Summary of Array"></a>Summary of Array</h4><ul>
<li><strong>数组下标都是从0开始的。</strong></li>
<li><strong>数组内存空间的地址是连续的</strong></li>
</ul>
<p>正是<strong>因为数组的在内存空间的地址是连续的，所以我们在删除或者增添元素的时候，就难免要移动其他元素的地址。</strong></p>
<p>我们来举一个Java的例子，例如： <code>int[][] rating = new int[3][4];</code> ， 这个二维数组在内存空间可不是一个 <code>3*4</code> 的连续地址空间</p>
<p>看了下图，就应该明白了：</p>
<p><img src="/../images/%E7%AE%97%E6%B3%95%E9%80%9A%E5%85%B3%E6%95%B0%E7%BB%843.png" alt="算法通关数组3"></p>
<p>所以<strong>Java的二维数组在内存中不是 <code>3\*4</code> 的连续地址空间，而是四条连续的地址空间组成！</strong></p>
<h3 id="Hash-table"><a href="#Hash-table" class="headerlink" title="Hash table"></a>Hash table</h3><h4 id="哈希碰撞"><a href="#哈希碰撞" class="headerlink" title="哈希碰撞"></a>哈希碰撞</h4><p>如图所示，小李和小王都映射到了索引下标 1 的位置，<strong>这一现象叫做哈希碰撞</strong>。</p>
<p><img src="/../images/2021010423494884.png" alt="哈希表3"></p>
<p>一般哈希碰撞有两种解决方法， 拉链法和线性探测法。</p>
<h4 id="拉链法"><a href="#拉链法" class="headerlink" title="#拉链法"></a><a href="https://programmercarl.com/%E5%93%88%E5%B8%8C%E8%A1%A8%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80.html#%E6%8B%89%E9%93%BE%E6%B3%95">#</a>拉链法</h4><p>刚刚小李和小王在索引1的位置发生了冲突，发生冲突的元素都被存储在链表中。 这样我们就可以通过索引找到小李和小王了</p>
<p><img src="/../images/20210104235015226.png" alt="哈希表4"></p>
<p>（数据规模是dataSize， 哈希表的大小为tableSize）</p>
<p>其实拉链法就是要选择适当的哈希表的大小，这样既不会因为数组空值而浪费大量内存，也不会因为链表太长而在查找上浪费太多时间。</p>
<h4 id="线性探测法"><a href="#线性探测法" class="headerlink" title="#线性探测法"></a><a href="https://programmercarl.com/%E5%93%88%E5%B8%8C%E8%A1%A8%E7%90%86%E8%AE%BA%E5%9F%BA%E7%A1%80.html#%E7%BA%BF%E6%80%A7%E6%8E%A2%E6%B5%8B%E6%B3%95">#</a>线性探测法</h4><p>使用线性探测法，一定要保证tableSize大于dataSize。 我们需要依靠哈希表中的空位来解决碰撞问题。</p>
<p>例如冲突的位置，放了小李，那么就向下找一个空位放置小王的信息。所以要求tableSize一定要大于dataSize ，要不然哈希表上就没有空置的位置来存放 冲突的数据了。如图所示：</p>
<p><img src="https://code-thinking-1253855093.file.myqcloud.com/pics/20210104235109950.png" alt="哈希表5"></p>
<p>其实关于哈希碰撞还有非常多的细节，感兴趣的同学可以再好好研究一下，这里我就不再赘述了。</p>
<p>hash表是牺牲空间减少时间cost</p>
<h4 id="Leetcode-242"><a href="#Leetcode-242" class="headerlink" title="Leetcode 242"></a>Leetcode 242</h4><p>给定两个字符串 s 和 t ，编写一个函数来判断 t 是否是 s 的字母异位词。</p>
<p>示例 1: 输入: s &#x3D; “anagram”, t &#x3D; “nagaram” 输出: true</p>
<p>示例 2: 输入: s &#x3D; “rat”, t &#x3D; “car” 输出: false</p>
<p><strong>说明:</strong> 你可以假设字符串只包含小写字母。</p>
<p><img src="/../images/242.%E6%9C%89%E6%95%88%E7%9A%84%E5%AD%97%E6%AF%8D%E5%BC%82%E4%BD%8D%E8%AF%8D.gif" alt="242.有效的字母异位词"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAnagram</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        Map&lt;Character,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:s.toCharArray())&#123;</span><br><span class="line">            map.put(c,map.getOrDefault(c,<span class="number">0</span>)+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; t.length(); i++) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> t.charAt(i);</span><br><span class="line">            <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> map.getOrDefault(c, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">if</span> (count == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (count == <span class="number">1</span>) &#123;</span><br><span class="line">                map.remove(c);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                map.put(c, count - <span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> map.isEmpty();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>更简单的做法是用数组</p>
<p><strong>数组其实就是一个简单哈希表</strong>，而且这道题目中字符串只有小写字符，那么就可以定义一个数组，来记录字符串s里字符出现的次数。需要定义一个多大的数组呢，定一个数组叫做record，大小为26 就可以了，初始化为0，因为字符a到字符z的ASCII也是26个连续的数值。</p>
<p>定义一个数组叫做record用来上记录字符串s里字符出现的次数。</p>
<p>需要把字符映射到数组也就是哈希表的索引下标上，<strong>因为字符a到字符z的ASCII是26个连续的数值，所以字符a映射为下标0，相应的字符z映射为下标25。</strong></p>
<p>再遍历 字符串s的时候，<strong>只需要将 s[i] - ‘a’ 所在的元素做+1 操作即可，并不需要记住字符a的ASCII，只要求出一个相对数值就可以了。</strong> 这样就将字符串s中字符出现的次数，统计出来了。</p>
<p>那看一下如何检查字符串t中是否出现了这些字符，同样在遍历字符串t的时候，对t中出现的字符映射哈希表索引上的数值再做-1的操作。</p>
<p>那么最后检查一下，<strong>record数组如果有的元素不为零0，说明字符串s和t一定是谁多了字符或者谁少了字符，return false。</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 242. 有效的字母异位词 字典解法</span></span><br><span class="line"><span class="comment"> * 时间复杂度O(m+n) 空间复杂度O(1)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isAnagram</span><span class="params">(String s, String t)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] record = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">26</span>];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            record[s.charAt(i) - <span class="string">&#x27;a&#x27;</span>]++;     <span class="comment">// 并不需要记住字符a的ASCII，只要求出一个相对数值就可以了</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; t.length(); i++) &#123;</span><br><span class="line">            record[t.charAt(i) - <span class="string">&#x27;a&#x27;</span>]--;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> count: record) &#123;</span><br><span class="line">            <span class="keyword">if</span> (count != <span class="number">0</span>) &#123;               <span class="comment">// record数组如果有的元素不为零0，说明字符串s和t 一定是谁多了字符或者谁少了字符。</span></span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;                        <span class="comment">// record数组所有元素都为零0，说明字符串s和t是字母异位词</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-349"><a href="#Leetcode-349" class="headerlink" title="Leetcode 349"></a>Leetcode 349</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] intersection(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2) &#123;</span><br><span class="line">    <span class="keyword">if</span>(nums1==<span class="literal">null</span>||nums2==<span class="literal">null</span>||nums1.length==<span class="number">0</span>||nums2.length==<span class="number">0</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0</span>];</span><br><span class="line">    &#125;</span><br><span class="line">    Set&lt;Integer&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    Set&lt;Integer&gt; resSet = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i:nums1)&#123;</span><br><span class="line">        set.add(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i:nums2)&#123;</span><br><span class="line">        <span class="keyword">if</span>(set.contains(i))&#123;</span><br><span class="line">            resSet.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">     <span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[resSet.size()];</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i : resSet)&#123;</span><br><span class="line">            arr[j++] = i;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">return</span> arr;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-202-快乐数"><a href="#Leetcode-202-快乐数" class="headerlink" title="Leetcode 202 快乐数"></a>Leetcode 202 快乐数</h4><p>这个题讨论3种假设情况</p>
<ol>
<li>最后n1-&gt;n2-&gt;…-&gt;1 true</li>
<li>最后循环下来了,n1-&gt;n2-&gt;…-&gt;n1 false</li>
<li>越加越大</li>
</ol>
<p>但是事实上不会越加越大，拿9来举例，9^2&#x3D;81,99-&gt;162, ….999-&gt;243,9999-&gt;324,99999-&gt;405这样加下去，不会超其本身，所以不会越加越大。所以我们只需要讨论前两种方案，只要在循环过程中出现了重复的，就停止循环并返回，出现1了也停止循环并返回。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isHappy</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        Set&lt;Integer&gt; record = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">while</span> (n != <span class="number">1</span> &amp;&amp; !record.contains(n)) &#123;</span><br><span class="line">            record.add(n);</span><br><span class="line">            n = getNextNumber(n);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n == <span class="number">1</span>;</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getNextNumber</span><span class="params">(<span class="type">int</span> n)</span>&#123;</span><br><span class="line">    <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(n&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> n%<span class="number">10</span>;</span><br><span class="line">        res+=temp*temp;</span><br><span class="line">        n=n/<span class="number">10</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-1-两数之和"><a href="#Leetcode-1-两数之和" class="headerlink" title="Leetcode 1 两数之和"></a>Leetcode 1 两数之和</h4><p><strong>Brute force:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;nums.length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(i==j)&#123;</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>((nums[i]+nums[j])==target)&#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;i,j&#125;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>HashMap:</strong></p>
<p>本解法有四个重点：</p>
<ul>
<li>为什么会想到用哈希表</li>
<li>哈希表为什么用map</li>
<li>本题map是用来存什么的</li>
<li>map中的key和value用来存什么的</li>
</ul>
<p>map目的用来存放我们访问过的元素，因为遍历数组的时候，需要记录我们之前遍历过哪些元素和对应的下标，这样才能找到与当前元素相匹配的（也就是相加等于target）</p>
<p>接下来是map中key和value分别表示什么。</p>
<p>这道题 我们需要 给出一个元素，判断这个元素是否出现过，如果出现过，返回这个元素的下标。</p>
<p>那么判断元素是否出现，这个元素就要作为key，所以数组中的元素作为key，有key对应的就是value，value用来存下标。</p>
<p>所以 map中的存储结构为 {key：数据元素，value：数组元素对应的下标}。</p>
<p>在遍历数组的时候，只需要向map去查询是否有和目前遍历元素匹配的数值，如果有，就找到的匹配对，如果没有，就把目前遍历的元素放进map中，因为map存放的就是我们访问过的元素。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums, <span class="type">int</span> target) &#123;</span><br><span class="line">    <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">if</span>(nums==<span class="literal">null</span>||nums.length==<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    Map&lt;Integer,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> target-nums[i];</span><br><span class="line">        <span class="keyword">if</span>(map.containsKey(temp))&#123;</span><br><span class="line">            res[<span class="number">0</span>]=i;</span><br><span class="line">            res[<span class="number">1</span>]=map.get(temp);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        map.put(nums[i],i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-454-四数相加"><a href="#Leetcode-454-四数相加" class="headerlink" title="Leetcode 454 四数相加"></a>Leetcode 454 四数相加</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">fourSumCount</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2, <span class="type">int</span>[] nums3, <span class="type">int</span>[] nums4)</span> &#123;</span><br><span class="line">        Map&lt;Integer,Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> temp;</span><br><span class="line">        <span class="type">int</span> res=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums1)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j:nums2)&#123;</span><br><span class="line">                temp=i+j;</span><br><span class="line">                <span class="keyword">if</span> (map.containsKey(temp)) &#123;</span><br><span class="line">                    map.put(temp, map.get(temp) + <span class="number">1</span>);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    map.put(temp, <span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i:nums3)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j:nums4)&#123;</span><br><span class="line">                temp=i+j;</span><br><span class="line">                <span class="keyword">if</span> (map.containsKey(<span class="number">0</span> - temp)) &#123;</span><br><span class="line">                    res += map.get(<span class="number">0</span> - temp);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="String-type-question"><a href="#String-type-question" class="headerlink" title="String type question"></a>String type question</h3><h4 id="344-Reverse-the-String"><a href="#344-Reverse-the-String" class="headerlink" title="344. Reverse the String"></a>344. Reverse the String</h4><p>使用双指针，<strong>left</strong>和<strong>right</strong></p>
<p>循环swap left 和 right 直到 <strong>left&gt;&#x3D;right</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] s)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> s.length-<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">while</span>(i&lt;j)&#123;</span><br><span class="line">        swap(s,i,j);</span><br><span class="line">        i++;</span><br><span class="line">        j--;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">char</span> s[], <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">    <span class="type">char</span> temp=s[i];</span><br><span class="line">    s[i]=s[j];</span><br><span class="line">    s[j]=temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="541-Reverse-the-String-II"><a href="#541-Reverse-the-String-II" class="headerlink" title="541. Reverse the String II"></a>541. Reverse the String II</h4><p>给定一个字符串 s 和一个整数 k，从字符串开头算起，每计数至 2k 个字符，就反转这 2k 字符中的前 k 个字符。</p>
<p>如果剩余字符少于 k 个，则将剩余字符全部反转。<br>如果剩余字符小于 2k 但大于或等于 k 个，则反转前 k 个字符，其余字符保持原样。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">reverseStr</span><span class="params">(String s, <span class="type">int</span> k)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">length</span> <span class="operator">=</span> s.length();</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">remain</span> <span class="operator">=</span> length;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (remain &gt;= <span class="number">2</span> * k) &#123;</span><br><span class="line">        res.append(reverse(s, <span class="number">0</span> + <span class="number">2</span> * k * count, k + <span class="number">2</span> * k * count));</span><br><span class="line">        res.append(s.substring(k + <span class="number">2</span> * k * count, <span class="number">2</span> * k + <span class="number">2</span> * k * count));</span><br><span class="line">        remain -= <span class="number">2</span> * k;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (remain &gt;= k) &#123;</span><br><span class="line">        res.append(reverse(s, <span class="number">0</span> + <span class="number">2</span> * k * count, k + <span class="number">2</span> * k * count));</span><br><span class="line">        res.append(s.substring(k + <span class="number">2</span> * k * count));</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">sub</span> <span class="operator">=</span> s.substring(<span class="number">0</span> + <span class="number">2</span> * k * count);</span><br><span class="line">        res.append(reverse(sub, <span class="number">0</span>, sub.length()));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> res.toString();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> String <span class="title function_">reverse</span><span class="params">(String s, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] a = s.substring(i, j).toCharArray();</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> a.length - <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        swap(a, left, right);</span><br><span class="line">        left++;</span><br><span class="line">        right--;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(a);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">char</span>[] s, <span class="type">int</span> i, <span class="type">int</span> j)</span> &#123;</span><br><span class="line">    <span class="type">char</span> <span class="variable">temp</span> <span class="operator">=</span> s[i];</span><br><span class="line">    s[i] = s[j];</span><br><span class="line">    s[j] = temp;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这题就是注意边界值的处理，别的没什么。</p>
<h4 id="剑指offer05"><a href="#剑指offer05" class="headerlink" title="剑指offer05"></a>剑指offer05</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">replaceSpace</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="type">char</span>[] ch = s.toCharArray();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">char</span> c: ch)&#123;</span><br><span class="line">        <span class="keyword">if</span>(c==<span class="number">32</span>)&#123;</span><br><span class="line">            sb.append(<span class="string">&quot;%20&quot;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            sb.append(c);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>双指针法，很巧妙</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">replaceSpace</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(s == <span class="literal">null</span> || s.length() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//扩充空间，空格数量2倍</span></span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">        <span class="keyword">if</span>(s.charAt(i) == <span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">            str.append(<span class="string">&quot;  &quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//若是没有空格直接返回</span></span><br><span class="line">    <span class="keyword">if</span>(str.length() == <span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//有空格情况 定义两个指针</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> s.length() - <span class="number">1</span>;<span class="comment">//左指针：指向原始字符串最后一个位置</span></span><br><span class="line">    s += str.toString();</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> s.length()-<span class="number">1</span>;<span class="comment">//右指针：指向扩展字符串的最后一个位置</span></span><br><span class="line">    <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line">    <span class="keyword">while</span>(left&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(chars[left] == <span class="string">&#x27; &#x27;</span>)&#123;</span><br><span class="line">            chars[right--] = <span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">            chars[right--] = <span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">            chars[right] = <span class="string">&#x27;%&#x27;</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            chars[right] = chars[left];</span><br><span class="line">        &#125;</span><br><span class="line">        left--;</span><br><span class="line">        right--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="151-翻转字符串里的单词"><a href="#151-翻转字符串里的单词" class="headerlink" title="151 翻转字符串里的单词"></a>151 翻转字符串里的单词</h4><p>My solution: use a stack</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">String[] words = s.split(<span class="string">&quot;\\s+&quot;</span>);</span><br><span class="line">Stack&lt;String&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span>(String word: words)&#123;</span><br><span class="line">    stack.push(word);</span><br><span class="line">&#125;</span><br><span class="line"><span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"><span class="keyword">while</span>(!stack.isEmpty())&#123;</span><br><span class="line">    sb.append(stack.pop());</span><br><span class="line">    sb.append(<span class="string">&quot; &quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> sb.toString().trim();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">reverseWords</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;ReverseWords.reverseWords2() called with: s = [&quot; + s + &quot;]&quot;);</span></span><br><span class="line">        <span class="comment">// 1.去除首尾以及中间多余空格</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> removeSpace(s);</span><br><span class="line">        <span class="comment">// 2.反转整个字符串</span></span><br><span class="line">        reverseString(sb, <span class="number">0</span>, sb.length() - <span class="number">1</span>);</span><br><span class="line">        <span class="comment">// 3.反转各个单词</span></span><br><span class="line">        reverseEachWord(sb);</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125; </span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> StringBuilder <span class="title function_">removeSpace</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;ReverseWords.removeSpace() called with: s = [&quot; + s + &quot;]&quot;);</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> s.length() - <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (s.charAt(start) == <span class="string">&#x27; &#x27;</span>) start++;</span><br><span class="line">        <span class="keyword">while</span> (s.charAt(end) == <span class="string">&#x27; &#x27;</span>) end--;<span class="comment">//这两行是为了去除头部和尾部的空格</span></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">while</span> (start &lt;= end) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s.charAt(start);</span><br><span class="line">            <span class="keyword">if</span> (c != <span class="string">&#x27; &#x27;</span> || sb.charAt(sb.length() - <span class="number">1</span>) != <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                sb.append(c);</span><br><span class="line">            &#125;</span><br><span class="line">            start++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;ReverseWords.removeSpace returned: sb = [&quot; + sb + &quot;]&quot;);</span></span><br><span class="line">        <span class="keyword">return</span> sb;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 反转字符串指定区间[start, end]的字符</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(StringBuilder sb, <span class="type">int</span> start, <span class="type">int</span> end)</span> &#123;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;ReverseWords.reverseString() called with: sb = [&quot; + sb + &quot;], start = [&quot; + start + &quot;], end = [&quot; + end + &quot;]&quot;);</span></span><br><span class="line">        <span class="keyword">while</span> (start &lt; end) &#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">temp</span> <span class="operator">=</span> sb.charAt(start);</span><br><span class="line">            sb.setCharAt(start, sb.charAt(end));</span><br><span class="line">            sb.setCharAt(end, temp);</span><br><span class="line">            start++;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// System.out.println(&quot;ReverseWords.reverseString returned: sb = [&quot; + sb + &quot;]&quot;);</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">reverseEachWord</span><span class="params">(StringBuilder sb)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">start</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> sb.length();</span><br><span class="line">        <span class="keyword">while</span> (start &lt; n) &#123;</span><br><span class="line">            <span class="keyword">while</span> (end &lt; n &amp;&amp; sb.charAt(end) != <span class="string">&#x27; &#x27;</span>) &#123;</span><br><span class="line">                end++;</span><br><span class="line">            &#125;</span><br><span class="line">            reverseString(sb, start, end - <span class="number">1</span>);</span><br><span class="line">            start = end + <span class="number">1</span>;</span><br><span class="line">            end = start + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="剑指offer58-II"><a href="#剑指offer58-II" class="headerlink" title="剑指offer58 II"></a>剑指offer58 II</h4><p>基本解法:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> String <span class="title function_">reverseLeftWords</span><span class="params">(String s, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="type">char</span>[] ss= s.toCharArray();</span><br><span class="line">    <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=n;i&lt;s.length();i++)&#123;</span><br><span class="line">        sb.append(ss[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">        sb.append(ss[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> sb.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>解法二，省空间</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">reverseLeftWords</span><span class="params">(String s, <span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] chars = s.toCharArray();</span><br><span class="line">        reverse(chars, <span class="number">0</span>, chars.length - <span class="number">1</span>);</span><br><span class="line">        reverse(chars, <span class="number">0</span>, chars.length - <span class="number">1</span> - n);</span><br><span class="line">        reverse(chars, chars.length - n, chars.length - <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(chars);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverse</span><span class="params">(<span class="type">char</span>[] chars, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">            chars[left] ^= chars[right];</span><br><span class="line">            chars[right] ^= chars[left];</span><br><span class="line">            chars[left] ^= chars[right];</span><br><span class="line">            left++;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="leetcode-28"><a href="#leetcode-28" class="headerlink" title="leetcode 28"></a>leetcode 28</h4><p>解法1:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strStr</span><span class="params">(String haystack, String needle)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(needle.length()&gt;haystack.length())&#123;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(haystack.equals(needle))&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">char</span>[] s1 = haystack.toCharArray();</span><br><span class="line">    <span class="type">int</span> <span class="variable">nLen</span> <span class="operator">=</span> needle.length();</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;=(s1.length-nLen);i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(s1[i]==needle.charAt(<span class="number">0</span>))&#123;</span><br><span class="line">            <span class="keyword">if</span>(haystack.substring(i,i+nLen).equals(needle))&#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>解法2: KMP</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">strStr</span><span class="params">(String haystack, String needle)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (needle.length() == <span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span>[] next = <span class="keyword">new</span> <span class="title class_">int</span>[needle.length()];</span><br><span class="line">        getNext(next, needle);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; haystack.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; needle.charAt(j) != haystack.charAt(i)) </span><br><span class="line">                j = next[j - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (needle.charAt(j) == haystack.charAt(i)) </span><br><span class="line">                j++;</span><br><span class="line">            <span class="keyword">if</span> (j == needle.length()) </span><br><span class="line">                <span class="keyword">return</span> i - needle.length() + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">getNext</span><span class="params">(<span class="type">int</span>[] next, String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        next[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt; s.length(); i++) &#123;</span><br><span class="line">            <span class="keyword">while</span> (j &gt; <span class="number">0</span> &amp;&amp; s.charAt(j) != s.charAt(i)) </span><br><span class="line">                j = next[j - <span class="number">1</span>];</span><br><span class="line">            <span class="keyword">if</span> (s.charAt(j) == s.charAt(i)) </span><br><span class="line">                j++;</span><br><span class="line">            next[i] = j; </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>next数组求法</p>
<p>构造一个getNext方法，传入next数组和模式串作为参数</p>
<p>1.初始化</p>
<p>2.讨论前缀和后缀不同的情况</p>
<p>3.讨论前缀和后缀相同的情况</p>
<p>4.更新next数组</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getNext(<span class="type">int</span>[] next,String s)&#123;</span><br><span class="line"></span><br><span class="line">  <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  next[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;s.size();i++)&#123;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">while</span>(s[i]!=s[j]&amp;&amp;j&gt;<span class="number">0</span>)&#123;</span><br><span class="line">				j=next[j-<span class="number">1</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    	<span class="keyword">if</span>(s[i]==s[j])&#123;</span><br><span class="line">        j++;</span><br><span class="line">      &#125;</span><br><span class="line">	next[i]=j;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-459"><a href="#Leetcode-459" class="headerlink" title="Leetcode 459"></a>Leetcode 459</h4><p>重复的字串</p>
<p>使用kmp算法的解法. 对整个字符串求next前缀数组，可以得到最长的相等前后缀长度，然后用字符串减去这个长度，就可以算得重复字串长度，如果该字符串是由这个字串重复构成的话，那么它是能被字符串长度整除的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">repeatedSubstringPattern</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> len=s.length();</span><br><span class="line">        <span class="keyword">if</span> (s.equals(<span class="string">&quot;&quot;</span>)) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="type">int</span> j=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span>[] next = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        next[<span class="number">0</span>]=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;len;i++)&#123;</span><br><span class="line">            <span class="keyword">while</span>(j&gt;<span class="number">0</span>&amp;&amp;s.charAt(j)!=s.charAt(i))&#123;</span><br><span class="line">                j=next[j-<span class="number">1</span>];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(s.charAt(j)==s.charAt(i))&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            next[i]=j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(len%(len-next[len-<span class="number">1</span>])==<span class="number">0</span>&amp;&amp;next[len-<span class="number">1</span>]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="栈与队列"><a href="#栈与队列" class="headerlink" title="栈与队列"></a>栈与队列</h3><h4 id="leetcode-232"><a href="#leetcode-232" class="headerlink" title="leetcode 232"></a>leetcode 232</h4><p><strong>用栈实现队列</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">    Stack&lt;Integer&gt; s1;</span><br><span class="line">    Stack&lt;Integer&gt; s2;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyQueue</span><span class="params">()</span> &#123;</span><br><span class="line">        s1=<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">        s2=<span class="keyword">new</span> <span class="title class_">Stack</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        s1.push(x);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(!s1.isEmpty())&#123;</span><br><span class="line">            s2.push(s1.pop());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> result=s2.pop();</span><br><span class="line">        <span class="keyword">while</span>(!s2.isEmpty())&#123;</span><br><span class="line">            s1.push(s2.pop());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span>(!s1.isEmpty())&#123;</span><br><span class="line">            s2.push(s1.pop());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> result=s2.peek();</span><br><span class="line">        <span class="keyword">while</span>(!s2.isEmpty())&#123;</span><br><span class="line">            s1.push(s2.pop());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> s1.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里面有四次将s1的元素和s2的元素互相倒过去或者倒回来的，所以我们可以将这一步抽象成一个方法。</p>
<h4 id="leetcode-225"><a href="#leetcode-225" class="headerlink" title="leetcode 225"></a>leetcode 225</h4><p><strong>用队列实现栈</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyStack</span> &#123;</span><br><span class="line"></span><br><span class="line">    Queue&lt;Integer&gt; queue1; <span class="comment">// 和栈中保持一样元素的队列</span></span><br><span class="line">    Queue&lt;Integer&gt; queue2; <span class="comment">// 辅助队列</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/** Initialize your data structure here. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyStack</span><span class="params">()</span> &#123;</span><br><span class="line">        queue1 = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue2 = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Push element x onto stack. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">push</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">        queue2.offer(x); <span class="comment">// 先放在辅助队列中</span></span><br><span class="line">        <span class="keyword">while</span> (!queue1.isEmpty())&#123;</span><br><span class="line">            queue2.offer(queue1.poll());</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;Integer&gt; queueTemp;</span><br><span class="line">        queueTemp = queue1;</span><br><span class="line">        queue1 = queue2;</span><br><span class="line">        queue2 = queueTemp; <span class="comment">// 最后交换queue1和queue2，将元素都放到queue1中</span></span><br><span class="line">    &#125;</span><br><span class="line">  <span class="comment">//在这里让队列push元素的方法使得最后保持pop的时候和栈的pop顺序一样就行</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Removes the element on top of the stack and returns that element. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">pop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue1.poll(); <span class="comment">// 因为queue1中的元素和栈中的保持一致，所以这个和下面两个的操作只看queue1即可</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Get the top element. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">top</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue1.peek();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/** Returns whether the stack is empty. */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">empty</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> queue1.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Leetcode20"><a href="#Leetcode20" class="headerlink" title="Leetcode20"></a>Leetcode20</h4><p><strong>括号匹配问题</strong></p>
<p>这个题主要有一点比较巧妙，我们来遍历整个字符串，遇到左括号，我们就往栈里面push其相应的右括号，在遇到右括号就开始判断这个栈首元素和这个右括号是否匹配，如果不匹配或者说栈已经空了，那么就是返回false。最后完成字符串扫描后，如果栈内还没pop干净也说明没匹配上。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(s.length()%<span class="number">2</span>!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">char</span>[] ss = s.toCharArray();</span><br><span class="line">        Deque&lt;Character&gt; dq = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:ss)&#123;</span><br><span class="line">            <span class="keyword">if</span>(c==<span class="string">&#x27;(&#x27;</span>)&#123;</span><br><span class="line">                dq.push(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(c==<span class="string">&#x27;&#123;&#x27;</span>)&#123;</span><br><span class="line">                dq.push(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(c==<span class="string">&#x27;[&#x27;</span>)&#123;</span><br><span class="line">                dq.push(<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(dq.isEmpty()||dq.peek()!=c)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                dq.pop();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dq.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-1047-删除字符串中的所有相邻重复项"><a href="#Leetcode-1047-删除字符串中的所有相邻重复项" class="headerlink" title="Leetcode 1047 删除字符串中的所有相邻重复项"></a>Leetcode 1047 删除字符串中的所有相邻重复项</h4><p>这道题和上一道括号匹配问题类似，都是用栈来解决</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">removeDuplicates</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] ss = s.toCharArray();</span><br><span class="line">        Deque&lt;Character&gt; dq = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">char</span> c:ss)&#123;</span><br><span class="line">            <span class="keyword">if</span>(!dq.isEmpty()&amp;&amp;dq.peek()==c)&#123;</span><br><span class="line">                dq.pop();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                dq.push(c);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">while</span>(!dq.isEmpty())&#123;</span><br><span class="line">            sb.append(dq.pollLast());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sb.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode150-逆波兰式表达式求值"><a href="#Leetcode150-逆波兰式表达式求值" class="headerlink" title="Leetcode150 逆波兰式表达式求值"></a>Leetcode150 逆波兰式表达式求值</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">evalRPN</span><span class="params">(String[] tokens)</span> &#123;</span><br><span class="line">       Deque&lt;String&gt; dq = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">       <span class="keyword">for</span>(String s:tokens)&#123;</span><br><span class="line">           <span class="keyword">if</span>(s.equals(<span class="string">&quot;+&quot;</span>))&#123;</span><br><span class="line">               <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.parseInt(dq.pop());</span><br><span class="line">               <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Integer.parseInt(dq.pop());</span><br><span class="line">               dq.push(Integer.toString(a+b));</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;*&quot;</span>))&#123;</span><br><span class="line">               <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.parseInt(dq.pop());</span><br><span class="line">               <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Integer.parseInt(dq.pop());</span><br><span class="line">               dq.push(Integer.toString(a*b));</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;-&quot;</span>))&#123;</span><br><span class="line">               <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.parseInt(dq.pop());</span><br><span class="line">               <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Integer.parseInt(dq.pop());</span><br><span class="line">               dq.push(Integer.toString(b-a));</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="keyword">else</span> <span class="keyword">if</span>(s.equals(<span class="string">&quot;/&quot;</span>))&#123;</span><br><span class="line">               <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> Integer.parseInt(dq.pop());</span><br><span class="line">               <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> Integer.parseInt(dq.pop());</span><br><span class="line">               dq.push(Integer.toString(b/a));</span><br><span class="line">           &#125;</span><br><span class="line">       <span class="keyword">else</span>&#123;</span><br><span class="line">           dq.push(s);</span><br><span class="line">       &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> Integer.parseInt(dq.pop());</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode239-滑动窗口的最大值"><a href="#Leetcode239-滑动窗口的最大值" class="headerlink" title="Leetcode239 滑动窗口的最大值"></a>Leetcode239 滑动窗口的最大值</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyQueue</span> &#123;</span><br><span class="line">    Deque&lt;Integer&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    <span class="comment">//弹出元素时，比较当前要弹出的数值是否等于队列出口的数值，如果相等则弹出</span></span><br><span class="line">    <span class="comment">//同时判断队列当前是否为空</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">poll</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!deque.isEmpty() &amp;&amp; val == deque.peek()) &#123;</span><br><span class="line">            deque.poll();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//添加元素时，如果要添加的元素大于入口处的元素，就将入口元素弹出</span></span><br><span class="line">    <span class="comment">//保证队列元素单调递减</span></span><br><span class="line">    <span class="comment">//比如此时队列元素3,1，2将要入队，比1大，所以1弹出，此时队列：3,2</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> val)</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (!deque.isEmpty() &amp;&amp; val &gt; deque.getLast()) &#123;</span><br><span class="line">            deque.removeLast();</span><br><span class="line">        &#125;</span><br><span class="line">        deque.add(val);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//队列队顶元素始终为最大值</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">peek</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> deque.peek();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] maxSlidingWindow(<span class="type">int</span>[] nums, <span class="type">int</span> k) &#123;</span><br><span class="line">        <span class="keyword">if</span> (nums.length == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> nums;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> nums.length - k + <span class="number">1</span>;</span><br><span class="line">        <span class="comment">//存放结果元素的数组</span></span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[len];</span><br><span class="line">        <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//自定义队列</span></span><br><span class="line">        <span class="type">MyQueue</span> <span class="variable">myQueue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyQueue</span>();</span><br><span class="line">        <span class="comment">//先将前k的元素放入队列</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">            myQueue.add(nums[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        res[num++] = myQueue.peek();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> k; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="comment">//滑动窗口移除最前面的元素，移除是判断该元素是否放入队列</span></span><br><span class="line">            myQueue.poll(nums[i - k]);</span><br><span class="line">            <span class="comment">//滑动窗口加入最后面的元素</span></span><br><span class="line">            myQueue.add(nums[i]);</span><br><span class="line">            <span class="comment">//记录对应的最大值</span></span><br><span class="line">            res[num++] = myQueue.peek();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="树-x2F-Tree"><a href="#树-x2F-Tree" class="headerlink" title="树&#x2F;Tree"></a>树&#x2F;Tree</h3><h4 id="树的种类"><a href="#树的种类" class="headerlink" title="树的种类"></a>树的种类</h4><p><strong>满二叉树</strong>：如果一棵二叉树只有度为0的结点和度为2的结点，并且度为0的结点在同一层上，则这棵二叉树为满二叉树。</p>
<p><strong>完全二叉树</strong>：在完全二叉树中，除了最底层节点可能没填满外，其余每层节点数都达到最大值，并且最下面一层的节点都集中在该层最左边的若干位置。若最底层为第 h 层（h从1开始），则该层包含 1~ 2^(h-1) 个节点。</p>
<p><strong>二叉搜索树</strong> (有序树):</p>
<ul>
<li>若它的左子树不空，则左子树上所有结点的值均小于它的根结点的值；</li>
<li>若它的右子树不空，则右子树上所有结点的值均大于它的根结点的值；</li>
<li>它的左、右子树也分别为二叉排序树</li>
</ul>
<p>**平衡二叉树AVL(Adelson-Velsky and Landis): **它是一棵空树或它的左右两个子树的高度差的绝对值不超过1，并且左右两个子树都是一棵平衡二叉树。</p>
<h4 id="树的实现"><a href="#树的实现" class="headerlink" title="树的实现"></a>树的实现</h4><p>链式存储（使用指针），顺序存储（使用数组）</p>
<h4 id="树的遍历"><a href="#树的遍历" class="headerlink" title="树的遍历"></a>树的遍历</h4><p><strong>1.DFS:</strong> </p>
<p>先往深走，遇到叶子节点再往回走</p>
<ul>
<li>前序遍历（递归法，迭代法）</li>
<li>中序遍历（递归法，迭代法）</li>
<li>后序遍历（递归法，迭代法）</li>
</ul>
<p><strong>2.BFS:</strong></p>
<p>一层一层的去遍历。</p>
<ul>
<li>层次遍历（迭代法）</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TreeNode</span> &#123;</span><br><span class="line">    <span class="type">int</span> val;</span><br><span class="line">    TreeNode left;</span><br><span class="line">    TreeNode right;</span><br><span class="line"></span><br><span class="line">    TreeNode() &#123;&#125;</span><br><span class="line">    TreeNode(<span class="type">int</span> val) &#123; <span class="built_in">this</span>.val = val; &#125;</span><br><span class="line">    TreeNode(<span class="type">int</span> val, TreeNode left, TreeNode right) &#123;</span><br><span class="line">        <span class="built_in">this</span>.val = val;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="二叉树递归遍历-DFS"><a href="#二叉树递归遍历-DFS" class="headerlink" title="二叉树递归遍历,DFS"></a>二叉树递归遍历,DFS</h4><p>前序遍历: 中左右 leetcode 144</p>
<p>中序遍历: 左中右 leetcode 145</p>
<p>后序遍历: 左右中 leetcode 94</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 前序遍历·递归·LC144_二叉树的前序遍历</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        preorder(root, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">preorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; result)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result.add(root.val);</span><br><span class="line">        preorder(root.left, result);</span><br><span class="line">        preorder(root.right, result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 中序遍历·递归·LC94_二叉树的中序遍历</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        inorder(root, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">inorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        inorder(root.left, list);</span><br><span class="line">        list.add(root.val);             <span class="comment">// 注意这一句</span></span><br><span class="line">        inorder(root.right, list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 后序遍历·递归·LC145_二叉树的后序遍历</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        postorder(root, res);</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">postorder</span><span class="params">(TreeNode root, List&lt;Integer&gt; list)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        postorder(root.left, list);</span><br><span class="line">        postorder(root.right, list);</span><br><span class="line">        list.add(root.val);             <span class="comment">// 注意这一句</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="N叉树的前序和后序遍历-leetcode-589-590"><a href="#N叉树的前序和后序遍历-leetcode-589-590" class="headerlink" title="N叉树的前序和后序遍历, leetcode 589,590"></a>N叉树的前序和后序遍历, leetcode 589,590</h4><p><strong>前序:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    pre(root,res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pre</span><span class="params">(Node root, List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    list.add(root.val);</span><br><span class="line">    <span class="keyword">for</span>(Node child : root.children)&#123;</span><br><span class="line">        pre(child,list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>后序:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    post(root,res);</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">post</span><span class="params">(Node root,List&lt;Integer&gt; list)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(root == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(Node child:root.children)&#123;</span><br><span class="line">        post(child,list);</span><br><span class="line">    &#125;</span><br><span class="line">    list.add(root.val);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="二叉树遍历，迭代法-DFS"><a href="#二叉树遍历，迭代法-DFS" class="headerlink" title="二叉树遍历，迭代法, DFS"></a>二叉树遍历，迭代法, DFS</h4><p>使用栈来进行迭代</p>
<p>前序</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">preorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        stack.push(root);</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty())&#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">            result.add(node.val);</span><br><span class="line">            <span class="keyword">if</span> (node.right != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (node.left != <span class="literal">null</span>)&#123;</span><br><span class="line">                stack.push(node.left);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>中序</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">inorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> result;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">cur</span> <span class="operator">=</span> root;</span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">null</span> || !stack.isEmpty())&#123;</span><br><span class="line">           <span class="keyword">if</span> (cur != <span class="literal">null</span>)&#123;</span><br><span class="line">               stack.push(cur);</span><br><span class="line">               cur = cur.left;</span><br><span class="line">           &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">               cur = stack.pop();</span><br><span class="line">               result.add(cur.val);</span><br><span class="line">               cur = cur.right;</span><br><span class="line">           &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>后序</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">postorderTraversal</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    List&lt;Integer&gt; result = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">if</span> (root == <span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line">    stack.push(root);</span><br><span class="line">    <span class="keyword">while</span> (!stack.isEmpty())&#123;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">        result.add(node.val);</span><br><span class="line">        <span class="keyword">if</span> (node.left != <span class="literal">null</span>)&#123;</span><br><span class="line">            stack.push(node.left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (node.right != <span class="literal">null</span>)&#123;</span><br><span class="line">            stack.push(node.right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Collections.reverse(result);</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="BFS"><a href="#BFS" class="headerlink" title="BFS"></a>BFS</h4><p><strong>Leetcode 102&#x2F;107</strong></p>
<p>需要队列来实现&#x2F;或者递归</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;List&lt;Integer&gt;&gt;();</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> res;</span><br><span class="line">       &#125;</span><br><span class="line">       Queue&lt;TreeNode&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;TreeNode&gt;();</span><br><span class="line">       que.offer(root);</span><br><span class="line"></span><br><span class="line">       <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">           List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">           <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> que.size();<span class="comment">//记录了每一层的节点个数，方便我们进入下一层。</span></span><br><span class="line">           <span class="keyword">while</span>(len&gt;<span class="number">0</span>)&#123;</span><br><span class="line">               <span class="type">TreeNode</span> <span class="variable">tem</span> <span class="operator">=</span> que.poll();</span><br><span class="line">               list.add(tem.val);</span><br><span class="line">               <span class="keyword">if</span>(tem.left!=<span class="literal">null</span>) que.offer(tem.left);</span><br><span class="line">               <span class="keyword">if</span>(tem.right!=<span class="literal">null</span>) que.offer(tem.right);</span><br><span class="line">               len--;</span><br><span class="line"></span><br><span class="line">           &#125;</span><br><span class="line">           res.add(list);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Leetcode 199 返回二叉树的右视图</strong></p>
<p>还是bfs，不过不用构造整棵二叉树，就返回每一层最右边的那个值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">rightSideView</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> res;</span><br><span class="line">        &#125;</span><br><span class="line">        Queue&lt;TreeNode&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        que.offer(root);</span><br><span class="line">        <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> que.size();</span><br><span class="line">            <span class="keyword">while</span>(len&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> que.poll();</span><br><span class="line">                <span class="keyword">if</span>(len==<span class="number">1</span>)&#123;</span><br><span class="line">                    res.add(node.val);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) que.offer(node.left);</span><br><span class="line">                <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) que.offer(node.right);</span><br><span class="line">                len--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<p><strong>Leetcode 637</strong></p>
<p>求每一层的平均值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Double&gt; <span class="title function_">averageOfLevels</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        List&lt;Double&gt; averages = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Double&gt;();</span><br><span class="line">       Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;TreeNode&gt;();</span><br><span class="line">       queue.offer(root);</span><br><span class="line">       <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">           <span class="type">double</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">           <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">               <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">               sum += node.val;</span><br><span class="line">               <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> node.left, right = node.right;</span><br><span class="line">               <span class="keyword">if</span> (left != <span class="literal">null</span>) &#123;</span><br><span class="line">                   queue.offer(left);</span><br><span class="line">               &#125;</span><br><span class="line">               <span class="keyword">if</span> (right != <span class="literal">null</span>) &#123;</span><br><span class="line">                   queue.offer(right);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;</span><br><span class="line">           averages.add(sum / size);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> averages;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p><strong>Leetcode 429</strong></p>
<p>遍历n叉树</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"><span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line">Queue&lt;Node&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">que.offer(root);</span><br><span class="line"><span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> que.size();</span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">while</span>(size&gt;<span class="number">0</span>)&#123;</span><br><span class="line">        <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> que.poll();</span><br><span class="line">        list.add(node.val);</span><br><span class="line">        <span class="keyword">for</span>(Node child:node.children)&#123;</span><br><span class="line">            <span class="keyword">if</span>(child!=<span class="literal">null</span>)&#123;</span><br><span class="line">                que.offer(child);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        size--;</span><br><span class="line">    &#125;</span><br><span class="line">    res.add(list);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Leetcode 515</strong></p>
<p>每一层的最大值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">largestValues</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> res;</span><br><span class="line">       &#125;</span><br><span class="line">       Queue&lt;TreeNode&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">       que.offer(root);</span><br><span class="line">       <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">           <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> que.size();</span><br><span class="line">           <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">           <span class="keyword">while</span>(size&gt;<span class="number">0</span>)&#123;</span><br><span class="line">               <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> que.poll();</span><br><span class="line">               <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) que.offer(node.left);</span><br><span class="line">               <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) que.offer(node.right);</span><br><span class="line">               <span class="keyword">if</span>(node.val&gt;max) max=node.val;</span><br><span class="line">               size--;</span><br><span class="line">           &#125;</span><br><span class="line">           res.add(max);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p><strong>Leetcode 116&#x2F;117</strong></p>
<p>这两道题用这个答案都可以通过leetcode</p>
<p>添加next指针，注意处理一下引入previous结点</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Node <span class="title function_">connect</span><span class="params">(Node root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">    Queue&lt;Node&gt; que = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">    que.offer(root);</span><br><span class="line">    <span class="keyword">while</span>(!que.isEmpty())&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> que.size();</span><br><span class="line">        <span class="type">Node</span> <span class="variable">previous</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="keyword">while</span>(len&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="type">Node</span> <span class="variable">node</span> <span class="operator">=</span> que.poll();</span><br><span class="line">            <span class="keyword">if</span>(previous!=<span class="literal">null</span>)&#123;</span><br><span class="line">                previous.next=node;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(len==<span class="number">1</span>)&#123;</span><br><span class="line">                node.next=<span class="literal">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(node.left!=<span class="literal">null</span>) que.offer(node.left);</span><br><span class="line">            <span class="keyword">if</span>(node.right!=<span class="literal">null</span>) que.offer(node.right);</span><br><span class="line">            previous=node;</span><br><span class="line">            len--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>Leetcode 104</strong></p>
<p>求最大深度递归就行了，不用遍历</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> Math.max((maxDepth(root.left)+<span class="number">1</span>),(maxDepth(root.right)+<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>Leetcode 111</strong></p>
<p>求最小深度的时候要讨论树退化成线性的情况，因为如果直接递归的话，这样子返回的最小值是1，但是其实这颗树的最小深度是整颗树的高度。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(root.right==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> minDepth(root.left)+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>(root.left==<span class="literal">null</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> minDepth(root.right)+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> Math.min((minDepth(root.left)+<span class="number">1</span>),(minDepth(root.right)+<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minDepth</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line"><span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"><span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> minDepth(root.left);</span><br><span class="line"><span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> minDepth(root.right);</span><br><span class="line"><span class="keyword">if</span>(left==<span class="number">0</span>||right==<span class="number">0</span>) <span class="keyword">return</span> left+right+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">return</span> Math.min(left,right)+<span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-226-翻转二叉树"><a href="#Leetcode-226-翻转二叉树" class="headerlink" title="Leetcode 226 翻转二叉树"></a>Leetcode 226 翻转二叉树</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> TreeNode <span class="title function_">invertTree</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">       <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> root.left;  <span class="comment">// 后面的操作会改变 left 指针，因此先保存下来</span></span><br><span class="line">       root.left=invertTree(root.right);</span><br><span class="line">       root.right=invertTree(left);</span><br><span class="line">       <span class="keyword">return</span> root;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcoed-100-相同的二叉树"><a href="#Leetcoed-100-相同的二叉树" class="headerlink" title="Leetcoed 100 相同的二叉树"></a>Leetcoed 100 相同的二叉树</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSameTree</span><span class="params">(TreeNode p, TreeNode q)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="literal">null</span>&amp;&amp;q==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p==<span class="literal">null</span>||q==<span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(p.val!=q.val)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isSameTree(p.left,q.left)&amp;&amp;isSameTree(p.right,q.right);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-101-对称二叉树"><a href="#Leetcode-101-对称二叉树" class="headerlink" title="Leetcode 101 对称二叉树"></a>Leetcode 101 对称二叉树</h4><p>递归法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span>(root==<span class="literal">null</span>) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       <span class="keyword">return</span> sym(root.left,root.right);</span><br><span class="line">&#125;</span><br><span class="line">   <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">sym</span><span class="params">(TreeNode t1, TreeNode t2)</span>&#123;</span><br><span class="line">       <span class="keyword">if</span>(t1==<span class="literal">null</span>&amp;t2==<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(t1==<span class="literal">null</span>||t2==<span class="literal">null</span>)&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span>(t1.val!=t2.val)&#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> sym(t1.left,t2.right)&amp;&amp;sym(t2.left,t1.right);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<p>迭代法，使用队列</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSymmetric</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; deque = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        deque.offer(root.left);</span><br><span class="line">        deque.offer(root.right);</span><br><span class="line">        <span class="keyword">while</span> (!deque.isEmpty()) &#123;</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">leftNode</span> <span class="operator">=</span> deque.poll();</span><br><span class="line">            <span class="type">TreeNode</span> <span class="variable">rightNode</span> <span class="operator">=</span> deque.poll();</span><br><span class="line">            <span class="keyword">if</span> (leftNode == <span class="literal">null</span> &amp;&amp; rightNode == <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            if (leftNode != null &amp;&amp; rightNode == null) &#123;</span></span><br><span class="line"><span class="comment">//                return false;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//            if (leftNode.val != rightNode.val) &#123;</span></span><br><span class="line"><span class="comment">//                return false;</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line">            <span class="comment">// 以上三个判断条件合并</span></span><br><span class="line">            <span class="keyword">if</span> (leftNode == <span class="literal">null</span> || rightNode == <span class="literal">null</span> || leftNode.val != rightNode.val) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 这里顺序与使用Deque不同</span></span><br><span class="line">            deque.offer(leftNode.left);</span><br><span class="line">            deque.offer(rightNode.right);</span><br><span class="line">            deque.offer(leftNode.right);</span><br><span class="line">            deque.offer(rightNode.left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-222"><a href="#Leetcode-222" class="headerlink" title="Leetcode 222"></a>Leetcode 222</h4><p>完全二叉树的个数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countNodes</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(root==<span class="literal">null</span>)&#123;</span><br><span class="line">          <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> countNodes(root.left)+countNodes(root.right)+<span class="number">1</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-110"><a href="#Leetcode-110" class="headerlink" title="Leetcode 110"></a>Leetcode 110</h4><p>平衡二叉树</p>
<p>这道题和求最大深度不一样，子树中要是最大深度差大于一了也不是平衡二叉树。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> getHeight(root) != -<span class="number">1</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">getHeight</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">int</span> <span class="variable">leftHeight</span> <span class="operator">=</span> getHeight(root.left);</span><br><span class="line">       <span class="keyword">if</span> (leftHeight == -<span class="number">1</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="type">int</span> <span class="variable">rightHeight</span> <span class="operator">=</span> getHeight(root.right);</span><br><span class="line">       <span class="keyword">if</span> (rightHeight == -<span class="number">1</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 左右子树高度差大于1，return -1表示已经不是平衡树了</span></span><br><span class="line">       <span class="keyword">if</span> (Math.abs(leftHeight - rightHeight) &gt; <span class="number">1</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> Math.max(leftHeight, rightHeight) + <span class="number">1</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isBalanced</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.abs(height(root.left) - height(root.right)) &lt;= <span class="number">1</span> &amp;&amp; isBalanced(root.left) &amp;&amp; isBalanced(root.right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">height</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Math.max(height(root.left), height(root.right)) + <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-257-二叉树的所有路径"><a href="#Leetcode-257-二叉树的所有路径" class="headerlink" title="Leetcode 257 二叉树的所有路径"></a>Leetcode 257 二叉树的所有路径</h4><p>前序遍历法,在遍历的过程中记得时刻记录每一条路径，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">binaryTreePaths</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line"> List&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"> <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">     <span class="keyword">return</span> res;</span><br><span class="line"> &#125;</span><br><span class="line"> Stack&lt;TreeNode&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"> stack.push(root);</span><br><span class="line"></span><br><span class="line"> Stack&lt;StringBuilder&gt; paths = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"> <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line"> sb.append(Integer.toString(root.val));</span><br><span class="line"> paths.push(sb);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">     <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> stack.pop();</span><br><span class="line">     sb = paths.pop();</span><br><span class="line"></span><br><span class="line">     <span class="keyword">if</span> (node.right != <span class="literal">null</span>) &#123;</span><br><span class="line">         stack.push(node.right);</span><br><span class="line">         <span class="type">StringBuilder</span> <span class="variable">newPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(sb);</span><br><span class="line">         newPath.append(<span class="string">&quot;-&gt;&quot;</span>);</span><br><span class="line">         newPath.append(Integer.toString(node.right.val));</span><br><span class="line">         paths.push(newPath);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (node.left != <span class="literal">null</span>) &#123;</span><br><span class="line">         stack.push(node.left);</span><br><span class="line">         <span class="type">StringBuilder</span> <span class="variable">newPath</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(sb);</span><br><span class="line">         newPath.append(<span class="string">&quot;-&gt;&quot;</span>);</span><br><span class="line">         newPath.append(Integer.toString(node.left.val));</span><br><span class="line">         paths.push(newPath);</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">if</span> (node.left == <span class="literal">null</span> &amp;&amp; node.right == <span class="literal">null</span>) &#123;</span><br><span class="line">         <span class="type">String</span> <span class="variable">route</span> <span class="operator">=</span> sb.toString();</span><br><span class="line">         res.add(route);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="keyword">return</span> res;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>迭代法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;String&gt; <span class="title function_">binaryTreePaths</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">       List&lt;String&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();<span class="comment">// 存最终的结果</span></span><br><span class="line">       <span class="keyword">if</span> (root == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> res;</span><br><span class="line">       &#125;</span><br><span class="line">       List&lt;Integer&gt; paths = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();<span class="comment">// 作为结果中的路径</span></span><br><span class="line">       traversal(root, paths, res);</span><br><span class="line">       <span class="keyword">return</span> res;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">traversal</span><span class="params">(TreeNode root, List&lt;Integer&gt; paths, List&lt;String&gt; res)</span> &#123;</span><br><span class="line">       paths.add(root.val);<span class="comment">// 前序遍历，中</span></span><br><span class="line">       <span class="comment">// 遇到叶子结点</span></span><br><span class="line">       <span class="keyword">if</span> (root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>) &#123;</span><br><span class="line">           <span class="comment">// 输出</span></span><br><span class="line">           <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();<span class="comment">// StringBuilder用来拼接字符串，速度更快</span></span><br><span class="line">           <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; paths.size() - <span class="number">1</span>; i++) &#123;</span><br><span class="line">               sb.append(paths.get(i)).append(<span class="string">&quot;-&gt;&quot;</span>);</span><br><span class="line">           &#125;</span><br><span class="line">           sb.append(paths.get(paths.size() - <span class="number">1</span>));<span class="comment">// 记录最后一个节点</span></span><br><span class="line">           res.add(sb.toString());<span class="comment">// 收集一个路径</span></span><br><span class="line">           <span class="keyword">return</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="comment">// 递归和回溯是同时进行，所以要放在同一个花括号里</span></span><br><span class="line">       <span class="keyword">if</span> (root.left != <span class="literal">null</span>) &#123; <span class="comment">// 左</span></span><br><span class="line">           traversal(root.left, paths, res);</span><br><span class="line">           paths.remove(paths.size() - <span class="number">1</span>);<span class="comment">// 回溯</span></span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">if</span> (root.right != <span class="literal">null</span>) &#123; <span class="comment">// 右</span></span><br><span class="line">           traversal(root.right, paths, res);</span><br><span class="line">           paths.remove(paths.size() - <span class="number">1</span>);<span class="comment">// 回溯</span></span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>





<h4 id="Leetcode-404-左叶子之和"><a href="#Leetcode-404-左叶子之和" class="headerlink" title="Leetcode 404 左叶子之和"></a>Leetcode 404 左叶子之和</h4><p>寻找这课树左叶子结点的和，叶子结点是没有子节点的。</p>
<p>我们的思路是通过某个节点的父节点来判断他是否是叶子结点也就是node.left!&#x3D;null&amp;&amp;node.left.left&#x3D;&#x3D;null&amp;&amp;node.left.right&#x3D;&#x3D;null;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">sumOfLeftLeaves</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">leftValue</span> <span class="operator">=</span> sumOfLeftLeaves(root.left);    <span class="comment">// 左</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">rightValue</span> <span class="operator">=</span> sumOfLeftLeaves(root.right);  <span class="comment">// 右</span></span><br><span class="line">                                                       </span><br><span class="line">        <span class="type">int</span> <span class="variable">midValue</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">if</span> (root.left != <span class="literal">null</span> &amp;&amp; root.left.left == <span class="literal">null</span> &amp;&amp; root.left.right == <span class="literal">null</span>) &#123; </span><br><span class="line">            midValue = root.left.val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> midValue + leftValue + rightValue;  <span class="comment">// 中</span></span><br><span class="line">        <span class="keyword">return</span> sum;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="Leetcode-513"><a href="#Leetcode-513" class="headerlink" title="Leetcode 513"></a>Leetcode 513</h4><p>寻找二叉树最左下角的值，注意不一定是最左边的值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//递归法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">Deep</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        value = root.val;</span><br><span class="line">        findLeftValue(root,<span class="number">0</span>);</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">findLeftValue</span> <span class="params">(TreeNode root,<span class="type">int</span> deep)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (root == <span class="literal">null</span>) <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">if</span> (root.left == <span class="literal">null</span> &amp;&amp; root.right == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (deep &gt; Deep) &#123;</span><br><span class="line">                value = root.val;</span><br><span class="line">                Deep = deep;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (root.left != <span class="literal">null</span>) findLeftValue(root.left,deep + <span class="number">1</span>);</span><br><span class="line">        <span class="keyword">if</span> (root.right != <span class="literal">null</span>) findLeftValue(root.right,deep + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//迭代法</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findBottomLeftValue</span><span class="params">(TreeNode root)</span> &#123;</span><br><span class="line">        Queue&lt;TreeNode&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        queue.offer(root);</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">size</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; size; i++) &#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">poll</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">                    res = poll.val;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (poll.left != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.offer(poll.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (poll.right != <span class="literal">null</span>) &#123;</span><br><span class="line">                    queue.offer(poll.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="随想练习"><a href="#随想练习" class="headerlink" title="随想练习"></a>随想练习</h3><h4 id="Leetcode-852山峰数组"><a href="#Leetcode-852山峰数组" class="headerlink" title="Leetcode 852山峰数组"></a>Leetcode 852山峰数组</h4><p><strong>线性查找, O(n)</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peakIndexInMountainArray</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>,j=len-<span class="number">1</span>;i&lt;len;i++,j--)&#123;</span><br><span class="line">            <span class="keyword">if</span>(arr[i]&gt;arr[i+<span class="number">1</span>])&#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(arr[j-<span class="number">1</span>]&lt;arr[j])&#123;</span><br><span class="line">                <span class="keyword">return</span> j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><strong>二分查找, O(log(n))</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">peakIndexInMountainArray</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> arr.length - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (left &lt; right) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> left + (right - left) / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (arr[mid] &lt; arr[mid + <span class="number">1</span>]) &#123;</span><br><span class="line">            left = mid + <span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            right = mid;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> left;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>快速排序quicksort</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] array)</span>&#123;</span><br><span class="line">    quick(array,<span class="number">0</span>,array.length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">quick</span><span class="params">(<span class="type">int</span>[] array, <span class="type">int</span> left, <span class="type">int</span> right)</span> &#123;</span><br><span class="line"> </span><br><span class="line">    <span class="comment">//递归结束条件:这里代表只有一个根   大于号：有可能没有子树  1  2  3   4  1为基准，pivot-1就越界了</span></span><br><span class="line">    <span class="keyword">if</span>(left &gt;= right)&#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> partition(array, left, right);</span><br><span class="line">    quick(array,left,pivot-<span class="number">1</span>);</span><br><span class="line">    quick(array,pivot+<span class="number">1</span>,right);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] array,<span class="type">int</span> start, <span class="type">int</span> end)</span>&#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> start;<span class="comment">//这里存开始时基准的下标，为了循环结束后，相遇值和基准值交换时能找到基准值的下标</span></span><br><span class="line">    <span class="type">int</span> <span class="variable">key</span> <span class="operator">=</span> array[start];<span class="comment">//这是基准</span></span><br><span class="line">    <span class="keyword">while</span> (start &lt; end)&#123;</span><br><span class="line">        <span class="keyword">while</span> (start &lt; end &amp;&amp; array[end] &gt;= key)&#123;</span><br><span class="line">            end--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (start &lt; end &amp;&amp; array[start] &lt;= key)&#123;</span><br><span class="line">            start++;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(array,start,end);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//到这里s和e相遇，把相遇值和基准值交换</span></span><br><span class="line">    swap(array,start,i);</span><br><span class="line">    <span class="keyword">return</span> start;<span class="comment">//返回基准下标</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title>Secured Software Engineering</title>
    <url>/2023/04/21/Secured-Software-Engineering/</url>
    <content><![CDATA[<p>The below case studies are given here in advance, they will be part of the final exam. </p>
<p><strong>Case Study 1:</strong> You are part of a team that has been tasked with developing a web-based application for a healthcare organisation. The application will allow doctors to view patient information, including medical history, test results and treatment plans. Patients will also be able to access the application to view their own medical information and communicate with their doctors. The application will be used by a large number of healthcare providers and patients, and therefore security is a top priority. (Provided ahead of the exam) </p>
<p><strong>Case Study 2:</strong> ABC airlines operates a large number of flights globally. In 2021, the airline suffered a significant data breach that affected the personal information of thousands of customers. In response to this breach, ABC airlines invested in a new approach to secure software engineering, including implementing secure coding practices, testing and validating software, and conducting regular security audits. The company has a complex network infrastructure that includes several web servers, database servers, and application servers. (Provided ahead of the exam)</p>
<p><strong>案例研究1</strong>： 你是一个团队的成员，他们的任务是为一个医疗机构开发一个基于网络的应用程序。该应用程序将允许医生查看病人信息，包括病史、测试结果和治疗计划。病人也可以访问该应用程序，查看他们自己的医疗信息，并与他们的医生沟通。该应用程序将被大量的医疗服务提供者和病人使用，因此安全性是重中之重。(该案例研究是期末考试的一部分，在考试前提供给大家)</p>
<p><strong>案例研究2：</strong>ABC航空公司在全球范围内运营着大量的航班。2021年，该航空公司遭受了一次重大的数据泄露事件，影响了成千上万的客户的个人信息。为了应对这一漏洞，ABC航空公司投资了一种新的安全软件工程方法，包括实施安全编码实践，测试和验证软件，并定期进行安全审计。该公司有一个复杂的网络基础设施，包括几个网络服务器、数据库服务器和应用服务器。(在考试前提供)</p>
<p><strong>1.</strong> <strong>Case Study:</strong> You are part of a team that has been tasked with developing a web-based application for a healthcare organization. The application will allow doctors to view patient information, including medical history, test results and treatment plans. Patients will also be able to access the application to view their own medical information and communicate with their doctors. The application will be used by a large number of healthcare providers and patients, so security is a top priority. (This case study is part of the final exam, provided ahead of the exam here)</p>
<p><strong>(a)</strong> Identify and list down five use cases and five misuse cases of the system. [5]</p>
<p>Use Cases:</p>
<ol>
<li>Registration: A new patient can securely register on the platform, providing their personal and contact information, and setting up a strong, unique password.</li>
<li>Medical Record Access: A doctor can access a patient’s medical history, including previous diagnoses, treatment plans, medications, and test results, to make informed decisions regarding the patient’s care.</li>
<li>Appointment Scheduling: Patients can use the application to schedule appointments with their healthcare providers, selecting available dates and times and receiving confirmation notifications.</li>
<li>Secure Messaging: Doctors and patients can communicate via a secure messaging platform within the application, discussing treatment plans, symptoms, and other healthcare-related topics.</li>
<li>Prescription Management: Healthcare providers can securely prescribe medications through the application, enabling patients to access their prescriptions and facilitating communication with pharmacies.</li>
</ol>
<p>Misuse Cases:</p>
<ol>
<li>Unauthorized Access: An attacker gains unauthorized access to a patient’s account, potentially viewing, altering, or deleting sensitive medical information, or even impersonating the patient.</li>
<li>Man-in-the-Middle Attack: An attacker intercepts the communication between the patient and the healthcare provider, potentially modifying the messages sent or received or eavesdropping on sensitive information.</li>
<li>Phishing Attacks: An attacker sends phishing emails or messages to patients, posing as a healthcare provider or the application itself, in an attempt to steal login credentials or other sensitive information.</li>
<li>Distributed Denial-of-Service (DDoS) Attack: An attacker overwhelms the application with a large volume of traffic, causing it to become unresponsive or slow, preventing healthcare providers and patients from accessing necessary information and services.</li>
<li>Security Misconfiguration: The application’s security settings are not properly configured, leaving it vulnerable to attacks and exposing sensitive patient data.</li>
</ol>
<p><strong>(b)</strong> List down five actors and five attackers of the system. [5]</p>
<p><strong>Actors:</strong></p>
<p>Patients, Doctors, Admin, Nurses, Patient Family.</p>
<p><strong>Attackers:</strong> </p>
<p>General attackers, Payment gateway attackers, Nurses, Doctors, Patient Family.</p>
<p><strong>(c)</strong> List down five high-level threats to the system. [5]</p>
<ol>
<li>Insecure authentication</li>
<li>DDoS Attacks</li>
<li>Leakage of patients medical information. Implement a chain of custody to monitor on this system.</li>
<li>Attacker modify the information of patients and drug perscription for patients.</li>
<li>Large size file uploads&#x2F;buffer overflow:</li>
</ol>
<p><strong>(d)</strong> Against each threat what would be your countermeasure? [5]</p>
<ol>
<li><p>Introduce multi-factor authentication.</p>
</li>
<li><p>Add defence against DoS&#x2F;DDoS attacks.</p>
</li>
<li><p>Implement a chain of custody to monitor on this system.</p>
</li>
<li><p>implement logging on website against all actions and audit to be performed by doctors.</p>
</li>
<li><p>implement max size limit for file submission and implement defence against buffer overflow.</p>
</li>
</ol>
<p><strong>2.</strong> <strong>(a)</strong> If requirements are introduced at a later stage in the project, what would be its impact on security?</p>
<p>Support your answer with an example. [3]</p>
<p>it often leads to incomplete or insufficient security measures, making the system vulnerable to threats and attacks. </p>
<ol>
<li>Increased complexity: Adding new requirements can make the system more complex, which in turn makes it harder to analyze and secure. Complex systems are more prone to vulnerabilities, as they have more potential points of failure and attack.</li>
</ol>
<p>Example: Imagine a web application that initially only required user authentication via username and password. If the project scope is changed to include multi-factor authentication, this introduces additional components such as SMS or email verification. The complexity of the system increases, making it more difficult to ensure that all security aspects are correctly implemented and that no vulnerabilities are introduced.</p>
<ol start="2">
<li>Insufficient time for security analysis and testing: Introducing new requirements late in the project often means that there is less time available for security analysis and testing, increasing the likelihood of vulnerabilities remaining undetected.</li>
</ol>
<p>Example: If a new payment feature is added to an e-commerce website just before the project’s deadline, there may not be enough time to perform a thorough security analysis and test all potential attack vectors, such as SQL injection or cross-site scripting vulnerabilities.</p>
<ol start="3">
<li>Cost and resource constraints: Late requirement changes can lead to increased costs and put additional strain on resources. This can result in cutting corners on security measures or failing to allocate enough time for thorough security testing.</li>
</ol>
<p>Example: If a new payment feature is added to an e-commerce website just before the project’s deadline, there may not be enough time to perform a thorough security analysis and test all potential attack vectors, such as SQL injection or cross-site scripting vulnerabilities.</p>
<ol start="4">
<li>Incomplete integration of security measures: New requirements might not be fully compatible with existing security measures, requiring rework or additional implementation to ensure that the overall security posture remains strong.</li>
</ol>
<p>Example: An organization decides to migrate its on-premises infrastructure to the cloud during the project’s later stages. This change requires a reassessment of the security measures in place, as cloud environments have different security considerations compared to on-premises infrastructure. If not addressed properly, this can lead to vulnerabilities in the cloud environment.</p>
<p><strong>(b)</strong> An organisation is performing risk analysis during the development stage for their asset having an </p>
<p>estimated value of £100,000. The exposure factor of the asset is estimated to be 0.25 and annual </p>
<p>rate of occurrence is expected to be 0.5. Mitigating the risk will cost the organization £5,000, is it </p>
<p>feasible to fix the vulnerability in the code or not? [5]</p>
<p>If do not fix the vulnerablity, the annual lost will be £12500</p>
<p>So, it is very worthy to spend £5000 to fix this vulnerability.</p>
<p><strong>(c)</strong> A company wants to do the audit of their software for GDPR compliance. Which three <em>Secure</em> </p>
<p><em>Software Engineering</em> methods you would recommend for this purpose? Give a brief explanation </p>
<p>for each method. [6]</p>
<p><strong>Biometric Recognition Multi-factor Authentication</strong></p>
<p><strong>(d)</strong> In the code given on the next page, identify which variables are considered tainted and identify </p>
<p>any two potential security vulnerabilities in the code and suggest how to fix them (write in your </p>
<p>own words, no coding is required). [6]</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">authenticateUser</span>(<span class="params">username, password</span>) &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> userCredentials = &#123;</span><br><span class="line"></span><br><span class="line"> <span class="attr">username</span>: username, </span><br><span class="line"></span><br><span class="line"> <span class="attr">password</span>: password </span><br><span class="line"></span><br><span class="line"> &#125;;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> input = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;input&quot;</span>).<span class="property">value</span>; </span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (<span class="title function_">isValidEmail</span>(input)) &#123;</span><br><span class="line"></span><br><span class="line"> userCredentials.<span class="property">email</span> = input; </span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> $.<span class="title function_">post</span>(<span class="string">&quot;/login&quot;</span>, userCredentials, <span class="keyword">function</span>(<span class="params">response</span>) &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (response.<span class="property">success</span>) &#123;</span><br><span class="line"></span><br><span class="line"> <span class="title function_">alert</span>(<span class="string">&quot;You are logged in!&quot;</span>);</span><br><span class="line"></span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line"><span class="title function_">alert</span>(<span class="string">&quot;Authentication failed.&quot;</span>);</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &#125;);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">isValidEmail</span>(<span class="params">email</span>) &#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">var</span> emailRegex = <span class="regexp">/^[^\s@]+@[^\s@]+\.[^\s@]+$/</span>;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">return</span> emailRegex.<span class="title function_">test</span>(email); </span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<ol>
<li>tainted varaibles:</li>
</ol>
<p>userCredentials中的username和userpassword可能受污染，因为他是直接从传入的参数中获得的，</p>
<p>input变量同样是直接从页面中获取的，可能收到污染</p>
<ol start="2">
<li>solution</li>
</ol>
<p>对于用户名和密码，进行表单提交，并且进行表单认证，并且对于用户名和密码进行安全编码，同时对用户的输入进行输入检查，如dompurify的库可以帮助做到这一点</p>
<p>对于发送的 POST 请求，应该使用 HTTPS 协议进行通信，并对用户输入的敏感信息进行加密或者哈希处理，避免被劫持或者窃取。可以使用加密算法、哈希算法或者 SSL&#x2F;TLS 协议来保证通信安全。</p>
<p>代码中有两个潜在的安全漏洞:</p>
<p>跨站脚本漏洞:</p>
<p>代码接受用户输入(用户名和密码)，并直接将其发送到服务器，而没有进行适当的验证或处理。如果攻击者将恶意脚本注入到输入字段中，服务器可能会执行这些脚本，从而可能危及应用程序。</p>
<p>要修复此漏洞，您应该在将用户输入发送到服务器之前对其进行清理和验证。您可以使用像DOMPurify这样的库来净化输入，并创建一个验证函数来检查输入字段中的任何无效字符。</p>
<p>敏感数据的不安全传输:</p>
<p>该代码将用户的凭据(用户名和密码)以明文形式发送到服务器，而不进行任何加密。这可能会将敏感信息暴露给潜在的窃听者或攻击者，特别是在连接没有使用HTTPS保护的情况下。</p>
<p>为了解决这个问题，你应该确保你的网站使用HTTPS，它加密客户端和服务器之间传输的数据。此外，考虑实现更安全的身份验证机制(如OAuth2)或使用密码散列技术(如bcrypt)来安全地存储和传输密码。</p>
<p>(e).</p>
<p>(a). You are being asked to consult with a start-up who are looking to put together a security policy for integrity. You are told that there are three security levels for the objects: o1 &lt; o2 &lt;o3 where o3 is the highest and o1 is the lowest security level. The following table present the associated security levels and categories for the objects (o). The subjects S1 lies on Level 1, S2 lies on Level 2 and S3 lies on Level 3. Fill out the following table to indicate all applicable permissions when the Simple Security Property is applied. Write -p’ for read and ‘-w’ for write and ‘-rw’ for both read and write operations. If a Subject is not authorized to perform any action, leave the cell blank. [8] </p>
<table>
<thead>
<tr>
<th></th>
<th>O1</th>
<th>O2</th>
<th>O3</th>
</tr>
</thead>
<tbody><tr>
<td>S1</td>
<td>-r</td>
<td></td>
<td></td>
</tr>
<tr>
<td>S2</td>
<td>-r</td>
<td>-r</td>
<td></td>
</tr>
<tr>
<td>S3</td>
<td>-r</td>
<td>-r</td>
<td>-r</td>
</tr>
</tbody></table>
<p>Table 1: A security model indicating subject and object integrity levels</p>
<p>(b). How an organization can effectively apply confidentiality and integrity in their software products?</p>
<p>Provide a brief explanation of the consequences.</p>
<p>(c). ABC airlines operates a large number of flights globally. In 2021, the airline suffered a significant data breach that affected the personal information of thousands of customers. In response to this breach, ABC airlines invested in a new approach to secure software engineering, including implementing secure coding practices, testing and validating software, and conducting regular security audits. The company has a complex network infrastructure that includes several web servers, database servers, and application servers. Now, the airline company wants to implement confidentiality and integrity in their system, how it will be done? List any three suggestions.</p>
<p>(d). Why it is important to rank stakeholders in the system? Provide an example scenario and rank 3 different stakeholders in it.</p>
<p>Reason: </p>
<p>The ranking is important to satisfy the competing needs,Contradiction of needs e.g., privacy in one case can conflict with requirement to send name and email in other case.</p>
<p>Candidate stakeholders are: end users, project manager, CEO, CIO, team lead, network admin, db manager, marketing department, legal department and sales team.</p>
<p>Number of external stakeholders is limited</p>
<h1 id="revision"><a href="#revision" class="headerlink" title="revision"></a>revision</h1><h2 id="Risk"><a href="#Risk" class="headerlink" title="Risk"></a>Risk</h2><p><strong>Risk and Risk management</strong></p>
<ul>
<li>﻿﻿Risk is the potential that a given threat will exploit vulnerabilities of an asset or group of assets and thereby cause harm to the organization</li>
<li>﻿﻿Risk management— “Process of identifying, controlling and minimizing or eliminating security risks that may affect information systems, for an acceptable cost.”</li>
<li>﻿﻿Risk assessment—“assessment of threats to, impact on and vulnerabilities of information and information processing facilities and the likelihood of their occurrence.”</li>
</ul>
<p><strong>Who is the enemy? Why do they do it?</strong><br>• Offenders</p>
<ul>
<li>Crackers—mostly teenagers doing as intellectual challenge</li>
<li>Information system’s criminals—Espionage and&#x2F;or<br>Fraud&#x2F;abuse—for a nation&#x2F;company to gain a competitive advantage over its rivals</li>
<li>Vandals—authorized users and strangers (cracker or a criminal)—motivated by anger directed at an individual&#x2F;organization&#x2F;life in general</li>
</ul>
<p><strong>Risk &#x3D; Threats × Vulnerabilities</strong></p>
<table>
<thead>
<tr>
<th>Risk</th>
<th>Threats</th>
<th>Vulnerabilities</th>
</tr>
</thead>
<tbody><tr>
<td>business disruption</td>
<td>angry employees</td>
<td>software bugs</td>
</tr>
<tr>
<td>financial losses</td>
<td>dishonest employees</td>
<td>broken processes</td>
</tr>
<tr>
<td>loss of privacy</td>
<td>criminals</td>
<td>ineffective controls</td>
</tr>
<tr>
<td>damage to reputation</td>
<td>governments</td>
<td>hardware flaws</td>
</tr>
<tr>
<td>loss of confidence</td>
<td>terrorists</td>
<td>business change</td>
</tr>
<tr>
<td>legal penalties</td>
<td>the press</td>
<td>legacy systems</td>
</tr>
<tr>
<td>impaired growth</td>
<td>competitors</td>
<td>Inadequate BCP</td>
</tr>
<tr>
<td>loss of life</td>
<td>hackers</td>
<td>human error</td>
</tr>
<tr>
<td></td>
<td>nature</td>
<td></td>
</tr>
</tbody></table>
<p><strong>Types of Damage</strong></p>
<ul>
<li>﻿﻿Interruption—destroyed&#x2F;unavailable services&#x2F;resources</li>
<li>﻿﻿Interception—unauthorized party snooping or getting access to a resource</li>
<li>﻿﻿Modification— unauthorized party modifying<br> a resource</li>
<li>﻿﻿Fabrication—unauthorized party inserts a fake asset&#x2F;resource</li>
</ul>
<p><strong>The purpose of risk management</strong></p>
<ul>
<li>﻿﻿Ensure overall business and business assets are safe</li>
<li>﻿Protect against competitive disadvantage</li>
<li>﻿Compliance with laws and best business practices</li>
<li>﻿Maintain a good public reputation</li>
</ul>
<p><strong>Accountability for Risk Management</strong></p>
<ul>
<li><p>﻿﻿It is the responsibility of each community of interest to manage risks; each community has a role to play:</p>
</li>
<li><p>﻿﻿Information Security - best understands the threats and attacks that introduce risk into the organization</p>
</li>
<li><p>﻿﻿Management and Users - play a part in the early detection and response process - they also insure sufficient resources are allocated</p>
</li>
<li><p>﻿﻿Information Technology - must assist in building secure systems and operating them safely</p>
</li>
</ul>
<p><img src="/../images/image-20230426143138064.png" alt="image-20230426143138064"></p>
<p><strong>Steps of a risk management plan</strong></p>
<ul>
<li>﻿﻿Step 1: Identify Risk</li>
<li>﻿﻿Step 2: Assess Risk</li>
<li>﻿﻿Step 3: Control Risk</li>
<li>﻿﻿Steps are similar regardless of context (InfoSec, Physical Security, Financial, etc.)</li>
<li>﻿﻿This presentation will focus on controlling risk within an InfoSec context</li>
</ul>
<p><strong>Risk Identification</strong></p>
<ul>
<li><p>﻿﻿The steps to risk identification are:</p>
</li>
<li><p>﻿﻿Identify your organization’s information assets</p>
</li>
<li><p>﻿﻿Classify and categorize said assets into useful groups</p>
</li>
<li><p>﻿﻿Rank assets necessity to the organization</p>
</li>
</ul>
<p>To the right is a simplified example of how a company may identify risks</p>
<p><strong>Risk Assessment</strong></p>
<ul>
<li><p>﻿﻿The steps to risk assessment are:</p>
</li>
<li><p>﻿﻿Identify threats and threat agents</p>
</li>
<li><p>﻿﻿Prioritize threats and threat agents</p>
</li>
<li><p>﻿﻿Assess vulnerabilities in current InfoSec plan</p>
</li>
<li><p>﻿﻿Determine risk of each threat</p>
</li>
</ul>
<p>R&#x3D;P*V-M+ U</p>
<p>​	R&#x3D; Risk</p>
<p>​	P&#x3D; Probability of threat attack</p>
<p>​	V &#x3D; Value of Information Asset</p>
<p>​	M &#x3D; Mitigation by current controls</p>
<p>​	U &#x3D; Uncertainty of vulnerability</p>
<p><strong>Risk control</strong></p>
<ul>
<li>﻿﻿The steps to risk control are:</li>
<li>﻿﻿Cost-Benefit Analysis (CBA)<ul>
<li>﻿﻿Single Loss Expectancy (SLE)</li>
<li>﻿﻿Annualized Rate of Occurrence (ARO)</li>
<li>﻿﻿Annual Loss Expectancy (ALE)</li>
<li>﻿﻿Annual Cost of the Safeguard (ASG)</li>
</ul>
</li>
<li>﻿Feasibility Analysis<ul>
<li>﻿﻿Organizational Feasibility</li>
<li>﻿﻿Operational Feasibility</li>
<li>﻿﻿Technical Feasibility</li>
<li>﻿﻿Political Feasibility</li>
</ul>
</li>
<li>﻿Risk Control Strategy Implementation</li>
</ul>
<p><strong>Cost-Benefit analysis</strong></p>
<ul>
<li><p>﻿Determine what risk control strategies are cost effective</p>
</li>
<li><p>﻿﻿Below are some common formulas used to calculate cost-benefit analysis</p>
</li>
<li><p>﻿﻿SLE &#x3D; AV * EF</p>
<ul>
<li>﻿﻿AV &#x3D; Asset Value, EF &#x3D;<br> Exposure factor (% of asset affected)</li>
</ul>
</li>
<li><p>﻿﻿ALE &#x3D; SLE * ARO</p>
</li>
<li><p>﻿﻿CBA &#x3D; ALE (pre-control) -</p>
<p>ALE (post-control) - ACE(Annually Countermeasure Expectancy)</p>
</li>
</ul>
<p>SLE - single loss expectancy, ALE - Annual loss expectancy, CBA – Cost benefit analysis</p>
<p><strong>Feasibility analysis</strong></p>
<p>Organizational: Does the plan correspond to the organization’s objectives? What is in it for the organization? Does it limit the organization’s capabilities in any way?</p>
<p>Operational: Will shareholders (users, managers, etc.) be able&#x2F;willing to accept the plan? Is the system compatible with the new changes? Have the possible changes been communicated to the employees?</p>
<p>Technical: Is the necessary technology owned or obtainable? Are our employees trained and if not can we afford to train them? Should we hire new employees?</p>
<p>Political: Can InfoSec acquire the necessary budget and approval to implement the plan? Is the budget required justifiable? Does InfoSec have to compete with other departments to acquire the desired budget?</p>
<p><strong>Risk control Strategies</strong></p>
<ul>
<li>﻿﻿Defense</li>
<li>﻿﻿Transferal</li>
<li>﻿﻿Mitigation</li>
<li>﻿﻿Acceptance (Abandonment)</li>
<li>﻿﻿Termination</li>
</ul>
<p><strong>Risk control Strategy: defense</strong></p>
<p>• Defense: Prevent the exploitation of the system via application of policy, training&#x2F;education, and technology. Preferably layered security (defense in depth)</p>
<p>% Counter threats</p>
<p>% Remove vulnerabilities from assess</p>
<p>% Limit access to assets</p>
<p>§ Add protective safeguards</p>
<p>Figure 1-Application Security Layered Approach</p>
<p><img src="/../images/20230426144850808.png" alt="image-20230426144850808"></p>
<p><strong>Risk control Strategy: transferal</strong></p>
<ul>
<li>﻿﻿Transferal: Shift risks to other areas or outside entities to handle</li>
<li>﻿﻿Can include:</li>
</ul>
<p>% Purchasing insurance</p>
<p>• Outsourcing to other organizations</p>
<p>* Implementing service contracts with providers<br> § Revising deployment models</p>
<p><img src="/../images/20230426145019527.png" alt="image-20230426145019527"></p>
<p><strong>Risk control Strategy: Mitigation</strong></p>
<p><img src="/../images/20230426145147173.png" alt="image-20230426145147173"></p>
<p><strong>Risk control Strategy: Acceptance</strong></p>
<p>Appropriate when:</p>
<p>% The cost to protect an asset or assets exceeds the cost to replace it&#x2F;them</p>
<ul>
<li>﻿When the probability of risk is very low and the asset is of low priority</li>
<li>﻿﻿Otherwise acceptance &#x3D; negligence</li>
</ul>
<p><strong>Risk control Strategy: Termination</strong></p>
<ul>
<li>﻿﻿Termination: Removing or discontinuing the information asset from the organization</li>
<li>﻿﻿Examples include:</li>
</ul>
<p>Equipment disposal</p>
<p>Discontinuing a provided service</p>
<p>Firing an employee</p>
<p><strong>Pros and cons of each strategy</strong></p>
<p><img src="/../images/20230426145601149.png" alt="image-20230426145601149"></p>
<p><strong>Standard approaches to risk management</strong></p>
<ul>
<li>﻿﻿U.S CERT’s Operationally Critical Threat Assessment<br> Vulnerability Evaluation (OCTAVE) Methods (Original, OCTAVE-S, OCTAVE-Allegro)</li>
<li>﻿﻿ISO 27005 Standard for InfoSec Risk Management</li>
<li>﻿﻿NIST Risk Management Model</li>
<li>﻿﻿Microsoft Risk Management Approach</li>
<li>﻿﻿Jack A. Jones’ Factor Analysis of Information Risk<br> (FAIR)</li>
<li>﻿﻿Delphi Technique</li>
</ul>
<p><strong>Risk Determination</strong></p>
<p>For the purpose of relative risk assessment:</p>
<p>RISK &#x3D;</p>
<p>​	likelihood of vulnerability occurrence times value (or impact)</p>
<p>MINUS</p>
<p>​	percentage risk already controlled	</p>
<p>PLUS</p>
<p>​	an element of uncertainty</p>
<p><strong>Access Controls</strong></p>
<ul>
<li><p>﻿﻿One particular application of controls is in the area of access controls</p>
</li>
<li><p>﻿﻿Access controls are those controls that specifically address admission of a user into a trusted area of the organization</p>
</li>
<li><p>﻿﻿There are a number of approaches to controlling access</p>
</li>
<li><p>﻿﻿Access controls can be</p>
</li>
<li><p>﻿﻿discretionary</p>
</li>
<li><p>﻿﻿mandatory</p>
</li>
<li><p>﻿﻿nondiscretionary</p>
</li>
</ul>
<p><strong>Types of Access Controls</strong></p>
<ul>
<li>﻿﻿Discretionary Access Controls (DAC) are implemented at the discretion or option of the data user</li>
<li>﻿﻿Mandatory Access Controls (MACs) are structured and coordinated with a data classification scheme, and are required</li>
<li>﻿﻿Nondiscretionary Controls are those determined by a central authority in the organization and can be based on that individual’s role</li>
</ul>
<p><strong>Lattice-based Control</strong></p>
<ul>
<li>﻿﻿Another type of nondiscretionary access is lattice-based control, where a lattice structure (or matrix) is created containing subjects and objects, and the boundaries associated with each pair is contained</li>
<li>﻿﻿This specifies the level of access each subiect has to each object</li>
<li>﻿﻿In a lattice-based control the column of attributes associated with a particular object are referred to as an access control list or ACL</li>
<li>﻿﻿The row of attributes associated with a particular subiect (such as a user) is referred to as a capabilities table</li>
<li>This is part of Principles of Information SecurityPrinciples of Information Security</li>
</ul>
<p><strong>Documenting Results of Risk Assessment</strong></p>
<ul>
<li>﻿﻿The goal of this process has been to identify the information assets of the organization that have specific vulnerabilities and create a list of them, ranked for focus on those most needing protection first</li>
<li>﻿﻿In preparing this list we have collected and preserved factual information about the assets, the threats they fac and the vulnerabilities they experience</li>
<li>﻿﻿We should also have collected some information about the controls that are already in place</li>
</ul>
<p><strong>Asset Identification and Valuation</strong></p>
<ul>
<li>﻿﻿This iterative process begins with the identification of assets, including all of the elements of an organization’s system</li>
<li>﻿﻿Then, we classify and categorize the assets adding details as we dig deeper into the analysis</li>
</ul>
<p><strong>Components of an Information System</strong></p>
<p><img src="/../images/20230426150102652.png" alt="image-20230426150102652"></p>
<p><strong>Hardware, Software, and Network Asset Identification</strong></p>
<p>• Automated tools can sometimes uncover the system elements that make up the hardware, software, and network components</p>
<p>Once created, the inventory listing must be kept current, often through a tool that periodically refreshes the data</p>
<ul>
<li>﻿﻿What attributes of each of these information assets should be tracked?</li>
<li>﻿﻿When deciding which information assets to track, consider including these asset attributes:</li>
</ul>
<p>​		Name</p>
<p>​		﻿﻿IP address</p>
<p>​		MAC address</p>
<p>​		Element type</p>
<p>​		﻿﻿Serial number</p>
<p>​	﻿﻿	Manufacturer name</p>
<p><strong>People, Procedures, and Data Asset Identification</strong></p>
<ul>
<li>﻿﻿Unlike the tangible hardware and software elements already described, the human resources, documentation, and data information assets are not as readily discovered and documented</li>
<li>﻿﻿These assets should be identified, described, and evaluated by people using knowledge, experience, and judgment</li>
<li>﻿﻿As these elements are identified, they should also be recorded into some reliable data handling process</li>
</ul>
<p><strong>Asset Information for People</strong></p>
<ul>
<li><p>﻿﻿For People:</p>
<ul>
<li><p>﻿﻿Position name&#x2F;number&#x2F;ID - try to avoid names and stick to identifying positions, roles, or functions</p>
</li>
<li><p>﻿﻿Supervisor</p>
</li>
<li><p>﻿﻿Security clearance level</p>
</li>
<li><p>﻿﻿Special skills</p>
</li>
</ul>
</li>
</ul>
<p><strong>Asset Information for Procedures</strong></p>
<ul>
<li><p>﻿﻿For Procedures:</p>
<ul>
<li><p>﻿﻿Description</p>
</li>
<li><p>﻿﻿Intended purpose</p>
</li>
<li><p>﻿﻿What elements is it tied to</p>
</li>
<li><p>﻿﻿Where is it stored for reference</p>
</li>
<li><p>﻿﻿Where is it stored for update purposes</p>
</li>
</ul>
</li>
</ul>
<p><strong>Asset Information for Data</strong></p>
<ul>
<li><p>﻿﻿For Data:</p>
<ul>
<li><p>﻿﻿Classification</p>
</li>
<li><p>﻿﻿Owner&#x2F;creator&#x2F;manager</p>
</li>
<li><p>﻿﻿Size of data structure</p>
</li>
<li><p>﻿﻿Data structure used - sequential, relational</p>
</li>
<li><p>﻿﻿Online or offline</p>
</li>
<li><p>﻿﻿Where located</p>
</li>
<li><p>﻿﻿Backup procedures employed</p>
</li>
</ul>
</li>
</ul>
<p><strong>Information Asset Classification</strong></p>
<ul>
<li><p>﻿﻿Many organizations already have a classification scheme</p>
</li>
<li><p>﻿﻿Examples of these kinds of classifications are:</p>
<ul>
<li><p>﻿﻿confidential data</p>
</li>
<li><p>﻿﻿internal data</p>
</li>
<li><p>﻿﻿public data</p>
</li>
</ul>
</li>
<li><p>﻿﻿Informal organizations may have to organize themselves to create a useable data classification model</p>
</li>
<li><p>﻿﻿The other side of the data classification scheme is the personnel security clearance structure</p>
</li>
</ul>
<p><strong>Information Asset Valuation</strong></p>
<ul>
<li><p>﻿﻿Each asset is categorized</p>
</li>
<li><p>﻿﻿Questions to assist in developing the criteria to be used for asset valuation:</p>
<ul>
<li><p>﻿﻿Which information asset is the most critical to the success of the organization?</p>
</li>
<li><p>﻿﻿Which information asset generates the most revenue?</p>
</li>
<li><p>﻿﻿Which information asset generates the most profitability?</p>
</li>
<li><p>﻿﻿Which information asset would be the most expensive to replace?</p>
</li>
<li><p>﻿﻿Which information asset would be the most expensive to protect?</p>
</li>
<li><p>﻿﻿Which information asset would be the most embarrassing or cause the greatest liability if revealed?</p>
</li>
</ul>
</li>
</ul>
<p><strong>Examples of Information Security Vulnerabilities</strong></p>
<ul>
<li>﻿﻿Information security vulnerabilities are weaknesses that expose an organization to risk.</li>
<li>﻿﻿Through employees: Social interaction, Customer interaction,<br> Discussing work in public locations,</li>
<li>﻿﻿Through former employees—Former employees working for competitors, Former employees retaining company data,<br> Former employees discussing company matters</li>
<li>﻿﻿Though Technology—Social networking, File sharing, Rapid technological changes, Legacy systems, Storing data on mobile devices such as mobile phones, Internet browsers</li>
<li>﻿﻿Through hardware—. Susceptibility to dust, heat and humidity,<br> Hardware design flaws, Out of date hardware,</li>
<li>Misconfiguration of hardware</li>
</ul>
<p><strong>Examples of Information Security Vulnerabilities (Cont.)</strong></p>
<ul>
<li>﻿﻿Through software—Insufficient testing, Lack of audit trail, Software bugs and design faults, Unchecked user input, Software that fails to consider human factors, Software complexity (bloatware), Software as a service (relinquishing control of data), Software vendors that go out of business or change ownership</li>
<li>﻿Through Network—Unprotected network communications, Open physical connections, IPs and ports, Insecure network architecture, Unused user ids, Excessive privileges, Unnecessary jobs and scripts executing, Wifi networks</li>
<li>﻿﻿Through IT Management—Insufficient IT capacity, Missed security patches, Insufficient incident and problem management, Configuration errors and missed security notices, System operation errors</li>
<li>﻿Partners and suppliers—Disruption of telecom services, Disruption of utility services such as electric, gas, water, Hardware failure, Software failure, Lost mail and courier packages, Supply disruptions, Sharing confidential data with partners and suppliers</li>
</ul>
<p><img src="/../images/20230426150722235.png" alt="image-20230426150722235"></p>
<p><strong>Programme Criticality</strong></p>
<ul>
<li><p>﻿﻿The programme criticality framework is a common<br> United Nations system framework for decision-making that puts in place a systematic structured approach that uses programme criticality as a way to ensure that programme activities can be balanced against security risks.</p>
</li>
<li><p>﻿﻿The concept of criticality means the critical impact of an activity on the population, not necessarily on the organisation.</p>
</li>
<li><p>﻿﻿Programme criticality assessment is mandatory in areas with residual risk levels of ‘high’ and very high,’ as determined in the Security Risk Assessments (SRAs).</p>
</li>
<li><p>﻿﻿Primary accountability for programme criticality is with United Nations senior management at the country level.</p>
</li>
</ul>
<p>A programme criticality assessment has steps as follows:</p>
<ul>
<li><p>﻿﻿1. Establish geographical scope and timeframe</p>
</li>
<li><p>﻿﻿2. List strategic results (SRs)</p>
</li>
<li><p>﻿﻿3. List UN activities&#x2F;outputs (involving UN personnel)</p>
</li>
<li><p>﻿﻿4. Assess contribution to strategic results</p>
</li>
<li><p>﻿﻿5. Assess likelihood of implementation</p>
</li>
<li><p>﻿﻿6. Evaluate activities&#x2F;outputs with PCI criteria</p>
</li>
<li><p>﻿﻿7. View PC level results, form consensus within the UN system and approve final results</p>
</li>
<li><p>﻿﻿8. Agree on a process to address and manage the results of the PC<br> assessment</p>
</li>
<li><p>﻿﻿9. Follow-up and review.</p>
</li>
<li><p>﻿﻿There are two possible criteria for an activity to be considered a PCI activity:</p>
<ul>
<li><p>﻿﻿Either the activity is assessed as lifesaving (humanitarian or non-humanitarian) at scale (defined as any activity to support processes or services, including needs assessments), that would have an immediate and significant impact on mortality; or</p>
</li>
<li><p>﻿﻿The activity is a directed activity that receives the endorsement of the Office of the Secretary-General for this particular situation.</p>
</li>
</ul>
</li>
<li><p>﻿﻿Risk level has no impact on programme criticality.<br> There must be no consideration of risk level when determining PC.</p>
</li>
<li><p>﻿﻿Programme criticality has no impact on risk level.<br> There must be no consideration of PC when determining risk level.</p>
</li>
</ul>
<p><img src="/../images/20230426152530740.png" alt="image-20230426152530740"></p>
<p><strong>Other Processes with Security Implications</strong></p>
<ul>
<li>﻿﻿Intelligence and Information Cycle.</li>
<li>﻿﻿Strategic-level Integrated Mission Planning Process.</li>
<li>﻿﻿Mission-level Integrated Planning, Coordination and implementation.</li>
<li>﻿﻿Mission Component Planning and Implementation<br> Processes.</li>
<li>﻿﻿UN Budget Processes.</li>
<li>﻿﻿Staff Selection and Managed Mobility System.</li>
<li>﻿﻿Any other process that impacts the substance of UN security.</li>
</ul>
<h2 id="Security-Patterns"><a href="#Security-Patterns" class="headerlink" title="Security Patterns"></a><strong>Security Patterns</strong></h2><p><strong>Values of security pattern:</strong></p>
<p>Security patterns can apply <strong>security principles</strong>, <strong>guide the design and implementation</strong>, <strong>guide the use of security mechanisms</strong>,<strong>help understanding and use of complex</strong> **standards (**XACML, WiMax) and <strong>Convenient for teaching</strong> security principles and mechanisms.</p>
<p><strong>An Abstract Security Pattern (ASP)</strong>, describes a conceptual security mechanism that realizes one or more security policies able to control (stop or mitigate) a threat or comply with a security-related regulation or institutional policy (no implementation aspects).</p>
<p><strong>Conceptual security</strong></p>
<ul>
<li>﻿﻿Security is a <strong>quality</strong> aspect that constrains the semantic behavior of applications (by imposing access restrictions), so the requirements stage is the right development stage to start addressing security</li>
<li>﻿﻿However, we only want to indicate at this stage which specific security controls are needed, not their convenient or optimal implementation.</li>
<li>﻿﻿For example, in bank applications we only want to specify the semantic aspects of accounts, customers, and transactions with their corresponding restrictions.</li>
</ul>
<p><strong>An ASP example: Authenticator:</strong></p>
<ul>
<li>﻿﻿This is the Intent section of an Authenticator pattern: “When a user or system (subject) identifies itself to the system, how do we verify that the subject intending to access the system is who it says it is? Present some information that is recognized by the system as identifying this subject.<br> After being recognized, the requestor is given some proof that it has been authenticated.”</li>
<li>﻿﻿Authentication restricts access to a system to only registered users; it handles the threat where an intruder enters a system and may try to perform unauthorized access to information</li>
<li>﻿﻿It is clear that there are many ways to perform this authentication, that go from manual ways, as done in voting places, to purely automatic ways, as when accessing a web site, but all of them must include the requirements of the abstract Authenticator</li>
</ul>
<p><strong>Authentication</strong> as an <strong>abstract</strong> function requires a basic sequence of activities.  Concrete realizations of this sequence implement these steps in different ways but all must perform these two steps: • The subject requests to enter a system indicating its identity and presenting some proof of identity. • If the system recognizes the subject using its identity information, it grants her entrance to the system and provides her with a proof of authentication for further use.  If not, the request is denied. • We can define a hierarchy of authentication patterns starting from the abstract Authenticator</p>
<p><strong>Force os abstract authenticator</strong></p>
<ul>
<li><p><strong>Closed system</strong>. If the authentication information presented by the user is not recognized, there is no access. In an open system all subjects would have access except some who are blacklisted for some reason.</p>
</li>
<li><p><strong>Registration</strong>. Users must register their identity information so that the system can recognize them later.</p>
</li>
<li><p><strong>Flexibility</strong>. There may be a variety of individuals (users) who require access to the system and a variety of system units with different access restrictions. We need to be able to handle all this variety appropriately or we risk security exposures.</p>
</li>
<li><p><strong>Dependability</strong>. We need to authenticate users in a reliable and secure way.</p>
<p>This means a robust protocol and a high degree of availability. Otherwise, users may fool the authentication process or enter when the system authentication is down.</p>
</li>
<li><p><strong>Protection of authentication information</strong>. Users should not be able to read or modify the authentication information. Otherwise, they can give themselves access to the system.</p>
</li>
<li><p>﻿﻿<strong>Simplicity</strong>. The authentication process must be relatively simple or the users or administrators may be confused. User errors are annoying to them but administrator errors may lead to security exposures.</p>
</li>
<li><p>﻿﻿<strong>Reach</strong>. Successful authentication only gives access to the system, not to any specific resource in the system. Access to these resources must be controlled using other mechanisms, typically authorization.</p>
</li>
<li><p><strong>Tamper freedom</strong>. It should be very difficult to falsify the proof of identity presented by the user.</p>
</li>
<li><p>﻿﻿<strong>Cost</strong>. There should be tradeoffs between security and cost, more security can be obtained at a higher cost.</p>
</li>
<li><p>﻿﻿<strong>Performance</strong>. Authentication should not take a long time or users will be annoyed.</p>
</li>
<li><p>﻿﻿<strong>Frequency</strong>. We should not make users authenticate frequently. Frequent authentications waste time and annoy the users.<br> All these properties must be present in the lower-level ways of performing authentication, e.g. in a Password Authenticator (see next slide). A Password Authenticator needs tomake concrete its Authentication Information (list of passwords) and its proof of authentication (a session)</p>
</li>
</ul>
<p><strong>Reference Monitor</strong></p>
<ul>
<li>Authorization rules define who has access to what and how. They must be enforced when a process request a resource</li>
<li>Each request for resources must be intercepted and evaluated for authorized access; this is the concept of Reference Monitor</li>
<li>An abstract concept, implemented as memory access manager, file permission checks, CORBA adapters, etc.</li>
</ul>
<p><strong>Role-Based Access Control</strong></p>
<ul>
<li>﻿﻿Users are assigned roles according to their functions and given the needed rights (access types for specific objects)</li>
<li>﻿﻿When users are assigned by administrators, this is a mandatory model</li>
<li>﻿﻿Can implement least privilege and separation of duty policies</li>
</ul>
<p><strong>XML firewall</strong></p>
<p>• <strong>Controls input&#x2F;output of XML applications</strong></p>
<p>• <strong>Well-formed documents (schema as</strong> <strong>reference)</strong></p>
<p>• <strong>Harmful data (wrong type or length)</strong></p>
<p>• <strong>Encryption&#x2F;decryption</strong></p>
<p>• <strong>Sign and verify signatures in documents</strong></p>
<hr>
<p><strong>Building secure systems</strong></p>
<ul>
<li>﻿﻿Secure systems need to be built in a systematic way where security is an integral part of the lifecycle, and the same applies to safety.</li>
<li>﻿﻿The platform should match the type of application, and all compliance, safety and security constraints should be defined at the application level, where their semantics are understood and propagated to the lower levels.</li>
<li>﻿﻿The lower levels must provide the assurance that the constraints are being followed, i.e., they implement these constraints and enforce that there are no ways to bypass them.</li>
<li>﻿﻿Following these ideas, the Authors of the book in reference developed a secure systems development methodology, which considers all lifecycle stages and all architectural levels. It is expanded with architectural aspects, and recently with process aspects.</li>
</ul>
<p><strong><em>Security methodology</em>:</strong></p>
<p><strong>systematic way of introducing security into a software system</strong> <strong>during the development life-cycle</strong></p>
<p>Consists of two aspects&#x2F;facets:<strong>security process</strong>(SP) and <strong>conceptualsecurity framework</strong> (CF)</p>
<p><strong>ASE:</strong> <strong>a comprehensive security methodology for distributed systems</strong></p>
<ul>
<li>Many methodologies exist with different paradigms</li>
<li>Very important class is methodologies that use security patterns</li>
<li>ASE: a security methodology using patterns and related constructs designed specifically for general distributed systems</li>
</ul>
<p><strong>Basic security principles for system design</strong></p>
<ul>
<li>﻿﻿Security constraints must be defined at the highest layer, where their semantics are clear, and propagated to the lower levels, which enforce them.</li>
<li>﻿﻿All the layers of the architecture must be secure.</li>
<li>﻿﻿We can define patterns at all levels. This allows a designer to make sure that all levels are secured, and also makes easier propagating down the high-level constraints.</li>
<li>﻿﻿We must apply security in all development stages</li>
<li>﻿﻿A two-dimensional approach: time and space</li>
</ul>
<p><strong>Reference Architecture (RA)</strong></p>
<p>• A Reference Architecture (RA) is a generic software architecture, based on one or more domains, with no implementation aspects<br>• An RA is reusable, extendable, and configurable.<br>• It specifies the components of the system, their individual functionalities and their mutual interaction.<br>• An RA can be considered as a compound pattern and its components described as patterns.<br>• In addition to domain models, an RA may include a set of use cases (UC), and a set of Roles (R) corresponding to its stakeholders actors).</p>
<p>We can measure security by <strong>counting the threats that have been</strong> <strong>neutralized by using patterns</strong></p>
<p><strong>Incident Response Plan</strong></p>
<p>• Before system is released, an incident response plan should be created (compromise or failure)</p>
<p>• Contact personnel, availability and procedures for multiple levels of failure</p>
<p>• A minor glitch does not require CEO to be informed but should be documented</p>
<p>• Network admin or security admin to determine an appropriate response when incident occurs</p>
<p><strong>Key elements</strong> of incident response plan:</p>
<ul>
<li><p>﻿﻿Monitoring duties for the software in live operation</p>
</li>
<li><p>﻿﻿A definition for incidents</p>
</li>
<li><p>﻿﻿A contact for incidents</p>
</li>
<li><p>﻿﻿An emergency contact for priority incidents</p>
</li>
<li><p>﻿﻿A clear chain of escalation</p>
</li>
<li><p>﻿﻿Procedures for shutting down the software or components of the software</p>
</li>
<li><p>﻿﻿Procedures for specified exploits or attacks</p>
</li>
<li><p>﻿﻿Security documentation or the references for external ode or hardware used</p>
</li>
</ul>
<p>*It depends on the organization that the person responsible is from development team or outside</p>
<p><strong>evolving attacks &#x2F; periodic review and archiving</strong></p>
<h2 id="Web-Application-Threats"><a href="#Web-Application-Threats" class="headerlink" title="Web Application Threats"></a>Web Application Threats</h2><ul>
<li>﻿﻿Never trust the client at the server side</li>
<li>﻿﻿Never trust the browser on the client side</li>
<li>﻿﻿Never execute client input as code</li>
<li>﻿﻿Never allow client input to pass into the system without validation internally</li>
<li>﻿﻿Scrub client for any known exploits and suspect characters</li>
</ul>
<p><strong>XSS</strong></p>
<p><strong>CSRF</strong></p>
<p><strong>File Upload</strong></p>
<p><strong>Buffer Overflow</strong></p>
<p><strong>SQL Injection</strong></p>
<h2 id="Threat-Modelling"><a href="#Threat-Modelling" class="headerlink" title="Threat Modelling"></a>Threat Modelling</h2><p>• In a nutshell, threat modelling is the use of abstractions to help you consider risks.<br>• Involves developing a shared understanding of a product or service architecture and the problems that could happen.<br>•When you model threats, you typically use one of two types of model.</p>
<ol>
<li>The model for what you are building.</li>
<li>The model for the threats of what you are building.</li>
</ol>
<p>The Four-Step Framework</p>
<ol>
<li><strong>Model System</strong>, Model the system you’re building, deploying or changing.</li>
<li><strong>Find Threats</strong>, Find threats using the model.</li>
<li><strong>Addrasc Inrears</strong>,  Address the threats.</li>
<li><strong>Validate,Validate</strong>, the result for completeness and effectiveness</li>
</ol>
<p>(1) What are you Building?</p>
<ul>
<li>﻿﻿Diagrams are a good way to communicate what you are building.</li>
<li>﻿﻿There are lots of ways to diagram software and you can start with a whiteboard diagram of how data flows through the system.</li>
</ul>
<p>(2) What can go wrong?</p>
<ul>
<li><p>﻿﻿Given a simple diagram, we can start thinking about what can go wrong. Example:</p>
</li>
<li><p>﻿﻿How do you know that the web browser is being used by the person you expect?</p>
</li>
<li><p>﻿﻿What happens if someone modifies data in the database?</p>
</li>
<li><p>﻿﻿Is it okay for information to move from one box to the next without encryption?</p>
</li>
<li><p>﻿﻿You can identify threats like these using the STRIDE approach.</p>
</li>
<li><p>﻿﻿Use STRIDE to walk through each part of the diagram:</p>
</li>
<li><p>﻿﻿Spoofing.</p>
</li>
<li><p>﻿﻿Tampering.</p>
</li>
<li><p>﻿﻿Repudiation.</p>
</li>
<li><p>﻿﻿Information Disclosure.</p>
</li>
<li><p>﻿﻿Denial of Service.</p>
</li>
<li><p>﻿﻿Elevation of Privilege.</p>
</li>
</ul>
<p><strong>(3) What Are We Going To Do</strong> <strong>About It</strong></p>
<p>• There are four types of action you can take against a threat:</p>
<ol>
<li>Mitigate it.</li>
</ol>
<p><img src="/../images/20230427001002917.png" alt="image-20230427001002917"></p>
<p><img src="/../images/20230427001035008.png" alt="image-20230427001035008"></p>
<p><img src="/../images/20230427001116901.png" alt="image-20230427001116901"></p>
<p><img src="/../images/20230427001224625.png" alt="image-20230427001224625"></p>
<p><img src="/../images/20230427001300080.png" alt="image-20230427001300080"></p>
<p><img src="/../images/20230427001333023.png" alt="image-20230427001333023"></p>
<ol start="2">
<li><p>Eliminate it. Vpn（Geo-restrictions: A VPN can be used to bypass geo-restrictions and access content that may be blocked in certain regions, reducing the risk of inadvertently visiting malicious websites or downloading malicious content.）</p>
</li>
<li><p>Transfer it.</p>
</li>
<li><p>Accept it</p>
</li>
</ol>
<p><strong>(4) Did We Do A Good Job</strong></p>
<ol>
<li>﻿﻿﻿Look at the diagram, does it represent the system well?</li>
<li>﻿﻿﻿Look at the list of threats, did you find at least 5 threats per node in the diagram?</li>
<li>﻿﻿﻿Did you file a bug per threat?</li>
</ol>
<ul>
<li>﻿﻿When you find threats that violate your requirements and cannot be mitigated, it generally makes sense to adjust your requirements.<br> Sometimes it’s possible to either mitigate the threat operationally, or defer a decision to the person using the system.</li>
<li>﻿﻿There are many other threat modelling techniques, we have only touched most popular approaches.</li>
<li>﻿﻿Some other threat modelling approaches include:</li>
<li>﻿﻿PASTA (Process for Attack Simulation and Threat Analysis)</li>
<li>﻿﻿CSVSS Common Vulnerability Scoring System)</li>
<li>﻿﻿HMM (Hybrid Threat Modelling Method)</li>
</ul>
<h2 id="Attack-Trees"><a href="#Attack-Trees" class="headerlink" title="Attack Trees"></a><strong>Attack Trees</strong></h2><p><img src="/../images/20230427001820867.png" alt="image-20230427001820867"></p>
<ul>
<li>﻿﻿Top level node (or root) represents the ultimate goal of an attacker.</li>
<li>﻿﻿The nodes (or leaves) represent sub goals that need to be achieved (together or independently) to arrive at the top level goal.</li>
</ul>
<p>• An alternative to STRIDE(Spoofing, tampering, repudiation, Information disclosure,Denial of service,Denial of service).</p>
<p>• You can use attack trees as a way to find threats, or as a way to organize threats.</p>
<p>​	• Attack trees work well as a building block for threat enumeration in the fourstep framework.</p>
<p><strong>We can use attack trees to find the threats</strong></p>
<p><strong>Attack-Defence Scenarios</strong></p>
<p>• Attack trees are used to model attack-defence scenarios.</p>
<p>• The attack-defence scenario is a game between two players:</p>
<p>• The proponent (denoted as p)</p>
<p>• The opponent (denoted as o)</p>
<ul>
<li><p>The root of an attack tree represents the main goal of the proponent. </p>
<ul>
<li>When the root is an attack node, the proponent is an attacker and the opponent is a defender.</li>
<li>﻿﻿Conversely, when the root is a defence node, the proponent is a defender and the opponent is an attacker.</li>
</ul>
</li>
<li><p>Notations:</p>
</li>
<li><p>﻿﻿Attack nodes are represented with circles.</p>
</li>
<li><p>﻿﻿Defence nodes are represented with rectangles.</p>
</li>
<li><p>﻿﻿Refinements:</p>
<ul>
<li>﻿﻿Refinements can be conjunctive (AND aggregation) or disjunctive (OR choice)</li>
<li>﻿﻿Refinement relations are indicated by solid edges between nodes.</li>
<li>﻿﻿Countermeasures are indicated by dotted edges.</li>
<li>﻿﻿A conjunctive refinement of a node is represented by an arc over all edges connecting the node and its children of equal type.</li>
</ul>
</li>
</ul>
<p><strong>The basic steps to create an attack tree are as follows</strong>:</p>
<p>\1. Decide on a representation.</p>
<p>Two types of trees:</p>
<p><strong>AND trees</strong> (aggregation): The state of a node depends on all of the nodes below it being true. 有夹脚</p>
<p><strong>Or trees</strong> (choice): A node is true if any of its subnodes are true. 没夹脚</p>
<p>\2. Create a root node.</p>
<p><strong>If the root node is a countermeasure mitigation action…</strong></p>
<p><strong>Then the subnodes are used to identify what can go wrong.</strong></p>
<p><strong>Decompose the mitigation action and identify how the results can be threatened.</strong></p>
<p><strong>If the root node is a goal of the attacker</strong>:</p>
<p><strong>Then we consider ways to achieve that goal.</strong></p>
<p><strong>Each alternative way to achieve the goal should be drawn as a subnode.</strong></p>
<p>\3. Create subnodes.</p>
<p>• You typically create subnodes by brainstorming in some structured manner.</p>
<p>• The relation between subnodes and parent node can be AND or OR.</p>
<p>• Some possible structures for first-level subnodes include:</p>
<p>Attacking a system:</p>
<ul>
<li>﻿﻿Physical access.</li>
<li>﻿﻿Subvert software.</li>
<li>﻿﻿Subvert a person.</li>
</ul>
<p>Attacking a system via:</p>
<ul>
<li>﻿﻿People.<br> Process.</li>
<li>﻿﻿Technology.</li>
</ul>
<p>Attacking a product during:</p>
<ul>
<li>Design.</li>
<li>Production.</li>
<li>Distribution.</li>
<li>Usage.</li>
</ul>
<p>\4. Consider completeness.</p>
<p><strong>• An attack tree can be checked for quality by iterating over the node, looking for additional ways to reach the goal. It may be helpful to use STRIDE or attack libraries.</strong></p>
<p>\5. Prune the tree.</p>
<p><strong>• In this step, go through each node in the tree and consider whether the action in each subnode is prevented or duplicative.</strong></p>
<p>\6. Check the presentation.</p>
<p><strong>• Trees can be represented in two ways:</strong></p>
<p><strong>• As a free form (human viewable) model without any technical structure.</strong></p>
<p><strong>• As a structured representation with variable types and&#x2F;or metadata to facilitate programmatic analysis.</strong></p>
<p><strong>Human Viewable Representations</strong></p>
<p>• Attack trees can be drawn graphically or shown in outline form.</p>
<p>• Care should be taken to ensure that the graphics are actually information rich and useful.</p>
<p>• Outline representations are easier to create than graphical representations, but they tend to be less attention-grabbing.</p>
<p>• <strong>If you are using someone else’s tree, be sure to understand their intent. If you are creating once, be sure you are clear on your intent and communicate your intent clearly.</strong></p>
<p><strong>Risk Analysis</strong></p>
<p>• <strong>Risk</strong> &#x3D; (<strong>Probability</strong> of <strong>Incident</strong>) x (Incident Impact)</p>
<p>• When dealing with hostile risk, consider the following:</p>
<p>​	• Vulnerabilities in systems are NOT constants.</p>
<p>​	• Capabilities of the adversary are NOT constant.</p>
<p>​	• Motivators for adversary changes instantaneously.</p>
<p>​	• Adversaries can attack your system anytime.</p>
<p><strong>Probability of Incident</strong> &#x3D; Vulnerability x Threat x Motivation</p>
<p><strong>Security Functional Requirements</strong></p>
<ul>
<li>﻿﻿FAU: Security auditing.</li>
<li>﻿﻿FCP: Communications.</li>
<li>﻿﻿FCS: Cryptographic support.</li>
<li>﻿﻿FDP: User data protection.</li>
<li>﻿﻿FIA: Identification and authentication.</li>
<li>﻿﻿FMT: Security management.</li>
<li>﻿﻿FPR: Privacy.</li>
<li>﻿﻿FPT: Protection of security function.</li>
<li>﻿﻿FRU: Resource utilization.</li>
<li>﻿﻿FTA: Access.</li>
<li>﻿﻿FTP: Trusted path.</li>
</ul>
<p><strong>Security Mechanisms</strong>s</p>
<ul>
<li>There are several ways in which the security policy can be enforced.</li>
<li>Assurance requirements detail the ways in which security is demonstrated.</li>
<li>There are also different ways of evaluating these requirements.</li>
<li>Here are the FIPS standards.</li>
</ul>
<p><img src="/../images/20230427124928638.png" alt="image-20230427124928638"></p>
<p><img src="/../images/20230427125103365.png" alt="image-20230427125103365"></p>
]]></content>
      <categories>
        <category>Courses</category>
      </categories>
      <tags>
        <tag>Courses</tag>
      </tags>
  </entry>
  <entry>
    <title>docker</title>
    <url>/2023/06/17/docker/</url>
    <content><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><h2 id="docker容器使用"><a href="#docker容器使用" class="headerlink" title="docker容器使用"></a>docker容器使用</h2><h3 id="Pull-images"><a href="#Pull-images" class="headerlink" title="Pull images"></a><strong>Pull images</strong></h3><p><code>docker pull</code> 可以来载入镜像</p>
<h3 id="Run-containers"><a href="#Run-containers" class="headerlink" title="Run containers"></a><strong>Run containers</strong></h3><p><code>docker run -it ubuntu /bin/bash</code></p>
<p>参数说明：</p>
<ul>
<li><strong>-i</strong>: 交互式操作。</li>
<li><strong>-t</strong>: 终端。</li>
<li><strong>ubuntu</strong>: ubuntu 镜像。</li>
<li><strong>&#x2F;bin&#x2F;bash</strong>：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 &#x2F;bin&#x2F;bash。</li>
</ul>
<h3 id="Exit-terminal"><a href="#Exit-terminal" class="headerlink" title="Exit terminal"></a><strong>E</strong>xit terminal</h3><p><code>exit</code></p>
<h3 id="查看所有的容器命令如下："><a href="#查看所有的容器命令如下：" class="headerlink" title="查看所有的容器命令如下："></a><strong>查看所有的容器命令如下：</strong></h3><p><code>docker ps -a</code></p>
<p>然后可以用</p>
<p><code>docker start</code>来启动已经关闭的容器</p>
<p><code>docker stop</code>来关闭容器</p>
<p><code>docker restart</code></p>
<h3 id="进入容器"><a href="#进入容器" class="headerlink" title="进入容器"></a><strong>进入容器</strong></h3><p>在使用 <strong>-d</strong> 参数时，容器启动后会进入后台。此时想要进入容器，可以通过以下指令进入：</p>
<ul>
<li><strong>docker attach</strong></li>
<li><strong>docker exec</strong>：推荐大家使用 docker exec 命令，因为此命令会退出容器终端，但不会导致容器的停止。</li>
</ul>
<p><strong>attach 命令</strong>，如果从这个容器退出，会导致容器的停止。</p>
<h3 id="导出或者导入容器"><a href="#导出或者导入容器" class="headerlink" title="导出或者导入容器"></a><strong>导出或者导入容器</strong></h3><p><strong>导出容器</strong></p>
<p>如果要导出本地某个容器，可以使用 <strong>docker export</strong> 命令。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">export</span> 1e560fca3906 &gt; ubuntu.tar</span><br></pre></td></tr></table></figure>

<p><strong>导入容器快照</strong></p>
<p>可以使用 docker import 从容器快照文件中再导入为镜像，以下实例将快照文件 ubuntu.tar 导入到镜像 test&#x2F;ubuntu:v1:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cat</span> docker/ubuntu.tar | docker import - <span class="built_in">test</span>/ubuntu:v1</span><br></pre></td></tr></table></figure>

<p>此外，也可以通过指定 URL 或者某个目录来导入，例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker import http://example.com/exampleimage.tgz example/imagerep</span><br></pre></td></tr></table></figure>

<h3 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a><strong>删除容器</strong></h3><p>删除容器使用 <strong>docker rm</strong> 命令：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">rm</span> -f 1e560fca3906</span><br></pre></td></tr></table></figure>

<p>下面的命令可以清理掉所有处于终止状态的容器。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker container prune</span><br></pre></td></tr></table></figure>



<h3 id="运行web"><a href="#运行web" class="headerlink" title="运行web"></a><strong>运行web</strong></h3><p>前面我们运行的容器并没有一些什么特别的用处。</p>
<p>接下来让我们尝试使用 docker 构建一个 web 应用程序。</p>
<p>我们将在docker容器中运行一个 Python Flask 应用来运行一个web应用。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker pull training/webapp  <span class="comment"># 载入镜像</span></span><br><span class="line">docker run -d -P training/webapp python app.py</span><br></pre></td></tr></table></figure>

<ul>
<li>**-d:**让容器在后台运行。</li>
<li>**-P:**将容器内部使用的网络端口随机映射到我们使用的主机上。</li>
</ul>
<p><strong>端口信息</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">PORTS</span><br><span class="line">0.0.0.0:32769-&gt;5000/tcp</span><br></pre></td></tr></table></figure>

<p>我们也可以通过 -p 参数来设置不一样的端口</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -d -p 5000:5000 training/webapp python app.py</span><br></pre></td></tr></table></figure>



<h3 id="网络端口的快捷方式"><a href="#网络端口的快捷方式" class="headerlink" title="网络端口的快捷方式"></a>网络端口的快捷方式</h3><p>通过 <strong>docker ps</strong> 命令可以查看到容器的端口映射，<strong>docker</strong> 还提供了另一个快捷方式 <strong>docker port</strong>，使用 <strong>docker port</strong> 可以查看指定 （ID 或者名字）容器的某个确定端口映射到宿主机的端口号。</p>
<p>上面我们创建的 web 应用容器 ID 为 <strong>bf08b7f2cd89</strong> 名字为 <strong>wizardly_chandrasekhar</strong>。</p>
<p>我可以使用 <strong>docker port bf08b7f2cd89</strong> 或 <strong>docker port wizardly_chandrasekhar</strong> 来查看容器端口的映射情况。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker port bf08b7f2cd89</span><br><span class="line">5000/tcp -&gt; 0.0.0.0:5000</span><br><span class="line"></span><br><span class="line">$ docker port wizardly_chandrasekhar</span><br><span class="line">5000/tcp -&gt; 0.0.0.0:5000</span><br></pre></td></tr></table></figure>



<h3 id="查看-WEB-应用程序日志"><a href="#查看-WEB-应用程序日志" class="headerlink" title="查看 WEB 应用程序日志"></a>查看 WEB 应用程序日志</h3><p>docker logs [ID或者名字] 可以查看容器内部的标准输出。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker logs -f bf08b7f2cd89</span><br><span class="line"> * Running on http://0.0.0.0:5000/ (Press CTRL+C to quit)</span><br><span class="line">192.168.239.1 - - [09/May/2016 16:30:37] <span class="string">&quot;GET / HTTP/1.1&quot;</span> 200 -</span><br><span class="line">192.168.239.1 - - [09/May/2016 16:30:37] <span class="string">&quot;GET /favicon.ico HTTP/1.1&quot;</span> 404 -</span><br></pre></td></tr></table></figure>

<p><strong>-f:</strong> 让 <strong>docker logs</strong> 像使用 <strong>tail -f</strong> 一样来输出容器内部的标准输出。</p>
<p>从上面，我们可以看到应用程序使用的是 5000 端口并且能够查看到应用程序的访问日志。</p>
<h3 id="查看WEB应用程序容器的进程"><a href="#查看WEB应用程序容器的进程" class="headerlink" title="查看WEB应用程序容器的进程"></a>查看WEB应用程序容器的进程</h3><p>我们还可以使用 docker top 来查看容器内部运行的进程</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker top wizardly_chandrasekhar</span><br><span class="line">UID     PID         PPID          ...       TIME                CMD</span><br><span class="line">root    23245       23228         ...       00:00:00            python app.py</span><br></pre></td></tr></table></figure>



<h3 id="检查-WEB-应用程序"><a href="#检查-WEB-应用程序" class="headerlink" title="检查 WEB 应用程序"></a>检查 WEB 应用程序</h3><p>使用 <strong>docker inspect</strong> 来查看 Docker 的底层信息。它会返回一个 JSON 文件记录着 Docker 容器的配置和状态信息。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker inspect wizardly_chandrasekhar</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">&quot;Id&quot;</span>: <span class="string">&quot;bf08b7f2cd897b5964943134aa6d373e355c286db9b9885b1f60b6e8f82b2b85&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Created&quot;</span>: <span class="string">&quot;2018-09-17T01:41:26.174228707Z&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Path&quot;</span>: <span class="string">&quot;python&quot;</span>,</span><br><span class="line">        <span class="string">&quot;Args&quot;</span>: [</span><br><span class="line">            <span class="string">&quot;app.py&quot;</span></span><br><span class="line">        ],</span><br><span class="line">        <span class="string">&quot;State&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;Status&quot;</span>: <span class="string">&quot;running&quot;</span>,</span><br><span class="line">            <span class="string">&quot;Running&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">&quot;Paused&quot;</span>: <span class="literal">false</span>,9</span><br><span class="line">            <span class="string">&quot;Restarting&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;OOMKilled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Dead&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">            <span class="string">&quot;Pid&quot;</span>: 23245,</span><br><span class="line">            <span class="string">&quot;ExitCode&quot;</span>: 0,</span><br><span class="line">            <span class="string">&quot;Error&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="string">&quot;StartedAt&quot;</span>: <span class="string">&quot;2018-09-17T01:41:26.494185806Z&quot;</span>,</span><br><span class="line">            <span class="string">&quot;FinishedAt&quot;</span>: <span class="string">&quot;0001-01-01T00:00:00Z&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<h3 id="重启WEB应用容器"><a href="#重启WEB应用容器" class="headerlink" title="重启WEB应用容器"></a>重启WEB应用容器</h3><p>已经停止的容器，我们可以使用命令 docker start 来启动。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker start wizardly_chandrasekhar</span><br><span class="line">wizardly_chandrasekhar</span><br></pre></td></tr></table></figure>

<p>docker ps -l 查询最后一次创建的容器：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">#  docker ps -l </span><br><span class="line">CONTAINER ID        IMAGE                             PORTS                     NAMES</span><br><span class="line">bf08b7f2cd89        training/webapp     ...        0.0.0.0:5000-&gt;5000/tcp    wizardly_chandrasekhar</span><br></pre></td></tr></table></figure>

<p>正在运行的容器，我们可以使用 <strong>docker restart</strong> 命令来重启。</p>
<hr>
<h3 id="移除WEB应用容器"><a href="#移除WEB应用容器" class="headerlink" title="移除WEB应用容器"></a>移除WEB应用容器</h3><p>我们可以使用 docker rm 命令来删除不需要的容器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker <span class="built_in">rm</span> wizardly_chandrasekhar  </span><br><span class="line">wizardly_chandrasekhar</span><br></pre></td></tr></table></figure>

<p>删除容器时，容器必须是停止状态，否则会报如下错误</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker <span class="built_in">rm</span> wizardly_chandrasekhar</span><br><span class="line">Error response from daemon: You cannot remove a running container bf08b7f2cd897b5964943134aa6d373e355c286db9b9885b1f60b6e8f82b2b85. Stop the container before attempting removal or force remove</span><br></pre></td></tr></table></figure>



<h2 id="Docker镜像"><a href="#Docker镜像" class="headerlink" title="Docker镜像"></a>Docker镜像</h2><p><strong>docker images</strong></p>
<p>各个选项说明:</p>
<ul>
<li><strong>REPOSITORY：</strong>表示镜像的仓库源</li>
<li><strong>TAG：</strong>镜像的标签</li>
<li><strong>IMAGE ID：</strong>镜像ID</li>
<li><strong>CREATED：</strong>镜像创建时间</li>
<li><strong>SIZE：</strong>镜像大小</li>
</ul>
<p>同一仓库源可以有多个 TAG，代表这个仓库源的不同个版本，如 ubuntu 仓库源里，有 15.10、14.04 等多个不同的版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。</p>
<p>所以，我们如果要使用版本为15.10的ubuntu系统镜像来运行容器时，命令如下：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -t -i ubuntu:15.10 /bin/bash </span><br></pre></td></tr></table></figure>

<p>如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像。</p>
<h3 id="获取一个新的镜像"><a href="#获取一个新的镜像" class="headerlink" title="获取一个新的镜像"></a>获取一个新的镜像</h3><p>当我们在本地主机上使用一个不存在的镜像时 Docker 就会自动下载这个镜像。如果我们想预先下载这个镜像，我们可以使用 docker pull 命令来下载它。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">Crunoob@runoob:~$ docker pull ubuntu:13.10</span><br><span class="line">13.10: Pulling from library/ubuntu</span><br><span class="line">6599cadaf950: Pull complete </span><br><span class="line">23eda618d451: Pull complete </span><br><span class="line">f0be3084efe9: Pull complete </span><br><span class="line">52de432f084b: Pull complete </span><br><span class="line">a3ed95caeb02: Pull complete </span><br><span class="line">Digest: sha256:15b79a6654811c8d992ebacdfbd5152fcf3d165e374e264076aa435214a947a3</span><br><span class="line">Status: Downloaded newer image <span class="keyword">for</span> ubuntu:13.10</span><br></pre></td></tr></table></figure>

<p>下载完成后，我们可以直接使用这个镜像来运行容器。</p>
<h3 id="查找镜像"><a href="#查找镜像" class="headerlink" title="查找镜像"></a>查找镜像</h3><p>我们可以从 Docker Hub 网站来搜索镜像，Docker Hub 网址为： <strong><a href="https://hub.docker.com/">https://hub.docker.com/</a></strong></p>
<p>我们也可以使用 docker search 命令来搜索镜像。比如我们需要一个 httpd 的镜像来作为我们的 web 服务。我们可以通过 docker search 命令搜索 httpd 来寻找适合我们的镜像。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker search httpd</span><br></pre></td></tr></table></figure>



<p><strong>NAME:</strong> 镜像仓库源的名称</p>
<p><strong>DESCRIPTION:</strong> 镜像的描述</p>
<p><strong>OFFICIAL:</strong> 是否 docker 官方发布</p>
<p><strong>stars:</strong> 类似 Github 里面的 star，表示点赞、喜欢的意思。</p>
<p><strong>AUTOMATED:</strong> 自动构建。</p>
<h3 id="拖取镜像"><a href="#拖取镜像" class="headerlink" title="拖取镜像"></a>拖取镜像</h3><p>我们决定使用上图中的 httpd 官方版本的镜像，使用命令 docker pull 来下载镜像。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker pull httpd</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/httpd</span><br><span class="line">8b87079b7a06: Pulling fs layer </span><br><span class="line">a3ed95caeb02: Download complete </span><br><span class="line">0d62ec9c6a76: Download complete </span><br><span class="line">a329d50397b9: Download complete </span><br><span class="line">ea7c1f032b5c: Waiting </span><br><span class="line">be44112b72c7: Waiting</span><br></pre></td></tr></table></figure>

<p>下载完成后，我们就可以使用这个镜像了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker run httpd</span><br></pre></td></tr></table></figure>



<h3 id="删除镜像"><a href="#删除镜像" class="headerlink" title="删除镜像"></a>删除镜像</h3><p>镜像删除使用 <strong>docker rmi</strong> 命令，比如我们删除 hello-world 镜像：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker rmi hello-world</span><br></pre></td></tr></table></figure>





<h3 id="当我们从-docker-镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。"><a href="#当我们从-docker-镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。" class="headerlink" title="当我们从 docker 镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。"></a>当我们从 docker 镜像仓库中下载的镜像不能满足我们的需求时，我们可以通过以下两种方式对镜像进行更改。</h3><ul>
<li>1、从已经创建的容器中更新镜像，并且提交这个镜像</li>
<li>2、使用 Dockerfile 指令来创建一个新的镜像</li>
</ul>
<h4 id="更新镜像"><a href="#更新镜像" class="headerlink" title="更新镜像"></a>更新镜像</h4><p>更新镜像之前，我们需要使用镜像来创建一个容器。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker run -t -i ubuntu:15.10 /bin/bash</span><br><span class="line">root@e218edb10161:/<span class="comment"># </span></span><br></pre></td></tr></table></figure>

<p>在运行的容器内使用 <strong>apt-get update</strong> 命令进行更新。</p>
<p>在完成操作之后，输入 exit 命令来退出这个容器。</p>
<p>此时 ID 为 e218edb10161 的容器，是按我们的需求更改的容器。我们可以通过命令 docker commit 来提交容器副本。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker commit -m=<span class="string">&quot;has update&quot;</span> -a=<span class="string">&quot;runoob&quot;</span> e218edb10161 runoob/ubuntu:v2</span><br><span class="line">sha256:70bf1840fd7c0d2d8ef0a42a817eb29f854c1af8f7c59fc03ac7bdee9545aff8</span><br></pre></td></tr></table></figure>

<p>各个参数说明：</p>
<ul>
<li><strong>-m:</strong> 提交的描述信息</li>
<li><strong>-a:</strong> 指定镜像作者</li>
<li><strong>e218edb10161：</strong>容器 ID</li>
<li><strong>runoob&#x2F;ubuntu:v2:</strong> 指定要创建的目标镜像名</li>
</ul>
<p>我们可以使用 <strong>docker images</strong> 命令来查看我们的新镜像 <strong>runoob&#x2F;ubuntu:v2</strong>：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker images</span><br><span class="line">REPOSITORY          TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">runoob/ubuntu       v2                  70bf1840fd7c        15 seconds ago      158.5 MB</span><br><span class="line">ubuntu              14.04               90d5884b1ee0        5 days ago          188 MB</span><br><span class="line">php                 5.6                 f40e9e0f10c8        9 days ago          444.8 MB</span><br><span class="line">nginx               latest              6f8d099c3adc        12 days ago         182.7 MB</span><br><span class="line">mysql               5.6                 f2e8d6c772c0        3 weeks ago         324.6 MB</span><br><span class="line">httpd               latest              02ef73cf1bc0        3 weeks ago         194.4 MB</span><br><span class="line">ubuntu              15.10               4e3b13c8a266        4 weeks ago         136.3 MB</span><br><span class="line">hello-world         latest              690ed74de00f        6 months ago        960 B</span><br><span class="line">training/webapp     latest              6fae60ef3446        12 months ago       348.8 MB</span><br></pre></td></tr></table></figure>

<p>使用我们的新镜像 <strong>runoob&#x2F;ubuntu</strong> 来启动一个容器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker run -t -i runoob/ubuntu:v2 /bin/bash                            </span><br><span class="line">root@1a9fbdeb5da3:/<span class="comment">#</span></span><br></pre></td></tr></table></figure>



<h4 id="构建镜像"><a href="#构建镜像" class="headerlink" title="构建镜像"></a>构建镜像</h4><p>我们使用命令 <strong>docker build</strong> ， 从零开始来创建一个新的镜像。为此，我们需要创建一个 Dockerfile 文件，其中包含一组指令来告诉 Docker 如何构建我们的镜像。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ <span class="built_in">cat</span> Dockerfile </span><br><span class="line">FROM    centos:6.7</span><br><span class="line">MAINTAINER      Fisher <span class="string">&quot;fisher@sudops.com&quot;</span></span><br><span class="line"></span><br><span class="line">RUN     /bin/echo <span class="string">&#x27;root:123456&#x27;</span> |chpasswd</span><br><span class="line">RUN     useradd runoob</span><br><span class="line">RUN     /bin/echo <span class="string">&#x27;runoob:123456&#x27;</span> |chpasswd</span><br><span class="line">RUN     /bin/echo -e <span class="string">&quot;LANG=\&quot;en_US.UTF-8\&quot;&quot;</span> &gt;/etc/default/local</span><br><span class="line">EXPOSE  22</span><br><span class="line">EXPOSE  80</span><br><span class="line">CMD     /usr/sbin/sshd -D</span><br></pre></td></tr></table></figure>

<p>每一个指令都会在镜像上创建一个新的层，每一个指令的前缀都必须是大写的。</p>
<p>第一条FROM，指定使用哪个镜像源</p>
<p>RUN 指令告诉docker 在镜像内执行命令，安装了什么。。。</p>
<p>然后，我们使用 Dockerfile 文件，通过 docker build 命令来构建一个镜像。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker build -t runoob/centos:6.7 .</span><br><span class="line">Sending build context to Docker daemon 17.92 kB</span><br><span class="line">Step 1 : FROM centos:6.7</span><br><span class="line"> ---&amp;gt; d95b5ca17cc3</span><br><span class="line">Step 2 : MAINTAINER Fisher <span class="string">&quot;fisher@sudops.com&quot;</span></span><br><span class="line"> ---&amp;gt; Using cache</span><br><span class="line"> ---&amp;gt; 0c92299c6f03</span><br><span class="line">Step 3 : RUN /bin/echo <span class="string">&#x27;root:123456&#x27;</span> |chpasswd</span><br><span class="line"> ---&amp;gt; Using cache</span><br><span class="line"> ---&amp;gt; 0397ce2fbd0a</span><br><span class="line">Step 4 : RUN useradd runoob</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><strong>-t</strong> ：指定要创建的目标镜像名</li>
<li><strong>.</strong> ：Dockerfile 文件所在目录，可以指定Dockerfile 的绝对路径</li>
</ul>
<p>使用docker images 查看创建的镜像已经在列表中存在,镜像ID为860c279d2fec</p>
<p>我们可以使用新的镜像来创建容器</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker run -t -i runoob/centos:6.7  /bin/bash</span><br><span class="line">[root@41c28d18b5fb /]<span class="comment"># id runoob</span></span><br><span class="line">uid=500(runoob) gid=500(runoob) <span class="built_in">groups</span>=500(runoob)</span><br></pre></td></tr></table></figure>

<p>从上面看到新镜像已经包含我们创建的用户 runoob。</p>
<h4 id="设置镜像标签"><a href="#设置镜像标签" class="headerlink" title="设置镜像标签"></a>设置镜像标签</h4><p>我们可以使用 docker tag 命令，为镜像添加一个新的标签。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker tag 860c279d2fec runoob/centos:dev</span><br></pre></td></tr></table></figure>

<p>docker tag 镜像ID，这里是 860c279d2fec ,用户名称、镜像源名(repository name)和新的标签名(tag)。</p>
<p>使用 docker images 命令可以看到，ID为860c279d2fec的镜像多一个标签。</p>
<h2 id="Docker-容器连接"><a href="#Docker-容器连接" class="headerlink" title="Docker 容器连接"></a>Docker 容器连接</h2><p>让外部也可以访问这些应用，可以通过 <strong>-P</strong> 或 <strong>-p</strong> 参数来指定端口映射。</p>
<h3 id="网络端口映射"><a href="#网络端口映射" class="headerlink" title="网络端口映射"></a>网络端口映射</h3><p>我们创建了一个 python 应用的容器。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker run -d -P training/webapp python app.py</span><br><span class="line">fce072cc88cee71b1cdceb57c2821d054a4a59f67da6b416fceb5593f059fc6d</span><br></pre></td></tr></table></figure>

<p>另外，我们可以指定容器绑定的网络地址，比如绑定 127.0.0.1。</p>
<p>我们使用 <strong>-P</strong> 绑定端口号，使用 <strong>docker ps</strong> 可以看到容器端口 5000 绑定主机端口 32768。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker ps</span><br><span class="line">CONTAINER ID    IMAGE               COMMAND            ...           PORTS                     NAMES</span><br><span class="line">fce072cc88ce    training/webapp     <span class="string">&quot;python app.py&quot;</span>    ...     0.0.0.0:32768-&gt;5000/tcp   grave_hopper</span><br></pre></td></tr></table></figure>

<p>我们也可以使用 <strong>-p</strong> 标识来指定容器端口绑定到主机端口。</p>
<p>两种方式的区别是:</p>
<ul>
<li><strong>-P :<strong>是容器内部端口</strong>随机</strong>映射到主机的端口。</li>
<li><strong>-p :</strong> 是容器内部端口绑定到<strong>指定</strong>的主机端口。（上面的-P的就是随机分配的32768端口，而下面的则分配了主机的5000端口）</li>
</ul>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker run -d -p 5000:5000 training/webapp python app.py</span><br></pre></td></tr></table></figure>



<p>另外，我们可以指定容器绑定的网络地址，比如绑定 127.0.0.1。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -p 127.0.0.1:5001:5000 training/webapp python app.py</span><br></pre></td></tr></table></figure>

<p>这样我们就可以通过访问 127.0.0.1:5001 来访问容器的 5000 端口。</p>
<p>上面的例子中，默认都是绑定 tcp 端口，如果要绑定 UDP 端口，可以在端口后面加上 <strong>&#x2F;udp</strong>。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -d -p 127.0.0.1:5000:5000/udp training/webapp python app.py</span><br></pre></td></tr></table></figure>



<p><strong>docker port</strong> 命令可以让我们快捷地查看端口的绑定情况。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$ docker port adoring_stonebraker 5000</span><br></pre></td></tr></table></figure>



<h3 id="Docker-容器互联"><a href="#Docker-容器互联" class="headerlink" title="Docker 容器互联"></a>Docker 容器互联</h3><p>端口映射并不是唯一把 docker 连接到另一个容器的方法。</p>
<p>docker 有一个连接系统允许将多个容器连接在一起，共享连接信息。</p>
<p>docker 连接会创建一个父子关系，其中父容器可以看到子容器的信息。</p>
<h4 id="容器命名"><a href="#容器命名" class="headerlink" title="容器命名"></a>容器命名</h4><p>当我们创建一个容器的时候，docker 会自动对它进行命名。另外，我们也可以使用 <strong>–name</strong> 标识来命名容器，例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">runoob@runoob:~$  docker run -d -P --name runoob training/webapp python app.py</span><br></pre></td></tr></table></figure>



<h4 id="新建网络"><a href="#新建网络" class="headerlink" title="新建网络"></a>新建网络</h4><p>下面先创建一个新的 Docker 网络。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker network create -d bridge test-net</span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<p><strong>-d</strong>：参数指定 Docker 网络类型，有 bridge、overlay。</p>
<p>其中 overlay 网络类型用于 Swarm mode，在本小节中你可以忽略它。</p>
<h3 id="连接容器"><a href="#连接容器" class="headerlink" title="连接容器"></a>连接容器</h3><p>运行一个容器并连接到新建的 test-net 网络:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -itd --name test1 --network test-net ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>打开新的终端，再运行一个容器并加入到 test-net 网络:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -itd --name test2 --network test-net ubuntu /bin/bash</span><br></pre></td></tr></table></figure>

<p>用ping命令证明test1和test2都加入了test-net中。</p>
<p>如果 test1、test2 容器内中无 ping 命令，则在容器内执行以下命令安装 ping（即学即用：可以在一个容器里安装好，提交容器到镜像，在以新的镜像重新运行以上俩个容器）。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt install iputils-ping</span><br></pre></td></tr></table></figure>

<p><img src="/../images/docker-net3.png" alt="docker-net3"></p>
<p>这里在test1中可以ping通test2</p>
<p>这样，test1 容器和 test2 容器建立了互联关系。</p>
<p>如果你有多个容器之间需要互相连接，推荐使用 Docker Compose.</p>
<h4 id="配置-DNS"><a href="#配置-DNS" class="headerlink" title="配置 DNS"></a>配置 DNS</h4><p>我们可以在宿主机的 &#x2F;etc&#x2F;docker&#x2F;daemon.json 文件中增加以下内容来设置全部容器的 DNS：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;dns&quot;</span> : [</span><br><span class="line">    <span class="string">&quot;114.114.114.114&quot;</span>,</span><br><span class="line">    <span class="string">&quot;8.8.8.8&quot;</span></span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>设置后，启动容器的 DNS 会自动配置为 114.114.114.114 和 8.8.8.8。</p>
<p>配置完，需要重启 docker 才能生效。</p>
<p>查看容器的 DNS 是否生效可以使用以下命令，它会输出容器的 DNS 信息：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -it --<span class="built_in">rm</span>  ubuntu  <span class="built_in">cat</span> etc/resolv.conf</span><br></pre></td></tr></table></figure>



<p><strong>手动指定容器的配置</strong></p>
<p>如果只想在指定的容器设置 DNS，则可以使用以下命令：	</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker run -it --<span class="built_in">rm</span> -h host_ubuntu  --dns=114.114.114.114 --dns-search=test.com ubuntu</span><br></pre></td></tr></table></figure>

<p>这里的参数说明一下:</p>
<p><strong>–rm</strong>：容器退出时自动清理容器内部的文件系统。</p>
<p><strong>-h HOSTNAME 或者 –hostname&#x3D;HOSTNAME</strong>： 设定容器的主机名，它会被写到容器内的 &#x2F;etc&#x2F;hostname 和 &#x2F;etc&#x2F;hosts。</p>
<p><strong>–dns&#x3D;IP_ADDRESS</strong>： 添加 DNS 服务器到容器的 &#x2F;etc&#x2F;resolv.conf 中，让容器用这个服务器来解析所有不在 &#x2F;etc&#x2F;hosts 中的主机名。</p>
<p><strong>–dns-search&#x3D;DOMAIN</strong>： 设定容器的搜索域，当设定搜索域为 .example.com 时，在搜索一个名为 host 的主机时，DNS 不仅搜索 host，还会搜索 host.example.com。</p>
<p>如果在容器启动时没有指定 <strong>–dns</strong> 和 <strong>–dns-search</strong>，Docker 会默认用宿主主机上的 &#x2F;etc&#x2F;resolv.conf 来配置容器的 DNS。</p>
<h2 id="Docker-Repository仓库管理"><a href="#Docker-Repository仓库管理" class="headerlink" title="Docker Repository仓库管理"></a>Docker Repository仓库管理</h2><p>Repo contains images.</p>
<p>Docker Hub is a offical repo which is managed by docker.</p>
<p><strong>拉取镜像</strong></p>
<p>你可以通过 docker search 命令来查找官方仓库中的镜像，并利用 docker pull 命令来将它下载到本地。</p>
<p>比如你要搜索ubuntu, 你就可以使用以下的命令</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker search ubuntu</span><br></pre></td></tr></table></figure>

<p><img src="/../images/20230618135435373.png" alt="image-20230618135435373"></p>
<p>然后你就可以使用<code>docker pull ubuntu</code>命令</p>
<p><strong>推送镜像</strong></p>
<p>在用户登陆docker hub之后，你也可以推送自己的镜像到docker hub，使用<code>docker push</code>命令</p>
<p>以下命令中的 username 请替换为你的 Docker 账号用户名。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker tag ubuntu:18.04 username/ubuntu:18.04</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker image <span class="built_in">ls</span></span></span><br><span class="line"></span><br><span class="line">REPOSITORY      TAG        IMAGE ID            CREATED           ...  </span><br><span class="line">ubuntu          18.04      275d79972a86        6 days ago        ...  </span><br><span class="line">username/ubuntu 18.04      275d79972a86        6 days ago        ...  </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker push username/ubuntu:18.04</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">docker search username/ubuntu</span></span><br><span class="line"></span><br><span class="line">NAME             DESCRIPTION       STARS         OFFICIAL    AUTOMATED</span><br><span class="line">username/ubuntu</span><br></pre></td></tr></table></figure>



<h2 id="Docker-Dockerfile"><a href="#Docker-Dockerfile" class="headerlink" title="Docker Dockerfile"></a>Docker Dockerfile</h2><p>A Dockerfile is a text document that contains all the commands a user could call on the command line to assemble an image. Essentially, Dockerfiles are sets of instructions that Docker uses to build a Docker image automatically.</p>
<h3 id="使用dockerfile来定制镜像"><a href="#使用dockerfile来定制镜像" class="headerlink" title="使用dockerfile来定制镜像"></a>使用dockerfile来定制镜像</h3><p>以定制一个nginx镜像为例子，<strong>构建好的镜像内会有一个 &#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html&#x2F;index.html 文件</strong></p>
<p><strong>1.在一个空目录下，新建一个名为 Dockerfile 文件，并在文件内添加以下内容：</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">FROM nginx</span><br><span class="line">RUN echo &#x27;这是一个本地构建的nginx镜像&#x27; &gt; /usr/share/nginx/html/index.html</span><br></pre></td></tr></table></figure>



<p><strong>2.From和Run指令的作用</strong></p>
<p>FROM：定制的镜像都是基于 FROM 的镜像，这里的 nginx 就是定制需要的基础镜像。后续的操作都是基于 nginx。</p>
<p>RUN：用于执行后面跟着的命令行命令。有以下俩种格式：</p>
<p>shell格式:</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RUN &lt;命令行命令&gt;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">&lt;命令行命令&gt; 等同于，在终端操作的 shell 命令。</span></span><br></pre></td></tr></table></figure>

<p>exec 格式：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">RUN [&quot;可执行文件&quot;, &quot;参数1&quot;, &quot;参数2&quot;]</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">例如：</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">RUN [<span class="string">&quot;./test.php&quot;</span>, <span class="string">&quot;dev&quot;</span>, <span class="string">&quot;offline&quot;</span>] 等价于 RUN ./test.php dev offline</span></span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：Dockerfile 的指令每执行一次都会在 docker 上新建一层。所以过多无意义的层，会造成镜像膨胀过大。例如：</p>
<p>FROM centos<br>RUN <strong>yum</strong> -y <strong>install</strong> <strong>wget</strong><br>RUN <strong>wget</strong> -O redis.tar.gz “<a href="http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;">http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</a><br>RUN <strong>tar</strong> -xvf redis.tar.gz</p>
<p>以上执行会创建 3 层镜像。可简化为以下格式：</p>
<p>FROM centos<br>RUN <strong>yum</strong> -y <strong>install</strong> <strong>wget</strong> <br>  <strong>&amp;&amp;</strong> <strong>wget</strong> -O redis.tar.gz “<a href="http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;">http://download.redis.io/releases/redis-5.0.3.tar.gz&quot;</a> <br>  <strong>&amp;&amp;</strong> <strong>tar</strong> -xvf redis.tar.gz</p>
<p>如上，以 <strong>&amp;&amp;</strong> 符号连接命令，这样执行后，只会创建 1 层镜像。</p>
<h3 id="开始构建镜像"><a href="#开始构建镜像" class="headerlink" title="开始构建镜像"></a><strong>开始构建镜像</strong></h3><p>在 Dockerfile 文件的存放目录下，执行构建动作</p>
<p>示例，通过目录下的 Dockerfile 构建一个 nginx:v3 (镜像名称:镜像标签)。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">$ docker build -t nginx:v3 .</span><br></pre></td></tr></table></figure>

<p>The <code>.</code> specifies the build context or the path to the directory containing the Dockerfile.</p>
<p><img src="/../images/dockerfile2.png" alt="dockerfile2"></p>
<p>以上显示，说明已经构建成功。</p>
<h3 id="上下文路径"><a href="#上下文路径" class="headerlink" title="上下文路径"></a>上下文路径</h3><p> <code>.</code> 是上下文路径，那么什么是上下文路径呢？</p>
<p>上下文路径，是指 docker 在构建镜像，有时候想要使用到本机的文件（比如复制），docker build 命令得知这个路径后，会将路径下的所有内容打包。</p>
<p><strong>解析</strong>：由于 docker 的运行模式是 C&#x2F;S。我们本机是 C，docker 引擎是 S。实际的构建过程是在 docker 引擎下完成的，所以这个时候无法用到我们本机的文件。这就需要把我们本机的指定目录下的文件一起打包提供给 docker 引擎使用。</p>
<p>如果未说明最后一个参数，那么默认上下文路径就是 Dockerfile 所在的位置。</p>
<p><strong>注意</strong>：上下文路径下不要放无用的文件，因为会一起打包发送给 docker 引擎，如果文件过多会造成过程缓慢。</p>
<h3 id="dockerfile的指令详解"><a href="#dockerfile的指令详解" class="headerlink" title="dockerfile的指令详解"></a>dockerfile的指令详解</h3><p><strong>简洁版</strong></p>
<ul>
<li>FROM</li>
</ul>
<p>构建镜像基于哪个镜像</p>
<ul>
<li>MAINTAINER</li>
</ul>
<p>镜像维护者姓名或邮箱地址</p>
<ul>
<li>RUN</li>
</ul>
<p>构建镜像时运行的指令</p>
<ul>
<li>CMD</li>
</ul>
<p>运行容器时执行的shell环境</p>
<ul>
<li>VOLUME</li>
</ul>
<p>指定容器挂载点到宿主机自动生成的目录或其他容器</p>
<ul>
<li>USER</li>
</ul>
<p>为RUN、CMD、和 ENTRYPOINT 执行命令指定运行用户</p>
<ul>
<li>WORKDIR</li>
</ul>
<p>为 RUN、CMD、ENTRYPOINT、COPY 和 ADD 设置工作目录，就是切换目录</p>
<ul>
<li>HEALTHCHECH</li>
</ul>
<p>健康检查</p>
<ul>
<li>ARG</li>
</ul>
<p>构建时指定的一些参数</p>
<ul>
<li>EXPOSE</li>
</ul>
<p>声明容器的服务端口（仅仅是声明）</p>
<ul>
<li>ENV</li>
</ul>
<p>设置容器环境变量</p>
<ul>
<li>ADD</li>
</ul>
<p>拷贝文件或目录到容器中，如果是URL或压缩包便会自动下载或自动解压</p>
<ul>
<li>COPY</li>
</ul>
<p>拷贝文件或目录到容器中，跟ADD类似，但不具备自动下载或解压的功能</p>
<ul>
<li>ENTRYPOINT</li>
</ul>
<p>运行容器时执行的shell命令</p>
<hr>
<p><strong>详细版</strong></p>
<h4 id="COPY"><a href="#COPY" class="headerlink" title="COPY"></a>COPY</h4><p>复制指令，从上下文目录中复制文件或者目录到容器里指定路径。</p>
<p>格式：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">COPY [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] &lt;源路径1&gt;...  &lt;目标路径&gt;</span><br><span class="line">COPY [--<span class="built_in">chown</span>=&lt;user&gt;:&lt;group&gt;] [<span class="string">&quot;&lt;源路径1&gt;&quot;</span>,...  <span class="string">&quot;&lt;目标路径&gt;&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>**[–chown&#x3D;<user>:<group>]**：可选参数，用户改变复制到容器内文件的拥有者和属组。</group></user></p>
<p>**&lt;源路径&gt;**：源文件或者源目录，这里可以是通配符表达式，其通配符规则要满足 Go 的 filepath.Match 规则。例如：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">COPY hom* /mydir/</span><br><span class="line">COPY hom?.txt /mydir/</span><br></pre></td></tr></table></figure>

<p>**&lt;目标路径&gt;**：容器内的指定路径，该路径不用事先建好，路径不存在的话，会自动创建。</p>
<h4 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h4><p>ADD 指令和 COPY 的使用格类似（同样需求下，官方推荐使用 COPY）。功能也类似，不同之处如下：</p>
<ul>
<li>ADD 的优点：在执行 &lt;源文件&gt; 为 tar 压缩文件的话，压缩格式为 gzip, bzip2 以及 xz 的情况下，会自动复制并解压到 &lt;目标路径&gt;。</li>
<li>ADD 的缺点：在不解压的前提下，无法复制 tar 压缩文件。会令镜像构建缓存失效，从而可能会令镜像构建变得比较缓慢。具体是否使用，可以根据是否需要自动解压来决定。</li>
</ul>
<h4 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h4><p>类似于 RUN 指令，用于运行程序，但二者运行的时间点不同:</p>
<ul>
<li>CMD 在docker run 时运行。</li>
<li>RUN 是在 docker build。</li>
</ul>
<p><strong>作用</strong>：为启动的容器指定默认要运行的程序，程序运行结束，容器也就结束。CMD 指令指定的程序可被 docker run 命令行参数中指定要运行的程序所覆盖。</p>
<p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 CMD 指令，仅最后一个生效。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">CMD &lt;shell 命令&gt; </span><br><span class="line">CMD [&quot;&lt;可执行文件或命令&gt;&quot;,&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;,...] </span><br><span class="line">CMD [&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;,...]  # 该写法是为 ENTRYPOINT 指令指定的程序提供默认参数</span><br></pre></td></tr></table></figure>

<p>推荐使用第二种格式，执行过程比较明确。第一种格式实际上在运行的过程中也会自动转换成第二种格式运行，并且默认可执行文件是 sh。</p>
<h4 id="ENTRYPOINT"><a href="#ENTRYPOINT" class="headerlink" title="ENTRYPOINT"></a>ENTRYPOINT</h4><p>类似于 CMD 指令，但其不会被 docker run 的命令行参数指定的指令所覆盖，而且这些命令行参数会被当作参数送给 ENTRYPOINT 指令指定的程序。</p>
<p>但是, 如果运行 docker run 时使用了 –entrypoint 选项，将覆盖 ENTRYPOINT 指令指定的程序。</p>
<p><strong>优点</strong>：在执行 docker run 的时候可以指定 ENTRYPOINT 运行所需的参数。</p>
<p><strong>注意</strong>：如果 Dockerfile 中如果存在多个 ENTRYPOINT 指令，仅最后一个生效。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ENTRYPOINT [&quot;&lt;executeable&gt;&quot;,&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;,...]</span><br></pre></td></tr></table></figure>

<p>可以搭配 CMD 命令使用：一般是变参才会使用 CMD ，这里的 CMD 等于是在给 ENTRYPOINT 传参，以下示例会提到。</p>
<p>示例：</p>
<p>假设已通过 Dockerfile 构建了 nginx:test 镜像：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">FROM nginx</span><br><span class="line"></span><br><span class="line">ENTRYPOINT [&quot;nginx&quot;, &quot;-c&quot;] # 定参</span><br><span class="line">CMD [&quot;/etc/nginx/nginx.conf&quot;] # 变参 </span><br></pre></td></tr></table></figure>

<p>1、不传参运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ docker run  nginx:test</span><br></pre></td></tr></table></figure>

<p>容器内会默认运行以下命令，启动主进程。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nginx -c /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<p>2、传参运行</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$ docker run  nginx:test -c /etc/nginx/new.conf</span><br></pre></td></tr></table></figure>

<p>容器内会默认运行以下命令，启动主进程(&#x2F;etc&#x2F;nginx&#x2F;new.conf:假设容器内已有此文件)</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">nginx -c /etc/nginx/new.conf</span><br></pre></td></tr></table></figure>

<h4 id="ENV"><a href="#ENV" class="headerlink" title="ENV"></a>ENV</h4><p>设置环境变量，定义了环境变量，那么在后续的指令中，就可以使用这个环境变量。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ENV &lt;key&gt; &lt;value&gt;</span><br><span class="line">ENV &lt;key1&gt;=&lt;value1&gt; &lt;key2&gt;=&lt;value2&gt;...</span><br></pre></td></tr></table></figure>

<p>以下示例设置 NODE_VERSION &#x3D; 7.2.0 ， 在后续的指令中可以通过 $NODE_VERSION 引用：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ENV NODE_VERSION 7.2.0</span><br><span class="line"></span><br><span class="line">RUN curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION-linux-x64.tar.xz&quot; \</span><br><span class="line">  &amp;&amp; curl -SLO &quot;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc&quot;</span><br></pre></td></tr></table></figure>

<h4 id="ARG"><a href="#ARG" class="headerlink" title="ARG"></a>ARG</h4><p>构建参数，与 ENV 作用一致。不过作用域不一样。ARG 设置的环境变量仅对 Dockerfile 内有效，也就是说只有 docker build 的过程中有效，构建好的镜像内不存在此环境变量。</p>
<p>构建命令 docker build 中可以用 –build-arg &lt;参数名&gt;&#x3D;&lt;值&gt; 来覆盖。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ARG &lt;参数名&gt;[=&lt;默认值&gt;]</span><br></pre></td></tr></table></figure>

<h4 id="VOLUME"><a href="#VOLUME" class="headerlink" title="VOLUME"></a>VOLUME</h4><p>定义匿名数据卷。在启动容器时忘记挂载数据卷，会自动挂载到匿名卷。</p>
<p>作用：</p>
<ul>
<li>避免重要的数据，因容器重启而丢失，这是非常致命的。</li>
<li>避免容器不断变大。</li>
</ul>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">VOLUME [&quot;&lt;路径1&gt;&quot;, &quot;&lt;路径2&gt;&quot;...]</span><br><span class="line">VOLUME &lt;路径&gt;</span><br></pre></td></tr></table></figure>

<p>在启动容器 docker run 的时候，我们可以通过 -v 参数修改挂载点。</p>
<h4 id="EXPOSE"><a href="#EXPOSE" class="headerlink" title="EXPOSE"></a>EXPOSE</h4><p>仅仅只是声明端口。</p>
<p>作用：</p>
<ul>
<li>帮助镜像使用者理解这个镜像服务的守护端口，以方便配置映射。</li>
<li>在运行时使用随机端口映射时，也就是 docker run -P 时，会自动随机映射 EXPOSE 的端口。</li>
</ul>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">EXPOSE &lt;端口1&gt; [&lt;端口2&gt;...]</span><br></pre></td></tr></table></figure>

<h4 id="WORKDIR"><a href="#WORKDIR" class="headerlink" title="WORKDIR"></a>WORKDIR</h4><p>指定工作目录。用 WORKDIR 指定的工作目录，会在构建镜像的每一层中都存在。以后各层的当前目录就被改为指定的目录，如该目录不存在，WORKDIR 会帮你建立目录。</p>
<p>docker build 构建镜像过程中的，每一个 RUN 命令都是新建的一层。只有通过 WORKDIR 创建的目录才会一直存在。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">WORKDIR &lt;工作目录路径&gt;</span><br></pre></td></tr></table></figure>

<h4 id="USER"><a href="#USER" class="headerlink" title="USER"></a>USER</h4><p>用于指定执行后续命令的用户和用户组，这边只是切换后续命令执行的用户（用户和用户组必须提前已经存在）。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">USER &lt;用户名&gt;[:&lt;用户组&gt;]</span><br></pre></td></tr></table></figure>

<h4 id="HEALTHCHECK"><a href="#HEALTHCHECK" class="headerlink" title="HEALTHCHECK"></a>HEALTHCHECK</h4><p>用于指定某个程序或者指令来监控 docker 容器服务的运行状态。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HEALTHCHECK [选项] CMD &lt;命令&gt;：设置检查容器健康状况的命令</span><br><span class="line">HEALTHCHECK NONE：如果基础镜像有健康检查指令，使用这行可以屏蔽掉其健康检查指令</span><br><span class="line"></span><br><span class="line">HEALTHCHECK [选项] CMD &lt;命令&gt; : 这边 CMD 后面跟随的命令使用，可以参考 CMD 的用法。</span><br></pre></td></tr></table></figure>

<h4 id="ONBUILD"><a href="#ONBUILD" class="headerlink" title="ONBUILD"></a>ONBUILD</h4><p>用于延迟构建命令的执行。简单的说，就是 Dockerfile 里用 ONBUILD 指定的命令，在本次构建镜像的过程中不会执行（假设镜像为 test-build）。当有新的 Dockerfile 使用了之前构建的镜像 FROM test-build ，这时执行新镜像的 Dockerfile 构建时候，会执行 test-build 的 Dockerfile 里的 ONBUILD 指定的命令。</p>
<p>格式：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ONBUILD &lt;其它指令&gt;</span><br></pre></td></tr></table></figure>

<h4 id="LABEL"><a href="#LABEL" class="headerlink" title="LABEL"></a>LABEL</h4><p>LABEL 指令用来给镜像添加一些元数据（metadata），以键值对的形式，语法格式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</span><br></pre></td></tr></table></figure>

<p>比如我们可以添加镜像的作者：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">LABEL org.opencontainers.image.authors=&quot;runoob&quot;</span><br></pre></td></tr></table></figure>



<h2 id="Docker-Compose"><a href="#Docker-Compose" class="headerlink" title="Docker Compose"></a>Docker Compose</h2><p><strong>what is compose?</strong></p>
<p>Compose 是用于定义和运行多容器 Docker 应用程序的工具。通过 Compose，您可以使用 YML 文件来配置应用程序需要的所有服务。然后，使用一个命令，就可以从 YML 文件配置中创建并启动所有服务。Compose 使用的三个步骤：</p>
<ul>
<li>使用 Dockerfile 定义应用程序的环境。</li>
<li>使用 docker-compose.yml 定义构成应用程序的服务，这样它们可以在隔离环境中一起运行。</li>
<li>最后，执行 docker-compose up 命令来启动并运行整个应用程序。</li>
</ul>
<p>docker-compose.yml 的配置案例如下（配置参数参考下文）：</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># yaml 配置实例</span></span><br><span class="line"><span class="attr">version:</span> <span class="string">&#x27;3&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line"> <span class="attr">web:</span></span><br><span class="line">  <span class="attr">build:</span> <span class="string">.</span></span><br><span class="line">  <span class="attr">ports:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;5000:5000&quot;</span></span><br><span class="line">  <span class="attr">volumes:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">.:code</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">logvolume01:/var/log</span></span><br><span class="line">  <span class="attr">links:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">redis</span></span><br><span class="line"> <span class="attr">redis:</span></span><br><span class="line">  <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line"> <span class="attr">logvolume01:</span> &#123;&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
  </entry>
  <entry>
    <title>mall developing</title>
    <url>/2023/03/31/mall-developing/</url>
    <content><![CDATA[<h2 id="Bug-shooting"><a href="#Bug-shooting" class="headerlink" title="Bug shooting"></a>Bug shooting</h2><h3 id="Bug1"><a href="#Bug1" class="headerlink" title="Bug1."></a>Bug1.</h3><p><strong>captcha disappearance</strong></p>
<p><a href="https://www.javazxz.com/thread-7116-1-1.html">https://www.javazxz.com/thread-7116-1-1.html</a></p>
<h3 id="Bug2"><a href="#Bug2" class="headerlink" title="Bug2."></a>Bug2.</h3><p><strong>com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure</strong></p>
<p>network problem. The student.gla.ac.uk network filed cannot access to tencent server.</p>
<h3 id="Bug3"><a href="#Bug3" class="headerlink" title="Bug3."></a>Bug3.</h3><p><strong>No spring.config.import property has been defined</strong></p>
<p>产生问题的原因是bootstrap.properties比application.properties的优先级要高<br>由于bootstrap.properties是系统级的资源配置文件，是用在程序引导执行时更加早期配置信息读取；<br>而application.properties是用户级的资源配置文件，是用来后续的一些配置所需要的公共参数。<br>但是在SpringCloud 2020.* 版本把bootstrap禁用了，导致在读取文件的时候读取不到而报错，所以我们只要把bootstrap从新导入进来就会生效了。</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.clouds<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.0.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在全部使用nacos配置后，就不用引用这个了</p>
<h3 id="Bug4"><a href="#Bug4" class="headerlink" title="Bug4"></a>Bug4</h3><p>java: 找不到符号 符号：方法 XXX() 位置: 类型为io.renren.modules.sys.entity</p>
<p><strong>Solution:</strong></p>
<ol>
<li>这是因为你的idea中内置lombok和项目中pom文件的版本不兼容的原因，简单说就是这两个发生冲突了，大部分的出现在idea2020和2021版本上可能会出现问题。</li>
<li>因为lombok版本是一般是受springboot版本管理的，也可以通过升级springboot的版本来提高lombok版本，只要你springboot中引用的Lombok高于上面的版本就可以。</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Lombok--&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.14<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;<span class="name">scope</span>&gt;</span>provided<span class="tag">&lt;/<span class="name">scope</span>&gt;</span>//注意这行代码一定要加上去，我的问题就是出现在没有加这行代码还是会报错、</span><br><span class="line">		<span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Config"><a href="#Config" class="headerlink" title="Config:"></a>Config:</h2><h3 id="1-redis"><a href="#1-redis" class="headerlink" title="1. redis"></a>1. redis</h3><p>Remote configuration:![image-20230403164112175](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230403164112175.png)</p>
<h3 id="mysql"><a href="#mysql" class="headerlink" title="mysql"></a>mysql</h3><p>![image-20230403164158804](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230403164158804.png)</p>
<p>![image-20230403164227851](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230403164227851.png)</p>
<p><strong>JDBC</strong></p>
<p>Info:</p>
<p>Url:jdbc:mysql:&#x2F;&#x2F;47.98.63.250:3306&#x2F;mall_pms</p>
<p><em>use the server’s public ip addr</em></p>
<p>DBMS: MySQL (ver. 5.7.41)<br>Case sensitivity: plain&#x3D;exact, delimited&#x3D;exact<br>Driver: MySQL Connector&#x2F;J (ver. mysql-connector-java-8.0.25 (Revision: 08be9e9b4cba6aa115f9b27b215887af40b159e0), JDBC4.2)</p>
<p>Ping: 1 sec, 25 ms<br>SSL: yes</p>
<p><strong>nacos:</strong></p>
<p>nacos配置按照最新版本的springcloud alibaba来</p>
<p>不用使用bootstrap的配置文件来定位nacos</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-alibaba-nacos-config<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 排除 bootstrap, 未来版本 spring-cloud-alibaba 应该在 spring boot &gt;= 2.4.0 时将该依赖设置为 optional --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>



<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">cloud:</span></span><br><span class="line">    <span class="attr">nacos:</span></span><br><span class="line">      <span class="attr">config:</span></span><br><span class="line">        <span class="attr">server-addr:</span> <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span><span class="string">:8848</span></span><br><span class="line">        <span class="attr">namespace:</span> <span class="string">2e40d043-66f9-4a92-acc1-af90e80b9204</span></span><br><span class="line">        <span class="attr">group:</span> <span class="string">dev</span></span><br><span class="line">  <span class="attr">config:</span></span><br><span class="line">    <span class="attr">import:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">optional:nacos:mall-coupon.yml?group=dev</span> <span class="comment"># 监听 DEFAULT_GROUP:mall-coupon.yml覆盖默认 group, 监听 group_01:test01.yml</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">optional:nacos:datasource.yml?group=dev&amp;refreshEnabled=false</span> <span class="comment"># 不开启动态刷新</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">optional:nacos:mybatis.yml?group=dev</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">optional:nacos:other.yml?group=dev</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>容器重启数据丢失问题:</strong></p>
<p><strong>MySQL</strong> <strong>配置</strong> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vi /mydata/mysql/conf/my.cnf </span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[client] </span><br><span class="line"></span><br><span class="line">default-character-set=utf8 </span><br><span class="line"></span><br><span class="line">[mysql] </span><br><span class="line"></span><br><span class="line">default-character-set=utf8 </span><br><span class="line"></span><br><span class="line">[mysqld] </span><br><span class="line"></span><br><span class="line">init_connect=<span class="string">&#x27;SET collation_connection = utf8_unicode_ci&#x27;</span> </span><br><span class="line"></span><br><span class="line">init_connect=<span class="string">&#x27;SET NAMES utf8&#x27;</span> </span><br><span class="line"></span><br><span class="line">character-set-server=utf8 </span><br><span class="line"></span><br><span class="line">collation-server=utf8_unicode_ci </span><br><span class="line"></span><br><span class="line">skip-character-set-client-handshake </span><br><span class="line"></span><br><span class="line">skip-name-resolve</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker run -p 3306:3306 \</span><br><span class="line">--name mysql \</span><br><span class="line">-v /mydata/mysql/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf:/etc/mysql/my.cnf  \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql:5.7 </span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>通过容器的</strong> <strong>mysql</strong> <strong>命令行工具连接</strong> </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql mysql -uroot -proot</span><br></pre></td></tr></table></figure>



<p><strong>设置</strong> <strong>root</strong> <strong>远程访问</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">grant all privileges on *.* to <span class="string">&#x27;root&#x27;</span>@<span class="string">&#x27;%&#x27;</span> identified by <span class="string">&#x27;root&#x27;</span> with grant option; </span><br><span class="line"></span><br><span class="line">flush privileges;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker <span class="built_in">exec</span> -it mysql /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> /etc/mysql</span><br><span class="line"><span class="built_in">ls</span></span><br></pre></td></tr></table></figure>

<p>解决方法<br>了解上面的介绍后，解决它就很简单了。</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">docker ps -a 找到我们上次运行的容器<span class="built_in">id</span></span><br><span class="line">docker restart <span class="built_in">id</span> 即可</span><br></pre></td></tr></table></figure>

<p>你没看错就这样就完了。</p>
<p>我这里创建了volume容器来对其进行持久化，位置在&#x2F;var&#x2F;lib&#x2F;docker&#x2F;volumes&#x2F;mysql-data&#x2F;_data，从mysql容器中mount在我的cloud server上的路径为my&#x2F;own</p>
<p><strong>Gateway</strong></p>
<p>将renren-fast注册到nacos中去, 可能会遇到一些依赖错误，在该微服务的pom文件中引入这两个坐标</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-commons<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span> <span class="comment">&lt;!-- Make sure to use the correct version --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在gateway中按格式加入</p>
<figure class="highlight yml"><table><tr><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">id:</span> <span class="string">admin_route</span></span><br><span class="line">  <span class="attr">uri:</span> <span class="string">lb://renren-fast</span> <span class="comment"># 路由给renren-fast，lb代表负载均衡</span></span><br><span class="line">  <span class="attr">predicates:</span>  <span class="comment"># 什么情况下路由给它</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Path=/api/**</span> <span class="comment"># 默认前端项目都带上api前缀，</span></span><br><span class="line">  <span class="attr">filters:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RewritePath=/api/(?&lt;segment&gt;.*),/renren-fast/$\&#123;segment&#125;</span></span><br></pre></td></tr></table></figure>



<p><strong>Cors</strong></p>
<p>记得将renren-fast中的cors注解掉</p>
<p>并在网关中配置这个</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.josh.mall.gateway.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfiguration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.CorsConfigurationSource;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.CorsWebFilter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Description:</span></span><br><span class="line"><span class="comment"> * Author: joshua</span></span><br><span class="line"><span class="comment"> * Date: 2023/5/28</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span> <span class="comment">// gateway</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MallCorsConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span> <span class="comment">// 添加过滤器</span></span><br><span class="line">    <span class="keyword">public</span> CorsWebFilter <span class="title function_">corsWebFilter</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="comment">// 基于url跨域，选择reactive包下的</span></span><br><span class="line">        UrlBasedCorsConfigurationSource source=<span class="keyword">new</span> <span class="title class_">UrlBasedCorsConfigurationSource</span>();</span><br><span class="line">        <span class="comment">// 跨域配置信息</span></span><br><span class="line">        <span class="type">CorsConfiguration</span> <span class="variable">corsConfiguration</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CorsConfiguration</span>();</span><br><span class="line">        <span class="comment">// 允许跨域的头</span></span><br><span class="line">        corsConfiguration.addAllowedHeader(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 允许跨域的请求方式</span></span><br><span class="line">        corsConfiguration.addAllowedMethod(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 允许跨域的请求来源</span></span><br><span class="line">        corsConfiguration.addAllowedOriginPattern(<span class="string">&quot;*&quot;</span>);</span><br><span class="line">        <span class="comment">// 是否允许携带cookie跨域</span></span><br><span class="line">        corsConfiguration.setAllowCredentials(<span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 任意url都要进行跨域配置</span></span><br><span class="line">        source.registerCorsConfiguration(<span class="string">&quot;/**&quot;</span>,corsConfiguration);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">CorsWebFilter</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title>kubernetes</title>
    <url>/2023/06/26/kubernetes/</url>
    <content><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>Kubernetes is a portable, extensible, open source platform for managing containerized workloads and services, that facilitates both declarative configuration and automation. It has a large, rapidly growing ecosystem. Kubernetes services, support, and tools are widely available.</p>
<ul>
<li>When you deploy Kubernetes, you get a cluster.</li>
<li>A Kubernetes cluster consists of a set of worker machines, called <a href="https://kubernetes.io/docs/concepts/architecture/nodes/">nodes</a>, that run containerized applications.</li>
<li>Every cluster has at least one worker node.</li>
</ul>
<h2 id="Components"><a href="#Components" class="headerlink" title="Components"></a>Components</h2><p>This document outlines the various components you need to have for a complete and working Kubernetes cluster.</p>
<h3 id="Control-Plane-components"><a href="#Control-Plane-components" class="headerlink" title="Control Plane components"></a>Control Plane components</h3><h4 id="kube-api-server"><a href="#kube-api-server" class="headerlink" title="kube-api server"></a><strong>kube-api server</strong></h4><p>The API server is the front end for the Kubernetes control plane.</p>
<p>The main implementation of a Kubernetes API server is <a href="https://kubernetes.io/docs/reference/generated/kube-apiserver/">kube-apiserver</a>. kube-apiserver is designed to scale horizontally—that is, it scales by deploying more instances. You can run several instances of kube-apiserver and balance traffic between those instances.</p>
<p><strong>Horizontal scaling vs Vertical scaling:</strong></p>
<p><strong>水平扩展</strong></p>
<p>是通过增加或减少工作负载的实例数量来调整资源的过程。在 Kubernetes 中，这通常是通过增加或减少 Pod 的副本数量来实现的。例如，如果一个应用程序的负载增加，可以增加 Pod 的数量来分散负载。这通常是通过使用 Kubernetes 的 Horizontal Pod Autoscaler (HPA) 来自动完成的，HPA 根据 CPU 利用率或其他选择的度量标准来自动调整 Pod 的数量。<br>水平扩展通常适用于无状态应用程序，因为增加的实例可以独立处理请求，不需要访问共享资源。</p>
<p><strong>垂直扩展</strong></p>
<p>是通过增加或减少单个实例的资源（如 CPU 或内存）来调整资源的过程。在 Kubernetes 中，这通常是通过增加或减少 Pod 的资源限制和请求来实现的。</p>
<p>例如，如果一个应用程序的性能受到 CPU 或内存的限制，可以增加 Pod 的 CPU 或内存资源来提高性能。</p>
<p>垂直扩展通常适用于有状态应用程序，因为这些应用程序通常需要访问共享资源，而且可能不容易在多个实例之间分散负载。</p>
<h4 id="etcd"><a href="#etcd" class="headerlink" title="etcd"></a><strong>etcd</strong></h4><p>Consistent and highly-available key value store used as Kubernetes’ backing store for all cluster data. If your Kubernetes cluster uses etcd as its backing store, make sure you have a back up plan for the data.</p>
<h4 id="Kube-scheduler"><a href="#Kube-scheduler" class="headerlink" title="Kube-scheduler"></a><strong>Kube-scheduler</strong></h4><p>Control plane component that watches for newly created Pods with no assigned node, and selects a node for them to run on. Factors taken into account for scheduling decisions include: individual and collective resource requirements, hardware&#x2F;software&#x2F;policy constraints, affinity and anti-affinity specifications, data locality, inter-workload interference, and deadlines.</p>
<h4 id="Kube-controller-manager"><a href="#Kube-controller-manager" class="headerlink" title="Kube-controller-manager"></a>Kube-controller-manager</h4><p>Control plane component that runs <a href="https://kubernetes.io/docs/concepts/architecture/controller/">controller</a> processes. Logically, each <a href="https://kubernetes.io/docs/concepts/architecture/controller/">controller</a> is a separate process, but to reduce complexity, they are all compiled into a single binary and run in a single process. </p>
<p>Some types of these controllers are:</p>
<ul>
<li>Node controller: Responsible for noticing and responding when nodes go down.</li>
<li>Job controller: Watches for Job objects that represent one-off tasks, then creates Pods to run those tasks to completion.</li>
<li>EndpointSlice controller: Populates EndpointSlice objects (to provide a link between Services and Pods).</li>
<li>ServiceAccount controller: Create default ServiceAccounts for new namespaces.</li>
</ul>
<h4 id="Cloud-controller-manager"><a href="#Cloud-controller-manager" class="headerlink" title="Cloud-controller-manager"></a>Cloud-controller-manager</h4><p>A Kubernetes <a href="https://kubernetes.io/docs/reference/glossary/?all=true#term-control-plane">control plane</a> component that embeds cloud-specific control logic. The cloud controller manager lets you link your cluster into your cloud provider’s API, and separates out the components that interact with that cloud platform from components that only interact with your cluster.</p>
<h3 id="Node-Components"><a href="#Node-Components" class="headerlink" title="Node Components"></a>Node Components</h3><h4 id="Kubelet"><a href="#Kubelet" class="headerlink" title="Kubelet"></a>Kubelet</h4><p>An agent that runs on each <a href="https://kubernetes.io/docs/concepts/architecture/nodes/">node</a> in the cluster. It makes sure that <a href="https://kubernetes.io/docs/concepts/containers/">containers</a> are running in a <a href="https://kubernetes.io/docs/concepts/workloads/pods/">Pod</a>.</p>
<h4 id="Kube-proxy"><a href="#Kube-proxy" class="headerlink" title="Kube-proxy"></a>Kube-proxy</h4><p>kube-proxy is a network proxy that runs on each <a href="https://kubernetes.io/docs/concepts/architecture/nodes/">node</a> in your cluster, implementing part of the Kubernetes <a href="https://kubernetes.io/docs/concepts/services-networking/service/">Service</a> concept.	</p>
<h4 id="Container-runtime"><a href="#Container-runtime" class="headerlink" title="Container-runtime"></a>Container-runtime</h4><p>The container runtime is the software that is responsible for running containers.</p>
<h3 id="Addons"><a href="#Addons" class="headerlink" title="Addons"></a>Addons</h3><p>Addons use Kubernetes resources (<a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset">DaemonSet</a>, <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment</a>, etc) to implement cluster features. Because these are providing cluster-level features, namespaced resources for addons belong within the <code>kube-system</code> namespace.</p>
<h4 id="DNS"><a href="#DNS" class="headerlink" title="DNS"></a>DNS</h4><p>While the other addons are not strictly required, all Kubernetes clusters should have <a href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/">cluster DNS</a>, as many examples rely on it.</p>
<h4 id="Web-UI-Dashboard"><a href="#Web-UI-Dashboard" class="headerlink" title="Web-UI(Dashboard)"></a>Web-UI(Dashboard)</h4><p><a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/">Dashboard</a> is a general purpose, web-based UI for Kubernetes clusters. It allows users to manage and troubleshoot applications running in the cluster, as well as the cluster itself.</p>
<h4 id="Container-Resource-Monitoring"><a href="#Container-Resource-Monitoring" class="headerlink" title="Container Resource Monitoring"></a>Container Resource Monitoring</h4><p><a href="https://kubernetes.io/docs/tasks/debug/debug-cluster/resource-usage-monitoring/">Container Resource Monitoring</a> records generic time-series metrics about containers in a central database, and provides a UI for browsing that data.</p>
<h4 id="Cluster-level-Logging"><a href="#Cluster-level-Logging" class="headerlink" title="Cluster-level Logging"></a>Cluster-level Logging</h4><p>A <a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">cluster-level logging</a> mechanism is responsible for saving container logs to a central log store with search&#x2F;browsing interface.</p>
<h4 id="Network-Plugins"><a href="#Network-Plugins" class="headerlink" title="Network Plugins"></a>Network Plugins</h4><p><a href="https://kubernetes.io/docs/concepts/extend-kubernetes/compute-storage-net/network-plugins">Network plugins</a> are software components that implement the container network interface (CNI) specification. They are responsible for allocating IP addresses to pods and enabling them to communicate with each other within the cluster.</p>
<h1 id="Elementary"><a href="#Elementary" class="headerlink" title="Elementary"></a>Elementary</h1><h2 id="0-基础"><a href="#0-基础" class="headerlink" title="0.基础"></a>0.基础</h2><p>A cluster is made by nodes(master node and worker nodes), Master is used to managed the cluster. <strong>Worker节点是虚拟机或物理计算机，充当k8s集群中的工作计算机。</strong> 每个Worker节点都有一个Kubelet，它管理该Worker节点并负责与Master节点通信。该Worker节点还应具有用于处理容器操作的工具，例如Docker。</p>
<p>A node is made by pods</p>
<p>Pod is created by deployment, you can specify how many replicas you want. You can use deployment to manage these pods replicas.</p>
<p>A pod is made by containers.</p>
<h2 id="1-部署一个应用程序"><a href="#1-部署一个应用程序" class="headerlink" title="1.部署一个应用程序"></a>1.部署一个应用程序</h2><p>首先得创建一个yaml文件，里面包含了</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">apps/v1</span>	<span class="comment">#与k8s集群版本有关，使用 kubectl api-versions 即可查看当前集群支持的版本</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Deployment</span>	<span class="comment">#该配置的类型，我们使用的是 Deployment</span></span><br><span class="line"><span class="attr">metadata:</span>	        <span class="comment">#译名为元数据，即 Deployment 的一些基本属性和信息</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">nginx-deployment</span>	<span class="comment">#Deployment 的名称</span></span><br><span class="line">  <span class="attr">labels:</span>	    <span class="comment">#标签，可以灵活定位一个或多个资源，其中key和value均可自定义，可以定义多组，目前不需要理解</span></span><br><span class="line">    <span class="attr">app:</span> <span class="string">nginx</span>	<span class="comment">#为该Deployment设置key为app，value为nginx的标签</span></span><br><span class="line"><span class="attr">spec:</span>	        <span class="comment">#这是关于该Deployment的描述，可以理解为你期待该Deployment在k8s中如何使用</span></span><br><span class="line">  <span class="attr">replicas:</span> <span class="number">1</span>	<span class="comment">#使用该Deployment创建一个应用程序实例</span></span><br><span class="line">  <span class="attr">selector:</span>	    <span class="comment">#标签选择器，与上面的标签共同作用，目前不需要理解</span></span><br><span class="line">    <span class="attr">matchLabels:</span> <span class="comment">#选择包含标签app:nginx的资源</span></span><br><span class="line">      <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">  <span class="attr">template:</span>	    <span class="comment">#这是选择或创建的Pod的模板</span></span><br><span class="line">    <span class="attr">metadata:</span>	<span class="comment">#Pod的元数据</span></span><br><span class="line">      <span class="attr">labels:</span>	<span class="comment">#Pod的标签，上面的selector即选择包含标签app:nginx的Pod</span></span><br><span class="line">        <span class="attr">app:</span> <span class="string">nginx</span></span><br><span class="line">    <span class="attr">spec:</span>	    <span class="comment">#期望Pod实现的功能（即在pod中部署）</span></span><br><span class="line">      <span class="attr">containers:</span>	<span class="comment">#生成container，与docker中的container是同一种</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">nginx</span>	<span class="comment">#container的名称</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">nginx:1.7.9</span>	<span class="comment">#使用镜像nginx:1.7.9创建container，该container默认80端口可访问</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">kubectl apply -f nginx-deployment.yaml</span><br></pre></td></tr></table></figure>

<p>这样应该就能够看见了</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看 Deployment</span></span><br><span class="line">kubectl get deployments</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看 Pod</span></span><br><span class="line">kubectl get pods</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="2-查看pods-x2F-nodes"><a href="#2-查看pods-x2F-nodes" class="headerlink" title="2.查看pods&#x2F;nodes"></a>2.查看pods&#x2F;nodes</h2><p>在部署完一个应用程序后，k8s创建了一个deployment，由它创建了一个pod来放置应用程序实例也就是container</p>
<p>在一个pod中，里面的容器containers会共享</p>
<ul>
<li>共享存储，称为卷(Volumes)，即图上紫色圆柱</li>
<li>网络，每个 Pod（容器组）在集群中有个唯一的 IP，pod（容器组）中的 container（容器）共享该IP地址</li>
<li>container（容器）的基本信息，例如容器的镜像版本，对外暴露的端口等</li>
</ul>
<p>Pod（容器组）是 k8s 集群上的最基本的单元。当我们在 k8s 上创建 Deployment 时，会在集群上创建包含容器的 Pod (而不是直接创建容器)。每个Pod都与运行它的 worker 节点（Node）绑定，并保持在那里直到终止或被删除。如果节点（Node）发生故障，则会在群集中的其他可用节点（Node）上运行相同的 Pod(从同样的镜像创建 Container，使用同样的配置，IP 地址不同，Pod 名字不同)。</p>
<p>Node </p>
<p>![截屏2023-07-15 14.42.27](..&#x2F;images&#x2F;截屏2023-07-15 14.42.27.png)</p>
<p>Pod总是在 <strong>Node</strong> 上运行。Node是 kubernetes 集群中的计算机，可以是虚拟机或物理机。每个 Node都由 master 管理。一个 Node可以有多个Pod，kubernetes master 会根据每个 Node上可用资源的情况，自动调度 Pod到最佳的 Node上。</p>
<p>每个 Kubernetes Node至少运行：</p>
<ul>
<li>Kubelet，负责 master 节点和 worker 节点之间通信的进程；管理 Pod和 Pod内运行的 Containers.</li>
<li>容器运行环境（如Docker）负责下载镜像、创建和运行容器等.</li>
</ul>
<p><strong>kubectl 还有如下四个常用命令，在我们排查问题时可以提供帮助：</strong></p>
<p><strong>kubectl get – 资源类型,</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#获取类型为Deployment的资源列表</span></span><br><span class="line">kubectl get deployments</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取类型为Pod的资源列表</span></span><br><span class="line">kubectl get pods</span><br><span class="line"></span><br><span class="line"><span class="comment">#获取类型为Node的资源列表</span></span><br><span class="line">kubectl get nodes</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>名称空间</p>
<p>在命令后增加 <code>-A</code> 或 <code>--all-namespaces</code> 可查看所有 <a href="https://kuboard.cn/learning/k8s-intermediate/obj/namespaces.html">名称空间中</a> 的对象，使用参数 <code>-n</code> 可查看指定名称空间的对象，例如</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 查看所有名称空间的 Deployment</span></span><br><span class="line">kubectl get deployments -A</span><br><span class="line">kubectl get deployments --all-namespaces</span><br><span class="line"><span class="comment"># 查看 kube-system 名称空间的 Deployment</span></span><br><span class="line">kubectl get deployments -n kube-system</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>kubectl describe</strong> - 显示有关资源的详细信息</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl describe 资源类型 资源名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看名称为nginx-XXXXXX的Pod的信息</span></span><br><span class="line">kubectl describe pod nginx-XXXXXX	</span><br><span class="line"></span><br><span class="line"><span class="comment">#查看名称为nginx的Deployment的信息</span></span><br><span class="line">kubectl describe deployment nginx	</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Kubectl logs</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl logs Pod名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#查看名称为nginx-pod-XXXXXXX的Pod内的容器打印的日志</span></span><br><span class="line"><span class="comment">#本案例中的 nginx-pod 没有输出日志，所以您看到的结果是空的</span></span><br><span class="line">kubectl logs -f nginx-pod-XXXXXXX</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>Kubectl exec</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># kubectl exec Pod名称 操作命令</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在名称为nginx-pod-xxxxxx的Pod中运行bash</span></span><br><span class="line">kubectl <span class="built_in">exec</span> -it nginx-pod-xxxxxx /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>TIP</p>
<p>Worker节点是k8s中的工作计算机，可能是VM或物理计算机，具体取决于群集。多个Pod可以在一个节点上运行。</p>
<h2 id="3-公布应用程序"><a href="#3-公布应用程序" class="headerlink" title="3.公布应用程序"></a>3.公布应用程序</h2><p>Kubernetes service</p>
<p>Pod有自己的生命周期。当worker node故障的时候，节点上运行的pod也会消失，然后deployment可以通过创建新的 Pod（容器组）来动态地将群集调整回原来的状态，以使应用程序保持运行。</p>
<p>举个例子，假设有一个图像处理后端程序，具有 3 个运行时副本。这 3 个副本是可以替换的（无状态应用），即使 Pod消失并被重新创建，或者副本数由 3 增加到 5，前端系统也无需关注后端副本的变化。由于 Kubernetes 集群中每个 Pod都有一个唯一的 IP 地址（即使是同一个 Node 上的不同 Pod），我们需要一种机制，为前端系统屏蔽后端系统的 Pod在销毁、创建过程中所带来的 IP 地址的变化。</p>
<p>kubernetes 的 service就提供这样的功能，它提供了这样的一个抽象层，它选择具备某些特征的 Pod并为它们定义一个访问方式。Service使Pod之间的相互依赖解耦（原本从一个 Pod 中访问另外一个 Pod，需要知道对方的 IP 地址）。一个 Service选定哪些<strong>Pod</strong>通常由<strong>LabelSelector</strong>来决定。</p>
<p>在创建Service的时候，通过设置配置文件中的 spec.type 字段的值，可以以不同方式向外部暴露应用程序：</p>
<ul>
<li><p><strong>ClusterIP</strong>（默认）</p>
<p>在群集中的内部IP上公布服务，这种方式的 Service（服务）只在集群内部可以访问到</p>
</li>
<li><p><strong>NodePort</strong></p>
<p>使用 NAT 在集群中每个的同一端口上公布服务。这种方式下，可以通过访问集群中任意节点+端口号的方式访问服务 <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>。此时 ClusterIP 的访问方式仍然可用。</p>
</li>
<li><p><strong>LoadBalancer</strong></p>
<p>在云环境中（需要云供应商可以支持）创建一个集群外部的负载均衡器，并为使用该负载均衡器的 IP 地址作为服务的访问地址。此时 ClusterIP 和 NodePort 的访问方式仍然可用。</p>
</li>
</ul>
<p><strong>TIPs</strong></p>
<p>Service是一个抽象层，它通过 LabelSelector 选择了一组 Pod（容器组），把这些 Pod 的指定端口公布到到集群外部，并支持负载均衡和服务发现。</p>
<ul>
<li>公布 Pod 的端口以使其可访问</li>
<li>在多个 Pod 间实现负载均衡</li>
<li>使用 Label 和 LabelSelector</li>
</ul>
<p>下图中有两个服务<strong>Service A(黄色虚线)<strong>和</strong>Service B(蓝色虚线)</strong> Service A 将请求转发到 IP 为 10.10.10.1 的Pod上， Service B 将请求转发到 IP 为 10.10.10.2、10.10.10.3、10.10.10.4 的Pod上。</p>
<p>![截屏2023-07-15 16.17.04](..&#x2F;images&#x2F;截屏2023-07-15 16.17.04.png)</p>
<p>Service 将外部请求路由到一组 Pod 中，它提供了一个抽象层，使得 Kubernetes 可以在不影响服务调用者的情况下，动态地调度pods(在容器组失效后重新创建容器组，增加或者减少同一个 Deployment 对应容器组的数量等).</p>
<p>Service使用 <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels">Labels、LabelSelector(标签和选择器) (opens new window)</a>匹配一组 Pod。Labels（标签）是附加到 Kubernetes 对象的键值对，其用途有多种：</p>
<ul>
<li>将 Kubernetes 对象（Node、Deployment、Pod、Service等）指派用于开发环境、测试环境或生产环境</li>
<li>嵌入版本标签，使用标签区别不同应用软件版本</li>
<li>使用标签对 Kubernetes 对象进行分类</li>
</ul>
<p>下图体现了 Labels（标签）和 LabelSelector（标签选择器）之间的关联关系</p>
<ul>
<li><p>Deployment B 含有 LabelSelector 为 app&#x3D;B 通过此方式声明含有 app&#x3D;B 标签的 Pod 与之关联</p>
</li>
<li><p>通过 Deployment B 创建的 Pod 包含标签为 app&#x3D;B</p>
</li>
<li><p>Service B 通过标签选择器 app&#x3D;B 选择可以路由的 Pod</p>
<p>![截屏2023-07-15 16.24.25](..&#x2F;images&#x2F;截屏2023-07-15 16.24.25.png)</p>
</li>
</ul>
<p>Labels可以在创建 Kubernetes 对象时附加上去，也可以在创建之后再附加上去。任何时候都可以修改一个 Kubernetes 对象的 Labels.</p>
<p><strong>实战:</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">metadata:	<span class="comment">#译名为元数据，即Deployment的一些基本属性和信息</span></span><br><span class="line">  name: nginx-deployment	<span class="comment">#Deployment的名称</span></span><br><span class="line">  labels:	<span class="comment">#标签，可以灵活定位一个或多个资源，其中key和value均可自定义，可以定义多组</span></span><br><span class="line">    app: nginx	<span class="comment">#为该Deployment设置key为app，value为nginx的标签</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">vim nginx-service.yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-service	<span class="comment">#Service 的名称</span></span><br><span class="line">  labels:     	<span class="comment">#Service 自己的标签</span></span><br><span class="line">    app: nginx	<span class="comment">#为该 Service 设置 key 为 app，value 为 nginx 的标签</span></span><br><span class="line">spec:	    <span class="comment">#这是关于该 Service 的定义，描述了 Service 如何选择 Pod，如何被访问</span></span><br><span class="line">  selector:	    <span class="comment">#标签选择器</span></span><br><span class="line">    app: nginx	<span class="comment">#选择包含标签 app:nginx 的 Pod</span></span><br><span class="line">  ports:</span><br><span class="line">  - name: nginx-port	<span class="comment">#端口的名字</span></span><br><span class="line">    protocol: TCP	    <span class="comment">#协议类型 TCP/UDP</span></span><br><span class="line">    port: 80	        <span class="comment">#集群内的其他容器组可通过 80 端口访问 Service</span></span><br><span class="line">    nodePort: 32600   <span class="comment">#通过任意节点的 32600 端口访问 Service</span></span><br><span class="line">    targetPort: 80	<span class="comment">#将请求转发到匹配 Pod 的 80 端口</span></span><br><span class="line">  <span class="built_in">type</span>: NodePort	<span class="comment">#Serive的类型，ClusterIP/NodePort/LoaderBalancer</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 执行命令</span></span><br><span class="line">kubectl apply -f nginx-service.yaml</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 检查执行结果</span></span><br><span class="line">kubectl get services -o wide</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可查看到名称为 nginx-service 的服务。</span></span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 访问服务</span></span><br><span class="line">curl &lt;任意节点的 IP&gt;:32600</span><br></pre></td></tr></table></figure>



<h2 id="4-Scaling"><a href="#4-Scaling" class="headerlink" title="4. Scaling"></a>4. Scaling</h2><p>Sacling应用程序</p>
<p>在之前的文章中，我们创建了一个 <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/">Deployment </a>，然后通过 <a href="https://kubernetes.io/docs/concepts/services-networking/service/">service</a>提供访问 Pod 的方式。我们发布的 Deployment 只创建了一个 Pod 来运行我们的应用程序。当流量增加时，我们需要对应用程序进行伸缩操作以满足系统性能需求。</p>
<p><strong>Scaling</strong> 的实现可以通过更改 nginx-deployment.yaml 文件中部署的 replicas（副本数）来完成</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">spec:</span><br><span class="line">  replicas: 2    <span class="comment">#使用该Deployment创建两个应用程序实例</span></span><br></pre></td></tr></table></figure>

<p>![截屏2023-07-16 00.01.42](..&#x2F;images&#x2F;截屏2023-07-16 00.01.42.png)</p>
<p>修改了 Deployment 的 replicas 为 4 后，Kubernetes 又为该 Deployment 创建了 3 新的 Pod，这 4 个 Pod 有相同的标签。因此Service A通过标签选择器与新的 Pod建立了对应关系，将访问流量通过负载均衡在 4 个 Pod 之间进行转发。</p>
<p>![截屏2023-07-16 00.02.26](..&#x2F;images&#x2F;截屏2023-07-16 00.02.26.png)</p>
<h2 id="5-Rolling-update"><a href="#5-Rolling-update" class="headerlink" title="5.Rolling update"></a>5.Rolling update</h2><p>用户期望应用程序始终可用，为此开发者&#x2F;运维者在更新应用程序时要分多次完成。在 Kubernetes 中，这是通过 Rolling Update 滚动更新完成的。<strong>Rolling Update滚动更新</strong> 通过使用新版本的 Pod 逐步替代旧版本的 Pod 来实现 Deployment 的更新，从而实现零停机。新的 Pod 将在具有可用资源的 Node（节点）上进行调度。</p>
<p>Kubernetes 更新多副本的 Deployment 的版本时，会逐步的创建新版本的 Pod，逐步的停止旧版本的 Pod，以便使应用一直处于可用状态。这个过程中，Service 能够监视 Pod 的状态，将流量始终转发到可用的 Pod 上。</p>
<h1 id="Intermediate"><a href="#Intermediate" class="headerlink" title="Intermediate"></a>Intermediate</h1><h1 id="Advanced"><a href="#Advanced" class="headerlink" title="Advanced"></a>Advanced</h1>]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title>travel</title>
    <url>/2023/05/04/travel/</url>
    <content><![CDATA[<p><strong>Glasgow</strong></p>
<p><img src="/../images/webs/UoG_bkgrnd_2021.jpg" alt="391667424236_.pic"></p>
<p><strong>Edinburgh</strong></p>
<p><img src="/../images/391667424236_.pic.jpg" alt="IMG_6792"></p>
<p><img src="/../images/IMG_6792.jpeg" alt="IMG_6792"></p>
<p><strong>Munich</strong></p>
<p><img src="/../images/webs/C4B30D74-1139-4945-B8F9-F6A74834CFCD_1_102_o.jpeg" alt="IMG_6792"></p>
<p><img src="/../images/IMG_8419.jpeg" alt="IMG_8419"></p>
<p><strong>Swiss</strong></p>
<p><img src="/../images/IMG_7862.jpeg" alt="IMG_7867"></p>
<p><img src="/../images/IMG_7867.jpeg" alt="IMG_7867"></p>
<p><strong>Paris</strong></p>
<p><img src="/../images/IMG_7410.jpeg" alt="IMG_7410"></p>
<p><img src="/../images/IMG_7577.jpeg" alt="IMG_7577"></p>
]]></content>
      <categories>
        <category>travel</category>
      </categories>
      <tags>
        <tag>travel</tag>
      </tags>
  </entry>
  <entry>
    <title>pandapower</title>
    <url>/2024/07/31/pandapower/</url>
    <content><![CDATA[<h1 id="Pandapower"><a href="#Pandapower" class="headerlink" title="Pandapower"></a>Pandapower</h1><p>For powerflow system simulation!</p>
<h2 id="Create-an-Empty-Network"><a href="#Create-an-Empty-Network" class="headerlink" title="Create an Empty Network"></a>Create an Empty Network</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pandapower.create.create_empty_network(name=<span class="string">&#x27;&#x27;</span>, f_hz=<span class="number">50.0</span>, sn_mva=<span class="number">1</span>, add_stdtypes=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>This function initializes the pandapower datastructure.</p>
<p><strong>OPTIONAL:</strong><br><strong>f_hz (float, 50. Default 50hz)</strong> - power system frequency in hertz</p>
<p><strong>name (string, None)</strong> - name for the network</p>
<p><strong>sn_mva (float, 1e3)</strong> - reference apparent power for per unit system</p>
<p>add_stdtypes (boolean, True) - Includes standard types to net</p>
<p><strong>OUTPUT:</strong><br><strong>net (attrdict)</strong> - PANDAPOWER attrdict with empty tables:</p>
<p><em><strong>EXAMPLE:</strong></em><br>net &#x3D; create_empty_network()</p>
<h2 id="Bus"><a href="#Bus" class="headerlink" title="Bus"></a>Bus</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pandapower.create_bus(net, vn_kv, name=<span class="literal">None</span>, index=<span class="literal">None</span>, geodata=<span class="literal">None</span>, <span class="built_in">type</span>=<span class="string">&#x27;b&#x27;</span>, zone=<span class="literal">None</span>, in_service=<span class="literal">True</span>, max_vm_pu=nan, min_vm_pu=nan, coords=<span class="literal">None</span>, **kwargs)</span><br></pre></td></tr></table></figure>

<p>Adds one bus in table net[“bus”].</p>
<p>Busses are the nodes of the network that all other elements connect to.</p>
<p><strong>INPUT:</strong></p>
<ul>
<li><strong>net (pandapowerNet)</strong> - The pandapower network in which the element is created</li>
<li><strong>vn_kv</strong> <strong>(float)</strong> - The grid voltage level.</li>
</ul>
<p><strong>OPTIONAL:</strong></p>
<ul>
<li><strong>name</strong> (string, default None) - the name for this bus</li>
<li><strong>index</strong> (int, default None) - Force a specified ID if it is available. If None, the index one higher than the highest already existing index is selected.</li>
<li><strong>geodata</strong> ((x,y)-tuple, default None) - coordinates used for plotting</li>
<li><strong>type</strong> (string, default “b”) - Type of the bus. “n” - node, “b” - busbar, “m” - muff</li>
<li><strong>zone</strong> (string, None) - grid region</li>
<li><strong>in_service</strong> (boolean) - True for in_service or False for out of service</li>
<li><strong>max_vm_pu</strong> (float, NAN) - Maximum bus voltage in p.u. - necessary for OPF</li>
<li><strong>min_vm_pu</strong> (float, NAN) - Minimum bus voltage in p.u. - necessary for OPF</li>
<li><strong>coords</strong> (list (len&#x3D;2) of tuples (len&#x3D;2), default None) - busbar coordinates to plot the bus with multiple points. coords is typically a list of tuples (start and endpoint of the busbar) - Example: [(x1, y1), (x2, y2)]</li>
</ul>
<p><strong>Electric Model</strong></p>
<p>Result Parameters</p>
<p><em>net.res_bus</em></p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Datatype</strong></th>
<th><strong>Explanation</strong></th>
</tr>
</thead>
<tbody><tr>
<td>vm_pu</td>
<td>float</td>
<td>voltage magnitude [p.u]</td>
</tr>
<tr>
<td>va_degree</td>
<td>float</td>
<td>voltage angle [degree]</td>
</tr>
<tr>
<td>p_mw</td>
<td>float</td>
<td>resulting active power demand [MW]</td>
</tr>
<tr>
<td>q_mvar</td>
<td>float</td>
<td>resulting reactive power demand [Mvar]</td>
</tr>
</tbody></table>
<p><em>net.res_bus_3ph</em></p>
<p>这是一个dataframe，存储了电力网络中每个三相母线的结果数据。它包含了执行潮流分析（如负载流计算）后的结果，主要用于记录和查看每个目线在网络模拟结束后的电压，相位和其他可能的电气参数。</p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Datatype</strong></th>
<th><strong>Explanation</strong></th>
</tr>
</thead>
<tbody><tr>
<td>vm_a_pu</td>
<td>float</td>
<td>voltage magnitude:Phase A [p.u]</td>
</tr>
<tr>
<td>va_a_degree</td>
<td>float</td>
<td>voltage angle:Phase A [degree]</td>
</tr>
<tr>
<td>vm_b_pu</td>
<td>float</td>
<td>voltage magnitude:Phase B [p.u]</td>
</tr>
<tr>
<td>va_b_degree</td>
<td>float</td>
<td>voltage angle:Phase B [degree]</td>
</tr>
<tr>
<td>vm_c_pu</td>
<td>float</td>
<td>voltage magnitude:Phase C [p.u]</td>
</tr>
<tr>
<td>va_c_degree</td>
<td>float</td>
<td>voltage angle:Phase C [degree]</td>
</tr>
<tr>
<td>p_a_mw</td>
<td>float</td>
<td>resulting active power demand:Phase A [MW]</td>
</tr>
<tr>
<td>q_a_mvar</td>
<td>float</td>
<td>resulting reactive power demand:Phase A [Mvar]</td>
</tr>
<tr>
<td>p_b_mw</td>
<td>float</td>
<td>resulting active power demand:Phase B [MW]</td>
</tr>
<tr>
<td>q_b_mvar</td>
<td>float</td>
<td>resulting reactive power demand:Phase B [Mvar]</td>
</tr>
<tr>
<td>p_c_mw</td>
<td>float</td>
<td>resulting active power demand:Phase C [MW]</td>
</tr>
<tr>
<td>q_c_mvar</td>
<td>float</td>
<td>resulting reactive power demand:Phase C [Mvar]</td>
</tr>
<tr>
<td>unbalance_percent</td>
<td>float</td>
<td>unbalance in percent defined as the ratio of V0 and V1 according to IEC 6</td>
</tr>
</tbody></table>
<p><em>net.res_bus_est</em></p>
<p>存储电力网络中母线的状态估计结果。状态估计是电力系统监控和运营中的一种关键技术</p>
<p>The state estimation results are put into <em>net.res_bus_est</em> with the same definition as in <em>net.res_bus</em>.</p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Datatype</strong></th>
<th><strong>Explanation</strong></th>
</tr>
</thead>
<tbody><tr>
<td>vm_pu</td>
<td>float</td>
<td>voltage magnitude [p.u]</td>
</tr>
<tr>
<td>va_degree</td>
<td>float</td>
<td>voltage angle [degree]</td>
</tr>
<tr>
<td>p_mw</td>
<td>float</td>
<td>resulting active power demand [MW]</td>
</tr>
<tr>
<td>q_mvar</td>
<td>float</td>
<td>resulting reactive power demand [Mvar]</td>
</tr>
</tbody></table>
<p><em>net.res_bus_sc</em></p>
<p>它存储了电力网络中每个母线的短路分析结果</p>
<p>The short-circuit (SC) results are put into <em>net.res_bus_sc</em> with following definitions:</p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Datatype</strong></th>
<th><strong>Explanation</strong></th>
</tr>
</thead>
<tbody><tr>
<td>ikss_ka</td>
<td>float</td>
<td>initial short-circuit current value [kA]</td>
</tr>
<tr>
<td>skss_mw</td>
<td>float</td>
<td>initial short-circuit power [MW]</td>
</tr>
<tr>
<td>ip_ka</td>
<td>float</td>
<td>peak value of the short-circuit current [kA]</td>
</tr>
<tr>
<td>ith_ka</td>
<td>float</td>
<td>equivalent thermal short-circuit current [kA]</td>
</tr>
<tr>
<td>rk_ohm</td>
<td>float</td>
<td>resistive part of equiv. (positive&#x2F;negative sequence) SC impedance [Ohm]</td>
</tr>
<tr>
<td>xk_ohm</td>
<td>float</td>
<td>reactive part of equiv. (positive&#x2F;negative sequence) SC impedance [Ohm]</td>
</tr>
<tr>
<td>rk0_ohm</td>
<td>float</td>
<td>resistive part of equiv. (zero sequence) SC impedance [Ohm]</td>
</tr>
<tr>
<td>xk0_ohm</td>
<td>float</td>
<td>reactive part of equiv. (zero sequence) SC impedance [Ohm]</td>
</tr>
</tbody></table>
<h2 id="Line-Creation"><a href="#Line-Creation" class="headerlink" title="Line Creation"></a>Line Creation</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pandapower.create_line(net, from_bus, to_bus, length_km, std_type, name=<span class="literal">None</span>, index=<span class="literal">None</span>, geodata=<span class="literal">None</span>, df=<span class="number">1.0</span>, parallel=<span class="number">1</span>, in_service=<span class="literal">True</span>, max_loading_percent=nan, alpha=nan, temperature_degree_celsius=nan, **kwargs)</span><br></pre></td></tr></table></figure>

<p>Creates a line element in net[“line”] The line parameters are defined through the standard type library.</p>
<p><strong>INPUT:</strong></p>
<ul>
<li><strong>net</strong> - The net within this line should be created</li>
<li><strong>from_bus</strong> (int) - ID of the bus on one side which the line will be connected with</li>
<li><strong>to_bus</strong> (int) - ID of the bus on the other side which the line will be connected with</li>
<li><strong>length_km</strong> (float) - The line length in km</li>
<li><strong>std_type</strong> (string) - Name of a standard linetype :Pre-defined in standard_linetypes<strong>or</strong>Customized std_type made using </li>
<li><strong>create_std_type()</strong></li>
</ul>
<p><strong>OPTIONAL:</strong></p>
<ul>
<li><strong>name</strong> (string, None) - A custom name for this line</li>
<li><strong>index</strong> (int, None) - Force a specified ID if it is available. If None, the index one higher than the highest already existing index is selected.</li>
<li><strong>geodata</strong> (Iterable[Tuple[int, int]|Tuple[float, float]], default None) - The geodata of the line. The first element should be the coordinates of from_bus and the last should be the coordinates of to_bus. The points in the middle represent the bending points of the line</li>
<li><strong>in_service</strong> (boolean, True) - True for in_service or False for out of service</li>
<li><strong>df</strong> (float, 1) - derating factor: maximal current of line in relation to nominal current of line (from 0 to 1)</li>
<li><strong>parallel</strong> (integer, 1) - number of parallel line systems</li>
<li><strong>max_loading_percent (float)</strong> - maximum current loading (only needed for OPF)</li>
<li><strong>alpha (float)</strong> - temperature coefficient of resistance: R(T) &#x3D; R(T_0) * (1 + alpha * (T - T_0)))</li>
<li><strong>temperature_degree_celsius (float)</strong> - line temperature for which line resistance is adjusted</li>
<li><strong>tdpf (bool)</strong> - whether the line is considered in the TDPF calculation</li>
<li><strong>wind_speed_m_per_s (float)</strong> - wind speed at the line in m&#x2F;s (TDPF)</li>
<li><strong>wind_angle_degree (float)</strong> - angle of attack between the wind direction and the line (TDPF)</li>
<li><strong>conductor_outer_diameter_m (float)</strong> - outer diameter of the line conductor in m (TDPF)</li>
<li><strong>air_temperature_degree_celsius (float)</strong> - ambient temperature in °C (TDPF)</li>
<li><strong>reference_temperature_degree_celsius (float)</strong> - reference temperature in °C for which r_ohm_per_km for the line is specified (TDPF)</li>
<li><strong>solar_radiation_w_per_sq_m (float)</strong> - solar radiation on horizontal plane in W&#x2F;m² (TDPF)</li>
<li><strong>solar_absorptivity (float)</strong> - Albedo factor for absorptivity of the lines (TDPF)</li>
<li><strong>emissivity (float)</strong> - Albedo factor for emissivity of the lines (TDPF)</li>
<li><strong>r_theta_kelvin_per_mw (float)</strong> - thermal resistance of the line (TDPF, only for simplified method)</li>
<li><strong>mc_joule_per_m_k (float)</strong> - specific mass of the conductor multiplied by the specific thermal capacity of the material (TDPF, only for thermal inertia consideration with tdpf_delay_s parameter)</li>
</ul>
<p><strong>OUTPUT:</strong></p>
<ul>
<li><strong>index</strong> (int) - The unique ID of the created line</li>
</ul>
<p><strong>EXAMPLE:</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">create_line(net, “line1”, from_bus = <span class="number">0</span>, to_bus = <span class="number">1</span>, length_km=<span class="number">0.1</span>, std_type=”NAYY 4x50 SE”)</span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pandapower.create_line_from_parameters(net, from_bus, to_bus, length_km, r_ohm_per_km, x_ohm_per_km, c_nf_per_km, max_i_ka, name=<span class="literal">None</span>, index=<span class="literal">None</span>, <span class="built_in">type</span>=<span class="literal">None</span>, geodata=<span class="literal">None</span>, in_service=<span class="literal">True</span>, df=<span class="number">1.0</span>, parallel=<span class="number">1</span>, g_us_per_km=<span class="number">0.0</span>, max_loading_percent=nan, alpha=nan, temperature_degree_celsius=nan, r0_ohm_per_km=nan, x0_ohm_per_km=nan, c0_nf_per_km=nan, g0_us_per_km=<span class="number">0</span>, endtemp_degree=nan, **kwargs)</span><br></pre></td></tr></table></figure>

<p>Creates a line element in net[“line”] from line parameters.</p>
<p><strong>INPUT:</strong></p>
<ul>
<li><strong>net</strong> - The net within this line should be created</li>
<li><strong>from_bus</strong> (int) - ID of the bus on one side which the line will be connected with</li>
<li><strong>to_bus</strong> (int) - ID of the bus on the other side which the line will be connected with</li>
<li><strong>length_km</strong> (float) - The line length in km</li>
<li><strong>r_ohm_per_km</strong> (float) - line resistance in ohm per km</li>
<li><strong>x_ohm_per_km</strong> (float) - line reactance in ohm per km</li>
<li><strong>c_nf_per_km</strong> (float) - line capacitance (line-to-earth) in nano Farad per km</li>
<li><strong>r0_ohm_per_km</strong> (float) - zero sequence line resistance in ohm per km</li>
<li><strong>x0_ohm_per_km</strong> (float) - zero sequence line reactance in ohm per km</li>
<li><strong>c0_nf_per_km</strong> (float) - zero sequence line capacitance in nano Farad per km</li>
<li><strong>max_i_ka</strong> (float) - maximum thermal current in kilo Ampere</li>
</ul>
<p><strong>OPTIONAL:</strong></p>
<ul>
<li><strong>name</strong> (string, None) - A custom name for this line</li>
<li><strong>index</strong> (int, None) - Force a specified ID if it is available. If None, the index one higher than the highest already existing index is selected.</li>
<li><strong>in_service</strong> (boolean, True) - True for in_service or False for out of service</li>
<li><strong>type</strong> (str, None) - type of line (“ol” for overhead line or “cs” for cable system)</li>
<li><strong>df</strong> (float, 1) - derating factor: maximal current of line in relation to nominal current of line (from 0 to 1)</li>
<li><strong>g_us_per_km</strong> (float, 0) - dielectric conductance in micro Siemens per km</li>
<li><strong>g0_us_per_km</strong> (float, 0) - zero sequence dielectric conductance in micro Siemens per km</li>
<li><strong>parallel</strong> (integer, 1) - number of parallel line systems</li>
<li><strong>geodata</strong> (array, default None, shape&#x3D; (,2)) - The geodata of the line. The first row should be the coordinates of bus a and the last should be the coordinates of bus b. The points in the middle represent the bending points of the line</li>
<li><strong>max_loading_percent (float)</strong> - maximum current loading (only needed for OPF)</li>
<li><strong>alpha (float)</strong> - temperature coefficient of resistance: R(T) &#x3D; R(T_0) * (1 + alpha * (T - T_0)))</li>
<li><strong>temperature_degree_celsius (float)</strong> - line temperature for which line resistance is adjusted</li>
<li><strong>tdpf (bool)</strong> - whether the line is considered in the TDPF calculation</li>
<li><strong>wind_speed_m_per_s (float)</strong> - wind speed at the line in m&#x2F;s (TDPF)</li>
<li><strong>wind_angle_degree (float)</strong> - angle of attack between the wind direction and the line (TDPF)</li>
<li><strong>conductor_outer_diameter_m (float)</strong> - outer diameter of the line conductor in m (TDPF)</li>
<li><strong>air_temperature_degree_celsius (float)</strong> - ambient temperature in °C (TDPF)</li>
<li><strong>reference_temperature_degree_celsius (float)</strong> - reference temperature in °C for which r_ohm_per_km for the line is specified (TDPF)</li>
<li><strong>solar_radiation_w_per_sq_m (float)</strong> - solar radiation on horizontal plane in W&#x2F;m² (TDPF)</li>
<li><strong>solar_absorptivity (float)</strong> - Albedo factor for absorptivity of the lines (TDPF)</li>
<li><strong>emissivity (float)</strong> - Albedo factor for emissivity of the lines (TDPF)</li>
<li><strong>r_theta_kelvin_per_mw (float)</strong> - thermal resistance of the line (TDPF, only for simplified method)</li>
<li><strong>mc_joule_per_m_k (float)</strong> - specific mass of the conductor multiplied by the specific thermal capacity of the material (TDPF, only for thermal inertia consideration with tdpf_delay_s parameter)</li>
</ul>
<p><strong>OUTPUT:</strong></p>
<ul>
<li><strong>index</strong> (int) - The unique ID of the created line</li>
</ul>
<p><strong>EXAMPLE:</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">create_line_from_parameters(net, “line1”, from_bus = <span class="number">0</span>, to_bus = <span class="number">1</span>, lenght_km=<span class="number">0.1</span>, r_ohm_per_km = <span class="number">.01</span>, x_ohm_per_km = <span class="number">0.05</span>, c_nf_per_km = <span class="number">10</span>, max_i_ka = <span class="number">0.4</span>)</span><br></pre></td></tr></table></figure>



<p><em>net.line</em></p>
<p>This is for defining a line with length zero leads to a division by zero in the power flow and is therefore for the same reason. </p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Datatype</strong></th>
<th><strong>Value Range</strong></th>
<th><strong>Explanation</strong></th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>string</td>
<td></td>
<td>name of the line</td>
</tr>
<tr>
<td>std_type</td>
<td>string</td>
<td></td>
<td>standard type which can be used to easily define line parameters with the pandapower standard type library</td>
</tr>
<tr>
<td>from_bus*</td>
<td>integer</td>
<td></td>
<td>Index of bus where the line starts</td>
</tr>
<tr>
<td>to_bus*</td>
<td>integer</td>
<td></td>
<td>Index of bus where the line ends</td>
</tr>
<tr>
<td>length_km*</td>
<td>float</td>
<td>&gt; 0</td>
<td>length of the line [km]</td>
</tr>
<tr>
<td>r_ohm_per_km*</td>
<td>float</td>
<td>≥ 0</td>
<td>resistance of the line [Ohm per km]</td>
</tr>
<tr>
<td>x_ohm_per_km*</td>
<td>float</td>
<td>≥ 0</td>
<td>inductance of the line [Ohm per km]</td>
</tr>
<tr>
<td>c_nf_per_km*</td>
<td>float</td>
<td>≥ 0</td>
<td>capacitance of the line (line-to-earth) [nano Farad per km]</td>
</tr>
<tr>
<td>r0_ohm_per_km****</td>
<td>float</td>
<td>≥ 0</td>
<td>zero sequence resistance of the line [Ohm per km]</td>
</tr>
<tr>
<td>x0_ohm_per_km****</td>
<td>float</td>
<td>≥ 0</td>
<td>zero sequence inductance of the line [Ohm per km]</td>
</tr>
<tr>
<td>c0_nf_per_km****</td>
<td>float</td>
<td>≥ 0</td>
<td>zero sequence capacitance of the line [nano Farad per km]</td>
</tr>
<tr>
<td>g_us_per_km*</td>
<td>float</td>
<td>≥ 0</td>
<td>dielectric conductance of the line [micro Siemens per km]</td>
</tr>
<tr>
<td>max_i_ka*</td>
<td>float</td>
<td>&gt; 0</td>
<td>maximal thermal current [kilo Ampere]</td>
</tr>
<tr>
<td>parallel*</td>
<td>integer</td>
<td>≥ 1</td>
<td>number of parallel line systems</td>
</tr>
<tr>
<td>df*</td>
<td>float</td>
<td>0…1</td>
<td>derating factor (scaling) for max_i_ka</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>Naming conventions:<em>“ol”</em> - overhead line<em>“cs”</em> - underground cable system</td>
<td>type of line</td>
</tr>
<tr>
<td>max_loading_percent**</td>
<td>float</td>
<td>&gt; 0</td>
<td>Maximum loading of the line</td>
</tr>
<tr>
<td>endtemp_degree***</td>
<td>float</td>
<td>&gt; 0</td>
<td>Short-Circuit end temperature of the line</td>
</tr>
<tr>
<td>in_service*</td>
<td>boolean</td>
<td>True &#x2F; False</td>
<td>specifies if the line is in service.</td>
</tr>
</tbody></table>
<p>*necessary for executing a balanced power flow calculation<br>** optimal power flow parameter<br>***short-circuit calculation parameter<br>**** necessary for executing a three phase power flow &#x2F; single phase short circuit .. note:</p>
<p><em>net.line_geodata</em></p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Datatype</strong></th>
<th><strong>Explanation</strong></th>
</tr>
</thead>
<tbody><tr>
<td>coords</td>
<td>list</td>
<td>List of (x,y) tuples that mark the inflexion points of the line</td>
</tr>
</tbody></table>
<h2 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pandapower.create.create_switch(net, bus, element, et, closed=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="literal">None</span>, name=<span class="literal">None</span>, index=<span class="literal">None</span>, z_ohm=<span class="number">0</span>, in_ka=nan, **kwargs)</span><br></pre></td></tr></table></figure>

<p>Adds a switch in the net[“switch”] table.</p>
<p>Switches can be either between two buses (bus-bus switch) or at the end of a line or transformer element (bus-element switch).</p>
<p>Two buses that are connected through a closed bus-bus switches are fused in the power flow if the switch is closed or separated if the switch is open.</p>
<p>An element that is connected to a bus through a bus-element switch is connected to the bus if the switch is closed or disconnected if the switch is open.</p>
<p><strong>INPUT:</strong></p>
<ul>
<li><p><strong>net</strong> (pandapowerNet) - The net within which this switch should be created</p>
</li>
<li><p><strong>bus</strong> - The bus that the switch is connected to</p>
</li>
<li><p><strong>element</strong> - index of the element: bus id if et &#x3D;&#x3D; “b”, line id if et &#x3D;&#x3D; “l”, trafo id if et &#x3D;&#x3D; “t”</p>
<ul>
<li><p><strong>et</strong> - (string) element type: “l” &#x3D; switch between bus and line, “t” &#x3D; switch between</p>
<p>bus and transformer, “t3” &#x3D; switch between bus and transformer3w, “b” &#x3D; switch between two buses</p>
</li>
</ul>
</li>
</ul>
<p><strong>OPTIONAL:</strong></p>
<ul>
<li><strong>closed</strong> (boolean, True) - switch position: False &#x3D; open, True &#x3D; closed</li>
<li><strong>type</strong> (int, None) - indicates the type of switch: “LS” &#x3D; Load Switch, “CB” &#x3D; Circuit Breaker, “LBS” &#x3D; Load Break Switch or “DS” &#x3D; Disconnecting Switch<ul>
<li><strong>z_ohm</strong> (float, 0) - indicates the resistance of the switch, which has effect only on bus-bus switches, if sets to 0, the buses will be fused like before, if larger than 0 a branch will be created for the switch which has also effects on the bus mapping</li>
</ul>
</li>
<li><strong>name</strong> (string, default None) - The name for this switch</li>
<li><strong>in_ka</strong> (float, default None) - maximum current that the switch can carry<ul>
<li>normal operating conditions without tripping</li>
</ul>
</li>
</ul>
<p><strong>OUTPUT:</strong></p>
<p>sid - The unique switch_id of the created switch</p>
<p><strong>EXAMPLE:</strong></p>
<p>create_switch(net, bus &#x3D; 0. element &#x3D; 1, et &#x3D; ‘b’, type &#x3D; ‘LS’, z_ohm &#x3D; 0.1)</p>
<p>create_switch(net, bus &#x3D; 0. element &#x3D; 1, et &#x3D; ‘I’)</p>
<p><strong>Input Parameters</strong> of <em><strong>net.switch</strong></em></p>
<table>
<thead>
<tr>
<th><strong>Parameter</strong></th>
<th><strong>Datatype</strong></th>
<th><strong>Value Range</strong></th>
<th><strong>Explanation</strong></th>
</tr>
</thead>
<tbody><tr>
<td>bus*</td>
<td>integer</td>
<td></td>
<td>index of connected bus</td>
</tr>
<tr>
<td>name</td>
<td>string</td>
<td></td>
<td>name of the switch</td>
</tr>
<tr>
<td>element*</td>
<td>integer</td>
<td></td>
<td>index of the element the switch is connected to:- bus index if et &#x3D; <em>“b”</em>- line index if et &#x3D; <em>“l”</em>- trafo index if et &#x3D; <em>“t”</em></td>
</tr>
<tr>
<td>et*</td>
<td>string</td>
<td><em>“b”</em> - bus-bus switch<em>“l”</em> - bus-line switch<em>“t”</em> - bus-trafo<em>“t3”</em> - bus-trafo3w switch</td>
<td>element type the switch connects to</td>
</tr>
<tr>
<td>type</td>
<td>string</td>
<td>naming conventions:<em>“CB”</em> - circuit breaker<em>“LS”</em> - load switch<em>“LBS”</em> - load break switch<em>“DS”</em> - disconnecting switch</td>
<td>type of switch</td>
</tr>
<tr>
<td>closed*</td>
<td>boolean</td>
<td>True &#x2F; False</td>
<td>signals the switching state of the switch</td>
</tr>
<tr>
<td>in_ka*</td>
<td>float</td>
<td>&gt;0</td>
<td>maximum current that the switch can carry under normal operating conditions without tripping</td>
</tr>
</tbody></table>
<h2 id="Load"><a href="#Load" class="headerlink" title="Load"></a>Load</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pandapower.create_load(net, bus, p_mw, q_mvar=<span class="number">0</span>, const_z_percent=<span class="number">0</span>, const_i_percent=<span class="number">0</span>, sn_mva=nan, name=<span class="literal">None</span>, scaling=<span class="number">1.0</span>, index=<span class="literal">None</span>, in_service=<span class="literal">True</span>, <span class="built_in">type</span>=<span class="string">&#x27;wye&#x27;</span>, max_p_mw=nan, min_p_mw=nan, max_q_mvar=nan, min_q_mvar=nan, controllable=nan, **kwargs)</span><br></pre></td></tr></table></figure>

<p>Adds one load in table net[“load”].</p>
<p>All loads are modelled in the consumer system, meaning load is positive and generation is negative active power. Please pay attention to the correct signing of the reactive power as well.</p>
<p><strong>INPUT:</strong></p>
<ul>
<li><strong>net</strong> - The net within this load should be created</li>
<li><strong>bus</strong> (int) - The bus id to which the load is connected</li>
</ul>
<p><strong>OPTIONAL:</strong></p>
<ul>
<li><strong>p_mw</strong> (float, default 0) - The active power of the load<ul>
<li>positive value -&gt; load</li>
<li>negative value -&gt; generation</li>
</ul>
</li>
<li><strong>q_mvar</strong> (float, default 0) - The reactive power of the load</li>
<li><strong>const_z_percent</strong> (float, default 0) - percentage of p_mw and q_mvar that will be associated to constant impedance load at rated voltage</li>
<li><strong>const_i_percent</strong> (float, default 0) - percentage of p_mw and q_mvar that will be associated to constant current load at rated voltage</li>
<li><strong>sn_mva</strong> (float, default None) - Nominal power of the load</li>
<li><strong>name</strong> (string, default None) - The name for this load</li>
<li><strong>scaling</strong> (float, default 1.) - An OPTIONAL scaling factor. Multiplies with p_mw and q_mvar.</li>
<li><strong>type</strong> (string, ‘wye’) - type variable to classify the load: wye&#x2F;delta</li>
<li><strong>index</strong> (int, None) - Force a specified ID if it is available. If None, the index one higher than the highest already existing index is selected.</li>
<li><strong>in_service</strong> (boolean) - True for in_service or False for out of service</li>
<li><strong>max_p_mw</strong> (float, default NaN) - Maximum active power load - necessary for controllable loads in for OPF</li>
<li><strong>min_p_mw</strong> (float, default NaN) - Minimum active power load - necessary for controllable loads in for OPF</li>
<li><strong>max_q_mvar</strong> (float, default NaN) - Maximum reactive power load - necessary for controllable loads in for OPF</li>
<li><strong>min_q_mvar</strong> (float, default NaN) - Minimum reactive power load - necessary for controllable loads in OPF</li>
<li><strong>controllable</strong> (boolean, default NaN) - States, whether a load is controllable or not. Only respected for OPF; defaults to False if “controllable” column exists in DataFrame</li>
</ul>
<p><strong>OUTPUT:</strong></p>
<ul>
<li><strong>index</strong> (int) - The unique ID of the created element</li>
</ul>
<p><strong>EXAMPLE:</strong></p>
<ul>
<li>create_load(net, bus&#x3D;0, p_mw&#x3D;10., q_mvar&#x3D;2.)</li>
</ul>
<p>state:</p>
<p>Action:</p>
]]></content>
      <categories>
        <category>Tech</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title>java studying</title>
    <url>/2023/04/01/java/</url>
    <content><![CDATA[<h1 id="Java"><a href="#Java" class="headerlink" title="Java"></a>Java</h1><h2 id="Comparable-vs-comparator"><a href="#Comparable-vs-comparator" class="headerlink" title="Comparable vs comparator"></a>Comparable vs comparator</h2><ul>
<li><strong>第一，字面含义不同</strong></li>
</ul>
<p>我们先从二者的字面含义来理解它，Comparable翻译为中文是“比较”的意思，而Comparator是“比较器”的意思。Comparable是以-able结尾的，表示它自身具备着某种能力，而Comparator是以-or结尾，表示自身是比较的参与者，这是从字面含义先来理解二者的不同。</p>
<ul>
<li><strong>第二，用法不同</strong></li>
</ul>
<p>二者都是顶级的接口，但拥有的方法和用法是不同的，下面我们分别来看。</p>
<h3 id="Comparable用法"><a href="#Comparable用法" class="headerlink" title="Comparable用法"></a><strong>Comparable用法</strong></h3><p>Comparable接口只有一个方法compareTo，实现Comparable接口并重写compareTo方法就可以实现某个类的排序了，它支持Collections.sort和Arrays.sort的排序。 </p>
<p>在我们没有使用Comparable时，程序的执行是这样的</p>
<p><img src="/../images/v2-227ef5bbf20b532f1bb342573b7ebef5_1440w.png" alt="v2-227ef5bbf20b532f1bb342573b7ebef5_1440w"></p>
<p><img src="/../images/v2-6c8292dea0e393ceffffabc72cdae6e3_1440w.png" alt="v2-6c8292dea0e393ceffffabc72cdae6e3_1440w"></p>
<p>从上图可以看出，当自定义类Person没有实现Comparable时，List集合是没有排序的，只能以元素的插入顺序作为输出的顺序。 </p>
<p>然而这个时候，老板有一个需求：需要根据Person对象的年龄age属性进行倒序，也就是根据age属性从大到小进行排序，这个时候就可以请出，我们本文的主角：Comparable出场了。 </p>
<p>Comparable的使用是在自定义对象的类中实现Comparable接口，并重写compareTo方法来实现自定义排序规则的，具体实现代码如下：</p>
<p><img src="/../images/v2-1cbf6d14a01aa2489f5a8a5a3e80b4d2_1440w.png" alt="v2-1cbf6d14a01aa2489f5a8a5a3e80b4d2_1440w"></p>
<p>程序的执行结果如下图所示：</p>
<p><img src="/../images/v2-724747d21c4f51c7b37ab98df34f5db7_1440w.png" alt="v2-724747d21c4f51c7b37ab98df34f5db7_1440w"></p>
<h4 id="compareTo排序方法说明"><a href="#compareTo排序方法说明" class="headerlink" title="compareTo排序方法说明"></a>compareTo排序方法说明</h4><p>compareTo方法接收的参数p是要对比的对象，排序规则是用当前对象和要对比的对象进行比较，然后返回一个int类型的值。正序从小到大的排序规则是：使用当前的对象值减去要对比对象的值；而倒序从大到小的排序规则刚好相反：是用对比对象的值减去当前对象的值。 </p>
<p>注意事项：如果自定义对象没有实现Comparable接口，那么它是不能使用Collections.sort方法进行排序的</p>
<h3 id="Comparator用法"><a href="#Comparator用法" class="headerlink" title="Comparator用法"></a>Comparator用法</h3><p>Comparator和Comparable的排序方法是不同的，Comparable排序的方法是compareTo，而Comparator排序的方法是compare，具体实现代码如下：</p>
<p><img src="/../images/v2-f742089317861a254770a57c2a41f0ee_1440w.png" alt="v2-f742089317861a254770a57c2a41f0ee_1440w"></p>
<p>程序的执行结果如下图所示：</p>
<p><img src="/../images/v2-dd7e3161f5eb2d2055f73a9796cf81ff_1440w.png" alt="v2-dd7e3161f5eb2d2055f73a9796cf81ff_1440w"></p>
<p>匿名类:</p>
<p><img src="/../images/v2-53099add8da4513a445681f7f835d05a_1440w.png" alt="v2-53099add8da4513a445681f7f835d05a_1440w"></p>
<h3 id="第三，使用场景不同"><a href="#第三，使用场景不同" class="headerlink" title="第三，使用场景不同"></a>第三，使用场景不同</h3><p>通过上面示例的实现代码我们可以看出，使用Comparable必须要修改原有的类，也就是你要排序那个类，就要在那个中实现Comparable接口并重写compareTo方法，所以Comparable更像是“对内”进行排序的接口。 </p>
<p>而Comparator的使用则不相同，Comparator无需修改原有类。也就是在最极端情况下，即使Person类是第三方提供的，我们依然可以通过创建新的自定义比较器Comparator，来实现对第三方类Person的排序功能。也就是说通过Comparator接口可以实现和原有类的解耦，在不修改原有类的情况下实现排序功能，所以Comparator可以看作是“对外”提供排序的接口。</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>Comparable和Comparator都是用来实现元素排序的，它们二者的区别如下：</p>
<ul>
<li>Comparable是“比较”的意思，而Comparator是“比较器”的意思；</li>
<li>Comparable是通过重写compareTo方法实现排序的，而Comparator是通过重写compare方法实现排序的；</li>
<li>Comparable必须由自定义类内部实现排序方法，而Comparator是外部定义并实现排序的。</li>
</ul>
<p>所以用一句话总结二者的区别：Comparable可以看作是“对内”进行排序接口，而Comparator是“对外”进行排序的接口。</p>
<h3 id="List"><a href="#List" class="headerlink" title="List"></a>List</h3><p>在Java中，List是一种接口类型，它定义了一组用于操作列表（List）数据结构的方法。ArrayList是List接口的一个实现类，它使用数组来实现List接口中定义的方法。在这里，使用List<Integer> list &#x3D; new ArrayList&lt;&gt;();这样的语法是因为：</Integer></p>
<ol>
<li>泛型：List<Integer>中的Integer表示这个List只能存储Integer类型的元素。这是Java泛型的一种应用，它可以在编译时检查类型错误，避免在运行时出现类型不匹配的错误。</Integer></li>
<li>多态性：使用List接口作为类型声明，而不是具体的ArrayList类，可以让代码更具有可扩展性。这样，如果需要更改实现方式，只需要更改赋值右侧的实现类，而不需要更改其余代码。</li>
<li>简洁性：使用diamond运算符（&lt;&gt;）可以让代码更简洁。在Java 7之前，需要写成List<Integer> list &#x3D; new ArrayList<Integer>();这样的形式。</Integer></Integer></li>
</ol>
<h3 id="Collection-sort"><a href="#Collection-sort" class="headerlink" title="Collection.sort()"></a>Collection.sort()</h3><p>如果要给自定义泛型的集合排序，需要确保该泛型类实现了 <code>Comparable</code> 接口，并重写 <code>compareTo</code> 方法。 <code>compareTo</code> 方法用于比较两个对象的大小关系，以便于排序。<strong>或者</strong>通过实现<code>Comparator</code>接口来给自定义范型的集合排序。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Comparable</span>&lt;Person&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// constructor, getter and setter methods</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compareTo</span><span class="params">(Person other)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.compare(<span class="built_in">this</span>.age, other.age);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//2</span></span><br><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name, <span class="type">int</span> age)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.age = age;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getAge</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> age;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AgeComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&lt;Person&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Person p1, Person p2)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> Integer.compare(p1.getAge(), p2.getAge());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Person&gt; persons = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        persons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;John&quot;</span>, <span class="number">25</span>));</span><br><span class="line">        persons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">30</span>));</span><br><span class="line">        persons.add(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">20</span>));</span><br><span class="line"></span><br><span class="line">        Collections.sort(persons, <span class="keyword">new</span> <span class="title class_">AgeComparator</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (Person p : persons) &#123;</span><br><span class="line">            System.out.println(p.getName() + <span class="string">&quot; &quot;</span> + p.getAge());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Object-Orientated"><a href="#Object-Orientated" class="headerlink" title="Object-Orientated"></a>Object-Orientated</h2><p><img src="/../images/java/Page1.jpg" alt="Page1"></p>
<p><img src="/../images/java/Page2.jpg" alt="Page2"></p>
<p><img src="/../images/java/Page3.jpg" alt="Page3"></p>
<p><img src="/../images/java/Page4.jpg" alt="Page4"></p>
<p><img src="/../images/java/Page5.jpg" alt="Page5"></p>
<p><img src="/../images/java/Page6.jpg" alt="Page6"></p>
<p><img src="/../images/java/Page7.jpg" alt="Page7"></p>
<p><img src="/../images/java/Page8.jpg" alt="Page8"></p>
<p><img src="/../images/java/Page9.jpg" alt="Page9"></p>
<h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><p>在Java中，如果一个Java对象可以在内部持有若干其他Java对象，并对外提供访问接口，我们把这种Java对象称为集合</p>
<p>Java的数组可以看作是一种集合</p>
<ul>
<li>数组初始化后大小不可变；</li>
<li>数组只能按索引顺序存取。</li>
</ul>
<p>Java标准库自带的<code>java.util</code>包提供了集合类：<code>Collection</code>. 它是除<code>Map</code>外所有其他集合类的根接口。Java的<code>java.util</code>包主要提供了以下三种类型的集合：</p>
<ul>
<li><code>List</code>：一种有序列表的集合，例如，按索引排列的<code>Student</code>的<code>List</code>；</li>
<li><code>Set</code>：一种保证没有重复元素的集合，例如，所有无重复名称的<code>Student</code>的<code>Set</code>；</li>
<li><code>Map</code>：一种通过键值（key-value）查找的映射表集合，例如，根据<code>Student</code>的<code>name</code>查找对应<code>Student</code>的<code>Map</code>。</li>
</ul>
<h3 id="List-1"><a href="#List-1" class="headerlink" title="List"></a>List</h3><p><code>ArrayList</code>在内部使用了数组来存储所有元素。例如，一个<code>ArrayList</code>拥有5个元素，实际数组大小为<code>6</code>(即有一个空位)</p>
<p><code>ArrayList</code>把添加和删除的操作封装起来，让我们操作<code>List</code>类似于操作数组，却不用关心内部元素如何移动。</p>
<p>我们考察<code>List&lt;E&gt;</code>接口，可以看到几个主要的接口方法：</p>
<ul>
<li>在末尾添加一个元素：<code>boolean add(E e)</code></li>
<li>在指定索引添加一个元素：<code>boolean add(int index, E e)</code></li>
<li>删除指定索引的元素：<code>E remove(int index)</code></li>
<li>删除某个元素：<code>boolean remove(Object e)</code></li>
<li>获取指定索引的元素：<code>E get(int index)</code></li>
<li>获取链表大小（包含元素的个数）：<code>int size()</code></li>
</ul>
<p><code>LinkedList</code>通过“链表”也实现了List接口。在<code>LinkedList</code>中，它的内部每个元素都指向下一个元素。</p>
<p>【遍历集合list】</p>
<p>我们要始终坚持使用迭代器<code>Iterator</code>来访问<code>List</code>。<code>Iterator</code>本身也是一个对象，但它是由<code>List</code>的实例调用<code>iterator()</code>方法的时候创建的。<code>Iterator</code>对象知道如何遍历一个<code>List</code>，并且不同的<code>List</code>类型，返回的<code>Iterator</code>对象实现也是不同的，但总是具有最高的访问效率。</p>
<p><code>Iterator</code>对象有两个方法：<code>boolean hasNext()</code>判断是否有下一个元素，<code>E next()</code>返回下一个元素。因此，使用<code>Iterator</code>遍历<code>List</code>代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = List.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (Iterator&lt;String&gt; it = list.iterator(); it.hasNext(); ) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> it.next();</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>Java的<code>for each</code>循环本身就可以帮我们使用<code>Iterator</code>遍历。上面的代码再改写如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = List.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">   <span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">       System.out.println(s);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>【list转化为array】</p>
<p>把<code>List</code>变为<code>Array</code>有三种方法，第一种是调用<code>toArray()</code>方法直接返回一个<code>Object[]</code>数组</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = List.of(<span class="string">&quot;apple&quot;</span>, <span class="string">&quot;pear&quot;</span>, <span class="string">&quot;banana&quot;</span>);</span><br><span class="line">Object[] array = list.toArray();</span><br><span class="line"><span class="keyword">for</span> (Object s : array) &#123;</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>第二种方式是给<code>toArray(T[])</code>传入一个类型相同的<code>Array</code>，<code>List</code>内部自动把元素复制到传入的<code>Array</code>中：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = List.of(<span class="number">12</span>, <span class="number">34</span>, <span class="number">56</span>);</span><br><span class="line">       Integer[] array = list.toArray(<span class="keyword">new</span> <span class="title class_">Integer</span>[<span class="number">3</span>]);</span><br><span class="line">       <span class="keyword">for</span> (Integer n : array) &#123;</span><br><span class="line">           System.out.println(n);</span><br><span class="line">       &#125;</span><br></pre></td></tr></table></figure>

<p>最后一种更简洁的写法是通过<code>List</code>接口定义的<code>T[] toArray(IntFunction&lt;T[]&gt; generator)</code>方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Integer[] array = list.toArray(Integer[]::<span class="keyword">new</span>);</span><br></pre></td></tr></table></figure>



<h3 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h3><p><code>Map</code>也是一个接口，最常用的实现类是<code>HashMap</code>。</p>
<p><strong>始终牢记：Map中不存在重复的key，因为放入相同的key，只会把原有的key-value对应的value给替换掉。</strong></p>
<p><strong>此外，在一个<code>Map</code>中，虽然<code>key</code>不能重复，但<code>value</code>是可以重复的</strong></p>
<ul>
<li><code>put(K key, V value)</code>: 将指定的键值对存储到HashMap中。</li>
<li><code>get(Object key)</code>: 返回与指定键关联的值，如果键不存在，则返回null。</li>
<li><code>containsKey(Object key)</code>: 检查HashMap中是否包含指定的键。</li>
<li><code>containsValue(Object value)</code>: 检查HashMap中是否包含指定的值。</li>
<li><code>remove(Object key)</code>: 从HashMap中删除指定键对应的键值对。</li>
<li><code>size()</code>: 返回HashMap中键值对的数量。</li>
<li><code>isEmpty()</code>: 检查HashMap是否为空。</li>
<li><code>clear()</code>: 清空HashMap，删除所有的键值对。</li>
<li><code>keySet()</code>: 返回HashMap中所有键构成的Set集合。</li>
<li><code>values()</code>: 返回HashMap中所有值构成的Collection集合。</li>
<li><code>entrySet()</code>: 返回HashMap中所有键值对构成的Set集合。</li>
<li><code>putAll(Map&lt;? extends K, ? extends V&gt; m)</code>: 将另一个Map中的所有键值对添加到HashMap中。</li>
<li><code>replaceAll(BiFunction&lt;? super K, ? super V, ? extends V&gt; function)</code>: 使用指定的函数对HashMap中的每个键值对进行替换操作。</li>
<li><code>computeIfAbsent(K key, Function&lt;? super K, ? extends V&gt; mappingFunction)</code>: 如果指定的键尚未与值关联，则使用给定函数计算一个值，并将其存储到HashMap中。</li>
<li><code>computeIfPresent(K key, BiFunction&lt;? super K, ? super V, ? extends V&gt; remappingFunction)</code>: 如果指定的键存在且与非空值关联，则使用给定函数重新计算该值，</li>
</ul>
<p><strong>在map中使用的作为key的对象也需要自己重新正确的编写equals()方法</strong></p>
<p>通过<code>key</code>计算索引的方式就是调用<code>key</code>对象的<code>hashCode()</code>方法，它返回一个<code>int</code>整数。<code>HashMap</code>正是通过这个方法直接定位<code>key</code>对应的<code>value</code>的索引，继而直接返回<code>value</code>。</p>
<p>因此，正确使用<code>Map</code>必须保证：</p>
<ol>
<li>作为<code>key</code>的对象必须正确覆写<code>equals()</code>方法，相等的两个<code>key</code>实例调用<code>equals()</code>必须返回<code>true</code>；</li>
<li>作为<code>key</code>的对象还必须正确覆写<code>hashCode()</code>方法，且<code>hashCode()</code>方法要严格遵循以下规范：</li>
</ol>
<ul>
<li>如果两个对象相等，则两个对象的<code>hashCode()</code>必须相等；</li>
<li>如果两个对象不相等，则两个对象的<code>hashCode()</code>尽量不要相等。</li>
</ul>
<p><strong>如何编写正确的equals()？</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String firstName;</span><br><span class="line">    String lastName;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把需要比较的字段找出来：</p>
<ul>
<li>firstName</li>
<li>lastName</li>
<li>age</li>
</ul>
<p>然后，引用类型使用<code>Objects.equals()</code>比较，基本类型使用<code>==</code>比较。</p>
<p>在正确实现<code>equals()</code>的基础上，我们还需要正确实现<code>hashCode()</code>，即上述3个字段分别相同的实例，<code>hashCode()</code>返回的<code>int</code>必须相同：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    String firstName;</span><br><span class="line">    String lastName;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">h</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        h = <span class="number">31</span> * h + firstName.hashCode();</span><br><span class="line">        h = <span class="number">31</span> * h + lastName.hashCode();</span><br><span class="line">        h = <span class="number">31</span> * h + age;</span><br><span class="line">        <span class="keyword">return</span> h;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意到<code>String</code>类已经正确实现了<code>hashCode()</code>方法，我们在计算<code>Person</code>的<code>hashCode()</code>时，反复使用<code>31*h</code>，这样做的目的是为了尽量把不同的<code>Person</code>实例的<code>hashCode()</code>均匀分布到整个<code>int</code>范围。</p>
<p>和实现<code>equals()</code>方法遇到的问题类似，如果<code>firstName</code>或<code>lastName</code>为<code>null</code>，上述代码工作起来就会抛<code>NullPointerException</code>。为了解决这个问题，我们在计算<code>hashCode()</code>的时候，经常借助<code>Objects.hash()</code>来计算：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="title function_">hashCode</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> Objects.hash(firstName, lastName, age);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以，编写<code>equals()</code>和<code>hashCode()</code>遵循的原则是：</p>
<p><strong><code>equals()</code>用到的用于比较的每一个字段，都必须在<code>hashCode()</code>中用于计算；<code>equals()</code>中没有使用到的字段，绝不可放在<code>hashCode()</code>中计算。</strong></p>
<p><strong>Extension</strong></p>
<ol>
<li>hashCode()返回的<code>int</code>范围高达±21亿，先不考虑负数，<code>HashMap</code>内部使用的数组得有多大？</li>
</ol>
<p>既然<code>HashMap</code>内部使用了数组，通过计算<code>key</code>的<code>hashCode()</code>直接定位<code>value</code>所在的索引，那么第一个问题来了：hashCode()返回的<code>int</code>范围高达±21亿，先不考虑负数，<code>HashMap</code>内部使用的数组得有多大？</p>
<p>实际上<code>HashMap</code>初始化时默认的数组大小只有16，任何<code>key</code>，无论它的<code>hashCode()</code>有多大，都可以简单地通过</p>
<p>把索引确定在0～15，即永远不会超出数组范围，上述算法只是一种最简单的实现。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> key.hashCode() &amp; <span class="number">0xf</span>; <span class="comment">// 0xf = 15</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>如果添加超过16个<code>key-value</code>到<code>HashMap</code>，数组不够用了怎么办？</li>
</ol>
<p>添加超过一定数量的<code>key-value</code>时，<code>HashMap</code>会在内部自动扩容，每次扩容一倍，即长度为16的数组扩展为长度32，相应地，需要重新确定<code>hashCode()</code>计算的索引位置。例如，对长度为32的数组计算<code>hashCode()</code>对应的索引，计算方式要改为：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> key.hashCode() &amp; <span class="number">0x1f</span>; <span class="comment">// 0x1f = 31</span></span><br></pre></td></tr></table></figure>

<p>由于扩容会导致重新分布已有的<code>key-value</code>，所以，频繁扩容对<code>HashMap</code>的性能影响很大。如果我们确定要使用一个容量为<code>10000</code>个<code>key-value</code>的<code>HashMap</code>，更好的方式是创建<code>HashMap</code>时就指定容量：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;(<span class="number">10000</span>);</span><br></pre></td></tr></table></figure>

<p>虽然指定容量是<code>10000</code>，但<code>HashMap</code>内部的数组长度总是2n，因此，实际数组长度被初始化为比<code>10000</code>大的<code>16384</code> which is 2^14.</p>
<ol start="3">
<li>如果不同的两个<code>key</code>，例如<code>&quot;a&quot;</code>和<code>&quot;b&quot;</code>，它们的<code>hashCode()</code>恰好是相同的（这种情况是完全可能的，因为不相等的两个实例，只要求<code>hashCode()</code>尽量不相等），那么，当我们放入：</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">map.put(<span class="string">&quot;a&quot;</span>, <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Xiao Ming&quot;</span>));</span><br><span class="line">map.put(<span class="string">&quot;b&quot;</span>, <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Xiao Hong&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>时，由于计算出的数组索引相同，后面放入的<code>&quot;Xiao Hong&quot;</code>会不会把<code>&quot;Xiao Ming&quot;</code>覆盖了？</p>
<p>当然不会！使用<code>Map</code>的时候，只要<code>key</code>不相同，它们映射的<code>value</code>就互不干扰。但是，在<code>HashMap</code>内部，确实可能存在不同的<code>key</code>，映射到相同的<code>hashCode()</code>，即相同的数组索引上，肿么办？</p>
<p>我们就假设<code>&quot;a&quot;</code>和<code>&quot;b&quot;</code>这两个<code>key</code>最终计算出的索引都是5，那么，在<code>HashMap</code>的数组中，实际存储的不是一个<code>Person</code>实例，而是一个<code>List</code>，它包含两个<code>Entry</code>，一个是<code>&quot;a&quot;</code>的映射，一个是<code>&quot;b&quot;</code>的映射：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">  ┌───┐</span><br><span class="line">0 │   │</span><br><span class="line">  ├───┤</span><br><span class="line">1 │   │</span><br><span class="line">  ├───┤</span><br><span class="line">2 │   │</span><br><span class="line">  ├───┤</span><br><span class="line">3 │   │</span><br><span class="line">  ├───┤</span><br><span class="line">4 │   │</span><br><span class="line">  ├───┤</span><br><span class="line">5 │ ●─┼───&gt; List&lt;Entry&lt;String, Person&gt;&gt;</span><br><span class="line">  ├───┤</span><br><span class="line">6 │   │</span><br><span class="line">  ├───┤</span><br><span class="line">7 │   │</span><br><span class="line">  └───┘</span><br></pre></td></tr></table></figure>

<p>在查找的时候，例如：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Person p = map.get(&quot;a&quot;);</span><br></pre></td></tr></table></figure>

<p>HashMap内部通过<code>&quot;a&quot;</code>找到的实际上是<code>List&lt;Entry&lt;String, Person&gt;&gt;</code>，它还需要遍历这个<code>List</code>，并找到一个<code>Entry</code>，它的<code>key</code>字段是<code>&quot;a&quot;</code>，才能返回对应的<code>Person</code>实例。</p>
<p>我们把不同的<code>key</code>具有相同的<code>hashCode()</code>的情况称之为哈希冲突。在冲突的时候，一种最简单的解决办法是用<code>List</code>存储<code>hashCode()</code>相同的<code>key-value</code>。显然，如果冲突的概率越大，这个<code>List</code>就越长，<code>Map</code>的<code>get()</code>方法效率就越低，这就是为什么要尽量满足条件二：</p>
<p> 如果两个对象不相等，则两个对象的hashCode()尽量不要相等。</p>
<h3 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h3><p>要正确使用<code>HashMap</code>，作为<code>key</code>的类必须正确覆写<code>equals()</code>和<code>hashCode()</code>方法；</p>
<p>一个类如果覆写了<code>equals()</code>，就必须覆写<code>hashCode()</code>，并且覆写规则是：</p>
<ul>
<li>如果<code>equals()</code>返回<code>true</code>，则<code>hashCode()</code>返回值必须相等；</li>
<li>如果<code>equals()</code>返回<code>false</code>，则<code>hashCode()</code>返回值尽量不要相等。</li>
</ul>
<p>实现<code>hashCode()</code>方法可以通过<code>Objects.hashCode()</code>辅助方法实现。</p>
<h3 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h3><p>还有一种<code>Map</code>，它在内部会对Key进行排序，这种<code>Map</code>就是<code>SortedMap</code>。注意到<code>SortedMap</code>是接口，它的实现类是<code>TreeMap</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">       ┌───┐</span><br><span class="line">       │Map│</span><br><span class="line">       └───┘</span><br><span class="line">         ▲</span><br><span class="line">    ┌────┴─────┐</span><br><span class="line">    │          │</span><br><span class="line">┌───────┐ ┌─────────┐</span><br><span class="line">│HashMap│ │SortedMap│</span><br><span class="line">└───────┘ └─────────┘</span><br><span class="line">               ▲</span><br><span class="line">               │</span><br><span class="line">          ┌─────────┐</span><br><span class="line">          │ TreeMap │</span><br><span class="line">          └─────────┘</span><br></pre></td></tr></table></figure>

<p><code>SortedMap</code>保证遍历时以Key的顺序来进行排序。例如，放入的Key是<code>&quot;apple&quot;</code>、<code>&quot;pear&quot;</code>、<code>&quot;orange&quot;</code>，遍历的顺序一定是<code>&quot;apple&quot;</code>、<code>&quot;orange&quot;</code>、<code>&quot;pear&quot;</code>，因为<code>String</code>默认按字母排序：</p>
<p>使用<code>TreeMap</code>时，放入的Key必须实现<code>Comparable</code>接口。<code>String</code>、<code>Integer</code>这些类已经实现了<code>Comparable</code>接口，因此可以直接作为Key使用。作为Value的对象则没有任何要求。</p>
<p>如果作为Key的class没有实现<code>Comparable</code>接口，那么，必须在创建<code>TreeMap</code>时同时指定一个自定义排序算法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;Person, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Person&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Person p1, Person p2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p1.name.compareTo(p2.name);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        map.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Tom&quot;</span>), <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bob&quot;</span>), <span class="number">2</span>);</span><br><span class="line">        map.put(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Lily&quot;</span>), <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span> (Person key : map.keySet()) &#123;</span><br><span class="line">            System.out.println(key);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// &#123;Person: Bob&#125;, &#123;Person: Lily&#125;, &#123;Person: Tom&#125;</span></span><br><span class="line">        System.out.println(map.get(<span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bob&quot;</span>))); <span class="comment">// 2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    Person(String name) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;&#123;Person: &quot;</span> + name + <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意到<code>Comparator</code>接口要求实现一个比较方法，它负责比较传入的两个元素<code>a</code>和<code>b</code>，如果<code>a&lt;b</code>，则返回负数，通常是<code>-1</code>，如果<code>a==b</code>，则返回<code>0</code>，如果<code>a&gt;b</code>，则返回正数，通常是<code>1</code>。<code>TreeMap</code>内部根据比较结果对Key进行排序。</p>
<p>从上述代码执行结果可知，打印的Key确实是按照<code>Comparator</code>定义的顺序排序的。如果要根据Key查找Value，我们可以传入一个<code>new Person(&quot;Bob&quot;)</code>作为Key，它会返回对应的<code>Integer</code>值<code>2</code>。</p>
<p>另外，注意到<code>Person</code>类并未覆写<code>equals()</code>和<code>hashCode()</code>，因为<code>TreeMap</code>不使用<code>equals()</code>和<code>hashCode()</code>。</p>
<p>我们来看一个稍微复杂的例子：这次我们定义了<code>Student</code>类，并用分数<code>score</code>进行排序，高分在前：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;Student, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">TreeMap</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">Comparator</span>&lt;Student&gt;() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(Student p1, Student p2)</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> p1.score &gt; p2.score ? -<span class="number">1</span> : <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        map.put(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Tom&quot;</span>, <span class="number">77</span>), <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">66</span>), <span class="number">2</span>);</span><br><span class="line">        map.put(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Lily&quot;</span>, <span class="number">99</span>), <span class="number">3</span>);</span><br><span class="line">        <span class="keyword">for</span> (Student key : map.keySet()) &#123;</span><br><span class="line">            System.out.println(key);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(map.get(<span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">66</span>))); <span class="comment">// null?</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> score;</span><br><span class="line">    Student(String name, <span class="type">int</span> score) &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.score = score;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">&quot;&#123;%s: score=%d&#125;&quot;</span>, name, score);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Properties"><a href="#Properties" class="headerlink" title="Properties"></a>Properties</h3><p>因为配置文件非常常用，所以Java集合库提供了一个<code>Properties</code>来表示一组“配置”。由于历史遗留原因。</p>
<p><code>Properties</code>内部本质上是一个<code>Hashtable</code>，但我们只需要用到<code>Properties</code>自身关于读写配置的接口。</p>
<p>可以从文件系统读取这个<code>.properties</code>文件：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">f</span> <span class="operator">=</span> <span class="string">&quot;setting.properties&quot;</span>;</span><br><span class="line"><span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">props.load(<span class="keyword">new</span> <span class="title class_">java</span>.io.FileInputStream(f));</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">filepath</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;last_open_file&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">interval</span> <span class="operator">=</span> props.getProperty(<span class="string">&quot;auto_save_interval&quot;</span>, <span class="string">&quot;120&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>可见，用<code>Properties</code>读取配置文件，一共有三步：</p>
<ol>
<li>创建<code>Properties</code>实例；</li>
<li>调用<code>load()</code>读取文件；</li>
<li>调用<code>getProperty()</code>获取配置。</li>
</ol>
<p>调用<code>getProperty()</code>获取配置时，如果key不存在，将返回<code>null</code>。我们还可以提供一个默认值，这样，当key不存在的时候，就返回默认值。</p>
<p>也可以从classpath读取<code>.properties</code>文件，因为<code>load(InputStream)</code>方法接收一个<code>InputStream</code>实例，表示一个字节流，它不一定是文件流，也可以是从jar包中读取的资源流：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">props.load(getClass().getResourceAsStream(<span class="string">&quot;/common/setting.properties&quot;</span>));</span><br></pre></td></tr></table></figure>



<p>试试从内存读取一个字节流：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">settings</span> <span class="operator">=</span> <span class="string">&quot;# test&quot;</span> + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;course=Java&quot;</span> + <span class="string">&quot;\n&quot;</span> + <span class="string">&quot;last_open_date=2019-08-07T12:35:01&quot;</span>;</span><br><span class="line">        <span class="type">ByteArrayInputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(settings.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">        props.load(input);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;course: &quot;</span> + props.getProperty(<span class="string">&quot;course&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;last_open_date: &quot;</span> + props.getProperty(<span class="string">&quot;last_open_date&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;last_open_file: &quot;</span> + props.getProperty(<span class="string">&quot;last_open_file&quot;</span>));</span><br><span class="line">        System.out.println(<span class="string">&quot;auto_save: &quot;</span> + props.getProperty(<span class="string">&quot;auto_save&quot;</span>, <span class="string">&quot;60&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p>如果我们只需要存储不重复的key，并不需要存储映射的value，那么就可以使用<code>Set</code>。</p>
<p><code>Set</code>用于存储不重复的元素集合，它主要提供以下几个方法：</p>
<ul>
<li>将元素添加进<code>Set&lt;E&gt;</code>：<code>boolean add(E e)</code></li>
<li>将元素从<code>Set&lt;E&gt;</code>删除：<code>boolean remove(Object e)</code></li>
<li>判断是否包含元素：<code>boolean contains(Object e)</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        System.out.println(set.add(<span class="string">&quot;abc&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(set.add(<span class="string">&quot;xyz&quot;</span>)); <span class="comment">// true</span></span><br><span class="line">        System.out.println(set.add(<span class="string">&quot;xyz&quot;</span>)); <span class="comment">// false，添加失败，因为元素已存在</span></span><br><span class="line">        System.out.println(set.contains(<span class="string">&quot;xyz&quot;</span>)); <span class="comment">// true，元素存在</span></span><br><span class="line">        System.out.println(set.contains(<span class="string">&quot;XYZ&quot;</span>)); <span class="comment">// false，元素不存在</span></span><br><span class="line">        System.out.println(set.remove(<span class="string">&quot;hello&quot;</span>)); <span class="comment">// false，删除失败，因为元素不存在</span></span><br><span class="line">        System.out.println(set.size()); <span class="comment">// 2，一共两个元素</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>放入<code>Set</code>的元素和<code>Map</code>的key类似，都要正确实现<code>equals()</code>和<code>hashCode()</code>方法，否则该元素无法正确地放入<code>Set</code>。</strong></p>
<p><strong>最常用的<code>Set</code>实现类是<code>HashSet</code>，实际上，<code>HashSet</code>仅仅是对<code>HashMap</code>的一个简单封装，它的核心代码如下：</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HashSet</span>&lt;E&gt; <span class="keyword">implements</span> <span class="title class_">Set</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="comment">// 持有一个HashMap:</span></span><br><span class="line">    <span class="keyword">private</span> HashMap&lt;E, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 放入HashMap的value:</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">PRESENT</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> map.put(e, PRESENT) == <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">contains</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> map.containsKey(o);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">remove</span><span class="params">(Object o)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> map.remove(o) == PRESENT;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><code>Set</code>接口并不保证有序，而<code>SortedSet</code>接口则保证元素是有序的：</p>
<ul>
<li><code>HashSet</code>是无序的，因为它实现了<code>Set</code>接口，并没有实现<code>SortedSet</code>接口；</li>
<li><code>TreeSet</code>是有序的，因为它实现了<code>SortedSet</code>接口。</li>
</ul>
<p>用一张图表示：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">       ┌───┐</span><br><span class="line">       │Set│</span><br><span class="line">       └───┘</span><br><span class="line">         ▲</span><br><span class="line">    ┌────┴─────┐</span><br><span class="line">    │          │</span><br><span class="line">┌───────┐ ┌─────────┐</span><br><span class="line">│HashSet│ │SortedSet│</span><br><span class="line">└───────┘ └─────────┘</span><br><span class="line">               ▲</span><br><span class="line">               │</span><br><span class="line">          ┌─────────┐</span><br><span class="line">          │ TreeSet │</span><br><span class="line">          └─────────┘</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;&gt;();</span><br><span class="line">        set.add(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        set.add(<span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        set.add(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        set.add(<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : set) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在这里打印出来的并不是按照既不是添加的顺序，也不是<code>String</code>排序的顺序，在不同版本的JDK中，这个顺序也可能是不同的。</p>
<p>但是如果用treeset的话，输出出来的就会是有序的了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Set&lt;String&gt; set = <span class="keyword">new</span> <span class="title class_">TreeSet</span>&lt;&gt;();</span><br><span class="line">        set.add(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        set.add(<span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        set.add(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        set.add(<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : set) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用<code>TreeSet</code>和使用<code>TreeMap</code>的要求一样，添加的元素必须正确实现<code>Comparable</code>接口，如果没有实现<code>Comparable</code>接口，那么创建<code>TreeSet</code>时必须传入一个<code>Comparator</code>对象。</p>
<h3 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h3><p>在Java的标准库中，队列接口<code>Queue</code>定义了以下几个方法：</p>
<ul>
<li><code>int size()</code>：获取队列长度；</li>
<li><code>boolean add(E)</code>&#x2F;<code>boolean offer(E)</code>：添加元素到队尾；</li>
<li><code>E remove()</code>&#x2F;<code>E poll()</code>：获取队首元素并从队列中删除；</li>
<li><code>E element()</code>&#x2F;<code>E peek()</code>：获取队首元素但并不从队列中删除。</li>
</ul>
<p>对于具体的实现类，有的Queue有最大队列长度限制，有的Queue没有。注意到添加、删除和获取队列元素总是有两个方法，这是因为在添加或获取元素失败时，这两个方法的行为是不同的。如下表所示（举个例子，add方法有可能会抛出一场而offer方法并不会）</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">throw Exception</th>
<th>返回false或null</th>
</tr>
</thead>
<tbody><tr>
<td align="left">添加元素到队尾</td>
<td align="left">add(E e)</td>
<td>boolean offer(E e)</td>
</tr>
<tr>
<td align="left">取队首元素并删除</td>
<td align="left">E remove()</td>
<td>E poll()</td>
</tr>
<tr>
<td align="left">取队首元素但不删除</td>
<td align="left">E element()</td>
<td>E peek()</td>
</tr>
</tbody></table>
<p>注意：不要把<code>null</code>添加到队列中，否则<code>poll()</code>方法返回<code>null</code>时，很难确定是取到了<code>null</code>元素还是队列为空。</p>
<h3 id="PriorityQueue"><a href="#PriorityQueue" class="headerlink" title="PriorityQueue."></a>PriorityQueue.</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Queue&lt;String&gt; q = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;();</span><br><span class="line">        <span class="comment">// 添加3个元素到队列:</span></span><br><span class="line">        q.offer(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        q.offer(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        q.offer(<span class="string">&quot;banana&quot;</span>);</span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// apple</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// banana</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// pear</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// null,因为队列为空</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>放入的顺序是apple、pear、banana但是出来的顺序是apple、banana、pear。这就是因为我们使用了 PriorityQueue&lt;&gt;，优先队列能够将队列中的元素按照顺序取出。所以，存入优先队列里面的元素也必须需要实现Comparable接口。如果没有实现Comparable接口的话，我们需要提供一个Comparator对象来判断两个元素的顺序。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Comparator;</span><br><span class="line"><span class="keyword">import</span> java.util.PriorityQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.Queue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Queue&lt;User&gt; q = <span class="keyword">new</span> <span class="title class_">PriorityQueue</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">UserComparator</span>());</span><br><span class="line">        <span class="comment">// 添加3个元素到队列:</span></span><br><span class="line">        q.offer(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Bob&quot;</span>, <span class="string">&quot;A1&quot;</span>));</span><br><span class="line">        q.offer(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Alice&quot;</span>, <span class="string">&quot;A2&quot;</span>));</span><br><span class="line">        q.offer(<span class="keyword">new</span> <span class="title class_">User</span>(<span class="string">&quot;Boss&quot;</span>, <span class="string">&quot;V1&quot;</span>));</span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// Boss/V1</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// Bob/A1</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// Alice/A2</span></span><br><span class="line">        System.out.println(q.poll()); <span class="comment">// null,因为队列为空</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">UserComparator</span> <span class="keyword">implements</span> <span class="title class_">Comparator</span>&lt;User&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">compare</span><span class="params">(User u1, User u2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (u1.number.charAt(<span class="number">0</span>) == u2.number.charAt(<span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="comment">// 如果两人的号都是A开头或者都是V开头,比较号的大小:</span></span><br><span class="line">            <span class="keyword">return</span> u1.number.compareTo(u2.number);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (u1.number.charAt(<span class="number">0</span>) == <span class="string">&#x27;V&#x27;</span>) &#123;</span><br><span class="line">            <span class="comment">// u1的号码是V开头,优先级高:</span></span><br><span class="line">            <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> String number;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(String name, String number)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.number = number;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> name + <span class="string">&quot;/&quot;</span> + number;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的<code>UserComparator</code>的比较逻辑其实还是有问题的，它会把<code>A10</code>排在<code>A2</code>的前面</p>
<h3 id="Deque-Double-Ended-Queue"><a href="#Deque-Double-Ended-Queue" class="headerlink" title="Deque (Double Ended Queue)"></a>Deque (Double Ended Queue)</h3><p>Java集合提供了接口<code>Deque</code>来实现一个双端队列，它的功能是：</p>
<ul>
<li>既可以添加到队尾，也可以添加到队首；</li>
<li>既可以从队首获取，又可以从队尾获取。</li>
</ul>
<p>我们来比较一下<code>Queue</code>和<code>Deque</code>出队和入队的方法：</p>
<table>
<thead>
<tr>
<th align="left"></th>
<th align="left">Queue</th>
<th align="left">Deque</th>
</tr>
</thead>
<tbody><tr>
<td align="left">添加元素到队尾</td>
<td align="left">add(E e) &#x2F; offer(E e)</td>
<td align="left">addLast(E e) &#x2F; offerLast(E e)</td>
</tr>
<tr>
<td align="left">取队首元素并删除</td>
<td align="left">E remove() &#x2F; E poll()</td>
<td align="left">E removeFirst() &#x2F; E pollFirst()</td>
</tr>
<tr>
<td align="left">取队首元素但不删除</td>
<td align="left">E element() &#x2F; E peek()</td>
<td align="left">E getFirst() &#x2F; E peekFirst()</td>
</tr>
<tr>
<td align="left">添加元素到队首</td>
<td align="left">无</td>
<td align="left">addFirst(E e) &#x2F; offerFirst(E e)</td>
</tr>
<tr>
<td align="left">取队尾元素并删除</td>
<td align="left">无</td>
<td align="left">E removeLast() &#x2F; E pollLast()</td>
</tr>
<tr>
<td align="left">取队尾元素但不删除</td>
<td align="left">无</td>
<td align="left">E getLast() &#x2F; E peekLast()</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 不推荐的写法:</span></span><br><span class="line">LinkedList&lt;String&gt; d1 = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">d1.offerLast(<span class="string">&quot;z&quot;</span>);</span><br><span class="line"><span class="comment">// 推荐的写法：</span></span><br><span class="line">Deque&lt;String&gt; d2 = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">d2.offerLast(<span class="string">&quot;z&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>可见面向抽象编程的一个原则就是：尽量持有接口，而不是具体的实现类。</p>
<h3 id="小结-1"><a href="#小结-1" class="headerlink" title="小结"></a>小结</h3><p><code>Deque</code>实现了一个双端队列（Double Ended Queue），它可以：</p>
<ul>
<li>将元素添加到队尾或队首：<code>addLast()</code>&#x2F;<code>offerLast()</code>&#x2F;<code>addFirst()</code>&#x2F;<code>offerFirst()</code>；</li>
<li>从队首／队尾获取元素并删除：<code>removeFirst()</code>&#x2F;<code>pollFirst()</code>&#x2F;<code>removeLast()</code>&#x2F;<code>pollLast()</code>；</li>
<li>从队首／队尾获取元素但不删除：<code>getFirst()</code>&#x2F;<code>peekFirst()</code>&#x2F;<code>getLast()</code>&#x2F;<code>peekLast()</code>；</li>
<li>总是调用<code>xxxFirst()</code>&#x2F;<code>xxxLast()</code>以便与<code>Queue</code>的方法区分开；</li>
<li>避免把<code>null</code>添加到队列。</li>
</ul>
<h3 id="Stack"><a href="#Stack" class="headerlink" title="Stack"></a>Stack</h3><p>在Java中，我们用<code>Deque</code>可以实现<code>Stack</code>的功能：</p>
<ul>
<li>把元素压栈：<code>push(E)</code>&#x2F;<code>addFirst(E)</code>；</li>
<li>把栈顶的元素“弹出”：<code>pop()</code>&#x2F;<code>removeFirst()</code>；</li>
<li>取栈顶元素但不弹出：<code>peek()</code>&#x2F;<code>peekFirst()</code></li>
</ul>
<p>为什么Java的集合类没有单独的<code>Stack</code>接口呢？因为有个遗留类名字就叫<code>Stack</code>，出于兼容性考虑，所以没办法创建<code>Stack</code>接口，只能用<code>Deque</code>接口来“模拟”一个<code>Stack</code>了。</p>
<p>当我们把<code>Deque</code>作为<code>Stack</code>使用时，注意只调用<code>push()</code>&#x2F;<code>pop()</code>&#x2F;<code>peek()</code>方法，不要调用<code>addFirst()</code>&#x2F;<code>removeFirst()</code>&#x2F;<code>peekFirst()</code>方法，这样代码更加清晰。</p>
<h3 id="Stack的作用"><a href="#Stack的作用" class="headerlink" title="Stack的作用"></a>Stack的作用</h3><p>Stack在计算机中使用非常广泛，JVM在处理Java方法调用的时候就会通过栈这种数据结构维护方法调用的层次，例如</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    foo(<span class="number">123</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> String <span class="title function_">foo</span><span class="params">(x)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;F-&quot;</span> + bar(x + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="type">int</span> <span class="title function_">bar</span><span class="params">(<span class="type">int</span> x)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> x &lt;&lt; <span class="number">2</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>JVM会创建方法调用栈，每调用一个方法时，先将参数压栈，然后执行对应的方法；当方法返回时，返回值压栈，调用方法通过出栈操作获得方法返回值。</p>
<p>因为方法调用栈有容量限制，嵌套调用过多会造成栈溢出，即引发<code>StackOverflowError</code>：</p>
<p>使用栈的思想来实现将10进制转化为16进制的功能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Stack;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DecimalToHexadecimal</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decimalToHex</span><span class="params">(<span class="type">int</span> decimal)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (decimal == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;0&quot;</span>; <span class="comment">// 十进制数为0时，直接返回&quot;0&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Stack&lt;Character&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (decimal &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">remainder</span> <span class="operator">=</span> decimal % <span class="number">16</span>;</span><br><span class="line">            <span class="type">char</span> <span class="variable">hexDigit</span> <span class="operator">=</span> getHexDigit(remainder);</span><br><span class="line">            stack.push(hexDigit);</span><br><span class="line">            decimal /= <span class="number">16</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">hexBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">while</span> (!stack.isEmpty()) &#123;</span><br><span class="line">            hexBuilder.append(stack.pop());</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> hexBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">char</span> <span class="title function_">getHexDigit</span><span class="params">(<span class="type">int</span> digit)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (digit &gt;= <span class="number">0</span> &amp;&amp; digit &lt;= <span class="number">9</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">char</span>) (digit + <span class="string">&#x27;0&#x27;</span>); <span class="comment">// 将数字转换为字符</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (<span class="type">char</span>) (digit - <span class="number">10</span> + <span class="string">&#x27;A&#x27;</span>); <span class="comment">// 将数字转换为A~F之间的字符</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">decimalNumber</span> <span class="operator">=</span> <span class="number">255</span>;</span><br><span class="line">        <span class="type">String</span> <span class="variable">hexadecimalNumber</span> <span class="operator">=</span> decimalToHex(decimalNumber);</span><br><span class="line">        System.out.println(<span class="string">&quot;十进制数 &quot;</span> + decimalNumber + <span class="string">&quot; 转换为十六进制数为 &quot;</span> + hexadecimalNumber);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="Iterator"><a href="#Iterator" class="headerlink" title="Iterator"></a>Iterator</h3><p>java的集合类都可以使用for each循环，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list = List.of(<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Orange&quot;</span>, <span class="string">&quot;Pear&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (String s : list) &#123;</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际上，Java编译器并不知道如何遍历<code>List</code>。上述代码能够编译通过，只是因为编译器把<code>for each</code>循环通过<code>Iterator</code>改写为了普通的<code>for</code>循环：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (Iterator&lt;String&gt; it = list.iterator(); it.hasNext(); ) &#123;</span><br><span class="line">     <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> it.next();</span><br><span class="line">     System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用迭代器的好处在于，调用方总是以统一的方式遍历各种集合类型，而不必关心它们内部的存储结构。</p>
<p>例如，我们虽然知道<code>ArrayList</code>在内部是以数组形式存储元素，并且，它还提供了<code>get(int)</code>方法。虽然我们可以用<code>for</code>循环遍历：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">for (int i=0; i&lt;list.size(); i++) &#123;</span><br><span class="line">    Object value = list.get(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是这样一来，调用方就必须知道集合的内部存储结构。并且，如果把<code>ArrayList</code>换成<code>LinkedList</code>，<code>get(int)</code>方法耗时会随着index的增加而增加。如果把<code>ArrayList</code>换成<code>Set</code>，上述代码就无法编译，因为<code>Set</code>内部没有索引。</p>
<p>用<code>Iterator</code>遍历就没有上述问题，因为<code>Iterator</code>对象是集合对象自己在内部创建的，它自己知道如何高效遍历内部的数据集合，调用方则获得了统一的代码，编译器才能把标准的<code>for each</code>循环自动转换为<code>Iterator</code>遍历。</p>
<p>如果我们自己编写了一个集合类，想要使用<code>for each</code>循环，只需满足以下条件：</p>
<ul>
<li><strong>集合类实现<code>Iterable</code>接</strong>口，该接口要求返回一个<code>Iterator</code>对象；</li>
<li><strong>用<code>Iterator</code>对象迭代集合内部数据</strong>。</li>
</ul>
<p>这里的关键在于，集合类通过调用<code>iterator()</code>方法，返回一个<code>Iterator</code>对象，这个对象必须自己知道如何遍历该集合。</p>
<p>一个简单的<code>Iterator</code>示例如下，它总是以倒序遍历集合：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ReverseList&lt;String&gt; rlist = <span class="keyword">new</span> <span class="title class_">ReverseList</span>&lt;&gt;();</span><br><span class="line">        rlist.add(<span class="string">&quot;Apple&quot;</span>);</span><br><span class="line">        rlist.add(<span class="string">&quot;Orange&quot;</span>);</span><br><span class="line">        rlist.add(<span class="string">&quot;Pear&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (String s : rlist) &#123;</span><br><span class="line">            System.out.println(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ReverseList</span>&lt;T&gt; <span class="keyword">implements</span> <span class="title class_">Iterable</span>&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;T&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(T t)</span> &#123;</span><br><span class="line">        list.add(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator&lt;T&gt; <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ReverseIterator</span>(list.size());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">class</span> <span class="title class_">ReverseIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span>&lt;T&gt; &#123;</span><br><span class="line">        <span class="type">int</span> index;</span><br><span class="line"></span><br><span class="line">        ReverseIterator(<span class="type">int</span> index) &#123;</span><br><span class="line">            <span class="built_in">this</span>.index = index;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> index &gt; <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> T <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">            index--;</span><br><span class="line">            <span class="keyword">return</span> ReverseList.<span class="built_in">this</span>.list.get(index);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<h3 id="Collections类"><a href="#Collections类" class="headerlink" title="Collections类"></a>Collections类</h3><p>位于java.util包中</p>
<p>它为集合类提供了很多静态的方法，方便我们操作各种集合</p>
<p><strong>1.创建空集合:</strong></p>
<ul>
<li>创建空List：<code>List&lt;T&gt; emptyList()</code></li>
<li>创建空Map：<code>Map&lt;K, V&gt; emptyMap()</code></li>
<li>创建空Set：<code>Set&lt;T&gt; emptySet()</code></li>
</ul>
<p><strong>要注意到返回的空集合是不可变集合，无法向其中添加或删除元素。</strong></p>
<p>此外，也可以用各个集合接口提供的<code>of(T...)</code>方法创建空集合。例如，以下创建空<code>List</code>的两个方法是等价的：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list1 = List.of();</span><br><span class="line">List&lt;String&gt; list2 = Collections.emptyList();</span><br></pre></td></tr></table></figure>



<p><strong>2.创建单元素集合:</strong></p>
<p><code>Collections</code>提供了一系列方法来创建一个单元素集合：</p>
<ul>
<li>创建一个元素的List：<code>List&lt;T&gt; singletonList(T o)</code></li>
<li>创建一个元素的Map：<code>Map&lt;K, V&gt; singletonMap(K key, V value)</code></li>
<li>创建一个元素的Set：<code>Set&lt;T&gt; singleton(T o)</code></li>
</ul>
<p>要注意到返回的单元素集合也是不可变集合，无法向其中添加或删除元素。</p>
<p>此外，也可以用各个集合接口提供的<code>of(T...)</code>方法创建单元素集合。例如，以下创建单元素<code>List</code>的两个方法是等价的：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list1 = List.of(&quot;apple&quot;);</span><br><span class="line">List&lt;String&gt; list2 = Collections.singletonList(&quot;apple&quot;);</span><br></pre></td></tr></table></figure>

<p>实际上，使用<code>List.of(T...)</code>更方便，因为它既可以创建空集合，也可以创建单元素集合，还可以创建任意个元素的集合：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">List&lt;String&gt; list1 = List.of(); // empty list</span><br><span class="line">List&lt;String&gt; list2 = List.of(&quot;apple&quot;); // 1 element</span><br><span class="line">List&lt;String&gt; list3 = List.of(&quot;apple&quot;, &quot;pear&quot;); // 2 elements</span><br><span class="line">List&lt;String&gt; list4 = List.of(&quot;apple&quot;, &quot;pear&quot;, &quot;orange&quot;); // 3 elements</span><br></pre></td></tr></table></figure>



<p><strong>3.排序:</strong></p>
<p><code>Collections</code>可以对<code>List</code>进行排序。因为排序会直接修改<code>List</code>元素的位置，因此必须传入可变<code>List</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="string">&quot;apple&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;pear&quot;</span>);</span><br><span class="line">        list.add(<span class="string">&quot;orange&quot;</span>);</span><br><span class="line">        <span class="comment">// 排序前:</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">        Collections.sort(list);</span><br><span class="line">        <span class="comment">// 排序后:</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>4.shuffle:</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++) &#123;</span><br><span class="line">            list.add(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 洗牌前:</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">        Collections.shuffle(list);</span><br><span class="line">        <span class="comment">// 洗牌后:</span></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p><strong>5.不可变集合</strong></p>
<p><code>Collections</code>还提供了一组方法把可变集合封装成不可变集合：</p>
<ul>
<li>封装成不可变List：<code>List&lt;T&gt; unmodifiableList(List&lt;? extends T&gt; list)</code></li>
<li>封装成不可变Set：<code>Set&lt;T&gt; unmodifiableSet(Set&lt;? extends T&gt; set)</code></li>
<li>封装成不可变Map：<code>Map&lt;K, V&gt; unmodifiableMap(Map&lt;? extends K, ? extends V&gt; m)</code></li>
</ul>
<p>这种封装实际上是通过创建一个代理对象，拦截掉所有修改方法实现的。我们来看看效果：</p>
<p><strong>6.线程安全集合</strong></p>
<p><code>Collections</code>还提供了一组方法，可以把线程不安全的集合变为线程安全的集合：</p>
<ul>
<li>变为线程安全的List：<code>List&lt;T&gt; synchronizedList(List&lt;T&gt; list)</code></li>
<li>变为线程安全的Set：<code>Set&lt;T&gt; synchronizedSet(Set&lt;T&gt; s)</code></li>
<li>变为线程安全的Map：<code>Map&lt;K,V&gt; synchronizedMap(Map&lt;K,V&gt; m)</code></li>
</ul>
<p>多线程的概念我们会在后面讲。因为从Java 5开始，引入了更高效的并发集合类，所以上述这几个同步方法已经没有什么用了。</p>
<h2 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h2><h3 id="File-object"><a href="#File-object" class="headerlink" title="File object"></a>File object</h3><p>import <strong>Java.io.</strong>*;</p>
<p>File f &#x3D; new File(Absolute path&#x2F;Relative Path);</p>
<p>注意Windows平台使用<code>\</code>作为路径分隔符，在Java字符串中需要用<code>\\</code>表示一个<code>\</code>。Linux平台使用<code>/</code>作为路径分隔符：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;/usr/bin/javac&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>传入相对路径时，相对路径前面加上当前目录就是绝对路径：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">// 假设当前目录是C:\Docs</span><br><span class="line">File f1 = new File(&quot;sub\\javac&quot;); // 绝对路径是C:\Docs\sub\javac</span><br><span class="line">File f3 = new File(&quot;.\\sub\\javac&quot;); // 绝对路径是C:\Docs\sub\javac</span><br><span class="line">File f3 = new File(&quot;..\\sub\\javac&quot;); // 绝对路径是C:\sub\javac</span><br></pre></td></tr></table></figure>

<p>This is can help to find the separator of the currect system.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File.separator</span><br></pre></td></tr></table></figure>



<h3 id="InputStream"><a href="#InputStream" class="headerlink" title="InputStream"></a>InputStream</h3><p><code>InputStream</code>就是Java标准库提供的最基本的输入流。它位于<code>java.io</code>这个包里。<code>java.io</code>包提供了所有同步IO的功能。</p>
<p>要特别注意的一点是，<code>InputStream</code>并不是一个接口，而是一个抽象类，它是所有输入流的超类。这个抽象类定义的一个最重要的方法就是<code>int read()</code>，签名如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public abstract int read() throws IOException;</span><br></pre></td></tr></table></figure>

<p>这个方法会读取输入流的下一个字节，并返回字节表示的<code>int</code>值（0~255）。如果已读到末尾，返回<code>-1</code>表示不能继续读取了</p>
<p><code>FileInputStream</code>是<code>InputStream</code>的一个子类。顾名思义，<code>FileInputStream</code>就是从文件流中读取数据。下面的代码演示了如何完整地读取一个<code>FileInputStream</code>的所有字节：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 创建一个FileInputStream对象:</span></span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/readme.txt&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> input.read(); <span class="comment">// 反复调用read()方法，直到返回-1</span></span><br><span class="line">        <span class="keyword">if</span> (n == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(n); <span class="comment">// 打印byte的值</span></span><br><span class="line">    &#125;</span><br><span class="line">    input.close(); <span class="comment">// 关闭流</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>InputStream</code>和<code>OutputStream</code>都是通过<code>close()</code>方法来关闭流。关闭流就会释放对应的底层资源。</p>
<p>我们还要注意到在读取或写入IO流的过程中，可能会发生错误，例如，文件不存在导致无法读取，没有写权限导致写入失败，等等，这些底层错误由Java虚拟机自动封装成<code>IOException</code>异常并抛出。因此，所有与IO操作相关的代码都必须正确处理<code>IOException</code>。</p>
<p>仔细观察上面的代码，会发现一个潜在的问题：如果读取过程中发生了IO错误，<code>InputStream</code>就没法正确地关闭，资源也就没法及时释放。</p>
<p>因此，我们需要用<code>try ... finally</code>来保证<code>InputStream</code>在无论是否发生IO错误的时候都能够正确地关闭：</p>
<p>只需要编写<code>try</code>语句，让编译器自动为我们关闭资源，Java7引入的新特性。推荐的写法如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/readme.txt&quot;</span>)) &#123;</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        <span class="keyword">while</span> ((n = input.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">            System.out.println(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="comment">// 编译器在此自动为我们写入finally并调用close()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>实际上，编译器并不会特别地为<code>InputStream</code>加上自动关闭。编译器只看<code>try(resource = ...)</code>中的对象是否实现了<code>java.lang.AutoCloseable</code>接口，如果实现了，就自动加上<code>finally</code>语句并调用<code>close()</code>方法。<code>InputStream</code>和<code>OutputStream</code>都实现了这个接口，因此，都可以用在<code>try(resource)</code>中。</p>
<p>上段代码与以下代码等价:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        input = <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/readme.txt&quot;</span>);</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        <span class="keyword">while</span> ((n = input.read()) != -<span class="number">1</span>) &#123; <span class="comment">// 利用while同时读取并判断</span></span><br><span class="line">            System.out.println(n);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input != <span class="literal">null</span>) &#123; input.close(); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="缓冲"><a href="#缓冲" class="headerlink" title="缓冲"></a>缓冲</h4><p>在InputStream中提供了两个重载的方法来支持读取多个字节。</p>
<ul>
<li><code>int read(byte[] b)</code>：读取若干字节并填充到<code>byte[]</code>数组，返回读取的字节数</li>
<li><code>int read(byte[] b, int off, int len)</code>：指定<code>byte[]</code>数组的偏移量和最大填充数</li>
</ul>
<p>利用上述方法一次读取多个字节时，需要先定义一个<code>byte[]</code>数组作为缓冲区，<code>read()</code>方法会尽可能多地读取字节到缓冲区， 但不会超过缓冲区的大小。<code>read()</code>方法的返回值不再是字节的<code>int</code>值，而是返回实际读取了多少个字节。如果返回<code>-1</code>，表示没有更多的数据了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/readme.txt&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// 定义1000个字节大小的缓冲区:</span></span><br><span class="line">        <span class="type">byte</span>[] buffer = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1000</span>];</span><br><span class="line">        <span class="type">int</span> n;</span><br><span class="line">        <span class="keyword">while</span> ((n = input.read(buffer)) != -<span class="number">1</span>) &#123; <span class="comment">// 读取到缓冲区</span></span><br><span class="line">            System.out.println(<span class="string">&quot;read &quot;</span> + n + <span class="string">&quot; bytes.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a>阻塞</h4><p>在调用<code>InputStream</code>的<code>read()</code>方法读取数据时，我们说<code>read()</code>方法是阻塞（Blocking）的。它的意思是，对于下面的代码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">int n;</span><br><span class="line">n = input.read(); // 必须等待read()方法返回才能执行下一行代码</span><br><span class="line">int m = n;</span><br></pre></td></tr></table></figure>

<p>执行到第二行代码时，必须等<code>read()</code>方法返回后才能继续。因为读取IO流相比执行普通代码，速度会慢很多，因此，无法确定<code>read()</code>方法调用到底要花费多长时间。</p>
<h4 id="InputStream实现类"><a href="#InputStream实现类" class="headerlink" title="InputStream实现类"></a>InputStream实现类</h4><p>用<code>FileInputStream</code>可以从文件获取输入流，这是<code>InputStream</code>常用的一个实现类。此外，<code>ByteArrayInputStream</code>可以在内存中模拟一个<code>InputStream</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] data = &#123; <span class="number">72</span>, <span class="number">101</span>, <span class="number">108</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">33</span> &#125;;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(data)) &#123;</span><br><span class="line">            <span class="type">int</span> n;</span><br><span class="line">            <span class="keyword">while</span> ((n = input.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                System.out.println((<span class="type">char</span>)n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>ByteArrayInputStream</code>实际上是把一个<code>byte[]</code>数组在内存中变成一个<code>InputStream</code>，虽然实际应用不多，但测试的时候，可以用它来构造一个<code>InputStream</code>。</p>
<p>举个栗子：我们想从文件中读取所有字节，并转换成<code>char</code>然后拼成一个字符串，可以这么写：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        String s;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;C:\\test\\README.txt&quot;</span>)) &#123;</span><br><span class="line">            <span class="type">int</span> n;</span><br><span class="line">            <span class="type">StringBuilder</span> <span class="variable">sb</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">            <span class="keyword">while</span> ((n = input.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                sb.append((<span class="type">char</span>) n);</span><br><span class="line">            &#125;</span><br><span class="line">            s = sb.toString();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="OutputStream"><a href="#OutputStream" class="headerlink" title="OutputStream:"></a>OutputStream:</h3><p>和<code>InputStream</code>类似，<code>OutputStream</code>也是抽象类，它是所有输出流的超类。这个抽象类定义的一个最重要的方法就是<code>void write(int b)</code>，签名如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(<span class="type">int</span> b)</span> <span class="keyword">throws</span> IOException;</span><br></pre></td></tr></table></figure>

<p>这个方法会写入一个字节到输出流。要注意的是，虽然传入的是<code>int</code>参数，但只会写入一个字节，即只写入<code>int</code>最低8位表示字节的部分（相当于<code>b &amp; 0xff</code>）。</p>
<p>和<code>InputStream</code>类似，<code>OutputStream</code>也提供了<code>close()</code>方法关闭输出流，以便释放系统资源。要特别注意：<code>OutputStream</code>还提供了一个<code>flush()</code>方法，它的目的是将缓冲区的内容真正输出到目的地。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">OutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;out/readme.txt&quot;</span>);</span><br><span class="line">    output.write(<span class="number">72</span>); <span class="comment">// H</span></span><br><span class="line">    output.write(<span class="number">101</span>); <span class="comment">// e</span></span><br><span class="line">    output.write(<span class="number">108</span>); <span class="comment">// l</span></span><br><span class="line">    output.write(<span class="number">108</span>); <span class="comment">// l</span></span><br><span class="line">    output.write(<span class="number">111</span>); <span class="comment">// o</span></span><br><span class="line">    output.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>每次写入一个字节非常麻烦，更常见的方法是一次性写入若干字节。这时，可以用<code>OutputStream</code>提供的重载方法<code>void write(byte[])</code>来实现：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">OutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;out/readme.txt&quot;</span>);</span><br><span class="line">    output.write(<span class="string">&quot;Hello&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>)); <span class="comment">// Hello</span></span><br><span class="line">    output.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>和<code>InputStream</code>一样，上述代码没有考虑到在发生异常的情况下如何正确地关闭资源。写入过程也会经常发生IO错误，例如，磁盘已满，无权限写入等等。我们需要用<code>try(resource)</code>来保证<code>OutputStream</code>在无论是否发生IO错误的时候都能够正确地关闭：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="keyword">try</span> (<span class="type">OutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;out/readme.txt&quot;</span>)) &#123;</span><br><span class="line">        output.write(<span class="string">&quot;Hello&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>)); <span class="comment">// Hello</span></span><br><span class="line">    &#125; <span class="comment">// 编译器在此自动为我们写入finally并调用close()</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="阻塞-1"><a href="#阻塞-1" class="headerlink" title="阻塞"></a>阻塞</h4><p>和<code>InputStream</code>一样，<code>OutputStream</code>的<code>write()</code>方法也是阻塞的。</p>
<h3 id="OutputStream实现类"><a href="#OutputStream实现类" class="headerlink" title="OutputStream实现类"></a>OutputStream实现类</h3><p>用<code>FileOutputStream</code>可以从文件获取输出流，这是<code>OutputStream</code>常用的一个实现类。此外，<code>ByteArrayOutputStream</code>可以在内存中模拟一个<code>OutputStream</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">byte</span>[] data;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ByteArrayOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>()) &#123;</span><br><span class="line">            output.write(<span class="string">&quot;Hello &quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            output.write(<span class="string">&quot;world!&quot;</span>.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">            data = output.toByteArray();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="keyword">new</span> <span class="title class_">String</span>(data, <span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Filter模式"><a href="#Filter模式" class="headerlink" title="Filter模式"></a>Filter模式</h3><p>Java的IO标准库提供的<code>InputStream</code>根据来源可以包括：</p>
<ul>
<li><code>FileInputStream</code>：从文件读取数据，是最终数据源；</li>
<li><code>ServletInputStream</code>：从HTTP请求读取数据，是最终数据源；</li>
<li><code>Socket.getInputStream()</code>：从TCP连接读取数据，是最终数据源；</li>
</ul>
<p>如果我们要给<code>FileInputStream</code>添加缓冲功能，则可以从<code>FileInputStream</code>派生一个又一个的类：</p>
<p>比如BufferedFileInputStream，DigestFileInputStream和CipherFileInputStream类，但是这样做的话很可能会遇到子类爆炸的情况。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">                          ┌─────────────────┐</span><br><span class="line">                          │ FileInputStream │</span><br><span class="line">                          └─────────────────┘</span><br><span class="line">                                   ▲</span><br><span class="line">             ┌───────────┬─────────┼─────────┬───────────┐</span><br><span class="line">             │           │         │         │           │</span><br><span class="line">┌───────────────────────┐│┌─────────────────┐│┌─────────────────────┐</span><br><span class="line">│BufferedFileInputStream│││DigestInputStream│││CipherFileInputStream│</span><br><span class="line">└───────────────────────┘│└─────────────────┘│└─────────────────────┘</span><br><span class="line">                         │                   │</span><br><span class="line">    ┌─────────────────────────────┐ ┌─────────────────────────────┐</span><br><span class="line">    │BufferedDigestFileInputStream│ │BufferedCipherFileInputStream│</span><br><span class="line">    └─────────────────────────────┘ └─────────────────────────────┘</span><br></pre></td></tr></table></figure>

<p>为了解决这个问题，JDK首先将<code>InputStream</code>分为两大类：</p>
<p>一类是直接提供数据的基础<code>InputStream</code>，例如：</p>
<ul>
<li>FileInputStream</li>
<li>ByteArrayInputStream</li>
<li>ServletInputStream</li>
<li>…</li>
</ul>
<p>一类是提供额外附加功能的<code>InputStream</code>，例如：</p>
<ul>
<li>BufferedInputStream</li>
<li>DigestInputStream</li>
<li>CipherInputStream</li>
<li>…</li>
</ul>
<p>当我们需要给一个“基础”<code>InputStream</code>附加各种功能时，我们先确定这个能提供数据源的<code>InputStream</code>，因为我们需要的数据总得来自某个地方，例如，<code>FileInputStream</code>，数据来源自文件：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">InputStream file = new FileInputStream(&quot;test.gz&quot;);</span><br></pre></td></tr></table></figure>

<p>紧接着，我们希望<code>FileInputStream</code>能提供缓冲的功能来提高读取的效率，因此我们用<code>BufferedInputStream</code>包装这个<code>InputStream</code>，得到的包装类型是<code>BufferedInputStream</code>，但它仍然被视为一个<code>InputStream</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">InputStream buffered = new BufferedInputStream(file);</span><br></pre></td></tr></table></figure>

<p>最后，假设该文件已经用gzip压缩了，我们希望直接读取解压缩的内容，就可以再包装一个<code>GZIPInputStream</code>：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">InputStream gzip = new GZIPInputStream(buffered);</span><br></pre></td></tr></table></figure>

<p>无论我们包装多少次，得到的对象始终是<code>InputStream</code>，我们直接用<code>InputStream</code>来引用它，就可以正常读取：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌─────────────────────────┐</span><br><span class="line">│GZIPInputStream          │</span><br><span class="line">│┌───────────────────────┐│</span><br><span class="line">││BufferedFileInputStream││</span><br><span class="line">││┌─────────────────────┐││</span><br><span class="line">│││   FileInputStream   │││</span><br><span class="line">││└─────────────────────┘││</span><br><span class="line">│└───────────────────────┘│</span><br><span class="line">└─────────────────────────┘</span><br></pre></td></tr></table></figure>

<p>上述这种通过一个“基础”组件再叠加各种“附加”功能组件的模式，称之为Filter模式（或者装饰器模式：Decorator）。它可以让我们通过少量的类来实现各种功能的组合：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">                 ┌─────────────┐</span><br><span class="line">                 │ InputStream │</span><br><span class="line">                 └─────────────┘</span><br><span class="line">                       ▲ ▲</span><br><span class="line">┌────────────────────┐ │ │ ┌─────────────────┐</span><br><span class="line">│  FileInputStream   │─┤ └─│FilterInputStream│</span><br><span class="line">└────────────────────┘ │   └─────────────────┘</span><br><span class="line">┌────────────────────┐ │     ▲ ┌───────────────────┐</span><br><span class="line">│ByteArrayInputStream│─┤     ├─│BufferedInputStream│</span><br><span class="line">└────────────────────┘ │     │ └───────────────────┘</span><br><span class="line">┌────────────────────┐ │     │ ┌───────────────────┐</span><br><span class="line">│ ServletInputStream │─┘     ├─│  DataInputStream  │</span><br><span class="line">└────────────────────┘       │ └───────────────────┘</span><br><span class="line">                             │ ┌───────────────────┐</span><br><span class="line">                             └─│CheckedInputStream │</span><br><span class="line">                               └───────────────────┘</span><br></pre></td></tr></table></figure>

<p>类似的，<code>OutputStream</code>也是以这种模式来提供各种功能：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">                  ┌─────────────┐</span><br><span class="line">                  │OutputStream │</span><br><span class="line">                  └─────────────┘</span><br><span class="line">                        ▲ ▲</span><br><span class="line">┌─────────────────────┐ │ │ ┌──────────────────┐</span><br><span class="line">│  FileOutputStream   │─┤ └─│FilterOutputStream│</span><br><span class="line">└─────────────────────┘ │   └──────────────────┘</span><br><span class="line">┌─────────────────────┐ │     ▲ ┌────────────────────┐</span><br><span class="line">│ByteArrayOutputStream│─┤     ├─│BufferedOutputStream│</span><br><span class="line">└─────────────────────┘ │     │ └────────────────────┘</span><br><span class="line">┌─────────────────────┐ │     │ ┌────────────────────┐</span><br><span class="line">│ ServletOutputStream │─┘     ├─│  DataOutputStream  │</span><br><span class="line">└─────────────────────┘       │ └────────────────────┘</span><br><span class="line">                              │ ┌────────────────────┐</span><br><span class="line">                              └─│CheckedOutputStream │</span><br><span class="line">                                └────────────────────┘</span><br></pre></td></tr></table></figure>





<h3 id="操作Zip"><a href="#操作Zip" class="headerlink" title="操作Zip"></a>操作Zip</h3><p><code>ZipInputStream</code>是一种<code>FilterInputStream</code>，它可以直接读取zip包的内容：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌───────────────────┐</span><br><span class="line">│    InputStream    │</span><br><span class="line">└───────────────────┘</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│ FilterInputStream │</span><br><span class="line">└───────────────────┘</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│InflaterInputStream│</span><br><span class="line">└───────────────────┘</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│  ZipInputStream   │</span><br><span class="line">└───────────────────┘</span><br><span class="line">          ▲</span><br><span class="line">          │</span><br><span class="line">┌───────────────────┐</span><br><span class="line">│  JarInputStream   │</span><br><span class="line">└───────────────────┘</span><br></pre></td></tr></table></figure>

<p>另一个<code>JarInputStream</code>是从<code>ZipInputStream</code>派生，它增加的主要功能是直接读取jar文件里面的<code>MANIFEST.MF</code>文件。因为本质上jar包就是zip包，只是额外附加了一些固定的描述文件。</p>
<h4 id="读取zip包"><a href="#读取zip包" class="headerlink" title="读取zip包"></a>读取zip包</h4><p>我们要创建一个<code>ZipInputStream</code>，通常是传入一个<code>FileInputStream</code>作为数据源，然后，循环调用<code>getNextEntry()</code>，直到返回<code>null</code>，表示zip流结束。</p>
<p>一个<code>ZipEntry</code>表示一个压缩文件或目录，如果是压缩文件，我们就用<code>read()</code>方法不断读取，直到返回<code>-1</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">ZipInputStream</span> <span class="variable">zip</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(...))) &#123;</span><br><span class="line">    <span class="type">ZipEntry</span> <span class="variable">entry</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((entry = zip.getNextEntry()) != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> entry.getName();</span><br><span class="line">        <span class="keyword">if</span> (!entry.isDirectory()) &#123; <span class="comment">//判断当前的entry不是目录而是zip文件就可以开始读了</span></span><br><span class="line">            <span class="type">int</span> n;</span><br><span class="line">            <span class="keyword">while</span> ((n = zip.read()) != -<span class="number">1</span>) &#123;</span><br><span class="line">                ...</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="写入zip包"><a href="#写入zip包" class="headerlink" title="写入zip包"></a>写入zip包</h4><p>使用了<code>ZipOutputStream</code>，是一种<code>FilterOutputStream</code>，它可以直接写入内容到zip包。</p>
<p>我们要先创建一个<code>ZipOutputStream</code>，通常是包装一个<code>FileOutputStream</code>，然后，每写入一个文件前，先调用<code>putNextEntry()</code>，然后用<code>write()</code>写入<code>byte[]</code>数据，写入完毕后调用<code>closeEntry()</code>结束这个文件的打包。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">ZipOutputStream</span> <span class="variable">zip</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ZipOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(...))) &#123;</span><br><span class="line">    File[] files = ...</span><br><span class="line">    <span class="keyword">for</span> (File file : files) &#123;</span><br><span class="line">        zip.putNextEntry(<span class="keyword">new</span> <span class="title class_">ZipEntry</span>(file.getName()));</span><br><span class="line">        zip.write(Files.readAllBytes(file.toPath()));</span><br><span class="line">        zip.closeEntry();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="读取classpath资源"><a href="#读取classpath资源" class="headerlink" title="读取classpath资源"></a>读取classpath资源</h3><p>我们知道，Java存放<code>.class</code>的目录或jar包也可以包含任意其他类型的文件，例如：</p>
<ul>
<li>配置文件，例如<code>.properties</code>；</li>
<li>图片文件，例如<code>.jpg</code>；</li>
<li>文本文件，例如<code>.txt</code>，<code>.csv</code>；</li>
</ul>
<p>从classpath读取文件就可以避免不同环境下文件路径不一致的问题：如果我们把<code>default.properties</code>文件放到classpath中，就不用关心它的实际存放路径。</p>
<p><strong>在classpath中的资源文件，路径总是以<code>／</code>开头</strong>，我们先获取当前的<code>Class</code>对象，然后调用<code>getResourceAsStream()</code>就可以直接从classpath读取任意的资源文件：</p>
<p>调用<code>getResourceAsStream()</code>需要特别注意的一点是，如果资源文件不存在，它将返回<code>null</code>。因此，我们需要检查返回的<code>InputStream</code>是否为<code>null</code>，如果为<code>null</code>，表示资源文件在classpath中没有找到：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> getClass().getResourceAsStream(<span class="string">&quot;/default.properties&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (input != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们把默认的配置放到jar包中，再从外部文件系统读取一个可选的配置文件，就可以做到既有默认的配置文件，又可以让用户自己修改配置：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">props.load(inputStreamFromClassPath(<span class="string">&quot;/default.properties&quot;</span>));</span><br><span class="line">props.load(inputStreamFromFile(<span class="string">&quot;./conf.properties&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><strong>类路径（Classpath）</strong>是用于指定在 Java 应用程序中查找类和资源文件的路径。它是一组目录和 JAR 文件的集合，这些文件包含了编译后的 Java 类文件和其他资源文件。</p>
<p><strong>Cautious</strong></p>
<p>把资源存储在classpath中可以避免文件路径依赖；</p>
<p><code>Class</code>对象的<code>getResourceAsStream()</code>可以从classpath中读取指定资源；</p>
<p>根据classpath读取资源时，需要检查返回的<code>InputStream</code>是否为<code>null</code>。</p>
<h3 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h3><p><strong>序列化是指</strong>把一个java对变成二进制内容，本质上就是一个byte[]数组。</p>
<p><strong>为什么</strong>要把Java对象序列化呢？因为序列化后可以把<code>byte[]</code>保存到文件中，或者把<code>byte[]</code>通过网络传输到远程，这样，就相当于把Java对象存储到文件或者通过网络传输出去了。</p>
<p>一个Java对象要能序列化，必须实现一个特殊的<code>java.io.Serializable</code>接口，它的定义如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Serializable</code>接口没有定义任何方法，它是一个空接口。我们把这样的空接口称为“标记接口”（Marker Interface），实现了标记接口的类仅仅是给自身贴了个“标记”，并没有增加任何方法。</p>
<h4 id="序列化的例子"><a href="#序列化的例子" class="headerlink" title="序列化的例子"></a>序列化的例子</h4><p>在这里我们需要用到<code>ObjectOutputStream</code>，它负责将一个java对象写入一个字节流。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">ByteArrayOutputStream</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">ObjectOutputStream</span> <span class="variable">output</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(buffer)) &#123;</span><br><span class="line">            <span class="comment">// 写入int:</span></span><br><span class="line">            output.writeInt(<span class="number">12345</span>);</span><br><span class="line">            <span class="comment">// 写入String:</span></span><br><span class="line">            output.writeUTF(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">            <span class="comment">// 写入Object:</span></span><br><span class="line">            output.writeObject(Double.valueOf(<span class="number">123.456</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Arrays.toString(buffer.toByteArray()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>ObjectOutputStream</code>既可以写入基本类型，如<code>int</code>，<code>boolean</code>，也可以写入<code>String</code>（以UTF-8编码），还可以写入实现了<code>Serializable</code>接口的<code>Object</code>。</p>
<p>因为写入<code>Object</code>时需要大量的类型信息，所以写入的内容很大。</p>
<h4 id="反序列化例子"><a href="#反序列化例子" class="headerlink" title="反序列化例子"></a>反序列化例子</h4><p>和<code>ObjectOutputStream</code>相反，<code>ObjectInputStream</code>负责从一个字节流读取Java对象：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">ObjectInputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(...)) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> input.readInt();</span><br><span class="line">    <span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> input.readUTF();</span><br><span class="line">    <span class="type">Double</span> <span class="variable">d</span> <span class="operator">=</span> (Double) input.readObject();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>除了能读取基本类型和<code>String</code>类型外，调用<code>readObject()</code>可以直接返回一个<code>Object</code>对象。要把它变成一个特定类型，必须强制转型。</p>
<p><code>readObject()</code>可能抛出的异常有：</p>
<ul>
<li><code>ClassNotFoundException</code>：没有找到对应的Class；</li>
<li><code>InvalidClassException</code>：Class不匹配。</li>
</ul>
<p>对于<code>ClassNotFoundException</code>，这种情况常见于一台电脑上的Java程序把一个Java对象，例如，<code>Person</code>对象序列化以后，通过网络传给另一台电脑上的另一个Java程序，但是这台电脑的Java程序并没有定义<code>Person</code>类，所以无法反序列化。</p>
<p>对于<code>InvalidClassException</code>，这种情况常见于序列化的<code>Person</code>对象定义了一个<code>int</code>类型的<code>age</code>字段，但是反序列化时，<code>Person</code>类定义的<code>age</code>字段被改成了<code>long</code>类型，所以导致class不兼容。</p>
<p><strong>为了解决这两个bug</strong></p>
<p>Java的序列化允许class定义一个特殊的<code>serialVersionUID</code>静态变量，用于标识Java类的序列化“版本”，通常可以由IDE自动生成。如果增加或修改了字段，可以改变<code>serialVersionUID</code>的值，这样就能自动阻止不匹配的class版本：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Person</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">long</span> <span class="variable">serialVersionUID</span> <span class="operator">=</span> <span class="number">2709425275741743919L</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反序列化时，由JVM直接构造出Java对象，不调用构造方法，构造方法内部的代码，在反序列化时根本不可能执行。</p>
<h4 id="小结-2"><a href="#小结-2" class="headerlink" title="小结"></a>小结</h4><p>可序列化的Java对象必须实现<code>java.io.Serializable</code>接口，类似<code>Serializable</code>这样的空接口被称为“标记接口”（Marker Interface）；</p>
<p>反序列化时不调用构造方法，可设置<code>serialVersionUID</code>作为版本号（非必需）；</p>
<p>Java的序列化机制仅适用于Java，如果需要与其它语言交换数据，必须使用通用的序列化方法，例如JSON。</p>
<h3 id="Reader-x2F-Writer"><a href="#Reader-x2F-Writer" class="headerlink" title="Reader&#x2F;Writer"></a>Reader&#x2F;Writer</h3><h4 id="Reader"><a href="#Reader" class="headerlink" title="Reader"></a>Reader</h4><p>这两个是java的IO库中提供的另外两个输入输出流接口，和InputStream的区别是，InputStream是一个字节流，以byte为单位读取，而Reader是一个字符流，即以char为单位读取。</p>
<table>
<thead>
<tr>
<th align="left">InputStream</th>
<th align="left">Reader</th>
</tr>
</thead>
<tbody><tr>
<td align="left">字节流，以<code>byte</code>为单位</td>
<td align="left">字符流，以<code>char</code>为单位</td>
</tr>
<tr>
<td align="left">读取字节（-1，0~255）：<code>int read()</code></td>
<td align="left">读取字符（-1，0~65535）：<code>int read()</code></td>
</tr>
<tr>
<td align="left">读到字节数组：<code>int read(byte[] b)</code></td>
<td align="left">读到字符数组：<code>int read(char[] c)</code></td>
</tr>
</tbody></table>
<p><code>java.io.Reader</code>是所有字符输入流的超类，它最主要的方法是：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> <span class="title function_">read</span><span class="params">()</span> <span class="keyword">throws</span> IOException;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="comment">// 创建一个FileReader对象:</span></span><br><span class="line">    <span class="type">Reader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;src/readme.txt&quot;</span>); <span class="comment">// 字符编码是???</span></span><br><span class="line">    <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> reader.read(); <span class="comment">// 反复调用read()方法，直到返回-1</span></span><br><span class="line">        <span class="keyword">if</span> (n == -<span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println((<span class="type">char</span>)n); <span class="comment">// 打印char</span></span><br><span class="line">    &#125;</span><br><span class="line">    reader.close(); <span class="comment">// 关闭流</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>如果我们读取一个纯ASCII编码的文本文件，上述代码工作是没有问题的。但如果文件中包含中文，就会出现乱码，因为<code>FileReader</code>默认的编码与系统相关，例如，Windows系统的默认编码可能是<code>GBK</code>，打开一个<code>UTF-8</code>编码的文本文件就会出现乱码。</p>
<p>要避免乱码问题，我们需要在创建<code>FileReader</code>时指定编码：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Reader reader = new FileReader(&quot;src/readme.txt&quot;, StandardCharsets.UTF_8);</span><br></pre></td></tr></table></figure>

<p>和<code>InputStream</code>类似，<code>Reader</code>也是一种资源，需要保证出错的时候也能正确关闭，所以我们需要用<code>try (resource)</code>来保证<code>Reader</code>在无论有没有IO错误的时候都能够正确地关闭：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">Reader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;src/readme.txt&quot;</span>, StandardCharsets.UTF_8) &#123;</span><br><span class="line">    <span class="comment">// TODO</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>Reader</code>还提供了一次性读取若干字符并填充到<code>char[]</code>数组的方法：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public int read(char[] c) throws IOException</span><br></pre></td></tr></table></figure>

<p>它返回实际读入的字符个数，最大不超过<code>char[]</code>数组的长度。返回<code>-1</code>表示流结束。</p>
<p>利用这个方法，我们可以先设置一个缓冲区，然后，每次尽可能地填充缓冲区：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">public void readFile() throws IOException &#123;</span><br><span class="line">    try (Reader reader = new FileReader(&quot;src/readme.txt&quot;, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">        char[] buffer = new char[1000];</span><br><span class="line">        int n;</span><br><span class="line">        while ((n = reader.read(buffer)) != -1) &#123;</span><br><span class="line">            System.out.println(&quot;read &quot; + n + &quot; chars.&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>CharArrayReader</strong></p>
<p><code>CharArrayReader</code>可以在内存中模拟一个<code>Reader</code>，它的作用实际上是把一个<code>char[]</code>数组变成一个<code>Reader</code>，这和<code>ByteArrayInputStream</code>非常类似：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try (Reader reader = new CharArrayReader(&quot;Hello&quot;.toCharArray())) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>StringReader</strong></p>
<p><code>StringReader</code>可以直接把<code>String</code>作为数据源，它和<code>CharArrayReader</code>几乎一样：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try (Reader reader = new StringReader(&quot;Hello&quot;)) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>InputStreamReader</strong></p>
<p><code>Reader</code>和<code>InputStream</code>有什么关系？</p>
<p>除了特殊的<code>CharArrayReader</code>和<code>StringReader</code>，普通的<code>Reader</code>实际上是基于<code>InputStream</code>构造的，因为<code>Reader</code>需要从<code>InputStream</code>中读入字节流（<code>byte</code>），然后，根据编码设置，再转换为<code>char</code>就可以实现字符流。如果我们查看<code>FileReader</code>的源码，它在内部实际上持有一个<code>FileInputStream</code>。</p>
<p>既然<code>Reader</code>本质上是一个基于<code>InputStream</code>的<code>byte</code>到<code>char</code>的转换器，那么，如果我们已经有一个<code>InputStream</code>，想把它转换为<code>Reader</code>，是完全可行的。<code>InputStreamReader</code>就是这样一个转换器，它可以把任何<code>InputStream</code>转换为<code>Reader</code>。示例代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 持有InputStream:</span></span><br><span class="line"><span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/readme.txt&quot;</span>);</span><br><span class="line"><span class="comment">// 变换为Reader:</span></span><br><span class="line"><span class="type">Reader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(input, <span class="string">&quot;UTF-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>构造<code>InputStreamReader</code>时，我们需要传入<code>InputStream</code>，还需要指定编码，就可以得到一个<code>Reader</code>对象。上述代码可以通过<code>try (resource)</code>更简洁地改写如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">Reader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;src/readme.txt&quot;</span>), <span class="string">&quot;UTF-8&quot;</span>)) &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码实际上就是<code>FileReader</code>的一种实现方式。</p>
<p>使用<code>try (resource)</code>结构时，当我们关闭<code>Reader</code>时，它会在内部自动调用<code>InputStream</code>的<code>close()</code>方法，所以，只需要关闭最外层的<code>Reader</code>对象即可。</p>
<p> 使用InputStreamReader，可以把一个InputStream转换成一个Reader。</p>
<p><strong>小结</strong></p>
<p><code>Reader</code>定义了所有字符输入流的超类：</p>
<ul>
<li><code>FileReader</code>实现了文件字符流输入，使用时需要指定编码；</li>
<li><code>CharArrayReader</code>和<code>StringReader</code>可以在内存中模拟一个字符流输入。</li>
</ul>
<p><code>Reader</code>是基于<code>InputStream</code>构造的：可以通过<code>InputStreamReader</code>在指定编码的同时将任何<code>InputStream</code>转换为<code>Reader</code>。</p>
<p>总是使用<code>try (resource)</code>保证<code>Reader</code>正确关闭。</p>
<h4 id="Writer"><a href="#Writer" class="headerlink" title="Writer"></a>Writer</h4><table>
<thead>
<tr>
<th align="left">OutputStream</th>
<th align="left">Writer</th>
</tr>
</thead>
<tbody><tr>
<td align="left">字节流，以<code>byte</code>为单位</td>
<td align="left">字符流，以<code>char</code>为单位</td>
</tr>
<tr>
<td align="left">写入字节（0~255）：<code>void write(int b)</code></td>
<td align="left">写入字符（0~65535）：<code>void write(int c)</code></td>
</tr>
<tr>
<td align="left">写入字节数组：<code>void write(byte[] b)</code></td>
<td align="left">写入字符数组：<code>void write(char[] c)</code></td>
</tr>
<tr>
<td align="left">无对应方法</td>
<td align="left">写入String：<code>void write(String s)</code></td>
</tr>
</tbody></table>
<p><code>Writer</code>是所有字符输出流的超类，它提供的方法主要有：</p>
<ul>
<li>写入一个字符（0~65535）：<code>void write(int c)</code>；</li>
<li>写入字符数组的所有字符：<code>void write(char[] c)</code>；</li>
<li>写入String表示的所有字符：<code>void write(String s)</code>。</li>
</ul>
<p><strong>FileWriter</strong></p>
<p><code>FileWriter</code>就是向文件中写入字符流的<code>Writer</code>。它的使用方法和<code>FileReader</code>类似：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try (Writer writer = new FileWriter(&quot;readme.txt&quot;, StandardCharsets.UTF_8)) &#123;</span><br><span class="line">    writer.write(&#x27;H&#x27;); // 写入单个字符</span><br><span class="line">    writer.write(&quot;Hello&quot;.toCharArray()); // 写入char[]</span><br><span class="line">    writer.write(&quot;Hello&quot;); // 写入String</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>CharArrayWriter</strong></p>
<p><code>CharArrayWriter</code>可以在内存中创建一个<code>Writer</code>，它的作用实际上是构造一个缓冲区，可以写入<code>char</code>，最后得到写入的<code>char[]</code>数组，这和<code>ByteArrayOutputStream</code>非常类似：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try (CharArrayWriter writer = new CharArrayWriter()) &#123;</span><br><span class="line">    writer.write(65);</span><br><span class="line">    writer.write(66);</span><br><span class="line">    writer.write(67);</span><br><span class="line">    char[] data = writer.toCharArray(); // &#123; &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>StringWriter</strong></p>
<p><code>StringWriter</code>也是一个基于内存的<code>Writer</code>，它和<code>CharArrayWriter</code>类似。实际上，<code>StringWriter</code>在内部维护了一个<code>StringBuffer</code>，并对外提供了<code>Writer</code>接口。</p>
<p><strong>OutputStreamWriter</strong></p>
<p>除了<code>CharArrayWriter</code>和<code>StringWriter</code>外，普通的Writer实际上是基于<code>OutputStream</code>构造的，它接收<code>char</code>，然后在内部自动转换成一个或多个<code>byte</code>，并写入<code>OutputStream</code>。因此，<code>OutputStreamWriter</code>就是一个将任意的<code>OutputStream</code>转换为<code>Writer</code>的转换器：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">try (Writer writer = new OutputStreamWriter(new FileOutputStream(&quot;readme.txt&quot;), &quot;UTF-8&quot;)) &#123;</span><br><span class="line">    // TODO:</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上述代码实际上就是<code>FileWriter</code>的一种实现方式。这和上一节的<code>InputStreamReader</code>是一样的。</p>
<p><strong>小结</strong></p>
<p><code>Writer</code>定义了所有字符输出流的超类：</p>
<ul>
<li><code>FileWriter</code>实现了文件字符流输出；</li>
<li><code>CharArrayWriter</code>和<code>StringWriter</code>在内存中模拟一个字符流输出。</li>
</ul>
<p>使用<code>try (resource)</code>保证<code>Writer</code>正确关闭。</p>
<p><code>Writer</code>是基于<code>OutputStream</code>构造的，可以通过<code>OutputStreamWriter</code>将<code>OutputStream</code>转换为<code>Writer</code>，转换时需要指定编码。</p>
<h3 id="PrintStream-x2F-PrintWriter"><a href="#PrintStream-x2F-PrintWriter" class="headerlink" title="PrintStream&#x2F;PrintWriter"></a>PrintStream&#x2F;PrintWriter</h3><p><code>PrintStream</code>是一种<code>FilterOutputStream</code>，它在<code>OutputStream</code>的接口上，额外提供了一些写入各种数据类型的方法：</p>
<ul>
<li>写入<code>int</code>：<code>print(int)</code></li>
<li>写入<code>boolean</code>：<code>print(boolean)</code></li>
<li>写入<code>String</code>：<code>print(String)</code></li>
<li>写入<code>Object</code>：<code>print(Object)</code>，实际上相当于<code>print(object.toString())</code></li>
</ul>
<p><strong>PrintWriter</strong></p>
<p><code>PrintStream</code>最终输出的总是byte数据，而<code>PrintWriter</code>则是扩展了<code>Writer</code>接口，它的<code>print()</code>&#x2F;<code>println()</code>方法最终输出的是<code>char</code>数据。两者的使用方法几乎是一模一样的：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>     &#123;</span><br><span class="line">        <span class="type">StringWriter</span> <span class="variable">buffer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringWriter</span>();</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">PrintWriter</span> <span class="variable">pw</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintWriter</span>(buffer)) &#123;</span><br><span class="line">            pw.println(<span class="string">&quot;Hello&quot;</span>);</span><br><span class="line">            pw.println(<span class="number">12345</span>);</span><br><span class="line">            pw.println(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(buffer.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong>小结</strong></p>
<p><code>PrintStream</code>是一种能接收各种数据类型的输出，打印数据时比较方便：</p>
<ul>
<li><code>System.out</code>是标准输出；</li>
<li><code>System.err</code>是标准错误输出。</li>
</ul>
<p><code>PrintWriter</code>是基于<code>Writer</code>的输出。</p>
<h3 id="Files"><a href="#Files" class="headerlink" title="Files"></a>Files</h3><p>从Java 7开始，提供了<code>Files</code>这个工具类，能极大地方便我们读写文件。</p>
<p>虽然<code>Files</code>是<code>java.nio</code>包里面的类，但他俩封装了很多读写文件的简单方法，例如，我们要把一个文件的全部内容读取为一个<code>byte[]</code>，可以这么写：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">byte</span>[] data = Files.readAllBytes(Path.of(<span class="string">&quot;/path/to/file.txt&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>如果是文本文件，可以把一个文件的全部内容读取为<code>String</code>：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 默认使用UTF-8编码读取:</span></span><br><span class="line"><span class="type">String</span> <span class="variable">content1</span> <span class="operator">=</span> Files.readString(Path.of(<span class="string">&quot;/path/to/file.txt&quot;</span>));</span><br><span class="line"><span class="comment">// 可指定编码:</span></span><br><span class="line"><span class="type">String</span> <span class="variable">content2</span> <span class="operator">=</span> Files.readString(Path.of(<span class="string">&quot;/path&quot;</span>, <span class="string">&quot;to&quot;</span>, <span class="string">&quot;file.txt&quot;</span>), StandardCharsets.ISO_8859_1);</span><br><span class="line"><span class="comment">// 按行读取并返回每行内容:</span></span><br><span class="line">List&lt;String&gt; lines = Files.readAllLines(Path.of(<span class="string">&quot;/path/to/file.txt&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>写入文件也非常方便：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 写入二进制文件:</span></span><br><span class="line"><span class="type">byte</span>[] data = ...</span><br><span class="line">Files.write(Path.of(<span class="string">&quot;/path/to/file.txt&quot;</span>), data);</span><br><span class="line"><span class="comment">// 写入文本并指定编码:</span></span><br><span class="line">Files.writeString(Path.of(<span class="string">&quot;/path/to/file.txt&quot;</span>), <span class="string">&quot;文本内容...&quot;</span>, StandardCharsets.ISO_8859_1);</span><br><span class="line"><span class="comment">// 按行写入文本:</span></span><br><span class="line">List&lt;String&gt; lines = ...</span><br><span class="line">Files.write(Path.of(<span class="string">&quot;/path/to/file.txt&quot;</span>), lines);</span><br></pre></td></tr></table></figure>

<p>此外，<code>Files</code>工具类还有<code>copy()</code>、<code>delete()</code>、<code>exists()</code>、<code>move()</code>等快捷方法操作文件和目录。</p>
<p>最后需要特别注意的是，<code>Files</code>提供的读写方法，受内存限制，只能读写小文件，例如配置文件等，不可一次读入几个G的大文件。读写大型文件仍然要使用文件流，每次只读写一部分文件内容。</p>
<h2 id="反射"><a href="#反射" class="headerlink" title="反射"></a>反射</h2><h3 id="class类"><a href="#class类" class="headerlink" title="class类"></a>class类</h3><p>而<code>class</code>是由JVM在执行过程中动态加载的。JVM在第一次读取到一种<code>class</code>类型时，将其加载进内存。</p>
<p>每加载一种<code>class</code>，JVM就为其创建一个<code>Class</code>类型的实例，并关联起来。注意：这里的<code>Class</code>类型是一个名叫<code>Class</code>的<code>class</code>。它长这样：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">class</span> <span class="title class_">Class</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Class</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>以<code>String</code>类为例，当JVM加载<code>String</code>类时，它首先读取<code>String.class</code>文件到内存，然后，为<code>String</code>类创建一个<code>Class</code>实例并关联起来：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Class</span>(String);</span><br></pre></td></tr></table></figure>

<p>这个<code>Class</code>实例是JVM内部创建的，如果我们查看JDK源码，可以发现<code>Class</code>类的构造方法是<code>private</code>，只有JVM能创建<code>Class</code>实例，我们自己的Java程序是无法创建<code>Class</code>实例的。</p>
<p><strong>所以，JVM持有的每个<code>Class</code>实例都指向一个数据类型（<code>class</code>或<code>interface</code>）</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌───────────────────────────┐</span><br><span class="line">│      Class Instance       │──────&gt; String</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│name = &quot;java.lang.String&quot;  │</span><br><span class="line">└───────────────────────────┘</span><br><span class="line">┌───────────────────────────┐</span><br><span class="line">│      Class Instance       │──────&gt; Random</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│name = &quot;java.util.Random&quot;  │</span><br><span class="line">└───────────────────────────┘</span><br><span class="line">┌───────────────────────────┐</span><br><span class="line">│      Class Instance       │──────&gt; Runnable</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│name = &quot;java.lang.Runnable&quot;│</span><br></pre></td></tr></table></figure>

<p>一个<code>Class</code>实例包含了该<code>class</code>的所有完整信息：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌───────────────────────────┐</span><br><span class="line">│      Class Instance       │──────&gt; String</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│name = &quot;java.lang.String&quot;  │</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│package = &quot;java.lang&quot;      │</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│super = &quot;java.lang.Object&quot; │</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│interface = CharSequence...│</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│field = value[],hash,...   │</span><br><span class="line">├───────────────────────────┤</span><br><span class="line">│method = indexOf()...      │</span><br><span class="line">└───────────────────────────┘</span><br></pre></td></tr></table></figure>

<p>因此，如果获取了某个<code>Class</code>实例，我们就可以通过这个<code>Class</code>实例获取到该实例对应的<code>class</code>的所有信息。</p>
<p>这种通过<code>Class</code>实例获取<code>class</code>信息的方法称为反射（Reflection）。</p>
<p>获取class的Class实例有三个方法</p>
<p>方法一：直接通过一个<code>class</code>的静态变量<code>class</code>获取：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> String.class;</span><br></pre></td></tr></table></figure>

<p>方法二：如果我们有一个实例变量，可以通过该实例变量提供的<code>getClass()</code>方法获取：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> s.getClass();</span><br></pre></td></tr></table></figure>

<p>方法三：如果知道一个<code>class</code>的完整类名，可以通过静态方法<code>Class.forName()</code>获取：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> Class.forName(<span class="string">&quot;java.lang.String&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>因为<code>Class</code>实例在JVM中是唯一的，所以，上述方法获取的<code>Class</code>实例是同一个实例。可以用<code>==</code>比较两个<code>Class</code>实例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Class</span> <span class="variable">cls1</span> <span class="operator">=</span> String.class;</span><br><span class="line"></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="string">&quot;Hello&quot;</span>;</span><br><span class="line"><span class="type">Class</span> <span class="variable">cls2</span> <span class="operator">=</span> s.getClass();</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">sameClass</span> <span class="operator">=</span> cls1 == cls2; <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p>注意一下<code>Class</code>实例比较和<code>instanceof</code>的差别：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">n</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(<span class="number">123</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">b1</span> <span class="operator">=</span> n <span class="keyword">instanceof</span> Integer; <span class="comment">// true，因为n是Integer类型</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">b2</span> <span class="operator">=</span> n <span class="keyword">instanceof</span> Number; <span class="comment">// true，因为n是Number类型的子类</span></span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="variable">b3</span> <span class="operator">=</span> n.getClass() == Integer.class; <span class="comment">// true，因为n.getClass()返回Integer.class</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">b4</span> <span class="operator">=</span> n.getClass() == Number.class; <span class="comment">// false，因为Integer.class!=Number.class</span></span><br></pre></td></tr></table></figure>



<p>获得反射后的Class实例中的信息，如下:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        printClassInfo(<span class="string">&quot;&quot;</span>.getClass());<span class="comment">//String,使用对象调取Class话需要用到.getClass()方法</span></span><br><span class="line">        printClassInfo(Runnable.class);<span class="comment">//Runnable interface</span></span><br><span class="line">        printClassInfo(java.time.Month.class);<span class="comment">//Month</span></span><br><span class="line">        printClassInfo(String[].class);<span class="comment">//String[]</span></span><br><span class="line">        printClassInfo(<span class="type">int</span>.class);<span class="comment">//int</span></span><br><span class="line">    &#125;</span><br><span class="line">		<span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">printClassInfo</span><span class="params">(Class cls)</span> &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Class name: &quot;</span> + cls.getName());</span><br><span class="line">    System.out.println(<span class="string">&quot;Simple name: &quot;</span> + cls.getSimpleName());</span><br><span class="line">    <span class="keyword">if</span> (cls.getPackage() != <span class="literal">null</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Package name: &quot;</span> + cls.getPackage().getName());</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;is interface: &quot;</span> + cls.isInterface());</span><br><span class="line">    System.out.println(<span class="string">&quot;is enum: &quot;</span> + cls.isEnum());</span><br><span class="line">    System.out.println(<span class="string">&quot;is array: &quot;</span> + cls.isArray());</span><br><span class="line">    System.out.println(<span class="string">&quot;is primitive: &quot;</span> + cls.isPrimitive());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取String的Class实例:</span></span><br><span class="line"><span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> String.class;</span><br><span class="line"><span class="comment">// 创建一个String实例:</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> (String) cls.newInstance();</span><br><span class="line"><span class="comment">//等同于</span></span><br><span class="line"><span class="type">String</span> <span class="variable">s</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>();</span><br></pre></td></tr></table></figure>

<p>String s &#x3D; (String) cls.newInstance();这样创建类实例的局限是只能调用public的无参构造方法。</p>
<p>JVM在执行Java程序的时候，并不是一次性把所有用到的class全部加载到内存，而是第一次需要用到class时才加载。例如：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Main.java</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (args.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            create(args[<span class="number">0</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">create</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="type">Person</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当执行<code>Main.java</code>时，由于用到了<code>Main</code>，因此，JVM首先会把<code>Main.class</code>加载到内存。然而，并不会加载<code>Person.class</code>，除非程序执行到<code>create()</code>方法，JVM发现需要加载<code>Person</code>类时，才会首次加载<code>Person.class</code>。如果没有执行<code>create()</code>方法，那么<code>Person.class</code>根本就不会被加载。</p>
<p>动态加载<code>class</code>的特性对于Java程序非常重要。利用JVM动态加载<code>class</code>的特性，我们才能在运行期根据条件加载不同的实现类。例如，Commons Logging总是优先使用Log4j，只有当Log4j不存在时，才使用JDK的logging。利用JVM动态加载特性，大致的实现代码如下：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// Commons Logging优先使用Log4j:</span></span><br><span class="line"><span class="type">LogFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (isClassPresent(<span class="string">&quot;org.apache.logging.log4j.Logger&quot;</span>)) &#123;</span><br><span class="line">    factory = createLog4j();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    factory = createJdkLog();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">boolean</span> <span class="title function_">isClassPresent</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        Class.forName(name);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这就是为什么我们只需要把Log4j的jar包放到classpath中，Commons Logging就会自动使用Log4j的原因。</p>
<h3 id="访问字段"><a href="#访问字段" class="headerlink" title="访问字段"></a>访问字段</h3><p>我们先看看如何通过<code>Class</code>实例获取字段信息。<code>Class</code>类提供了以下几个方法来获取字段：</p>
<ul>
<li>Field getField(name)：根据字段名获取某个public的field（包括父类）</li>
<li>Field getDeclaredField(name)：根据字段名获取当前类的某个field（不包括父类）</li>
<li>Field[] getFields()：获取所有public的field（包括父类）</li>
<li>Field[] getDeclaredFields()：获取当前类的所有field（不包括父类）</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Class</span> <span class="variable">stdClass</span> <span class="operator">=</span> Student.class;</span><br><span class="line">        <span class="comment">// 获取public字段&quot;score&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getField(<span class="string">&quot;score&quot;</span>));</span><br><span class="line">        <span class="comment">// 获取继承的public字段&quot;name&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getField(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">        <span class="comment">// 获取private字段&quot;grade&quot;:</span></span><br><span class="line">        System.out.println(stdClass.getDeclaredField(<span class="string">&quot;grade&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> score;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> grade;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>print out</strong>: org.example is the package name where this class is.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">int</span> org.example.Student.score</span><br><span class="line"><span class="keyword">public</span> java.lang.String org.example.Person.name</span><br><span class="line"><span class="keyword">private</span> <span class="type">int</span> org.example.Student.grade</span><br></pre></td></tr></table></figure>

<p><strong>Field对象</strong></p>
<p>一个<code>Field</code>对象包含了一个字段的所有信息：</p>
<ul>
<li><code>getName()</code>：返回字段名称，例如，<code>&quot;name&quot;</code>；</li>
<li><code>getType()</code>：返回字段类型，也是一个<code>Class</code>实例，例如，<code>String.class</code>；</li>
<li><code>getModifiers()</code>：返回字段的修饰符，它是一个<code>int</code>，不同的bit表示不同的含义。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> String.class.getDeclaredField(<span class="string">&quot;value&quot;</span>);</span><br><span class="line">f.getName(); <span class="comment">// &quot;value&quot;</span></span><br><span class="line">f.getType(); <span class="comment">// class [B 表示byte[]类型</span></span><br><span class="line"><span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> f.getModifiers();</span><br><span class="line">Modifier.isFinal(m); <span class="comment">// true</span></span><br><span class="line">Modifier.isPublic(m); <span class="comment">// false</span></span><br><span class="line">Modifier.isProtected(m); <span class="comment">// false</span></span><br><span class="line">Modifier.isPrivate(m); <span class="comment">// true</span></span><br><span class="line">Modifier.isStatic(m); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>



<p>下面这段代码可以先拿到name字段的field,再获取这个实例的name字段的值。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Object</span> <span class="variable">p</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Xiao Ming&quot;</span>);</span><br><span class="line">        <span class="type">Class</span> <span class="variable">c</span> <span class="operator">=</span> p.getClass();</span><br><span class="line">        <span class="type">Field</span> <span class="variable">f</span> <span class="operator">=</span> c.getDeclaredField(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">value</span> <span class="operator">=</span> f.get(p);</span><br><span class="line">        System.out.println(value); <span class="comment">// &quot;Xiao Ming&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Person</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>述代码先获取<code>Class</code>实例，再获取<code>Field</code>实例，然后，用<code>Field.get(Object)</code>获取指定实例的指定字段的值。</p>
<p><strong>运行代码，如果不出意外，会得到一个bug</strong><code>IllegalAccessException</code>，这是因为<code>name</code>被定义为一个<code>private</code>字段，正常情况下，<code>Main</code>类无法访问<code>Person</code>类的<code>private</code>字段。要修复错误，可以将<code>private</code>改为<code>public</code>，或者，在调用<code>Object value = f.get(p);</code>前，先写一句：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">f.setAccessible(true);</span><br></pre></td></tr></table></figure>

<p>调用<code>Field.setAccessible(true)</code>的意思是，别管这个字段是不是<code>public</code>，一律允许访问。</p>
<h3 id="调用方法"><a href="#调用方法" class="headerlink" title="调用方法"></a>调用方法</h3><h3 id="调用构造方法"><a href="#调用构造方法" class="headerlink" title="调用构造方法"></a>调用构造方法</h3><h3 id="获取继承关系"><a href="#获取继承关系" class="headerlink" title="获取继承关系"></a>获取继承关系</h3><h3 id="动态代理"><a href="#动态代理" class="headerlink" title="动态代理"></a>动态代理</h3><h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><h2 id="范型"><a href="#范型" class="headerlink" title="范型"></a>范型</h2><h2 id="多线程multi-thread"><a href="#多线程multi-thread" class="headerlink" title="多线程multi-thread"></a>多线程multi-thread</h2><h3 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h3><p>线程：在计算机中，我们把一个任务称为一个进程，浏览器就是一个进程，视频播放器是另一个进程</p>
<p>进程：某些进程内部还需要同时执行多个子任务。例如，我们在使用Word时，Word可以让我们一边打字，一边进行拼写检查，同时还可以在后台进行打印，我们把子任务称为线程。</p>
<p>进程和线程的关系就是：一个进程可以包含一个或多个线程，但<strong>至少会有一个线程</strong>。</p>
<p>操作系统调度的<strong>最小任务单位是线程</strong>。常用的Windows、Linux等操作系统都采用<strong>抢占式多任务</strong>，如何调度线程完全由操作系统决定，<strong>程序自己不能决定什么时候执行</strong>，以及执行多长时间。</p>
<p>同一个应用程序，既可以有多个进程，也可以有多个线程，因此，实现多任务的方法，有以下几种：</p>
<ol>
<li><p>多进程模式（每个进程只有一个线程）</p>
</li>
<li><p>多线程模式（一个进程有多个线程）</p>
</li>
<li><p>多进程加多线程（多个进程，且每个进程里面可能有多个线程）</p>
</li>
</ol>
<p>进程和线程是包含关系，但是<strong>多任务</strong>既可以由<strong>多进程</strong>实现，也可以由<strong>单进程</strong>内的<strong>多线程</strong>实现，还可以<strong>混合多进程＋多线程</strong>。</p>
<p>和多线程相比，<strong>多进程的缺点</strong>在于：</p>
<ul>
<li>创建进程比创建线程开销大，尤其是在Windows系统上；</li>
<li>进程间通信比线程间通信要慢，因为线程间通信就是读写同一个变量，速度很快。</li>
</ul>
<p>而<strong>多进程的优点</strong>在于：</p>
<p>多进程稳定性比多线程高，因为在多进程的情况下，一个进程崩溃不会影响其他进程，而在多线程的情况下，任何一个线程崩溃会直接导致整个进程崩溃。</p>
<h3 id="多线程"><a href="#多线程" class="headerlink" title="多线程"></a>多线程</h3><p>Java语言内置了多线程支持：一个Java程序实际上是一个JVM进程，JVM进程用一个主线程来执行<code>main()</code>方法，在<code>main()</code>方法内部，我们又可以启动多个线程。此外，JVM还有负责垃圾回收的其他工作线程等。</p>
<p>因此，对于大多数Java程序来说，我们说多任务，实际上是说如何使用多线程实现多任务。</p>
<p>和单线程相比，多线程编程的特点在于：多线程经常需要读写共享数据，并且需要同步。例如，播放电影时，就必须由一个线程播放视频，另一个线程播放音频，两个线程需要协调运行，否则画面和声音就不同步。因此，多线程编程的复杂度高，调试更困难。</p>
<p>Java多线程编程的特点又在于：</p>
<ul>
<li>多线程模型是Java程序最基本的并发模型；</li>
<li>后续读写网络、数据库、Web开发等都依赖Java多线程模型。</li>
</ul>
<p>因此，必须掌握Java多线程编程才能继续深入学习其他内容。</p>
<h3 id="创建新线程"><a href="#创建新线程" class="headerlink" title="创建新线程"></a>创建新线程</h3><p>Java语言内置了多线程支持。当Java程序启动的时候，实际上是启动了一个JVM进程，然后，JVM启动主线程来执行<code>main()</code>方法。在<code>main()</code>方法中，我们又可以启动其他线程。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>();</span><br><span class="line">        t.start(); <span class="comment">// 启动新线程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>让线程执行指定代码</p>
<p><strong>方法一</strong>：从<code>Thread</code>派生一个自定义类，然后覆写<code>run()</code>方法：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        t.start(); <span class="comment">// 启动新线程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start new thread!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>方法二</strong>：创建<code>Thread</code>实例时，传入一个<code>Runnable</code>实例：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyRunnable</span>());</span><br><span class="line">        t.start(); <span class="comment">// 启动新线程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;start new thread!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>等同于</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;start new thread!&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        t.start(); <span class="comment">// 启动新线程</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;main start...&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;thread run...&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;thread end.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t.start();</span><br><span class="line">        System.out.println(<span class="string">&quot;main end...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们看线程的执行顺序：</p>
<ol>
<li><code>main</code>线程肯定是先打印<code>main start</code>，再打印<code>main end</code>；</li>
<li><code>t</code>线程肯定是先打印<code>thread run</code>，再打印<code>thread end</code>。</li>
</ol>
<p>但是，除了可以肯定，<code>main start</code>会先打印外，<code>main end</code>打印在<code>thread run</code>之前、<code>thread end</code>之后或者之间，都无法确定。因为从<code>t</code>线程开始运行以后，两个线程就开始同时运行了，并且由操作系统调度，程序本身无法确定线程的调度顺序。</p>
<p>模拟并发的效果，调用thread.sleep(),</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;main start...&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>() &#123;</span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;thread run...&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">10</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">                System.out.println(<span class="string">&quot;thread end.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        t.start();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">20</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;&#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;main end...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>sleep()</code>传入的参数是毫秒。调整暂停时间的大小，我们可以看到<code>main</code>线程和<code>t</code>线程执行的先后顺序。</p>
<p><strong>要特别注意：直接调用<code>Thread</code>实例的<code>run()</code>方法是无效的：</strong></p>
<p>直接调用<code>run()</code>方法，相当于调用了一个普通的Java方法，当前线程并没有任何改变，也不会启动新线程。上述代码实际上是在<code>main()</code>方法内部又调用了<code>run()</code>方法，打印<code>hello</code>语句是在<code>main</code>线程中执行的，没有任何新线程被创建。</p>
<p>必须调用<code>Thread</code>实例的<code>start()</code>方法才能启动新线程，如果我们查看<code>Thread</code>类的源代码，会看到<code>start()</code>方法内部调用了一个<code>private native void start0()</code>方法，<code>native</code>修饰符表示这个方法是由JVM虚拟机内部的C代码实现的，不是由Java代码实现的。</p>
<p>可以对<strong>线程设定优先级</strong>，设定优先级的方法是：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Thread.setPriority(<span class="type">int</span> n) <span class="comment">// 1~10, 默认值5</span></span><br></pre></td></tr></table></figure>

<p>JVM自动把1（低）~10（高）的优先级映射到操作系统实际优先级上（不同操作系统有不同的优先级数量）。优先级高的线程被操作系统调度的优先级较高，操作系统对高优先级线程可能调度更频繁，但我们决不能通过设置优先级来确保高优先级的线程一定会先执行。</p>
<h3 id="线程的状态"><a href="#线程的状态" class="headerlink" title="线程的状态"></a>线程的状态</h3><p>在Java程序中，一个线程对象只能调用一次<code>start()</code>方法启动新线程，并在新线程中执行<code>run()</code>方法。一旦<code>run()</code>方法执行完毕，线程就结束了。因此，Java线程的状态有以下几种：</p>
<ul>
<li><strong>New</strong>：新创建的线程，尚未执行；</li>
<li><strong>Runnable</strong>：运行中的线程，正在执行<code>run()</code>方法的Java代码；</li>
<li><strong>Blocked</strong>：运行中的线程，因为某些操作被阻塞而挂起；</li>
<li><strong>Waiting</strong>：运行中的线程，因为某些操作在等待中；</li>
<li><strong>Timed Waiting</strong>：运行中的线程，因为执行<code>sleep()</code>方法正在计时等待；</li>
<li><strong>Terminated</strong>：线程已终止，因为<code>run()</code>方法执行完毕。</li>
</ul>
<p>用一个状态转移图表示如下：</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">         ┌─────────────┐</span><br><span class="line">         │     New     │</span><br><span class="line">         └─────────────┘</span><br><span class="line">                │</span><br><span class="line">                ▼</span><br><span class="line">┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐</span><br><span class="line">│┌─────────────┐ ┌─────────────┐│</span><br><span class="line">││  Runnable   │ │   Blocked   ││</span><br><span class="line">│└─────────────┘ └─────────────┘│</span><br><span class="line">│┌─────────────┐ ┌─────────────┐│</span><br><span class="line">││   Waiting   │ │Timed Waiting││</span><br><span class="line">│└─────────────┘ └─────────────┘│</span><br><span class="line"> ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─</span><br><span class="line">                │</span><br><span class="line">                ▼</span><br><span class="line">         ┌─────────────┐</span><br><span class="line">         │ Terminated  │</span><br><span class="line">         └─────────────┘</span><br></pre></td></tr></table></figure>

<p>当线程启动后，它可以在<code>Runnable</code>、<code>Blocked</code>、<code>Waiting</code>和<code>Timed Waiting</code>这几个状态之间切换，直到最后变成<code>Terminated</code>状态，线程终止。</p>
<p>线程终止的原因有：</p>
<ul>
<li>线程正常终止：<code>run()</code>方法执行到<code>return</code>语句返回；</li>
<li>线程意外终止：<code>run()</code>方法因为未捕获的异常导致线程终止；</li>
<li>对某个线程的<code>Thread</code>实例调用<code>stop()</code>方法强制终止（强烈不推荐使用）。</li>
</ul>
<p><strong>Join()</strong></p>
<p>一个线程还可以等待另一个线程直到其运行结束。例如，<code>main</code>线程在启动<code>t</code>线程后，可以通过<code>t.join()</code>等待<code>t</code>线程结束后再继续运行：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;start&quot;</span>);</span><br><span class="line">        t.start();</span><br><span class="line">        t.join();</span><br><span class="line">        System.out.println(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id><a href="#" class="headerlink" title></a></h3><h3 id="中断线程"><a href="#中断线程" class="headerlink" title="中断线程"></a>中断线程</h3><p>中断一个线程非常简单，只需要在其他线程中对目标线程调用<code>interrupt()</code>方法，目标线程需要反复检测自身状态是否是interrupted状态，如果是，就立刻结束运行。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        t.start();</span><br><span class="line">        Thread.sleep(<span class="number">1</span>); <span class="comment">// 暂停1毫秒</span></span><br><span class="line">        t.interrupt(); <span class="comment">// 中断t线程</span></span><br><span class="line">        t.join(); <span class="comment">// 等待t线程结束</span></span><br><span class="line">        System.out.println(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (! isInterrupted()) &#123;</span><br><span class="line">            n ++;</span><br><span class="line">            System.out.println(n + <span class="string">&quot; hello!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>仔细看上述代码，<code>main</code>线程通过调用<code>t.interrupt()</code>方法中断<code>t</code>线程，但是要注意，<code>interrupt()</code>方法仅仅向<code>t</code>线程发出了“中断请求”，至于<code>t</code>线程是否能立刻响应，要看具体代码。而<code>t</code>线程的<code>while</code>循环会检测<code>isInterrupted()</code>，所以上述代码能正确响应<code>interrupt()</code>请求，使得自身立刻结束运行<code>run()</code>方法。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">        t.start();</span><br><span class="line">        Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        t.interrupt(); <span class="comment">// 中断t线程</span></span><br><span class="line">        t.join(); <span class="comment">// 等待t线程结束</span></span><br><span class="line">        System.out.println(<span class="string">&quot;end&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">hello</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloThread</span>();</span><br><span class="line">        hello.start(); <span class="comment">// 启动hello线程</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            hello.join(); <span class="comment">// 等待hello线程结束</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;interrupted!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        hello.interrupt();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (!isInterrupted()) &#123;</span><br><span class="line">            n++;</span><br><span class="line">            System.out.println(n + <span class="string">&quot; hello!&quot;</span>);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">100</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>main</code>线程通过调用<code>t.interrupt()</code>从而通知<code>t</code>线程中断，而此时<code>t</code>线程正位于<code>hello.join()</code>的等待中，此方法会立刻结束等待并抛出<code>InterruptedException</code>。由于我们在<code>t</code>线程中捕获了<code>InterruptedException</code>，因此，就可以准备结束该线程。在<code>t</code>线程结束前，对<code>hello</code>线程也进行了<code>interrupt()</code>调用通知其中断。如果去掉这一行代码，可以发现<code>hello</code>线程仍然会继续运行，且JVM不会退出。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span>  <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">HelloThread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HelloThread</span>();</span><br><span class="line">        t.start();</span><br><span class="line">        Thread.sleep(<span class="number">1</span>);</span><br><span class="line">        t.running = <span class="literal">false</span>; <span class="comment">// 标志位置为false</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">HelloThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">running</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (running) &#123;</span><br><span class="line">            n ++;</span><br><span class="line">            System.out.println(n + <span class="string">&quot; hello!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;end!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>另一个常用的中断线程的方法是设置标志位。我们通常会用一个<code>running</code>标志位来标识线程是否应该继续运行，在外部线程中，通过把<code>HelloThread.running</code>置为<code>false</code>，就可以让线程结束</p>
<p>注意到<code>HelloThread</code>的标志位<code>boolean running</code>是一个线程间共享的变量。线程间共享变量需要使用<code>volatile</code>关键字标记，确保每个线程都能读取到更新后的变量值。</p>
<p>为什么要对线程间共享的变量用关键字<code>volatile</code>声明？这涉及到Java的内存模型。在Java虚拟机中，变量的值保存在主内存中，但是，当线程访问变量时，它会先获取一个副本，并保存在自己的工作内存中。如果线程修改了变量的值，虚拟机会在某个时刻把修改后的值回写到主内存，但是，这个时间是不确定的！</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ─ ┐</span><br><span class="line">│           Main Memory</span><br><span class="line">│                               │</span><br><span class="line">│  ┌───────┐┌───────┐┌───────┐</span><br><span class="line">│  │ var A ││ var B ││ var C │  │</span><br><span class="line">│  └───────┘└───────┘└───────┘</span><br><span class="line">│     │ ▲               │ ▲     │</span><br><span class="line"> ─ ─ ─│─│─ ─ ─ ─ ─ ─ ─ ─│─│─ ─ ─</span><br><span class="line">      │ │               │ │</span><br><span class="line">┌ ─ ─ ┼ ┼ ─ ─ ┐   ┌ ─ ─ ┼ ┼ ─ ─ ┐</span><br><span class="line">      ▼ │               ▼ │</span><br><span class="line">│  ┌───────┐  │   │  ┌───────┐  │</span><br><span class="line">   │ var A │         │ var C │</span><br><span class="line">│  └───────┘  │   │  └───────┘  │</span><br><span class="line">   Thread 1          Thread 2</span><br><span class="line">└ ─ ─ ─ ─ ─ ─ ┘   └ ─ ─ ─ ─ ─ ─ ┘</span><br></pre></td></tr></table></figure>

<p><code>volatile</code>关键字的目的是告诉虚拟机：</p>
<ul>
<li>每次访问变量时，总是获取主内存的最新值；</li>
<li>每次修改变量后，立刻回写到主内存</li>
</ul>
<p><code>volatile</code>关键字解决的是可见性问题：当一个线程修改了某个共享变量的值，其他线程能够立刻看到修改后的值。</p>
<p>如果我们去掉<code>volatile</code>关键字，运行上述程序，发现效果和带<code>volatile</code>差不多，这是因为在x86的架构下，JVM回写主内存的速度非常快，但是，换成ARM的架构，就会有显著的延迟。</p>
<h3 id="Daemon-Thread"><a href="#Daemon-Thread" class="headerlink" title="Daemon Thread"></a>Daemon Thread</h3><p>有一种线程的目的就是无限循环，例如，一个定时触发任务的线程：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TimerThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            System.out.println(LocalTime.now());</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对于这类线程，我们可以使用守护线程来结束他们</p>
<p>在JVM中，所有非守护线程都执行完毕后，无论有没有守护线程，虚拟机都会自动退出。因此，JVM退出时，不必关心守护线程是否已结束。</p>
<p>如何创建守护线程呢？方法和普通线程一样，只是在调用<code>start()</code>方法前，调用<code>setDaemon(true)</code>把该线程标记为守护线程：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">t.setDaemon(<span class="literal">true</span>);</span><br><span class="line">t.start();</span><br></pre></td></tr></table></figure>



<h3 id="Synchronized"><a href="#Synchronized" class="headerlink" title="Synchronized"></a>Synchronized</h3><p>如果多个线程同时读写共享变量，会出现数据不一致的问题。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">add</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddThread</span>();</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">dec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecThread</span>();</span><br><span class="line">        add.start();</span><br><span class="line">        dec.start();</span><br><span class="line">        add.join();</span><br><span class="line">        dec.join();</span><br><span class="line">        System.out.println(Counter.count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">   	 <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">AddThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    	<span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        	<span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123; Counter.count += <span class="number">1</span>; &#125;</span><br><span class="line">    	&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">class</span> <span class="title class_">DecThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">   	 <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">     	   <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123; Counter.count -= <span class="number">1</span>; &#125;</span><br><span class="line">    	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上面的代码每一次结果都可能不同因为没有保证代码执行的原子性</p>
<p>可见，保证一段代码的原子性就是通过加锁和解锁实现的。Java程序使用<code>synchronized</code>关键字对一个对象进行加锁：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(lock) &#123;</span><br><span class="line">    n = n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下面是使用synchoronized的一个例子，</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">var</span> <span class="variable">add</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AddThread</span>();</span><br><span class="line">        <span class="type">var</span> <span class="variable">dec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DecThread</span>();</span><br><span class="line">        add.start();</span><br><span class="line">        dec.start();</span><br><span class="line">        add.join();</span><br><span class="line">        dec.join();</span><br><span class="line">        System.out.println(Counter.count);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AddThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Counter.lock) &#123;</span><br><span class="line">                Counter.count += <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DecThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">10000</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Counter.lock) &#123;</span><br><span class="line">                Counter.count -= <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">synchronized</span>(Counter.lock) &#123; <span class="comment">// 获取锁</span></span><br><span class="line">    ...</span><br><span class="line">&#125; <span class="comment">// 释放锁</span></span><br></pre></td></tr></table></figure>

<p>这里表示使用Counter.lock这个实例作为锁，两个线程在执行各自的代码块的时候需要先获得锁，才能进行代码块执行代码，执行结束后，在sychronized修饰的代码块之后，会自动释放这个锁的资源。这样一来，对<code>Counter.count</code>变量进行读写就不可能同时进行。</p>
<p>注意不要错误的使用锁，比如对应该执行原子操作的变量使用两个锁去上锁，这样做是没用的；还有一种情况是对可以同步进行的数据进行上锁。</p>
<p>有些不需要synchronized的操作</p>
<ul>
<li>基本类型（<code>long</code>和<code>double</code>除外）赋值，例如：<code>int n = m</code>；</li>
<li>引用类型赋值，例如：<code>List&lt;String&gt; list = anotherList</code></li>
<li>对不可变对象的读写</li>
</ul>
<h3 id="Sychronized-Methods"><a href="#Sychronized-Methods" class="headerlink" title="Sychronized Methods"></a>Sychronized Methods</h3><p>让线程选择锁的对象，不如在定义对象的时候就将sychronized封装起来。例如以下的一个计数器</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">            count += n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dec</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123;</span><br><span class="line">            count -= n;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这样一来，线程调用<code>add()</code>、<code>dec()</code>方法时，它不必关心同步逻辑，因为<code>synchronized</code>代码块在<code>add()</code>、<code>dec()</code>方法内部。并且，<strong>我们注意到，<code>synchronized</code>锁住的对象是<code>this</code>，即当前实例，这又使得创建多个<code>Counter</code>实例的时候，它们之间互不影响，可以并发执行：</strong></p>
<p>如果一个类被设计为允许多线程正确访问，我们就说这个类就是“线程安全”的（thread-safe），上面的<code>Counter</code>类就是线程安全的。Java标准库的<code>java.lang.StringBuffer</code>也是线程安全的。</p>
<p>还有一些不变类，例如<code>String</code>，<code>Integer</code>，<code>LocalDate</code>，它们的所有成员变量都是<code>final</code>，多线程同时访问时只能读不能写，这些不变类也是线程安全的。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span>(<span class="built_in">this</span>) &#123; <span class="comment">// 锁住this</span></span><br><span class="line">        count += n;</span><br><span class="line">    &#125; <span class="comment">// 解锁</span></span><br><span class="line">&#125;</span><br><span class="line">等价于</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> n)</span> &#123; <span class="comment">// 锁住this</span></span><br><span class="line">    count += n;</span><br><span class="line">&#125; <span class="comment">// 解锁</span></span><br></pre></td></tr></table></figure>

<p>因此，用<code>synchronized</code>修饰的方法就是同步方法，它表示整个方法都必须用<code>this</code>实例加锁。</p>
<p>对于<code>static</code>方法，是没有<code>this</code>实例的，因为<code>static</code>方法是针对类而不是实例。但是我们注意到任何一个类都有一个由JVM自动创建的<code>Class</code>实例，因此，对<code>static</code>方法添加<code>synchronized</code>，锁住的是该类的<code>Class</code>实例。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">			&#125;</span><br><span class="line">&#125;</span><br><span class="line">等同于</span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">test</span><span class="params">(<span class="type">int</span> n)</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span>(Counter.class) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="Deadlock"><a href="#Deadlock" class="headerlink" title="Deadlock"></a>Deadlock</h3><p>JVM允许同一个线程重复获取同一个锁，这种能被同一个线程反复获取的锁，就叫做可重入锁。</p>
<p>由于Java的线程锁是可重入锁，所以，获取锁的时候，不但要判断是否是第一次获取，还要记录这是第几次获取。每获取一次锁，记录+1，每退出<code>synchronized</code>块，记录-1，减到0的时候，才会真正释放锁。</p>
<p>死锁：两个线程各自持有不同的锁，然后各自试图获取对方手里的锁，造成了双方无限等待下去，这就是死锁。</p>
<p>死锁发生后，没有任何机制能解除死锁，只能强制结束JVM进程。</p>
<p>那么我们应该如何避免死锁呢？答案是：线程获取锁的顺序要一致。即严格按照先获取<code>lockA</code>，再获取<code>lockB</code>的顺序</p>
<h3 id="Wait-and-notify"><a href="#Wait-and-notify" class="headerlink" title="Wait and notify"></a>Wait and notify</h3><p>在Java程序中，<code>synchronized</code>解决了多线程竞争的问题。例如，对于一个任务管理器，多个线程同时往队列中添加任务，可以用<code>synchronized</code>加锁：</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TaskQueue</span> &#123;</span><br><span class="line">    Queue&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addTask</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.queue.add(s);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title function_">getTask</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> queue.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Wrong!</p>
<p>When you are in the while loop, you lock ‘this’, and you can not invoke addTask</p>
<p>so add this.wait() in getTask() method.</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> String <span class="title function_">getTask</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">while</span> (queue.isEmpty()) &#123;</span><br><span class="line">        <span class="comment">// 释放this锁:</span></span><br><span class="line">        <span class="built_in">this</span>.wait();</span><br><span class="line">        <span class="comment">// 重新获取this锁</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> queue.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里的关键是：<code>wait()</code>方法必须在当前获取的锁对象上调用，这里获取的是<code>this</code>锁，因此调用<code>this.wait()</code></p>
<p> 而且必须在sychronized块中才能调用wait()方法。wait()方法调用时会释放线程获得的锁。在wait()方法返回hou，线程又会重新试图获得锁。</p>
<p>在相同的锁对象上调用<code>notify()</code>方法会让等待的线程被唤醒，然后从<code>wait()</code>方法返回。<code>notifyAll()</code>将唤醒所有当前正在<code>this</code>锁等待的线程。<code>notifyAll()</code>更安全。有些时候，如果我们的代码逻辑考虑不周，用<code>notify()</code>会导致只唤醒了一个线程，而其他线程可能永远等待下去醒不过来了。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addTask</span><span class="params">(String s)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.queue.add(s);</span><br><span class="line">    <span class="built_in">this</span>.notify(); <span class="comment">// 唤醒在this锁等待的线程</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="Design-pattern"><a href="#Design-pattern" class="headerlink" title="Design pattern"></a>Design pattern</h2><h3 id="Factory-pattern"><a href="#Factory-pattern" class="headerlink" title="Factory pattern"></a>Factory pattern</h3><p>The purpose of the factory method is to make creating and using objects separate, and the client always refers to the abstract factory and the abstract product:</p>
<p>工厂方法的目的是使得创建对象和使用对象是分离的，并且客户端总是引用抽象工厂和抽象产品：</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title>Network</title>
    <url>/2023/09/26/network/</url>
    <content><![CDATA[<h1 id="Network-review"><a href="#Network-review" class="headerlink" title="Network review"></a>Network review</h1><h2 id="Fundamental"><a href="#Fundamental" class="headerlink" title="Fundamental"></a>Fundamental</h2><h3 id="TCP-x2F-IP-Architecture"><a href="#TCP-x2F-IP-Architecture" class="headerlink" title="TCP&#x2F;IP Architecture"></a>TCP&#x2F;IP Architecture</h3><p>Application layer</p>
<p>Transimission layer</p>
<p>Network layer</p>
<p>Network Interface layer</p>
<p><img src="/../images/20230926204726040.png" alt="image-20230926204726040"></p>
<h2 id="What-happens-after-input-the-url-address"><a href="#What-happens-after-input-the-url-address" class="headerlink" title="What happens after input the url address?"></a>What happens after input the url address?</h2><p><img src="/../images/20230926220632759.png" alt="image-20230926220632759"></p>
<ol>
<li><h3 id="The-browser-will-resolve-the-URL"><a href="#The-browser-will-resolve-the-URL" class="headerlink" title="The browser will resolve the URL"></a>The browser will resolve the URL</h3></li>
</ol>
<p><img src="/../images/20230926225140347.png" alt="image-20230926225140347"></p>
<p>当没有路径名时，就代表访问根目录下事先设置的<strong>默认文件</strong>，也就是 <code>/index.html</code> 或者 <code>/default.html</code> 这些文件，这样就不会发生混乱了。</p>
<ol start="2">
<li><h3 id="生成http请求消息"><a href="#生成http请求消息" class="headerlink" title="生成http请求消息"></a>生成http请求消息</h3></li>
</ol>
<p>对 <code>URL</code> 进行解析之后，浏览器确定了 Web 服务器和文件名，接下来就是根据这些信息来生成 HTTP 请求消息了。</p>
<p><img src="/../images/20230926230201614.png" alt="image-20230926230201614"></p>
<ol start="3">
<li><h3 id="DNS-查询"><a href="#DNS-查询" class="headerlink" title="DNS 查询"></a>DNS 查询</h3></li>
</ol>
<p>通过浏览器解析 URL 并生成 HTTP 消息后，需要委托操作系统将消息发送给 <code>Web</code> 服务器。</p>
<p>但在发送之前，还有一项工作需要完成，那就是<strong>查询服务器域名对应的 IP 地址</strong>，因为委托操作系统发送消息时，必须提供通信对象的 IP 地址。</p>
<blockquote>
<p>域名的层级关系</p>
</blockquote>
<p>DNS 中的域名都是用<strong>句点</strong>来分隔的，比如 <code>www.server.com</code>，这里的句点代表了不同层次之间的<strong>界限</strong>。</p>
<p>在域名中，<strong>越靠右</strong>的位置表示其层级<strong>越高</strong>。</p>
<p>实际上域名最后还有一个点，比如 <code>www.server.com.</code>，这个最后的一个点代表根域名</p>
<p><img src="/../images/20230926232406414.png" alt="image-20230926232406414"></p>
<p>根域的 DNS 服务器信息保存在互联网中所有的 DNS 服务器中。</p>
<p>这样一来，任何 DNS 服务器就都可以找到并访问根域 DNS 服务器了。</p>
<p>因此，客户端只要能够找到任意一台 DNS 服务器，就可以通过它找到根域 DNS 服务器，然后再一路顺藤摸瓜找到位于下层的某台目标 DNS 服务器。</p>
<blockquote>
<p>域名解析的工作流程</p>
</blockquote>
<ol>
<li>客户端首先会发出一个 DNS 请求，问 <a href="http://www.server.com/">www.server.com</a> 的 IP 是啥，并发给本地 DNS 服务器（也就是客户端的 TCP&#x2F;IP 设置中填写的 DNS 服务器地址）。</li>
<li>本地域名服务器收到客户端的请求后，如果缓存里的表格能找到 <a href="http://www.server.com,则它直接返回/">www.server.com，则它直接返回</a> IP 地址。如果没有，本地 DNS 会去问它的根域名服务器：“老大， 能告诉我 <a href="http://www.server.com/">www.server.com</a> 的 IP 地址吗？” 根域名服务器是最高层次的，它不直接用于域名解析，但能指明一条道路。</li>
<li>根 DNS 收到来自本地 DNS 的请求后，发现后置是 .com，说：“<a href="http://www.server.com/">www.server.com</a> 这个域名归 .com 区域管理”，我给你 .com 顶级域名服务器地址给你，你去问问它吧。”</li>
<li>本地 DNS 收到顶级域名服务器的地址后，发起请求问“老二， 你能告诉我 <a href="http://www.server.com/">www.server.com</a> 的 IP 地址吗？”</li>
<li>顶级域名服务器说：“我给你负责 <a href="http://www.server.com/">www.server.com</a> 区域的权威 DNS 服务器的地址，你去问它应该能问到”。</li>
<li>本地 DNS 于是转向问权威 DNS 服务器：“老三，<a href="http://www.server.com对应的IP是啥呀？”">www.server.com对应的IP是啥呀？”</a> server.com 的权威 DNS 服务器，它是域名解析结果的原出处。为啥叫权威呢？就是我的域名我做主。</li>
<li>权威 DNS 服务器查询后将对应的 IP 地址 X.X.X.X 告诉本地 DNS。</li>
<li>本地 DNS 再将 IP 地址返回客户端，客户端和目标建立连接。</li>
</ol>
<p><img src="/../images/20230926232617702.png" alt="image-20230926232617702"></p>
<p>当然有缓存的存在，</p>
<p>浏览器会先看自身有没有对这个域名的缓存，如果有，就直接返回，如果没有，就去问操作系统，操作系统也会去看自己的缓存，如果有，就直接返回，如果没有，再去 hosts 文件看，也没有，才会去问「本地 DNS 服务器」。</p>
<blockquote>
<p>数据包表示：“DNS 老大哥厉害呀，找到了目的地了！我还是很迷茫呀，我要发出去，接下来我需要谁的帮助呢?”</p>
</blockquote>
<ol start="4">
<li><h3 id="Stack-protocol"><a href="#Stack-protocol" class="headerlink" title="Stack protocol"></a>Stack protocol</h3></li>
</ol>
<p>浏览器会先看自身有没有对这个域名的缓存，如果有，就直接返回，如果没有，就去问操作系统，操作系统也会去看自己的缓存，如果有，就直接返回，如果没有，再去 hosts 文件看，也没有，才会去问「本地 DNS 服务器」。</p>
<blockquote>
<p>数据包表示：“DNS 老大哥厉害呀，找到了目的地了！我还是很迷茫呀，我要发出去，接下来我需要谁的帮助呢?”</p>
</blockquote>
<h4 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h4><p><img src="/../images/20230927095406195.png" alt="image-20230927095406195"></p>
<p>首先，<strong>源端口号</strong>和<strong>目标端口</strong>号是不可少的，如果没有这两个端口号，数据就不知道应该发给哪个应用。</p>
<p>接下来有包的<strong>序</strong>号，这个是为了解决包乱序的问题。</p>
<p>还有应该有的是<strong>确认号</strong>，目的是确认发出去对方是否有收到。如果没有收到就应该重新发送，直到送达，这个是为了解决丢包的问题。</p>
<p>接下来还有一些<strong>状态位</strong>。例如 <code>SYN</code> 是发起一个连接，<code>ACK</code> 是回复，<code>RST</code> 是重新连接，<code>FIN</code> 是结束连接等。TCP 是面向连接的，因而双方要维护连接的状态，这些带状态位的包的发送，会引起双方的状态变更。</p>
<p>还有一个重要的就是<strong>窗口大小</strong>。TCP 要做<strong>流量控制</strong>，通信双方各声明一个窗口（缓存大小），标识自己当前能够的处理能力，别发送的太快，撑死我，也别发的太慢，饿死我。</p>
<p>除了做流量控制以外，TCP还会做<strong>拥塞控制</strong>，对于真正的通路堵车不堵车，它无能为力，唯一能做的就是控制自己，也即控制发送的速度。不能改变世界，就改变自己嘛。</p>
<blockquote>
<p>TCP 传输数据之前，要先三次握手建立连接</p>
</blockquote>
<p>在 HTTP 传输数据之前，首先需要 TCP 建立连接，TCP 连接的建立，通常称为<strong>三次握手</strong>。</p>
<p>这个所谓的「连接」，只是双方计算机里维护一个状态机，在连接建立的过程中，双方的状态变化时序图就像这样。</p>
<p><img src="/../images/20230927095600953.png" alt="image-20230927095600953"></p>
<ul>
<li>一开始，客户端和服务端都处于 <code>CLOSED</code> 状态。先是服务端主动监听某个端口，处于 <code>LISTEN</code> 状态。</li>
<li>然后客户端主动发起连接 <code>SYN</code>，之后处于 <code>SYN-SENT</code> 状态。</li>
<li>服务端收到发起的连接，返回 <code>SYN</code>，并且 <code>ACK</code> 客户端的 <code>SYN</code>，之后处于 <code>SYN-RCVD</code> 状态。</li>
<li>客户端收到服务端发送的 <code>SYN</code> 和 <code>ACK</code> 之后，发送对 <code>SYN</code> 确认的 <code>ACK</code>，之后处于 <code>ESTABLISHED</code> 状态，因为它一发一收成功了。</li>
<li>服务端收到 <code>ACK</code> 的 <code>ACK</code> 之后，处于 <code>ESTABLISHED</code> 状态，因为它也一发一收了。</li>
</ul>
<blockquote>
<p>如何查看 TCP 的连接状态？</p>
</blockquote>
<p>TCP 的连接状态查看，在 Linux 可以通过 <code>netstat -napt</code> 命令查看。</p>
<h4 id="IP"><a href="#IP" class="headerlink" title="IP"></a>IP</h4><p><img src="/../images/14.jpg" alt="IP 包头格式"></p>
<p>在 IP 协议里面需要有<strong>源地址 IP</strong> 和 <strong>目标地址 IP</strong>：</p>
<ul>
<li>源地址IP，即是客户端输出的 IP 地址；</li>
<li>目标地址，即通过 DNS 域名解析得到的 Web 服务器 IP。</li>
</ul>
<p>因为 HTTP 是经过 TCP 传输的，所以在 IP 包头的<strong>协议号</strong>，要填写为 <code>06</code>（十六进制），表示协议为 TCP。</p>
<blockquote>
<p>假设客户端有多个网卡，就会有多个 IP 地址，那 IP 头部的源地址应该选择哪个 IP 呢？</p>
</blockquote>
<p>当存在多个网卡时，在填写源地址 IP 时，就需要判断到底应该填写哪个地址。这个判断相当于在多块网卡中判断应该使用哪个一块网卡来发送包。</p>
<p>这个时候就需要根据<strong>路由表</strong>规则，来判断哪一个网卡作为源地址 IP。</p>
<p>在 Linux 操作系统，我们可以使用 <code>route -n</code> 命令查看当前系统的路由表。</p>
<p>举个例子，根据上面的路由表，我们假设 Web 服务器的目标地址是 <code>192.168.10.200</code>。</p>
<p><img src="/../images/16.jpg" alt="路由规则判断"></p>
<ol>
<li>首先先和第一条目的子网掩码（<code>Genmask</code>）进行 <strong>与运算</strong>，得到结果为 <code>192.168.10.0</code>，但是第一个条目的 <code>Destination</code> 是 <code>192.168.3.0</code>，两者不一致所以匹配失败。</li>
<li>再与第二条目的子网掩码进行 <strong>与运算</strong>，得到的结果为 <code>192.168.10.0</code>，与第二条目的 <code>Destination 192.168.10.0</code> 匹配成功，所以将使用 <code>eth1</code> 网卡的 IP 地址作为 IP 包头的源地址。</li>
</ol>
<p>那么假设 Web 服务器的目标地址是 <code>10.100.20.100</code>，那么依然依照上面的路由表规则判断，判断后的结果是和第三条目匹配。</p>
<p>第三条目比较特殊，它目标地址和子网掩码都是 <code>0.0.0.0</code>，这表示<strong>默认网关</strong>，如果其他所有条目都无法匹配，就会自动匹配这一行。并且后续就把包发给路由器，<code>Gateway</code> 即是路由器的 IP 地址。</p>
<h4 id="MAC"><a href="#MAC" class="headerlink" title="MAC"></a>MAC</h4><p>MAC 头部是以太网使用的头部，它包含了接收方和发送方的 MAC 地址等信息。</p>
<p>在 MAC 包头里需要<strong>发送方 MAC 地址</strong>和<strong>接收方目标 MAC 地址</strong>，用于<strong>两点之间的传输</strong>。</p>
<p>一般在 TCP&#x2F;IP 通信里，MAC 包头的<strong>协议类型</strong>只使用：</p>
<ul>
<li><code>0800</code> ： IP 协议</li>
<li><code>0806</code> ： ARP 协议</li>
</ul>
<blockquote>
<p>MAC 发送方和接收方如何确认?</p>
</blockquote>
<p><strong>发送方</strong>的 MAC 地址获取就比较简单了，MAC 地址是在网卡生产时写入到 ROM 里的，只要将这个值读取出来写入到 MAC 头部就可以了。</p>
<p><strong>接收方</strong>的 MAC 地址就有点复杂了，只要告诉以太网对方的 MAC 的地址，以太网就会帮我们把包发送过去，那么很显然这里应该填写对方的 MAC 地址。</p>
<p>所以先得搞清楚应该把包发给谁，这个只要查一下<strong>路由表</strong>就知道了。在路由表中找到相匹配的条目，然后把包发给 <code>Gateway</code> 列中的 IP 地址就可以了。</p>
<blockquote>
<p>既然知道要发给谁，按如何获取对方的 MAC 地址呢？</p>
</blockquote>
<p>不知道对方 MAC 地址？不知道就喊呗。</p>
<p>此时就需要 <code>ARP</code> 协议帮我们找到路由器的 MAC 地址。</p>
<p>ARP 协议会在以太网中以<strong>广播</strong>的形式，对以太网所有的设备喊出：“这个 IP 地址是谁的？请把你的 MAC 地址告诉我”。</p>
<p>然后就会有人回答：“这个 IP 地址是我的，我的 MAC 地址是 XXXX”。</p>
<p>如果对方和自己处于同一个子网中，那么通过上面的操作就可以得到对方的 MAC 地址。然后，我们将这个 MAC 地址写入 MAC 头部，MAC 头部就完成了。</p>
<blockquote>
<p>好像每次都要广播获取，这不是很麻烦吗？</p>
</blockquote>
<p>放心，在后续操作系统会把本次查询结果放到一块叫做 <strong>ARP 缓存</strong>的内存空间留着以后用，不过缓存的时间就几分钟。</p>
<p>也就是说，在发包时：</p>
<ul>
<li>先查询 ARP 缓存，如果其中已经保存了对方的 MAC 地址，就不需要发送 ARP 查询，直接使用 ARP 缓存中的地址。</li>
<li>而当 ARP 缓存中不存在对方 MAC 地址时，则发送 ARP 广播查询。</li>
</ul>
<blockquote>
<p>在 Linux 系统中，我们可以使用 <code>arp -a</code> 命令来查看 ARP 缓存的内容。</p>
</blockquote>
<p><img src="/../images/20.jpg" alt="ARP 缓存内容"></p>
<blockquote>
<p>MAC 报文生成</p>
</blockquote>
<p>至此，网络包的报文如下图。</p>
<p><img src="/../images/21.jpg" alt="MAC 层报文"></p>
<h4 id="网卡NIC-Network-Interface-Card-99"><a href="#网卡NIC-Network-Interface-Card-99" class="headerlink" title="网卡NIC (Network Interface Card)99"></a>网卡NIC (Network Interface Card)99</h4><p><strong>Function</strong>:</p>
<p>Convert the digital information into electrical signal. </p>
<p>NIC need the help with NIC drive</p>
<p>NIC drive</p>
<p>网卡驱动获取网络包之后，会将其<strong>复制</strong>到网卡内的缓存区中，接着会在其<strong>开头加上报头和起始帧分界符，在末尾加上用于检测错误的帧校验序列</strong>。</p>
<h4 id="Switch"><a href="#Switch" class="headerlink" title="Switch"></a>Switch</h4><p>首先，电信号到达网线接口，交换机里的模块进行接收，接下来交换机里的模块将电信号转换为数字信号。</p>
<p>然后通过packet末尾的 <code>FCS</code> 校验错误，如果没问题则放到缓冲区。这部分操作基本和计算机的网卡相同，但交换机的工作方式和网卡不同。</p>
<p>相对地，交换机的端口不核对接收方 MAC 地址，而是直接接收所有的包并存放到缓冲区中。因此，和网卡不同，<strong>交换机的端口不具有 MAC 地址</strong>（注意是端口没有）。</p>
<p>将包存入缓冲区后，接下来需要查询一下这个包的接收方 MAC 地址是否已经在交换机的 MAC 地址表中有记录了。（交换机的mac地址表主要有设备的mac地址，然后还有设备与交换机连接的端口号）</p>
<h3 id="Router"><a href="#Router" class="headerlink" title="Router"></a>Router</h3><p>网络包经过交换机之后，现在到达了<strong>路由器</strong>，并在此被转发到下一个路由器或目标设备。</p>
<p>这一步转发的工作原理和交换机类似，也是通过查表判断包转发的目标。</p>
<p>不过在具体的操作过程上，路由器和交换机是有区别的。</p>
<ul>
<li>因为<strong>路由器</strong>是基于 IP 设计的，俗称<strong>三层</strong>网络设备，路由器的各个端口都具有 MAC 地址和 IP 地址；</li>
<li>而<strong>交换机</strong>是基于以太网设计的，俗称<strong>二层</strong>网络设备，交换机的端口不具有 MAC 地址。</li>
</ul>
<p><strong>路由器的原理</strong></p>
<p>路由器的端口具有 MAC 地址，因此它就能够成为以太网的发送方和接收方；同时还具有 IP 地址，从这个意义上来说，它和计算机的网卡是一样的。</p>
<p>当转发包时，首先路由器端口会接收发给自己的以太网包，然后<strong>路由表</strong>查询转发目标，再由相应的端口作为发送方将以太网包发送出去。</p>
<p><strong>路由器的包接收</strong></p>
<p>首先，电信号到达网线接口部分，路由器中的模块会将电信号转成数字信号，然后通过包末尾的 <code>FCS</code> 进行错误校验。</p>
<p>如果没问题则检查 MAC 头部中的<strong>接收方 MAC 地址</strong>，看看是不是发给自己的包，如果是就放到接收缓冲区中，否则就丢弃这个包。</p>
<p>总的来说，路由器的端口都具有 MAC 地址，只接收与自身地址匹配的包，遇到不匹配的包则直接丢弃。</p>
<p><strong>查询路由表确定输出端口</strong></p>
<p>完成包接收操作之后，路由器就会<strong>去掉</strong>包开头的 MAC 头部。</p>
<p><strong>MAC 头部的作用就是将包送达路由器</strong>，其中的接收方 MAC 地址就是路由器端口的 MAC 地址。因此，当包到达路由器之后，MAC 头部的任务就完成了，于是 MAC 头部就会<strong>被丢弃</strong>。</p>
<p>接下来，路由器会根据 MAC 头部后方的 <code>IP</code> 头部中的内容进行包的转发操作。</p>
<p>转发操作分为几个阶段，</p>
<p><strong>首先是查询路由表判断转发目标。（建立路由）</strong></p>
<p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/%E9%94%AE%E5%85%A5%E7%BD%91%E5%9D%80%E8%BF%87%E7%A8%8B/24.jpg" alt="路由器转发"></p>
<p>假设地址为 <code>10.10.1.101</code> 的计算机要向地址为 <code>192.168.1.100</code> 的服务器发送一个包，这个包先到达图中的路由器。</p>
<p>判断转发目标的第一步，就是根据包的接收方 IP 地址查询路由表中的目标地址栏，以找到相匹配的记录。</p>
<p>路由匹配和前面讲的一样，每个条目的子网掩码和 <code>192.168.1.100</code> IP 做 <strong>&amp; 与运算</strong>后，得到的结果与对应条目的目标地址进行匹配，如果匹配就会作为候选转发目标，如果不匹配就继续与下个条目进行路由匹配。</p>
<p>如第二条目的子网掩码 <code>255.255.255.0</code> 与 <code>192.168.1.100</code> IP 做 <strong>&amp; 与运算</strong>后，得到结果是 <code>192.168.1.0</code> ，这与第二条目的目标地址 <code>192.168.1.0</code> 匹配，该第二条目记录就会被作为转发目标。</p>
<p>实在找不到匹配路由时，就会选择<strong>默认路由</strong>，路由表中子网掩码为 <code>0.0.0.0</code> 的记录表示「默认路由」。</p>
<p><strong>路由器的发送操作</strong></p>
<p>首先，我们需要根据<strong>路由表的网关列</strong>判断对方的地址。</p>
<ul>
<li>如果网关是一个 IP 地址，则这个IP 地址就是我们要转发到的目标地址，<strong>还未抵达终点</strong>，还需继续需要路由器转发。</li>
<li>如果网关为空，则 IP 头部中的接收方 IP 地址就是要转发到的目标地址，也是就终于找到 IP 包头里的目标地址了，说明<strong>已抵达终点</strong>。</li>
</ul>
<p>知道对方的 IP 地址之后，接下来需要通过 <code>ARP</code> 协议根据 IP 地址查询 MAC 地址，并将查询的结果作为接收方 MAC 地址。</p>
<p>路由器也有 ARP 缓存，因此首先会在 ARP 缓存中查询，如果找不到则发送 ARP 查询请求。</p>
<p>接下来是发送方 MAC 地址字段，这里填写输出端口的 MAC 地址。还有一个以太类型字段，填写 <code>0800</code> （十六进制）表示 IP 协议。</p>
<p>网络包完成后，接下来会将其转换成电信号并通过端口发送出去。这一步的工作过程和计算机也是相同的。</p>
<p>发送出去的网络包会通过<strong>交换机</strong>到达下一个路由器。由于接收方 MAC 地址就是下一个路由器的地址，所以交换机会根据这一地址将包传输到下一个路由器。</p>
<p>接下来，下一个路由器会将包转发给再下一个路由器，经过层层转发之后，网络包就到达了最终的目的地。</p>
<p>不知你发现了没有，在网络包传输的过程中，<strong>源 IP 和目标 IP 始终是不会变的，一直变化的是 MAC 地址</strong>，因为需要 MAC 地址在以太网内进行<strong>两个设备</strong>之间的包传输。</p>
<h3 id="OSI-Open-System-Interconnection-Reference-Model"><a href="#OSI-Open-System-Interconnection-Reference-Model" class="headerlink" title="OSI(Open System Interconnection Reference Model)"></a>OSI(<em>Open System Interconnection Reference Model</em>)</h3><p>为了使得多种设备能通过网络相互通信，和为了解决各种不同设备在网络互联中的兼容性问题，国际标准化组织制定了开放式系统互联通信参考模型（<em>Open System Interconnection Reference Model</em>），也就是 OSI 网络模型，该模型主要有 7 层，分别是应用层、表示层、会话层、传输层、网络层、数据链路层以及物理层。</p>
<p>每一层负责的职能都不同，如下：</p>
<ul>
<li>应用层，负责给应用程序提供统一的接口；</li>
<li>表示层，负责把数据转换成兼容另一个系统能识别的格式；</li>
<li>会话层，负责建立、管理和终止表示层实体之间的通信会话；</li>
<li>传输层，负责端到端的数据传输；</li>
<li>网络层，负责数据的路由、转发、分片；</li>
<li>数据链路层，负责数据的封帧和差错检测，以及 MAC 寻址；</li>
<li>物理层，负责在物理网络中传输数据帧；</li>
</ul>
<p>由于 OSI 模型实在太复杂，提出的也只是概念理论上的分层，<strong>并没有提供具体的实现方案</strong>。</p>
<p>事实上，我们比较常见，也比较实用的是四层模型，即 TCP&#x2F;IP 网络模型，Linux 系统正是按照这套网络模型来实现网络协议栈的。</p>
<p>TCP&#x2F;IP 网络模型共有 4 层，分别是应用层、传输层、网络层和网络接口层，每一层负责的职能如下：</p>
<ul>
<li>应用层，负责向用户提供一组应用程序，比如 HTTP、DNS、FTP 等;</li>
<li>传输层，负责端到端的通信，比如 TCP、UDP 等；</li>
<li>网络层，负责网络包的封装、分片、路由、转发，比如 IP、ICMP 等；</li>
<li>网络接口层，负责网络包在物理网络中的传输，比如网络包的封帧、 MAC 寻址、差错检测，以及通过网卡传输网络帧等；</li>
</ul>
<p><img src="/../images/OSI_TCP.webp" alt="MAC 层报文"></p>
<h3 id="Linux-Network-Protocol-Stack"><a href="#Linux-Network-Protocol-Stack" class="headerlink" title="Linux Network Protocol Stack"></a>Linux Network Protocol Stack</h3><p><img src="https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost3@main/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%B5%AE%E7%82%B9/%E5%B0%81%E8%A3%85.png" alt="img"></p>
<p>以太网中，规定了最大传输单元（MTU）是 <code>1500</code> 字节，也就是规定了单次传输的最大 IP 包大小。</p>
]]></content>
      <categories>
        <category>Tech</category>
      </categories>
      <tags>
        <tag>tech</tag>
      </tags>
  </entry>
  <entry>
    <title>webscience</title>
    <url>/2023/04/28/webscience/</url>
    <content><![CDATA[<h1 id="Revision"><a href="#Revision" class="headerlink" title="Revision"></a>Revision</h1><h2 id="Topic-1-Social-Media-Twitter-Crawl"><a href="#Topic-1-Social-Media-Twitter-Crawl" class="headerlink" title="Topic 1- Social Media (Twitter) Crawl"></a>Topic 1- Social Media (Twitter) Crawl</h2><h3 id="L1-TwitterData"><a href="#L1-TwitterData" class="headerlink" title="L1 TwitterData"></a>L1 TwitterData</h3><h4 id="Exploitation-of-the-twitter-data"><a href="#Exploitation-of-the-twitter-data" class="headerlink" title="Exploitation of the twitter data:"></a>Exploitation of the twitter data:</h4><p>With the amount of content posted to social media websites every day, such as Twitter, there is huge potential for its exploitation in many scenarios, such as:</p>
<p><strong>Sports and Finance:</strong> Stock market prediction &amp; Sports betting</p>
<p>predict stock market changes based on the sentiment of tweets</p>
<ul>
<li>Sentiment expressed in tweets had been used to predict stock market reactions</li>
<li>Opinions of investors’ posts on social media</li>
<li>combine with the stock prize movements</li>
</ul>
<p>Sports betting</p>
<h4 id="Web-Science-Concepts"><a href="#Web-Science-Concepts" class="headerlink" title="Web Science Concepts"></a>Web Science Concepts</h4><ul>
<li><p>﻿﻿Explore the science underlying the web</p>
<ul>
<li>﻿﻿From a socio-technical perspective</li>
<li>﻿﻿Mathematical properties, engineering principles, social impacts</li>
</ul>
</li>
<li><p>﻿﻿Understanding users and developing Web applications for them!</p>
<ul>
<li>﻿﻿Sociology &amp; Web Engineering</li>
</ul>
</li>
<li><p>﻿﻿Consulting corporations about social media activities</p>
<ul>
<li>﻿﻿Economics &amp; Web analvtics</li>
<li>﻿﻿For example, role of micro influencers on local economy</li>
<li>﻿﻿How much hate a brand page generates due to some comments, ….</li>
</ul>
</li>
<li><p>﻿﻿Data analvtics</p>
<ul>
<li>﻿﻿Growth of information; structured and unstructured</li>
<li>﻿﻿Intersection of networks &amp; data</li>
</ul>
</li>
<li><p>Broble mew technologies to scientists and engineers working together on large scale</p>
</li>
</ul>
<h3 id="L2-DataClustering"><a href="#L2-DataClustering" class="headerlink" title="L2 DataClustering"></a>L2 DataClustering</h3><h4 id="Content-processing"><a href="#Content-processing" class="headerlink" title="Content processing"></a>Content processing</h4><h4 id="1-Removing-stuff"><a href="#1-Removing-stuff" class="headerlink" title="1. Removing stuff"></a>1. Removing stuff</h4><ul>
<li>Non-ascii removal</li>
</ul>
<p>remove the emoji…</p>
<p><img src="/../images/webs/20230429103013009.png" alt="image-20230429103013009"></p>
<h4 id="2-Grouping-tweets"><a href="#2-Grouping-tweets" class="headerlink" title="2. Grouping tweets"></a>2. Grouping tweets</h4><ul>
<li>﻿﻿Based on content analysis like<ul>
<li>﻿﻿Clustering, locality sensitive hashing</li>
<li>﻿﻿Or through content indexes</li>
</ul>
</li>
<li>﻿﻿Once we know the groups<ul>
<li>﻿﻿We could analyse the words, user mentions, hashtags in these groups</li>
<li>﻿﻿We can add these terms to a list with a priority</li>
<li>﻿﻿This is possibly for identifying more tweets of this type<ul>
<li>﻿﻿Aim is data gathering</li>
</ul>
</li>
</ul>
</li>
<li>﻿﻿We can also look at proficient tweeters<ul>
<li>﻿﻿What are their total tweets</li>
</ul>
</li>
</ul>
<h4 id="3-Tokenization"><a href="#3-Tokenization" class="headerlink" title="3. Tokenization"></a>3. Tokenization</h4><p>Separate each token</p>
<p>Remove stopwords</p>
<h4 id="4-Vector-Representation"><a href="#4-Vector-Representation" class="headerlink" title="4. Vector Representation"></a>4. Vector Representation</h4><p>Documents are represented by a term vector</p>
<p><em>Di</em> &#x3D; (ti1,ti2 ,….,tin )</p>
<p>Queries are represented by a similar vector</p>
<p>• In binary scheme, tik is set to 1 when term k is present in Document i otherwise they are set to zero</p>
<ul>
<li>The most relevant documents for a query are expected to be those represented by the vectors closest to the query, that is documents that use similar words to the query.</li>
<li>﻿﻿Closeness is often calculated by just looking at angles between document vector and query vector</li>
<li>﻿﻿We need a similarity measure!<ul>
<li>Cosine similarity measure</li>
<li>Jaccard coefficient</li>
<li>Dice coefficient</li>
</ul>
</li>
</ul>
<h4 id="Finding-similar-tweets-Single-pass-clustering"><a href="#Finding-similar-tweets-Single-pass-clustering" class="headerlink" title="Finding similar tweets Single-pass clustering"></a>Finding similar tweets Single-pass clustering</h4><p><strong>Single-pass clustering</strong></p>
<ul>
<li><p>requires a single, sequential pass over the set of documents it attempts to cluster.</p>
</li>
<li><h4 id="The-algorithm-classifies-the-next-document-in-the-sequence-according-to-a-condition-on-the-similarity-function-employed"><a href="#The-algorithm-classifies-the-next-document-in-the-sequence-according-to-a-condition-on-the-similarity-function-employed" class="headerlink" title="The algorithm classifies the next document in the sequence according to a condition on the similarity function employed."></a>The algorithm classifies the next document in the sequence according to a condition on the similarity function employed.</h4></li>
<li><p>At every stage, <strong>the algorithm decides on whether a newly seen document should become a member of an already defined cluster or the centre of a new one.</strong></p>
<ul>
<li>In its most simple form, the similarity function gets defined on the basis of just some similarity (or alternatively, dissimilarity) measure between document-feature vectors.</li>
</ul>
</li>
</ul>
<p><img src="/../images/webs/20230429121645868.png" alt="image-20230429121645868"></p>
<p>Comments on Single Pass Method</p>
<ul>
<li>﻿﻿The single pass method is particularly simple<ul>
<li>﻿﻿since it requires that the data set be processed only once.</li>
</ul>
</li>
<li>﻿﻿Obviously, the results for this method are highly dependent on the similarity threshold that is used.</li>
<li>﻿﻿It tends to produce large clusters early in the clustering pass,<ul>
<li>﻿﻿and because the clusters formed are not independent of the order in which the data set is processed.</li>
<li>﻿﻿You should use your judgment in setting this threshold so that you are left with a reasonable number of clusters.</li>
</ul>
</li>
<li>﻿﻿It is sometimes used to form the groups that are used to initiate reallocation clustering.<ul>
<li>﻿﻿If we get a large noisy clusters of tweets, we could re-cluster them!!!</li>
</ul>
</li>
</ul>
<h3 id="L3-Credibility-amp-Newsworthiness"><a href="#L3-Credibility-amp-Newsworthiness" class="headerlink" title="L3 Credibility &amp; Newsworthiness"></a>L3 Credibility &amp; Newsworthiness</h3><h4 id="Newsworthy"><a href="#Newsworthy" class="headerlink" title="Newsworthy"></a><strong>Newsworthy</strong></h4><p>Key characteristics of newsworthy score</p>
<ul>
<li>﻿﻿Real-time<ul>
<li>﻿﻿Tweets should be scored as soon as it arrives!</li>
</ul>
</li>
<li>﻿﻿Generalizability<ul>
<li>﻿﻿Should be able to handle any types of events - not those just seen before</li>
</ul>
</li>
<li>﻿﻿Adaptive<ul>
<li>﻿﻿New information to be incorporated, as and when they arrive</li>
<li>﻿﻿Incorporate new information to the scoring model</li>
</ul>
</li>
</ul>
<p>These characteristics should be realized with the help of <strong>classification approach</strong> and <strong>distant supervision</strong>.</p>
<h4 id="HeurisIc-Labelling"><a href="#HeurisIc-Labelling" class="headerlink" title="HeurisIc Labelling"></a><strong>HeurisIc Labelling</strong></h4><ul>
<li>﻿﻿Semi-automatic labelling approach<ul>
<li>﻿﻿Using a set of heuristics to label<ul>
<li>﻿﻿High quality (newsworthy) and low quality (noisy) content</li>
</ul>
</li>
</ul>
</li>
<li>﻿﻿This will not label majority of the content</li>
<li>﻿﻿Advantages<ul>
<li>﻿﻿Minimal effort in creating a data set</li>
<li>﻿﻿Real-life data set - incremental and generalizable</li>
<li>﻿﻿Easily built as part of an algorithm for example event detection</li>
</ul>
</li>
</ul>
<p><strong>Overall approach</strong></p>
<ul>
<li><p>Collect a set of high-quality sets and low-quality sets of data</p>
</li>
<li><p>Use this dataset to potentially score a newsworthy tweet</p>
</li>
</ul>
<h4 id="Quality-Score"><a href="#Quality-Score" class="headerlink" title="Quality Score"></a>Quality Score</h4><p>Quality Score &#x3D; (profileWeight + verifiedWeight + followers Weight + accountAgeWeight + descriptionWeight)&#x2F;5</p>
<p>Range is [0 to 1]</p>
<p>if q score is higher than 0.65 -&gt; high quality </p>
<p>if q score is lower than 0.45 -&gt; low quality</p>
<h4 id="Scoring-model"><a href="#Scoring-model" class="headerlink" title="Scoring model"></a>Scoring model</h4><p>Likelihood ratio for each term</p>
<ul>
<li>﻿﻿R(t) &#x3D; relative importance of term in the particular quality model when compared to random background model</li>
<li>﻿﻿&gt;1<ul>
<li>﻿Term is more common in the model than random</li>
</ul>
</li>
<li>﻿﻿&lt;1<ul>
<li>﻿﻿Term is less common in the model than random</li>
</ul>
</li>
</ul>
<p><img src="/../images/webs/20230429134512747.png" alt="image-20230429134512747"></p>
<p><strong>cntd</strong></p>
<p>if RHQ(t)&lt;2 or RLQ(t)&lt;2 then the Score will be set 0 as to remove the terms which have no clear association with either high quality content or low-quality content.</p>
<p><img src="/../images/webs/20230429134931099.png" alt="image-20230429134931099"></p>
<h3 id="L4-Geo-localisation"><a href="#L4-Geo-localisation" class="headerlink" title="L4-Geo-localisation"></a>L4-Geo-localisation</h3><h4 id="Fine-grained-localization"><a href="#Fine-grained-localization" class="headerlink" title="Fine-grained localization"></a>Fine-grained localization</h4><p>Fine-grained localization refers to the task of accurately localizing objects or entities within an image or a video with high precision, usually at a sub-pixel or sub-object level. This involves identifying the precise location of the object, as well as any associated attributes such as shape, texture, and color.</p>
<p>The goal of fine-grained localization is to provide more detailed and accurate information about the location and properties of objects in an image, which can be useful for a range of applications such as object tracking, object recognition, and scene understanding.</p>
<p>Fine-grained localization can be challenging due to the variability in object appearance, pose, and scale. To overcome these challenges, various techniques such as deep learning and computer vision algorithms have been developed.</p>
<p>Examples of fine-grained localization tasks include localizing individual bird species in a bird-watching image, identifying specific car models in a crowded parking lot, or detecting the presence of a particular species of fish in an underwater video.</p>
<p><strong>Problem statement</strong></p>
<ul>
<li>﻿﻿Geo-localization<ul>
<li>﻿﻿Provide location estimates for individual tweets</li>
</ul>
</li>
<li>﻿﻿coarse-grained Geo-localization<ul>
<li>﻿﻿Provide location estimates for individual tweets at regional or country level</li>
</ul>
</li>
<li>﻿﻿fine-grained Geo-localization<ul>
<li>﻿﻿Provide location estimates for individual tweets at city or neighbourhood level</li>
</ul>
</li>
<li>﻿﻿Approach<ul>
<li>﻿﻿Train a model on a geo-tagged data set<ul>
<li>﻿﻿Validate and test on geo-tagged data</li>
<li>﻿﻿Test on non-geo tagged data as well</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="Topic3-Topic-modelling"><a href="#Topic3-Topic-modelling" class="headerlink" title="Topic3 Topic modelling"></a>Topic3 Topic modelling</h2><h3 id="Topic-modelling"><a href="#Topic-modelling" class="headerlink" title="Topic modelling"></a>Topic modelling</h3><h4 id="Discuss-why-searching-is-limited-when-exploring-a-collection"><a href="#Discuss-why-searching-is-limited-when-exploring-a-collection" class="headerlink" title="Discuss why searching is limited when exploring a collection"></a><strong>Discuss why searching is limited when exploring a collection</strong></h4><p>When exploring a collection, searching can be limited by various factors such as the completeness and accuracy of the metadata, the complexity of the query, and the quality of the search algorithm.</p>
<p>Firstly, the completeness and accuracy of the metadata associated with each item in the collection can limit the effectiveness of searching. If the metadata is incomplete or inconsistent, important information about an item may not be captured, making it difficult or impossible to find through search queries.</p>
<p>Secondly, the complexity of the search query can also limit the effectiveness of searching. For example, if a user is looking for items that have multiple attributes or characteristics, such as a specific color and shape, the search query may become too complex and difficult to execute accurately.</p>
<p>Finally, the quality of the search algorithm used to explore the collection can also limit the effectiveness of searching. If the algorithm is not designed to handle the specific characteristics of the collection or the query, it may return irrelevant or incomplete results.</p>
<p>To overcome these limitations, various techniques can be employed such as using natural language processing to simplify complex search queries, improving the quality and completeness of metadata through manual curation or machine learning techniques, and using advanced search algorithms that take into account the specific characteristics of the collection and query.</p>
<p>Topic modelling is the process of using a topic model to discover the <strong>hidden topics</strong> that are represented by a large collection of documents</p>
<ul>
<li><p>Observed</p>
<ul>
<li><p>﻿﻿collection</p>
</li>
<li><p>﻿﻿Document &amp; words</p>
</li>
</ul>
</li>
<li><p>﻿﻿Aim</p>
<ul>
<li>﻿﻿Use the observed information to infer<ul>
<li>﻿﻿Hidden structure</li>
</ul>
</li>
</ul>
</li>
<li><p>﻿﻿Topic structure - hidden</p>
<ul>
<li>﻿﻿per document topic distributions</li>
<li>﻿﻿Per document per-word topic assignments<ul>
<li>﻿﻿Annotation…</li>
<li>﻿﻿Can be used for retrieval, classification, browsing?</li>
</ul>
</li>
</ul>
</li>
<li><p>﻿﻿Utility</p>
<ul>
<li>﻿﻿Inferred hidden structure resembles the thematic structure of the collection</li>
</ul>
</li>
</ul>
<p><strong>latent</strong></p>
<p>(of a quality or state) existing but not yet developed or manifest hidden or concealed.;</p>
<p>Topic modelling </p>
<ul>
<li>A machine learning approach for Mining latent topics</li>
</ul>
<p>Identify hidden, gigantic structures</p>
<p>Probabilistic topic models</p>
<ul>
<li>a suite of algorithms that aim to discover and annotate large archives of documents of thematic information</li>
</ul>
<h4 id="Our-goal-in-topic-modelling"><a href="#Our-goal-in-topic-modelling" class="headerlink" title="Our goal in topic modelling"></a>Our goal in topic modelling</h4><ul>
<li>﻿﻿The goal of topic modeling is to automatically discover the topics in a collection of documents</li>
<li>﻿﻿Documents are observed<ul>
<li>﻿﻿Topics, per-document and per-word topic assignments - hidden</li>
<li>﻿﻿Hence latent!</li>
</ul>
</li>
<li>﻿﻿The central computation problem for topic modelling is to use the observed documents to infer hidden topic structure</li>
<li>﻿﻿Think it as reversing the generative process<ul>
<li>﻿﻿What is the hidden structure that likely generated the observed collection?</li>
</ul>
</li>
</ul>
<h4 id="LDA-Latent-Dirichlet-Allocation"><a href="#LDA-Latent-Dirichlet-Allocation" class="headerlink" title="LDA (Latent Dirichlet Allocation)"></a>LDA (Latent Dirichlet Allocation)</h4><ul>
<li><p>﻿﻿Is a statistical model of document collections that tries to capture the intuition<br> Each document can be described by a distribution of topics and each topic can be described by a distribution of words</p>
</li>
<li><p>﻿﻿Topic</p>
<ul>
<li><p>﻿﻿Defined as a distribution over the words&#x2F; fixed vocabulary</p>
<ul>
<li><p>E.g., genetic topic has words about genetics (sequenced, genes) with high probability</p>
</li>
<li><p>﻿﻿Evolutionary biology has words like life, organism with high probability</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Topic-Modelling-Approaches"><a href="#Topic-Modelling-Approaches" class="headerlink" title="Topic Modelling Approaches"></a>Topic Modelling Approaches</h4><ul>
<li>Number of possible topic structures is exponentially large</li>
<li>Approximate the posterior distribution</li>
<li>Topic modelling algorithms form an approximation of equation, <ul>
<li>by adapting an alternative distribution over latent topic structure to be close to the true posterior</li>
</ul>
</li>
</ul>
<p>Two approaches:</p>
<p><strong>1. Sampling based!</strong></p>
<p>Attempt to collect samples from the posterior to approximate it with an empirical distribution <strong>– Gibbs sampling!</strong></p>
<p><strong>2. Variational methods!</strong></p>
<p>Deterministic alternative to sampling based methods</p>
<p>Posit a parametrised family of distributions over the hidden structure and then find the member of that family that is closest to the posterior</p>
<p><strong>Summary</strong></p>
<p>The user specifies that there are K distinct topics</p>
<p>​	Each of the K topics is drawn from a aDirchlet distribution</p>
<p>​		Uniform base distribution (u) and concentration parameter B</p>
<p>​		theta_k ~ Dir(Bu)</p>
<p>Distributions over topics of each document 	theta_d ~ Dir (au)</p>
<ul>
<li>﻿﻿Topic assignment Z_d,n ~ Discrete(theta_d)</li>
<li>﻿Wd,n~theta_Z(d,n)</li>
</ul>
<p><strong>Sampling based!</strong></p>
<p>Attempt to collect samples from the posterior to approximate it with an empirical distribution - <strong>Gibbs sampling!</strong></p>
<p><strong>Variational methods!</strong></p>
<p>Deterministic alternative to sampling based methods</p>
<p>Posit a parametrised family of distributions over the hidden structure and then find the member of that family that is closest to the posterior</p>
<p><strong>Gibbs Sampling</strong></p>
<p>It generates samples from complex, high-dimensional probability distributions.</p>
<p>The algorithm for Gibbs sampling is as follows:</p>
<ol>
<li>Initialize each variable with an initial value.</li>
<li>Choose a variable to update, say the i-th variable.</li>
<li>Sample a new value for the i-th variable from its conditional distribution, given the current values of the other variables.</li>
<li>Repeat steps 2 and 3 for a specified number of iterations or until convergence is achieved.</li>
</ol>
<h4 id="LDA"><a href="#LDA" class="headerlink" title="LDA"></a><strong>LDA</strong></h4><ul>
<li><p>﻿﻿LDA is a probabilistic generative model</p>
<ul>
<li>﻿﻿Each document is a distribution of topics</li>
<li>﻿﻿Each topic is a distribution of words</li>
</ul>
</li>
<li><p>﻿﻿Sample a topic from a document-level topic distribution</p>
<ul>
<li>﻿﻿That obeys Dirichlet distribution</li>
</ul>
</li>
<li><p>﻿﻿Then sample a words according to the topic distribution of this topic</p>
<ul>
<li>﻿﻿Dirichlet distribution</li>
</ul>
</li>
<li><p>﻿﻿Generate a document</p>
</li>
<li><p>﻿﻿Hence, LDA implicitly model document level word co-occurrence pattern</p>
</li>
<li><p>﻿﻿Sparsity problem exacerbates performance issues</p>
<ul>
<li>﻿﻿The limited contexts make it more difficult for topic models to identify the senses of ambiguous words in short documents.</li>
</ul>
</li>
<li><p>﻿﻿Short documents like Tweet</p>
<ul>
<li>﻿﻿Sparse words …</li>
<li>﻿﻿Time-sensitive</li>
<li>﻿﻿Lack of clear context because not much information; no formal structure<ul>
<li>﻿﻿How words are related often measured through co-occurrence patterns</li>
<li>﻿﻿In short texts document-level co-occurrence patterns are difficult to capture</li>
</ul>
</li>
</ul>
</li>
<li><p>﻿﻿Massive volume of tweet;</p>
<ul>
<li>﻿﻿Memory requirements</li>
</ul>
</li>
<li><p>﻿﻿Real-time nature</p>
</li>
</ul>
<p>Problem with LDA to train twitter</p>
<p><strong>Why not LDA?</strong></p>
<ul>
<li>LDA needs to be trained on the entire data sets<ul>
<li>Memory requirements for the model</li>
</ul>
</li>
<li>LDA is trained and tested on a data set<ul>
<li>Time-sensitive nature of Twitter</li>
</ul>
</li>
</ul>
<p>How to address this issue …?</p>
<ul>
<li>﻿﻿Enrich the word co -occurrence information<ul>
<li>﻿﻿To enrich the limited word co -occurrence information contained in a single short text,</li>
</ul>
</li>
<li>﻿﻿Make larger texts by grouping short texts (tweets)<ul>
<li>﻿﻿Grouping tweets by the authors</li>
<li>﻿﻿However, this aggregation method highly depends on the meta - information of each text,<ul>
<li>﻿﻿which may not always be available for many kinds of short texts.</li>
</ul>
</li>
<li>﻿﻿Another strategy models the similarity between texts to aggregate similar texts into a long pseudo -document</li>
</ul>
</li>
<li>﻿﻿Explicit text similarity</li>
</ul>
<h2 id="Topic4-Network-Analysis"><a href="#Topic4-Network-Analysis" class="headerlink" title="Topic4 Network Analysis"></a>Topic4 Network Analysis</h2><h3 id="L6-Graph-based-Network-Analysis"><a href="#L6-Graph-based-Network-Analysis" class="headerlink" title="L6 Graph-based Network Analysis"></a>L6 Graph-based Network Analysis</h3><h4 id="Graph-Modelling"><a href="#Graph-Modelling" class="headerlink" title="Graph Modelling"></a>Graph Modelling</h4><ul>
<li>﻿﻿Capturing structural properties of social networks</li>
<li>﻿﻿Relationships formed between individuals<ul>
<li>﻿﻿To identify clusters</li>
<li>﻿﻿Cliques and connected components of users</li>
<li>﻿﻿Centrality measures</li>
</ul>
</li>
<li>﻿﻿Hashtags<ul>
<li>﻿﻿Which hashtags are strongly connected</li>
</ul>
</li>
</ul>
<p><strong>Centrality Measures:</strong> Find the influential users, find the centre of a graph.</p>
<p><strong>Why graph?</strong></p>
<ul>
<li><p>﻿﻿By analyzing network data, we can ask many questions</p>
<ul>
<li>﻿﻿Who is most important in a network?</li>
<li>﻿﻿Which way information flows?</li>
</ul>
</li>
<li><p>﻿﻿We can use graph analysis to answer questions like these</p>
</li>
<li><p>﻿﻿Note</p>
<ul>
<li>﻿﻿Sample questions!</li>
<li>﻿﻿What are people talking about?<br> How are they responding to a product?</li>
<li>﻿﻿The breadth of such analyses is huge and not covered fully</li>
</ul>
</li>
</ul>
<h4 id="Graph-Theory"><a href="#Graph-Theory" class="headerlink" title="Graph Theory"></a><strong>Graph Theory</strong></h4><p><strong>Graph</strong></p>
<ul>
<li><p>﻿﻿Graphs are way to formally represent a network or a set of interconnected objects</p>
</li>
<li><p>﻿﻿Nodes and edges</p>
</li>
<li><p>﻿﻿Unlike trees no concept of root node, In the graph, there is no unique node which is known as root.</p>
</li>
<li><p>﻿﻿One node might be connected to five others!</p>
</li>
<li><p>﻿﻿No concept one-directional flow!</p>
</li>
</ul>
<p>﻿﻿<strong>Edges</strong></p>
<ul>
<li>﻿﻿With direction or flow!</li>
<li>﻿﻿Without direction!</li>
</ul>
<p><strong>Direction</strong></p>
<ul>
<li>﻿﻿Origin to destination</li>
</ul>
<p><strong>Trees vs graphs</strong></p>
<p>A tree is a set of nodes and edges. In a tree, there is a unique node which is known as root.</p>
<p>Terminology - <strong>Undirected</strong> graphs</p>
<ul>
<li>﻿﻿u and v are adjacent if {u, v} is an edge,<ul>
<li>﻿﻿e is called incident with u and v</li>
<li>﻿﻿u and v are called endpoints of {u, v}</li>
</ul>
</li>
<li>﻿﻿Degree of Vertex (deg (V)):<ul>
<li>﻿﻿the number of edges incident on a vertex.</li>
<li>﻿﻿<strong>A loop contributes twice to the degree</strong></li>
</ul>
</li>
</ul>
<p>Terminology - <strong>Directed</strong> graphs</p>
<ul>
<li>﻿﻿For the edge (u, v), u is adjacent to v OR v is adjacent from u,</li>
<li>﻿﻿u - Initial vertex origin)</li>
<li>﻿﻿v - Terminal vertex destination)</li>
<li>﻿﻿In-degree (deg (u)): number of edges for which u is terminal vertex</li>
<li>﻿﻿Out-degree (deg+ (u)): number of edges for which u is initial vertex</li>
</ul>
<p><strong>Incidence Matrix:</strong></p>
<p>What are the maximum potential edges?</p>
<p>Undirected graph: (n*(n-1))&#x2F;2</p>
<p>Directed graph (n*(n-1))</p>
<p>Edge density &#x3D; no of edges&#x2F; max no of edges possible</p>
<p><strong>Adjacency Matrix</strong></p>
<ul>
<li><p>﻿﻿There is an N x N matrix, where |V| &#x3D; N,</p>
</li>
<li><p>﻿﻿the Adjacenct Matrix (N×N)</p>
</li>
<li><p>﻿﻿This makes it easier to find subgraphs</p>
</li>
<li><p>﻿﻿When there are relatively few edges in the graph the adjacency matrix is a sparse matrix</p>
</li>
</ul>
<h4 id="Graph-analysis-in-twitter"><a href="#Graph-analysis-in-twitter" class="headerlink" title="Graph analysis in twitter"></a>Graph analysis in twitter</h4><p>Twitter is directed graph while facebook is undirected</p>
<p><strong>Why graph analysis?</strong></p>
<ul>
<li>﻿﻿By analyzing tweet data, we can ask many questions</li>
<li>﻿﻿Who is most important in a network?</li>
<li>﻿﻿How did the information flow?</li>
<li>﻿﻿How could we reach 50% of the graph?</li>
<li>﻿﻿Who is more influential?</li>
<li>﻿﻿What are people talking about?</li>
<li>﻿﻿How are they responding to a product?</li>
</ul>
<p><strong>Centrality</strong></p>
<p>find who is important</p>
<ul>
<li>Measures of importance in social networks are called centrality measures</li>
</ul>
<p><strong>Degree centrality</strong></p>
<ul>
<li><p>Who gets the most re-tweets?</p>
<ul>
<li>Basically says who is most important in the network</li>
</ul>
</li>
<li><p>In-degree: number of retweets of a user</p>
</li>
<li><p>Out-degree: number of retweets this particular user made</p>
</li>
<li><p>﻿﻿The degree centrality is a fundamental metric in network analysis.</p>
</li>
<li><p>﻿﻿It is used to directly quantify the number of nodes in the network that a given node is adjacent to.</p>
</li>
<li><p>﻿﻿for directed networks</p>
<ul>
<li>﻿﻿There are variations of this metric that are used, where connections between nodes have a directionality.</li>
</ul>
</li>
<li><p>﻿﻿In directed networks, it makes sense to talk about the following:</p>
</li>
<li><p>﻿﻿In-degree - For a given node, how many edges are incoming to the node.<br> the node.</p>
</li>
<li><p>﻿Out-degree - For a given node, how many edges are outgoing from</p>
</li>
<li><p>﻿﻿CD(v) &#x3D; deg(v)</p>
</li>
</ul>
<p><strong>Centrality measures!</strong></p>
<p>Designed to characterise</p>
<ul>
<li>﻿﻿Functional role - what part does this node play in system dynamics?</li>
<li>﻿﻿Structural importance - how important is this node to the structural characteristics of the system?</li>
</ul>
<p>In each of the following networks, X has higher centrality than Y according to a particular measure</p>
<p><img src="/../images/webs/20230430204648900.png" alt="image-20230430204648900"></p>
<ul>
<li>﻿﻿“Who is the most important or central person in this network?”<ul>
<li>﻿﻿There are many answers to this question, depending on what we mean by importance.</li>
</ul>
</li>
<li>﻿﻿The power a person holds in the organization is inversely proportional to the number of keys on his keyring.<ul>
<li>﻿﻿A janitor has keys to every office, and no power.</li>
<li>﻿﻿The CEO does not need a key: people always open the door for him.</li>
</ul>
</li>
<li>﻿﻿Degree centrality of a vertex</li>
</ul>
<p><img src="/../images/webs/20230430205230578.png" alt="image-20230430205230578"></p>
<p><img src="/../images/webs/20230430210025438.png" alt="image-20230430210025438"></p>
<p>Eigenvector centrality</p>
<ul>
<li><p>﻿﻿Who is the most influential</p>
</li>
<li><p>﻿﻿In contrast to degree centrality</p>
<ul>
<li>﻿﻿How important are these retweeters?</li>
</ul>
</li>
<li><p>﻿﻿is a measure of the influence of a node</p>
<ul>
<li>﻿﻿It assigns relative scores to all nodes in the network based on the concept that</li>
<li>﻿﻿connections to high-scoring nodes contribute more to the score of the node in<br> question<ul>
<li>﻿﻿than equal connections to low-scoring nodes.</li>
</ul>
</li>
</ul>
</li>
<li><p>﻿﻿Google’s page rank is variant of the eigenvector centrality.</p>
</li>
<li><p>﻿﻿Using Adjacency network</p>
<ul>
<li>﻿﻿Ax &#x3D; lambda x</li>
<li>﻿﻿there is a unique largest eigenvalue, which is real and positive,</li>
<li>﻿﻿This greatest eigenvalue results in the desired centrality measure.</li>
</ul>
</li>
</ul>
<p>Betweenness Centrality&#x2F;Closeness Centrality</p>
<p><strong>Betweenness centrality</strong> measures the number shortest paths in which the user is in the sequence of nodes in the path.</p>
<ul>
<li>It was introduced as a measure for quantifying the control of a human on the communication between other humans in social network.</li>
<li>In this conception, vertices that have a high probability to occur on a randomly chosen shortest path between two randomly chosen vertices have a high betweenness.</li>
</ul>
<p><img src="/../images/webs/20230430213515337.png" alt="image-20230430213515337"></p>
<p>Closeness Centrality: Definition</p>
<ul>
<li>﻿﻿Closeness is based on the length of the average shortest path between a vertex and all vertices in the graph</li>
<li>﻿﻿Closeness Centrality</li>
</ul>
<h3 id="L7-Retweet-Graph-Trend-amp-Influencers"><a href="#L7-Retweet-Graph-Trend-amp-Influencers" class="headerlink" title="L7_Retweet Graph Trend &amp; Influencers"></a>L7_Retweet Graph Trend &amp; Influencers</h3><p>Information diffusion ….</p>
<p>tracing, understanding and predicting how </p>
<p>a piece of information is spreading. </p>
<h4 id="Information-diffusion"><a href="#Information-diffusion" class="headerlink" title="Information diffusion"></a>Information diffusion</h4><ul>
<li><p>in online communities, tracking the information diffusion is useful for many applications, for example,</p>
<ul>
<li>﻿﻿such as early warning systems,</li>
<li>﻿﻿social bot and community detection,</li>
<li>﻿﻿user location prediction,</li>
<li>﻿﻿financial recommendations,</li>
<li>﻿﻿marketing campaign effectiveness,</li>
<li>﻿﻿political mobilization and protests</li>
</ul>
</li>
<li><p>﻿﻿Twitter offers four possible actions to express interest in specific content:</p>
<ul>
<li>﻿﻿<strong>favorite</strong>, <strong>reply</strong>, <strong>quote</strong> and <strong>retweet</strong>.</li>
<li>﻿﻿Replying or liking a tweet does not involve the spread of the content,</li>
<li>﻿﻿whereas quotes and retweets are actions used to<ul>
<li>﻿﻿share information with a wider audience.</li>
</ul>
</li>
</ul>
</li>
<li><p>﻿﻿A retweet is often considered an endorsement, i.e., the user supports the original tweet’s content,</p>
</li>
<li><p>﻿﻿whereas <strong>quoting</strong> may be done in order to express a different idea</p>
</li>
</ul>
<h4 id="Hashtags-amp-mentions"><a href="#Hashtags-amp-mentions" class="headerlink" title="Hashtags&amp;mentions"></a>Hashtags&amp;mentions</h4><ul>
<li>﻿﻿Hashtag - adding a “#” to the beginning of an unbroken word or phrase creates a hashtag.<ul>
<li>When you use a hashtag in a Tweet, it becomes linked to all of the other<br>Tweets that include it.</li>
<li>﻿﻿Including a hashtag gives your Tweet context and allows people to easily follow topics that they’re interested in.</li>
</ul>
</li>
</ul>
<p>@Mentions are used when talking to or about someone (the user account of a person, brand, group, etc.)</p>
<ul>
<li>﻿﻿In marketing</li>
<li>﻿﻿Using hashtags helps a brand connect with what’s happening on Twitter.<br> When brands connect with what’s happening on Twitter, they see</li>
<li>﻿﻿lifts across the marketing funnel, such as<ul>
<li>﻿﻿+18% message association, +8% brand awareness, and +3% purchase intent</li>
</ul>
</li>
</ul>
<h4 id="Twitter-REST-API"><a href="#Twitter-REST-API" class="headerlink" title="Twitter REST API"></a>Twitter REST API</h4><ul>
<li><p>﻿﻿The user Tweet timeline endpoint is a REST endpoint that receives a single path parameter to indicate the desired user (by user ID).</p>
<ul>
<li>﻿﻿The endpoint can return the 3,200 most recent<ul>
<li>﻿﻿Tweets, Retweets, replies, and Quote Tweets posted by the user.</li>
</ul>
</li>
</ul>
</li>
<li><p>﻿﻿User mention timeline</p>
<ul>
<li>﻿﻿The user mention timeline endpoint allows you to request Tweets</li>
<li>﻿﻿mentioning a specific Twitter user, for example,<ul>
<li>﻿﻿if a Twitter account mentioned @TwitterDev within a Tweet</li>
</ul>
</li>
</ul>
</li>
<li><p>it is possible to collect a huge amount of information regarding tweets, accounts, users’ timelines and social networks (i.e., following and followers).</p>
</li>
</ul>
<h4 id="Interaction-among-users"><a href="#Interaction-among-users" class="headerlink" title="Interaction among users"></a>Interaction among users</h4><ul>
<li>﻿﻿In order to understand the connections among users, it is important to consider not only their social networks<ul>
<li>﻿﻿but also, the way they interact, especially through retweets</li>
</ul>
</li>
<li>﻿﻿the Twitter API does not provide complete information about retweets and their propagation paths.<ul>
<li>﻿﻿More precisely, the only information carried by a retweet is the original user</li>
</ul>
</li>
<li>﻿﻿To estimate retweet cascade graphs,<ul>
<li>﻿﻿many strategies based on social network information</li>
<li>﻿﻿(i.e., friends and followers) in conjunction with temporal information</li>
</ul>
</li>
</ul>
<h4 id="Retweet-Graph"><a href="#Retweet-Graph" class="headerlink" title="Retweet Graph"></a>Retweet Graph</h4><ul>
<li><p>﻿﻿a graph of users, where an edge</p>
<ul>
<li>﻿﻿means that one of the users has retweeted a message of a different user.</li>
</ul>
</li>
<li><p>﻿﻿retweet graph G &#x3D; (V, E),</p>
<ul>
<li>﻿﻿which is a graph of users that have participated in the discussion on a specific topic.</li>
<li>﻿﻿A directed edge e &#x3D; (u, v) indicates that user v has retweeted a tweet of u.</li>
<li>﻿﻿Or e &#x3D; (u, v) indicates that user u has retweeted a tweet of v.</li>
</ul>
</li>
</ul>
<p><img src="/../images/webs/20230430225752042.png" alt="image-20230430225752042"></p>
<p>Count the number of links to a node in the network</p>
<ul>
<li>﻿﻿the number of directed edges with source (destination)</li>
<li>﻿﻿In-degree - number of retweets of a user<br> Out-degree - number of retweets this particular node (user)<br> made</li>
</ul>
<p>observe the retweet graph at the time instances t &#x3D; 0, 1, 2, . ..,</p>
<ul>
<li>﻿﻿where either a new node or a new edge was added to the graph,</li>
<li>﻿﻿G, &#x3D; (V+, Et) the retweet graph at time t</li>
</ul>
<p><strong>Issues in building interaction graph</strong></p>
<ul>
<li>﻿﻿prior studies exploited the fact that users tend to interact more often with newer tweets,<ul>
<li>﻿﻿and a user is more likely to retweet the last friend who retweeted content.</li>
</ul>
</li>
<li>﻿﻿However, this approach is no longer a reliable way of estimating retweet graphs,</li>
<li>﻿﻿Since, Twitter does not show content based on<ul>
<li>﻿﻿simple reverse chronological order,</li>
<li>﻿﻿but according to user interests, trending topics and interactions</li>
</ul>
</li>
<li>﻿﻿fetch all the required social network information.<ul>
<li>﻿﻿the time required to fetch all</li>
</ul>
</li>
<li>﻿﻿Due to the Twitter API rate limits, the time required to collect the list of friends and followers is<ul>
<li>﻿﻿six times greater with respect to downloading the user’s timeline on average.</li>
</ul>
</li>
</ul>
<p><strong>Some findings</strong></p>
<ul>
<li>﻿﻿analyse the spread mechanics of content through hashtag use</li>
<li>﻿﻿and derive probabilities that users adopt a hashtag.</li>
<li>﻿﻿Hash tags tend to travel to more distant parts of the network and</li>
<li>﻿﻿URLs travel shorter distances.</li>
</ul>
<p>Random graph model</p>
<ul>
<li>﻿﻿Super-star random graph node for a giant component of a retweet graph.</li>
<li>﻿﻿users with many retweets have a higher chance to be retweeted,</li>
<li>﻿﻿however, there is also a super- star node that receives a new retweet at each step with a positive probability.</li>
</ul>
<h3 id="Modellng-Trends"><a href="#Modellng-Trends" class="headerlink" title="Modellng Trends"></a>Modellng Trends</h3><ul>
<li>﻿﻿Trending topics<ul>
<li>﻿﻿Ongoing topics that become suddenly extremely popular</li>
</ul>
</li>
<li>﻿﻿detecting different types of trends, for instance<ul>
<li>﻿﻿detecting emergencies,</li>
<li>﻿﻿earthquakes,</li>
<li>﻿﻿diseases or important events in sports.</li>
</ul>
</li>
<li>﻿﻿An important part of trending behaviour in social media is</li>
<li>﻿﻿the way these trends progress through the network.</li>
</ul>
<h3 id="Two-options"><a href="#Two-options" class="headerlink" title="Two options"></a>Two options</h3><ul>
<li><p>﻿﻿Content of the tweets discussing a topic</p>
<ul>
<li>﻿﻿How do we find this?</li>
</ul>
</li>
<li><p>﻿﻿Underlying networks describing the social ties between users of<br> Twitter</p>
<ul>
<li>﻿﻿a graph of users, where an edge means that one of the users has retweeted a message of a different user.</li>
</ul>
</li>
<li><p>﻿﻿In both cases, we could ask</p>
<ul>
<li><p>﻿﻿How big or small interaction network compared to followers’ network?</p>
</li>
<li><p>What kind of information goes through the network?</p>
<ul>
<li>85% of content is&#x2F;was News!</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Largest-connected-component-LCC"><a href="#Largest-connected-component-LCC" class="headerlink" title="Largest connected component LCC"></a>Largest connected component LCC</h4><ul>
<li>LCC refers to a maximum set of nodes</li>
<li>such that you can move from any node to any other node</li>
<li>in this set by only moving between side-adjacent nodes from the graph.</li>
</ul>
<p>All components of a graph can be found by looping through its vertices,</p>
<p>starting a new breadth-first or depth-first search whenever the loop reaches a vertex that has not already been included in a previously found component.</p>
<p><strong>Graph density</strong></p>
<ul>
<li>﻿﻿represents the ratio between the edges present in a graph ﻿﻿and the maximum number of edges that the graph can contain.</li>
<li>﻿﻿Conceptually, it provides an idea of how dense a graph is in terms of edge connectivity.</li>
<li>﻿﻿In this work |E|&#x2F;|V|</li>
</ul>
<p><strong>size</strong> of the largest connected component (LCC) and its <strong>density</strong> are the most informative characteristics for predicting the peak in Twitter. </p>
<h4 id="Information-diffusion-amp-influencers"><a href="#Information-diffusion-amp-influencers" class="headerlink" title="Information diffusion &amp; influencers"></a>Information diffusion &amp; influencers</h4><p>Issue with retweet graph</p>
<ul>
<li><p>﻿﻿users might be exposed and influenced by a piece of information by multiple users, hence forming multiple influence paths</p>
</li>
<li><p>﻿﻿When a message arrives that is a retweet, every friend that has (re)tweeted at an earlier point in time ﻿﻿has to be considered as a potential influencer</p>
</li>
<li><p>﻿﻿there is no agreement on the minimum number of followers needed to be regarded as an “influencer”</p>
</li>
<li><p>﻿﻿In fact, in marketing, they talk about</p>
<ul>
<li>Micro-influencers</li>
</ul>
</li>
</ul>
<p><strong>Influence paths express the relationship of “who was influenced by whom”.</strong> </p>
<p>The set of influence paths form a social graph, that share a <strong>common root</strong> (a single user who first seeded a tweet). Influence path is referred as “information cascade”. A cascade is formed when users forward the same original message from a user that we call the root user.</p>
<p><strong>Information cascade model</strong></p>
<ul>
<li><p>﻿how information is being propagated from user to user from the stream of messages and the social graph.</p>
</li>
<li><p>﻿Nodes of the cascade represent users (user nodes) of the social network that got ﻿“influenced” by the root or another user.</p>
</li>
<li><p>﻿Edges of the cascade represent edges of the social graph over which influence actually spread.</p>
</li>
</ul>
<p><strong>An “influencer” in the case of Twitter is the so called “friend” that exposes information to his&#x2F;her followers and</strong></p>
<p>exerts influence on them in such a way that they forward this piece of information.</p>
<p>However, real data is missing?</p>
<p>we can derive these influence paths from these social connections among users.</p>
<p><strong>Absolute Interaction strength</strong></p>
<p><img src="/../images/webs/20230501103443357.png" alt="image-20230501103443357"></p>
<p><strong>Retweet distribution</strong> </p>
<ul>
<li>﻿﻿The retweet distribution given the time delay between the retweet action date and the original tweet posting time<ul>
<li>﻿﻿for 16,304 cascades</li>
</ul>
</li>
<li>Temporal dynamics of the retweets after the respective roottime</li>
<li>﻿﻿Showing a decreasing trend,<ul>
<li>﻿﻿as the highest number of interactions occurred</li>
<li>﻿﻿soon after roottime (the original tweet creation date).</li>
</ul>
</li>
</ul>
<p><strong>Weighted information strength</strong></p>
<p><img src="/../images/webs/20230501103700956.png" alt="image-20230501103700956"></p>
<p><img src="/../images/webs/20230501103748922.png" alt="image-20230501103748922"></p>
<p><strong>Approach - Generating Retweet Cascade Graphs</strong> </p>
<p><img src="/../images/webs/20230501103852547.png" alt="image-20230501103852547"></p>
<p><strong>No interaction</strong></p>
<p><img src="/../images/webs/20230501103945037.png" alt="image-20230501103945037"></p>
<p><strong>In addition</strong></p>
<ul>
<li>﻿﻿when there are no available interactions by a user u, and thus</li>
<li>﻿﻿no IS values between u and any other user,</li>
<li>﻿﻿An alternative is to find a link from the u to another user in the cascade</li>
<li>﻿﻿collect the user’s friend list by using the Twitter API, and</li>
<li>﻿﻿every user’s friend that has retweeted at an earlier point in time is considered as a potential influencer</li>
<li>﻿﻿To identify the influencer that more likely spread the tweet to user u,</li>
<li>﻿﻿consider the most recent influencer, i.e., u is linked to the last friend that retweeted the message.</li>
<li>﻿﻿Users that still remaining without an edge after this second step are denoted as sparse nodes<br> (SN).</li>
</ul>
<p><strong>How do you find influencer nodes and communities?</strong></p>
<ul>
<li>How could we find important nodes?<ul>
<li>Influencers?</li>
</ul>
</li>
<li>How can we find the information paths?<ul>
<li>What measures you may use? <strong>Centrality</strong>, <strong>Degrees</strong>.</li>
</ul>
</li>
<li>What alternative mechanisms to weight graphs?</li>
</ul>
<h3 id="L8-Network-Analysis-Case-studies-in-Health-Communities"><a href="#L8-Network-Analysis-Case-studies-in-Health-Communities" class="headerlink" title="L8 Network Analysis - Case studies in Health Communities"></a>L8 Network Analysis - Case studies in Health Communities</h3><h4 id="Case-studies"><a href="#Case-studies" class="headerlink" title="Case studies"></a>Case studies</h4><p>How online communities of people with long-term conditions function &amp; evolve: network analysis of the structure and dynamics of the asthma UK and British lung foundation online communities,</p>
<p><strong>Problems</strong></p>
<ul>
<li><p>﻿﻿We have seen</p>
<ul>
<li><p>﻿﻿People express themselves through social media</p>
</li>
<li><p>﻿﻿Huge amount of data</p>
</li>
</ul>
</li>
<li><p>﻿﻿People suffering from mental health</p>
<ul>
<li>﻿﻿Silent suffering!</li>
</ul>
</li>
<li><p>﻿﻿Can we create a self-management or self-diagnosis tool</p>
<ul>
<li><p>﻿﻿A tool helping them to control their situation</p>
</li>
<li><p>﻿﻿A tool nudging them to get help!!</p>
</li>
</ul>
</li>
<li><p>﻿﻿To start with</p>
<ul>
<li>﻿﻿How prevalent is mental health issues in society?</li>
</ul>
</li>
<li><p>﻿﻿Can we mine network structure of social media to understand how communities support mental health issues?</p>
<ul>
<li>﻿﻿Network structure of social media data provide insights on support given by society on mental health issues</li>
</ul>
</li>
</ul>
<p><strong>Social Support</strong></p>
<p>Social Support is an exchange of resources between two individuals</p>
<ul>
<li><p>﻿﻿perceived by the provider or the recipient to be intended</p>
</li>
<li><p>﻿﻿to enhance the well-being of the recipient</p>
<ul>
<li><p>﻿﻿e.g.,</p>
<ul>
<li><p>﻿﻿Facebook interaction</p>
</li>
<li><p>﻿﻿RTs …</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>How to extract signatures of perceived social support?</p>
<p><strong>Post-reply Network</strong></p>
<p>Example -&gt; StackOverflow</p>
<p>It is not like twitter, its form is due to the users shared same interest.</p>
<p>A community expertise network.</p>
<h4 id="Graph-modelling-WHAT-IS-INTERACTION-GRAPH"><a href="#Graph-modelling-WHAT-IS-INTERACTION-GRAPH" class="headerlink" title="Graph modelling WHAT IS INTERACTION GRAPH"></a><strong>Graph modelling WHAT IS INTERACTION GRAPH</strong></h4><p><strong>User interaction graph</strong></p>
<p>Tie</p>
<ul>
<li><p>﻿﻿Tie connect a pair of users&#x2F;actors by one or more relations</p>
<ul>
<li><p>﻿﻿Sharing information, financial or Psychological support</p>
</li>
<li><p>﻿﻿One relation or multiple set of relations</p>
</li>
<li><p>﻿﻿Vary in content, direction &amp; strength</p>
</li>
</ul>
</li>
<li><p>﻿﻿look at the actual tie between users instead of message level interactions</p>
</li>
</ul>
<p><strong>Structural prestige in online communities</strong></p>
<ul>
<li><p>﻿﻿A thread</p>
<ul>
<li>How many people a user replied (out degree!!)</li>
<li>﻿﻿How many people replied to the user (in degree!!)</li>
</ul>
</li>
<li><p>﻿﻿In directed networks</p>
<ul>
<li><p>﻿﻿People who send many responses&#x2F;replies</p>
</li>
<li><p>﻿﻿are considered to be prestigious</p>
</li>
<li><p>﻿﻿Or person with knowledge</p>
</li>
</ul>
</li>
</ul>
<p><strong>Size of a node</strong></p>
<ul>
<li>﻿﻿the size of the node depends on the number of replies send by the user</li>
<li>﻿﻿The more the number of replies, the larger the node</li>
</ul>
<p><strong>How to create an interaction graph?</strong></p>
<ul>
<li><p>﻿﻿the users who post and the corresponding reply users</p>
</li>
<li><p>﻿﻿A Pandas DataFrame contains two columns of node names</p>
<ul>
<li>﻿﻿posts_author, comments_author.</li>
</ul>
</li>
<li><p>﻿﻿use nx.from pandas_ edgelist() to transfer the DataFrame to a network graph.</p>
<ul>
<li><p>﻿﻿Network (NX) is a python software package,</p>
</li>
<li><p>﻿﻿used to create and operate complex networks,</p>
</li>
<li><p>﻿﻿and to learn the structure, dynamics and functions of complex networks.</p>
</li>
</ul>
</li>
<li><p>﻿﻿To distinguish the importance of each user who post,</p>
<ul>
<li><p>﻿﻿we set the size of these users’ to twice its node degree<br> User’s node orange</p>
</li>
<li><p>﻿﻿Replies node to light gray the directed edges to light blue colour.</p>
</li>
</ul>
</li>
</ul>
<p><strong>Temporal activity patterns</strong></p>
<ul>
<li>Let us study how the community thrive?<ul>
<li>How do they function and evolve over time?</li>
</ul>
</li>
<li>Basically we are answering research questions <ul>
<li>like “ what is the basic structure of SUCH online communities and how do they function and evolve over time”</li>
</ul>
</li>
</ul>
<p><strong>Degree distributions</strong></p>
<ul>
<li><p>﻿﻿Look at the distribution of degrees,</p>
</li>
<li><p>﻿﻿Or the amount of edges a node has</p>
</li>
<li><p>﻿﻿Acros sall nodes in a graph</p>
</li>
<li><p>﻿﻿Top 1% of nodes</p>
<ul>
<li><p>﻿﻿in terms of degrees</p>
</li>
<li><p>﻿﻿most interactive and have<br> Established edges with a lot of other users by exchanging messages</p>
</li>
<li><p>﻿﻿Known as super users,</p>
</li>
</ul>
</li>
</ul>
<p><strong>Activity analysis</strong></p>
<ul>
<li><p>﻿﻿How are users engaging or community thrive?</p>
<ul>
<li>﻿﻿Does posting activity follow a time pattern?</li>
</ul>
</li>
<li><p>﻿﻿How many activity is happening on a daily or weekly basis on a particular community</p>
<ul>
<li><p>﻿﻿Number of messages exchanged in a community across the whole life cycle of data</p>
</li>
<li><p>﻿﻿how users engaging with a community</p>
</li>
</ul>
</li>
<li><p>﻿﻿Cumulative frequencies of activity</p>
<ul>
<li>﻿﻿Number of posts reply per week</li>
</ul>
</li>
</ul>
<p><strong>To understand the behaviour of the community</strong></p>
<ul>
<li><p>the trend tends to be linear,</p>
<ul>
<li>which indicates that the number of new replies per week remains stable.</li>
</ul>
</li>
<li><p>SuicideWatch, average 211605 posts to come weekly and PSTD average 1980 posts</p>
</li>
<li><p>This shows that the average weekly posting volume of Suicide Watch community users is almost 100 times that of PTSD.</p>
<ul>
<li>227,307 users in the SuicideWatch community, while PTSD has only 50032 users,</li>
</ul>
</li>
</ul>
<p><strong>Open question – how do we distinguish two communities?</strong></p>
<p>Modularity Optimization: Modularity is a measure of the degree to which nodes in a network are connected within their own community compared to the connections between different communities. Modularity optimization involves identifying communities that maximize modularity, or in other words, communities that have a high degree of internal connections and a low degree of external connections.</p>
<p>Girvan-Newman Algorithm: This algorithm involves iteratively removing edges from the network in order of their “betweenness centrality,” which is a measure of how often a given edge lies on the shortest path between two nodes. By removing edges in this way, the algorithm gradually breaks the network into smaller and smaller communities.</p>
<p>Label Propagation: This method involves assigning an initial label to each node in the network and then iteratively updating the labels based on the labels of neighboring nodes. Over time, nodes tend to cluster into groups with similar labels, forming communities.</p>
<p>Spectral Clustering: This method involves using the eigenvalues and eigenvectors of the network’s adjacency matrix to identify communities. By projecting the network onto a lower-dimensional space, spectral clustering can often separate nodes into distinct communities.</p>
<p> <strong>how did we study the behaviour of two communities &amp; what did we found?</strong></p>
<ul>
<li><p>﻿﻿For each week</p>
</li>
<li><p>﻿﻿Compute average post</p>
<ul>
<li><p>﻿﻿Look at the total posts by all users</p>
</li>
<li><p>﻿﻿Divided by total number of unique users</p>
</li>
</ul>
</li>
<li><p>﻿﻿How users are engaging with the community?</p>
<ul>
<li><p>﻿﻿A continuous engagement is good for the vitality of community.</p>
</li>
<li><p>﻿﻿Do these communities drive enough engagement and activity to sustain</p>
</li>
</ul>
</li>
</ul>
<p><strong>Super users</strong></p>
<ul>
<li><p>﻿﻿A small minority of users</p>
<ul>
<li><p>﻿﻿Responsible for a high proportion of posting activity and thus support</p>
</li>
<li><p>﻿﻿Functioning of communities</p>
</li>
</ul>
</li>
<li><p>﻿﻿5% of users generate</p>
<ul>
<li>﻿﻿Over 70% of content</li>
</ul>
</li>
<li><p>﻿How do we study the role of super users?</p>
<ul>
<li>﻿﻿Sensitivity analysis</li>
</ul>
</li>
</ul>
<p><strong>How to find the super user?</strong></p>
<ul>
<li><p>﻿﻿For each user</p>
<ul>
<li><p>﻿﻿Count the number of posts (A) and</p>
</li>
<li><p>﻿﻿The number of replies (B)</p>
</li>
<li><p>﻿﻿The number of total activity (A + B)</p>
</li>
</ul>
</li>
<li><p>﻿﻿Rank the user in terms of respective frequencies</p>
</li>
</ul>
<p><strong>Connected component</strong></p>
<ul>
<li>﻿﻿A connected component of an undirected graph is a maximal set of nodes such that<ul>
<li>﻿﻿each pair of nodes is connected by a path.</li>
</ul>
</li>
<li>﻿﻿Directed graphs have weakly and strongly connected components.</li>
<li>﻿﻿Two vertices are in the same weakly connected<br> component<ul>
<li>﻿﻿if they are connected by a path, where paths are allowed to go either way along any edge.</li>
</ul>
</li>
<li>﻿﻿The weakly connected components correspond closely to the concept of connected component in undirected graphs and the typical situation is similar<ul>
<li>﻿﻿there is usually one large weakly connected component plus other small ones.</li>
</ul>
</li>
</ul>
<p><strong>Largest connected component</strong></p>
<ul>
<li><p>﻿﻿A largest connected component of a</p>
<ul>
<li><p>﻿﻿Graph G(V,E) is the largest possible subgraph</p>
<ul>
<li><p>﻿G_L(V_L,E_L) of G,</p>
</li>
<li><p>﻿﻿such that each node in G_L, has at least one valid connected path to every other node in G_L,</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>﻿﻿LCC gives us the subset of users</p>
<ul>
<li>﻿﻿Who form a cohesive community</li>
</ul>
</li>
<li><p>﻿﻿Importance of super users on LCC</p>
<ul>
<li>﻿﻿By removing them and studying the cohesion</li>
</ul>
</li>
</ul>
<p><strong>Community resilience</strong></p>
<p>Temporal Analysis</p>
<ul>
<li><p>﻿﻿Characteristics of LCC on a weekly basis</p>
</li>
<li><p>﻿﻿Focused and cohesive nature of interactions</p>
<ul>
<li>﻿﻿By looking at the fraction of users belonging to the LCC.</li>
</ul>
</li>
<li><p>﻿﻿Our aim is to study</p>
<ul>
<li>﻿﻿community resilience</li>
</ul>
</li>
<li><p>﻿﻿First how cohesive</p>
<ul>
<li>﻿﻿The community is?</li>
</ul>
</li>
<li><p>﻿﻿For each weekly graph, G</p>
<ul>
<li><p>﻿﻿Compute the LCC</p>
</li>
<li><p>﻿﻿That is all nodes in LCC has at least one path</p>
</li>
</ul>
</li>
<li><p>﻿﻿Compute fraction N&#x2F;N</p>
<ul>
<li>﻿﻿Nk is the nodes in LCC</li>
</ul>
</li>
</ul>
<p><strong>Fragility of the community</strong></p>
<ul>
<li><p>﻿﻿If the conversation network is held by</p>
<ul>
<li><p>﻿﻿A more or less uniform contribution of nodes</p>
</li>
<li><p>﻿﻿Or</p>
</li>
<li><p>﻿﻿Is there a skew in the responsibility of nodes</p>
</li>
</ul>
</li>
<li><p>﻿﻿Sensitivity analysis methods</p>
<ul>
<li>﻿﻿Which measures the network’s capacity to diffuse information as you move nodes based on certain property</li>
</ul>
</li>
<li><p>﻿﻿Importance of super users</p>
</li>
</ul>
<p><strong>Sensitivity analysis</strong></p>
<ul>
<li>﻿﻿the targeted removal of nodes (users) starting from the most connected nodes.</li>
<li>﻿﻿represents the size of the largest component as a percentage of the network size.</li>
<li>﻿﻿Specifically, it illustrates the key effects of the superusers on the website from another perspective.</li>
</ul>
<p><strong>Rich club effect</strong></p>
<ul>
<li><p>﻿﻿that a few important nodes (users) show stronger and closer connection with each other,</p>
<ul>
<li>﻿﻿and constitute a structural core and functional hub.</li>
</ul>
</li>
<li><p>﻿﻿the rich-club coefficient</p>
<ul>
<li>is the ratio of the actual number of edges of nodes with order greater than k</li>
<li>﻿﻿to the number of potential edges of each order k</li>
</ul>
</li>
</ul>
<p><img src="/../images/webs/20230501161132105.png" alt="image-20230501161132105"></p>
<ul>
<li>the coefficient continues to be lower than 1,<ul>
<li>indicating that the amount of interaction between superusers are not high, </li>
<li>the amount of interactions between most non-superusers are also not high.</li>
</ul>
</li>
<li>the interactions between the superusers and non-superusers are very high,<ul>
<li>indicating that superusers are more inclined to communicate with users with fewer interactive connections.</li>
</ul>
</li>
<li>How do we explain this<ul>
<li>there are a large number of users with purposeful questions on the website and a small number of experts in the field.</li>
</ul>
</li>
</ul>
<h4 id="Z-score"><a href="#Z-score" class="headerlink" title="Z-score"></a>Z-score</h4><ul>
<li><p>﻿﻿We have seen core users and their relationship with other users from the graph</p>
</li>
<li><p>﻿﻿We do not know whether core users</p>
<ul>
<li><p>﻿﻿Tend to ask for help (post more)</p>
</li>
<li><p>﻿﻿Help others (reply more</p>
</li>
</ul>
</li>
<li><p>﻿﻿Look at a thread!</p>
</li>
<li><p>﻿﻿To find that out let us look at z-score!!<br>z &#x3D; (х - mean)&#x2F;sd</p>
</li>
</ul>
<h4 id><a href="#" class="headerlink" title></a></h4><h2 id="Emotion-Analysis"><a href="#Emotion-Analysis" class="headerlink" title="Emotion Analysis"></a>Emotion Analysis</h2><h3 id="L9"><a href="#L9" class="headerlink" title="L9"></a>L9</h3><h4 id="Sentiment-analysis-amp-variants"><a href="#Sentiment-analysis-amp-variants" class="headerlink" title="Sentiment analysis &amp; variants"></a>Sentiment analysis &amp; variants</h4><p><strong>Variants</strong></p>
<ul>
<li>﻿﻿<strong>Sentiment classification</strong><ul>
<li>﻿﻿whether a piece of text is positive, negative or neutral</li>
<li>﻿﻿Degree of intensity<ul>
<li>﻿﻿[-100,100]</li>
</ul>
</li>
</ul>
</li>
<li>﻿﻿Opinion analysis<ul>
<li>Determining from text, the speaker’s opinion and target of the opinion</li>
</ul>
</li>
<li>﻿﻿Stance<ul>
<li>﻿﻿Author of text is in favour of, against of, or neutral towards a proposition or target</li>
<li>﻿﻿For example, Brexit agreement<ul>
<li>﻿﻿Is people supportive?</li>
</ul>
</li>
</ul>
</li>
<li>﻿﻿<strong>Emotion</strong><ul>
<li>﻿﻿What are the emotion expressed in the text?</li>
</ul>
</li>
</ul>
<p><strong>Sentiment vs Stance</strong></p>
<ul>
<li>﻿﻿Target:<ul>
<li>﻿﻿Legalization of Abortion</li>
</ul>
</li>
<li>﻿﻿Tweet<ul>
<li>The pregnant are more than walking incubators. They have rights too!</li>
<li>﻿﻿In favour of the target</li>
<li>﻿﻿Target - Pro-life movement<ul>
<li>﻿??</li>
</ul>
</li>
</ul>
</li>
<li>﻿﻿Target<ul>
<li>﻿﻿Donald Trump</li>
</ul>
</li>
<li>﻿﻿Tweet<ul>
<li>﻿﻿Donald Trump has some strengths and some weakness<ul>
<li>neutral</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>Stance detection</strong></p>
<ul>
<li>﻿﻿Is the task of automatically determining from text<ul>
<li>﻿﻿whether the author of the text is in favour of, against of, or neutral</li>
<li>﻿﻿toward a proposition or target</li>
</ul>
</li>
<li>﻿﻿Target<ul>
<li>﻿﻿Person, organization, government policy, a movement, a product</li>
<li>﻿﻿E.g., infer from former Prime minister Boris Jonson’s speeches that he is in favour of Brexit</li>
<li>﻿﻿E.g., analysing tweets identify people in favour of leadership change</li>
</ul>
</li>
</ul>
<p>Aspect Based Sentiment Analysis</p>
<ul>
<li>﻿﻿A sentence contains one or more entities,<ul>
<li>﻿﻿each of which has a different polarity of emotion.</li>
</ul>
</li>
<li>﻿﻿For example, give a comment like<ul>
<li>﻿﻿“Great food but the service is dreadful!”,</li>
<li>﻿﻿the emotional polarity of entity “food” is “positive”</li>
<li>﻿﻿while the emotional polarity of entity “service” is “negative”.</li>
</ul>
</li>
<li>﻿﻿Compared to sentence level sentiment analysis, ABSA can present<ul>
<li>﻿﻿users with more precise and fine-grained sentiment information of entities</li>
</ul>
</li>
<li>﻿﻿You identify an aspect and the sentiment towards that aspect</li>
</ul>
<p><strong>Sentiment classifification is limited</strong></p>
<ul>
<li>﻿﻿Language serves social and interpersonal functions.<ul>
<li>﻿﻿Affective meaning is key for human interaction and a prominent characteristic of language use.</li>
</ul>
</li>
<li>﻿﻿This extends beyond<ul>
<li>﻿﻿opinions vs. factual or polarity distinctions</li>
<li>﻿﻿into multiple phenomena:<ul>
<li>﻿﻿emotion, mood, personality, attitude, credibility, volition, veracity, friendliness, etc.</li>
</ul>
</li>
</ul>
</li>
<li>﻿﻿<strong>Emotion:</strong><ul>
<li>﻿﻿angry, sad, joyful, fearful, …</li>
</ul>
</li>
<li>﻿﻿recognition, characterization, or generation of affect states,<ul>
<li>﻿﻿involves analysis of affect-related conditions, experiences, and activities.</li>
</ul>
</li>
</ul>
<p><strong>Textual emotion</strong></p>
<ul>
<li>﻿﻿We analyse the text and detect the emotion<ul>
<li>﻿﻿expressed by the author or</li>
<li>﻿﻿the emotion potentially felt by the reader</li>
</ul>
</li>
<li>﻿﻿Linguistic sensing of affective states can be used for<ul>
<li>﻿﻿Understanding social issues expressed through social media</li>
</ul>
</li>
<li>﻿﻿Researchers in psychological science believe that<ul>
<li>﻿﻿individuals have internal mechanisms for a limited collection of responses, usually</li>
<li>﻿﻿happy, sad, anger, disgust, and fear</li>
</ul>
</li>
</ul>
<p><strong>There are 6 emoMon categories that are widely used to describe</strong> </p>
<p>humans’ basic emoMons, based on facial expression: </p>
<p><strong>anger, disgust, fear,</strong> <strong>happiness</strong>, <strong>sadness</strong> and <strong>surprise</strong>.</p>
<ul>
<li>Categorical theories</li>
<li>EmoIons are discretely and difffferently constructed and</li>
<li>all humans are thought to have an innate set of basic emoIon </li>
<li>that are cross-culturally recognisable</li>
</ul>
<p><strong>OCC model</strong></p>
<p>22 emotions &#x3D; 6 Paul Ekman emotions + 16 addtional emotions</p>
<p><strong>Criticism</strong></p>
<ul>
<li>In the categorical approach, emotional states are restricted to a limited number of distinct types and</li>
<li>it can be difficult to resolve a complex emotional situation or mixed emotions.</li>
<li>Appraisal theory</li>
<li>It contains componential emotion models based on the theory of appraisal.</li>
<li>Appraisal theory describes how different emotions, in various participants and on different times, can arise from the same event</li>
</ul>
<h4 id="Text-emotion-detection"><a href="#Text-emotion-detection" class="headerlink" title="Text emotion detection"></a>Text emotion detection</h4><p><strong>motivation</strong></p>
<ul>
<li>﻿﻿because of the naturally vague and ambiguous human language is,<ul>
<li>﻿﻿the emotion detection can be highly “context-sensitive and complex”</li>
</ul>
</li>
<li>﻿﻿Emotion analysis is a convoluted task, even for human beings,<ul>
<li>﻿﻿due to the various cultures, gender, and context of people who authored the texts.</li>
<li>﻿﻿The task will be much easier when emotion is expressed explicitly, but in reality,</li>
<li>﻿﻿the majority of texts are subtle, ambiguous, and some words have more than one meaning, and</li>
<li>﻿﻿more than one word expresses the same emotions, and, in addition, some emotions can exist simultaneously</li>
</ul>
</li>
<li>﻿﻿Don’t u just HATE it when u cannot find something that u know you just saw like<br> 10 min ago!</li>
<li>By analysing the horse racing comments,</li>
<li>﻿﻿the model can learn about the information of winning horse and</li>
<li>﻿﻿would be able to give a reasonable prediction based on the emotion.</li>
</ul>
<p><strong>emotion classification</strong></p>
<ul>
<li>﻿﻿In the case of sentiment analysis, this task can be tackled using<ul>
<li>﻿﻿lexicon-based methods, machine learning, or a reule-based approach</li>
</ul>
</li>
<li>﻿﻿In emotion recognition task, the 4 most common approaches are<ul>
<li>﻿﻿Keyword-based detection<ul>
<li>﻿﻿Seed opinion words and find synonyms &amp; antonyms in WordNet</li>
<li>﻿﻿WordNet</li>
</ul>
</li>
</ul>
</li>
<li>﻿﻿Lexical affinity</li>
<li>﻿﻿hybrid</li>
<li>﻿﻿Learning based detection</li>
</ul>
<p><strong>Lexicon</strong></p>
<ul>
<li>﻿﻿Lexicons are linguistic tools for automated analysis of text</li>
<li>﻿﻿Most common<ul>
<li>﻿﻿Simple list of terms associated to a certain class of interest</li>
<li>﻿﻿Classification by counting</li>
<li>﻿﻿Terms can be weighted according to their strength of association with a given class</li>
</ul>
</li>
</ul>
<p>Lexicon based approaches?</p>
<ul>
<li>﻿﻿“I love horror books”</li>
<li>﻿﻿f(love) × 1.0 + f(horror) x 0.3 + f(books) x 0.5 &#x3D; 1.8 for positive</li>
<li>﻿﻿f(love) x 0.0 + f(horror) x 0.7 + f(books) × 0.5 &#x3D; 1.2 for negative</li>
<li>﻿﻿Decision function<ul>
<li>﻿﻿Classify one with maximum value</li>
</ul>
</li>
<li>Transparency<ul>
<li>﻿﻿Each prediction can be explained<ul>
<li>﻿﻿Analysing terms that were present in the text</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><strong>BERT VS gpt</strong></p>
<h1 id="Mock-Paper"><a href="#Mock-Paper" class="headerlink" title="Mock Paper"></a>Mock Paper</h1><h2 id="2022"><a href="#2022" class="headerlink" title="2022"></a>2022</h2><ol>
<li></li>
</ol>
<p>(a) Assume that the BBC recruited you to develop a social media application. The BBC is interested in knowing their readers’ feelings on the news and other events covered by the broadcaster. Your job is to develop a classifier. In this context, answer the following questions:</p>
<p>(i)</p>
<p>Your first task is to create Twitter datasets with positive and negative statements so that they can be used for estimating the probabilities for words in the respective classes. [Hint: Assuming that you have a social media crawler, discuss how you will automatically label positive and negative tweets; how will you avoid spurious data]</p>
<p><strong>use hashtag based data collection</strong></p>
<p>1.Data collection: Use a social media crawler to collect tweets that mention the BBC or are in response to BBC’s tweets. This could be done using Twitter’s API to search for tweets containing specific keywords, hashtags, or mentions related to BBC’s news and events.</p>
<p>2.Pre-process: Clean the collected tweets by removing irrelevant information such as URLs, mentions, and special characters. Convert all text to lowercase and tokenize the words for easier analysis. <strong>Ignore this step</strong>.</p>
<p>3.Automatic labeling: Loop the tweets, using lexicon approach to compute the overall score of a tweet. if a tweet has been annotated with a hashtag, then use NRC hashtag lexicon approach to label the tweet, if it has a emoji at the end then use emoticons based approach to label the tweet. Then calculate the score for each feature (word&#x2F;hashtag&#x2F;emoticon), select the label correspondingly based on overall score.</p>
<p><img src="/../images/webs/20230501223242594.png" alt="image-20230501223242594"></p>
<p>4.Avoid spurious data. Pre-defined relevant hashtags: Compile a list of relevant and meaningful hashtags associated with the BBC or specific news and events covered by the broadcaster. Only collect and analyze tweets containing these pre-defined hashtags to ensure high-quality data. Noise filtering: Filter out tweets that are ambiguous, contain sarcasm, or are irrelevant to the BBC’s content. This can be done using advanced NLP techniques or by setting a minimum sentiment score threshold to exclude borderline cases.</p>
<p>(ii)</p>
<p>Your second task is to develop a lexicon-based automatic sentiment analysis method, which assigns sentiment intensity between [-100,100].Describe an algorithm that also uses the dataset you created in (i). [Hint: identify a suitable lexicon; identify linguistic cases you may handle; specify a scoring method] </p>
<p>To develop a lexicon-based automatic sentiment analysis method that assigns sentiment intensity between [-100, 100], follow these steps:</p>
<ol>
<li><p>Choose a suitable lexicon: Select a pre-built sentiment lexicon that provides sentiment scores for words. Examples of such lexicons include SentiWordNet, AFINN, or VADER. These lexicons typically assign sentiment scores to words on a scale of -1 to 1 or -5 to 5.</p>
</li>
<li><p>Preprocessing: Clean the dataset created in step (i) by removing irrelevant information like URLs, mentions, and special characters. Convert all text to lowercase and tokenize the words for easier analysis.</p>
</li>
<li><p>Handling linguistic cases: Address various linguistic cases to improve sentiment analysis:</p>
<p>a. Negations: Identify negation words (e.g., not, never, isn’t) and modify the sentiment score of the words that follow. For example, you can reverse or reduce the sentiment score of the word following the negation.</p>
<p>b. Intensifiers: Identify intensifier words (e.g., very, extremely, really) and adjust the sentiment score of the following word accordingly. For example, you can multiply the sentiment score by a factor (e.g., 1.5 or 2) based on the intensity of the intensifier.</p>
<p>c. Diminishers: Identify diminisher words (e.g., slightly, barely, hardly) and adjust the sentiment score of the following word accordingly. For example, you can multiply the sentiment score by a factor (e.g., 0.5) based on the diminishing effect.</p>
</li>
<li><p>Scoring method: Implement a scoring method to calculate the sentiment intensity of each tweet using the lexicon and linguistic cases:</p>
<p>a. Initialize a sentiment score variable to 0 for each tweet.</p>
<p>b. Iterate through the words in the tweet, and for each word, check if it has a sentiment score in the lexicon.</p>
<p>c. If the word has a sentiment score, adjust the score based on the linguistic cases (negations, intensifiers, diminishers) if applicable.</p>
<p>d. Add the sentiment score of the word to the tweet’s sentiment score.</p>
<p>e. After processing all words, normalize the tweet’s sentiment score to fit the range of [-100, 100]. For example, if the lexicon’s sentiment scores range from -5 to 5, multiply the tweet’s sentiment score by 20.</p>
<p>f. Assign the normalized sentiment score to the tweet as its sentiment intensity.</p>
</li>
<li><p>Evaluation: Compare the sentiment intensity assigned by the lexicon-based method with the labels in the dataset created in step (i). Calculate performance metrics such as accuracy, precision, recall, and F1-score to evaluate the effectiveness of the lexicon-based sentiment analysis method.</p>
</li>
</ol>
<p>By following these steps, you can develop a lexicon-based automatic sentiment analysis method that assigns sentiment intensity between [-100, 100] and uses the dataset created in the previous task.</p>
<p>(iii)</p>
<p>Now that you created a sentiment analysis method, you want to verify the method’s validity from a user’s perspective. Design a scalable user-based study to ensure your sentiment scoring method is appropriate.</p>
<p>To design a scalable user-based study to ensure the sentiment scoring method’s appropriateness, follow these steps:</p>
<ol>
<li>Select a representative sample: Randomly sample a subset of tweets from the dataset created in the first task. Make sure the sample includes a balanced number of positive and negative tweets, as well as a diverse range of topics covered by the BBC.</li>
<li>Prepare the evaluation interface: Develop a user-friendly interface for the study participants. The interface should display a tweet and its corresponding sentiment score, calculated using the lexicon-based sentiment analysis method. Participants should be able to rate the sentiment score’s appropriateness on a scale (e.g., 1 to 5, with 1 being “strongly disagree” and 5 being “strongly agree”).</li>
<li>Recruit participants: Recruit a diverse group of participants to ensure a broad range of perspectives. You can use platforms like Amazon Mechanical Turk, Prolific, or other crowdsourcing services to recruit participants on a large scale.</li>
<li>Training and instructions: Provide clear instructions and examples to participants on how to evaluate the sentiment scores. Briefly explain the concept of sentiment analysis, the scoring range of [-100, 100], and the evaluation scale. You may also provide examples of tweets with appropriate and inappropriate sentiment scores to help participants understand the task better.</li>
<li>Evaluation process: Ask participants to evaluate the sentiment scores of the sampled tweets using the provided interface. Encourage them to consider the context of the tweet and the sentiment score’s appropriateness based on the tweet’s content.</li>
<li>Collect user feedback: Allow participants to provide qualitative feedback on the sentiment scoring method, highlighting any issues or suggestions for improvement. This feedback can help identify potential areas of refinement for the sentiment analysis method.</li>
<li>Analyze results: After collecting the evaluations, calculate the average appropriateness score for each tweet’s sentiment score. High average scores indicate that the sentiment scoring method is appropriate from the user’s perspective. Analyze the qualitative feedback to identify common themes and potential areas for improvement.</li>
<li>Iterate and improve: Based on the study results, refine the sentiment analysis method to address identified issues and incorporate user feedback. Repeat the user-based study with the updated method to evaluate its effectiveness iteratively.</li>
</ol>
<p>By designing and conducting a scalable user-based study, you can ensure that the sentiment scoring method is appropriate from the user’s perspective and make data-driven improvements to enhance its accuracy and effectiveness.</p>
<ol start="2">
<li></li>
</ol>
<p>(a)Create a vector representation for the following short text. Identify and remove potential stop words. “@AlanStainer @takeitev It’s mad isn’t it. In the UK there are 8k petrol stations with multiple pumps and 25k chargers (increasing by 300 pm). They do know the climate emergency is now right? Not in 30 years’ time, Just asking”</p>
<p>Stopwords: “the”, “in”, “and”</p>
<p>[“it’s”, “mad”, “isn’t”, “uk”, “8k”, “petrol”, “stations”, “multiple”, “pumps”, “25k”, “chargers”, “increasing”, “300”, “pm”, “know”, “climate”, “emergency”, “right”, “30”, “years’”, “time”, “asking”]</p>
<p>(b)Create all biterms from the following text, “in the UK there are 8k petrol stations with multiple pumps and 25k chargers</p>
<p>(“in”, “the”) (“in”, “UK”) (“in”, “there”) … (“pumps”, “and”) (“pumps”, “25k”) (“pumps”, “chargers”) … (“and”, “25k”) (“and”, “chargers”) … (“25k”, “chargers”)</p>
<p>(c) Assume you have developed a topic model on a collection with your university communications for the last academic year. Design a user-centred experiment to evaluate the interpretability of the model. [Hint: design tasks and justify, selection of subjects, number of users, what will you measure, how do you prove the results]</p>
<p>Designing a user-centered experiment to evaluate the interpretability of a topic model involves several components, including selecting subjects, designing tasks, determining the number of users, and measuring performance. Here’s an outline for such an experiment:</p>
<ol>
<li><p>Define the goal: The primary goal of the experiment is to evaluate the interpretability of the topic model in terms of the coherence and relevance of the identified topics within the context of university communications.</p>
</li>
<li><p>Selection of subjects: Choose participants who have some familiarity with the university environment, such as students, faculty, and administrative staff. This will ensure that they can understand and assess the relevance of the topics generated by the model.</p>
</li>
<li><p>Number of users: To ensure the results are reliable and generalizable, aim for a diverse sample of participants. A sample size of 30-50 participants is typically considered sufficient for user-centered experiments, but the optimal number may vary depending on factors such as the complexity of the tasks and the desired statistical power.</p>
</li>
<li><p>Design tasks: Create tasks that help assess the interpretability of the topics generated by the model. Example tasks include:</p>
<p>a. Topic labeling: Ask participants to assign meaningful labels to a given set of topics. This assesses whether users can understand and make sense of the topics generated by the model.</p>
<p>b. Topic ranking: Ask participants to rank a list of topics based on their relevance or importance to the university’s communications. This helps evaluate the model’s ability to identify meaningful and relevant topics.</p>
<p>c. Document-topic assignment: Provide participants with a set of documents and ask them to assign the most relevant topic from the model to each document. This task assesses whether users can effectively map the generated topics to real-world documents.</p>
</li>
<li><p>Measurement: Collect quantitative and qualitative data to evaluate the interpretability of the model.</p>
<p>a. Quantitative measures: Calculate agreement scores (e.g., Fleiss’ Kappa or Cohen’s Kappa) to measure the consistency among participants in terms of topic labeling, ranking, and document-topic assignments.</p>
<p>b. Qualitative measures: Collect subjective feedback from participants about the coherence, relevance, and overall interpretability of the topics. This can be done through open-ended questions, interviews, or questionnaires.</p>
</li>
<li><p>Analyze results: Analyze the quantitative and qualitative data to assess the interpretability of the model. High agreement scores and positive feedback from participants would indicate that the model generates interpretable topics.</p>
</li>
<li><p>Prove the results: To prove the results, compare the performance of the topic model with alternative models or baseline approaches (e.g., LDA, NMF). Conduct a similar user-centered experiment for the alternative models and compare the agreement scores and subjective feedback. A higher performance of the developed topic model compared to the alternatives would provide evidence for its interpretability.</p>
</li>
</ol>
<p>By carefully designing and executing a user-centered experiment, you can evaluate the interpretability of a topic model in the context of university communications, ensuring that the model generates meaningful and relevant topics for the users.</p>
<p>(d)You have collected tweets and newspaper articles from Scotland for the last month.</p>
<p>Describe a method to develop topic models from these datasets. [Hint identify issues in dealing with such heterogenous datasets; how would you handle such issues]</p>
<p>l Prepare the tweets data, Pre-process of the data. </p>
<p>l Create a bigram model and trigram model. Then use the data with bigrams and trigrams to create the dictionary which will be used in model training.</p>
<p>l Use dictionary to create the corpus.</p>
<p>l Use LDA model to run topic modelling by the previous data which has been processed.</p>
<p>l Use different measures which including KL divergence, perplexity, and coherence to evaluate the model. This step will also help us to determine the number of topics.</p>
<p>l Update the model parameter by the result of evaluation.</p>
<p>l Visualize the model. The topic keywords will be displayed by a chart or a word cloud.</p>
<p><strong>Handling heterogeneity:</strong> Tweets and newspaper articles have different lengths, styles, and contexts. To address these issues:</p>
<p>a. Length normalization: To mitigate the differences in length between tweets and newspaper articles, consider using techniques like document sampling or text chunking. For instance, divide newspaper articles into smaller chunks of approximately the same size as tweets.</p>
<p>b. Text representation: Use a suitable text representation method that can capture the context and semantics of both short and long texts. Techniques like TF-IDF, word embeddings (e.g., Word2Vec, GloVe), or even more advanced methods like BERT embeddings can be used.</p>
<p>c. Combining datasets: Combine the preprocessed tweets and newspaper article chunks into a single dataset to build a unified topic model.</p>
<p>3.Applying clustering (e.g., Single-pass clustering) on Twitter data stream will create groups of similar tweets of varying sizes. Design an algorithm to detect events from such groups. Specifically, answer the following questions.</p>
<p><strong>（i）What role do entities play in detecting events? How would you reduce the cost of detecting entities?</strong></p>
<p>Entities can include named entities like people, organizations, locations, or other relevant terms specific to an event. By identifying and tracking entities within the tweet clusters, we can recognize emerging events and monitor their development. Entities can help:</p>
<ol>
<li>Identify the key components of an event: Entities can represent the primary subjects or objects related to an event, enabling us to understand the event’s main focus.</li>
<li>Differentiate between events: Entities can help distinguish between different events by providing context-specific information, which allows us to separate events with similar keywords but different contexts.</li>
<li>Track the progression of events: Monitoring the frequency and co-occurrence of entities over time can provide insights into how an event is evolving and help identify new developments or trends.</li>
</ol>
<p>Reducing the cost of detecting entities:</p>
<p>Detecting entities in real-time can be computationally expensive, especially for large-scale Twitter data streams. To reduce the cost of detecting entities, consider the following strategies:</p>
<ol>
<li>Entity extraction optimization: Use efficient named entity recognition (NER) tools or libraries that can handle streaming data, like spaCy or the Stanford NER. These libraries are optimized for performance and can handle large-scale text data efficiently.</li>
<li>Filter irrelevant data: Preprocess the Twitter data stream to remove irrelevant information, such as URLs, hashtags, user mentions, and stop words. This reduces the volume of data to process and allows the entity extraction to focus on relevant content.</li>
<li>Keyword-based entity detection: Instead of using full-fledged NER models, you can create a list of relevant keywords or entities specific to the domain of interest. This can help in detecting events of interest with lower computational cost.</li>
<li>Incremental entity extraction: Instead of processing the entire data stream at once, perform entity extraction incrementally as new tweets arrive. This can help distribute the computational load over time, making it more manageable.</li>
<li>Parallelization: Utilize parallel processing techniques to distribute the entity extraction task across multiple cores or machines, which can significantly speed up the process and reduce the overall computational cost.</li>
</ol>
<p>By incorporating these strategies, you can reduce the cost of detecting entities in Twitter data streams while still effectively identifying and tracking events.</p>
<p><strong>(ii)If you were to use tf-idf concepts for representation, how would you capture them?</strong></p>
<p>To capture TF-IDF concepts for representation in the context of detecting events from Twitter data, follow these steps:</p>
<ol>
<li><p>Data preprocessing: Preprocess the tweets by removing irrelevant information (e.g., URLs, hashtags, user mentions), tokenizing the text, removing stop words, converting all text to lowercase, and performing lemmatization or stemming.</p>
</li>
<li><p>Term Frequency (TF): Calculate the term frequency for each term in each tweet. The term frequency is the number of times a term appears in a tweet divided by the total number of terms in that tweet. This step normalizes the frequency of terms in each tweet, accounting for varying tweet lengths.</p>
</li>
<li><p>Inverse Document Frequency (IDF): Calculate the inverse document frequency for each term across the entire Twitter data stream. The IDF measures the importance of a term by considering its rarity in the entire dataset. To calculate IDF, first compute the document frequency (DF) – the number of tweets containing a particular term. Then, compute the IDF as the logarithm of the total number of tweets divided by the DF.</p>
</li>
<li><p>TF-IDF representation: Compute the TF-IDF score for each term in each tweet by multiplying the TF and IDF values. This score represents the importance of a term in a tweet while considering its rarity in the entire dataset.</p>
</li>
<li><p>Feature vectors: For each tweet, create a feature vector with the TF-IDF scores of its terms. This can be represented as a sparse vector where each dimension corresponds to a unique term from the entire vocabulary across all tweets, and its value is the TF-IDF score for that term in the specific tweet. If a term is not present in a tweet, its value in the vector will be zero.</p>
</li>
<li><p>计算TF（Term Frequency，词频）：对于给定的文档d和词语t，它的TF值可以通过如下公式计算：</p>
<p>TF(t, d) &#x3D; (词语t在文档d中出现的次数) &#x2F; (文档d中词语总数)</p>
<p>其中，分子表示词语t在文档d中出现的次数，分母表示文档d中所有词语的总数。TF值反映了词语在当前文档中的重要程度，即出现次数越多，TF值越大。</p>
</li>
<li><p>计算IDF（Inverse Document Frequency，逆文档频率）：对于语料库中的所有文档和词语t，它的IDF值可以通过如下公式计算：</p>
<p>IDF(t) &#x3D; log((语料库中文档的总数) &#x2F; (包含词语t的文档数+1))</p>
<p>其中，分子表示语料库中所有文档的总数，分母表示包含词语t的文档数（加1是为了避免分母为0）。IDF值反映了词语在整个语料库中的重要程度，即出现文档数越少，IDF值越大。</p>
</li>
<li><p>计算TF-IDF：将TF和IDF相乘，得到词语t在文档d中的TF-IDF值。</p>
<p>TF-IDF(t, d) &#x3D; TF(t, d) * IDF(t)</p>
<p>TF-IDF值反映了词语t在文档d中的重要程度，同时也考虑了词语在整个语料库中的出现情况。在计算TF-IDF时，还可以对TF值进行平滑处理，例如使用下面的公式：</p>
<p>TF(t, d) &#x3D; 0.5 + 0.5 * (词语t在文档d中出现的次数) &#x2F; (文档d中词语总数)</p>
<p>这种平滑处理可以避免长文档中某个词语的TF值过高的问题。</p>
</li>
</ol>
<p><strong>(iii) How do you remove noisy or spam groups?</strong></p>
<p>Removing noisy or spam groups from a dataset involves filtering out irrelevant or low-quality content. Here are some strategies to identify and remove such groups:</p>
<ol>
<li>Text-based filtering: Analyze the content of the groups and apply filters to eliminate groups containing certain keywords or patterns that are commonly associated with spam or noise. For example, you can create a list of common spam keywords, phrases, or patterns, and remove groups that contain a high frequency of these terms.</li>
<li>Frequency-based filtering: Analyze the posting frequency of the groups. Spam or noisy groups often exhibit unusual posting patterns, such as posting the same content repeatedly, or posting at extremely high frequencies. Set a threshold for acceptable posting frequency and filter out groups that exceed this limit.</li>
<li>User-based filtering: Analyze the users contributing to the groups. If a group consists mostly of users with suspicious behavior or characteristics (e.g., newly created accounts, accounts with very few followers or following a large number of users), it might be a spam or noisy group. You can create a scoring system to rate the credibility of users and filter out groups with a high proportion of low-credibility users.</li>
<li>Group size: Small groups or groups with very few members might be more likely to be noisy or spammy. You can set a minimum group size threshold and remove groups that fall below this limit.</li>
<li>Language-based filtering: Analyze the language used in the groups. Spam or noisy groups may contain a high proportion of irrelevant    r nonsensical text, or text in a language that is not of interest for your analysis. Use natural language processing techniques, such as language detection, to filter out groups with content in unwanted languages or with a high proportion of unintelligible text.</li>
<li>Machine learning techniques: Train a machine learning model to classify groups as spam, noisy, or relevant based on features like text content, posting frequency, user characteristics, group size, and language. This approach can be more adaptive and effective in identifying spam and noisy groups, especially if the model is regularly updated with new data.</li>
</ol>
<p>By applying these strategies, you can identify and remove noisy or spam groups from your dataset, allowing for more accurate and meaningful analysis of the remaining content.</p>
<p><strong>(iv) How would you identify categories of events?</strong></p>
<p>1.Visualization, use diagram to demonstrate the top 20 most frequent words in a group, this can help us understand the topic of a group and help us to categorize the groups. Or use the PCA to reduce the dimensionality of the data and project it to a lower space, find the overlaps.</p>
<p>2.Cluster labeling, Assign descriptive labels to the groups based on the representative information extracted in the previous step. You can manually analyze the most frequent terms, key phrases, or named entities in each group and assign a suitable category label. Alternatively, you can use an automated approach like extracting the most frequent terms or key phrases as labels.</p>
<p><strong>(v) Provide an algorithm for combining similar groups of tweets (e.g., tweets containing same entities).</strong></p>
<ol>
<li>Extract entities from each group:<ul>
<li>For each group, extract the named entities (e.g., people, organizations, locations) from the text of the tweets and articles.</li>
<li>You can use a Named Entity Recognition (NER) library like spaCy or Stanford NER to perform this task.</li>
</ul>
</li>
<li>Calculate entity similarity between groups:<ul>
<li>Create a function to compute the similarity between two groups based on the shared entities.</li>
<li>You can use the Jaccard similarity coefficient, which is the size of the intersection of entities divided by the size of the union of entities for each pair of groups.</li>
</ul>
</li>
<li>Combine similar groups based on a similarity threshold:<ul>
<li>Set a similarity threshold (e.g., 0.5) to decide whether two groups should be combined.</li>
<li>For each pair of groups:<ul>
<li>Compute the entity similarity using the function created in step 2.</li>
<li>If the similarity score is greater than or equal to the threshold:<ul>
<li>Combine the two groups into one.</li>
<li>Update the entity set of the combined group.</li>
<li>Remove the original groups from the list of groups.</li>
</ul>
</li>
</ul>
</li>
<li>Repeat this process until no more groups can be combined based on the similarity threshold.</li>
</ul>
</li>
</ol>
<p> <strong>here are some other features than entities you can use to combine similar groups:</strong></p>
<ol>
<li>Term Frequency (TF):<ul>
<li>Use the frequency of terms within each group as a feature. Calculate the similarity between groups based on the overlap of their most frequent terms.</li>
</ul>
</li>
<li>Key phrases:<ul>
<li>Extract key phrases from the text in each group using techniques like RAKE (Rapid Automatic Keyword Extraction) or TextRank. Compare the groups based on the overlap of their key phrases.</li>
</ul>
</li>
<li>Sentiment analysis:<ul>
<li>Calculate the average sentiment score of each group using a sentiment analysis library or pre-trained model. Combine groups with similar sentiment scores.</li>
</ul>
</li>
<li>Topic modeling:<ul>
<li>Apply topic modeling techniques like Latent Dirichlet Allocation (LDA) to the dataset. Compare groups based on the distribution of topics within each group.</li>
</ul>
</li>
<li>Word embeddings:<ul>
<li>Use pre-trained word embeddings like Word2Vec, GloVe, or BERT to represent the text within each group. Calculate the average embedding for each group and compare groups using cosine similarity or other distance metrics.</li>
</ul>
</li>
<li>N-grams:<ul>
<li>Extract N-grams (sequences of N consecutive words) from the text within each group. Compare groups based on the overlap of their most frequent N-grams.</li>
</ul>
</li>
<li>Text similarity:<ul>
<li>Calculate the average pairwise text similarity within each group using a text similarity measure like cosine similarity, Jaccard similarity, or edit distance. Combine groups with similar average text similarity scores.</li>
</ul>
</li>
<li>Hashtags and user mentions:<ul>
<li>For Twitter data, extract hashtags and user mentions from the tweets within each group. Compare groups based on the overlap of their most frequent hashtags and user mentions.</li>
</ul>
</li>
</ol>
<p>(vi) how do we find the brusting clusters?</p>
<p>To find bursting clusters, you can use a sliding window algorithm combined with a clustering method. The idea is to divide the data into time windows and apply clustering within each window to identify groups of similar items. By comparing the clusters across different time windows, you can detect bursts of activity. Here’s an outline of the algorithm:</p>
<ol>
<li>Divide the data into time windows:<ul>
<li>Choose an appropriate window size and step size based on the dataset and the expected duration of bursts.</li>
<li>Divide the data into non-overlapping or overlapping time windows accordingly.</li>
</ul>
</li>
<li>Apply clustering within each time window:<ul>
<li>For each time window, preprocess the data (e.g., tokenize, remove stop words, stemming&#x2F;lemmatization) and create feature vectors using methods like TF-IDF or word embeddings.</li>
<li>Apply a clustering algorithm (e.g., K-means, DBSCAN) to the feature vectors within the window to group similar items.</li>
</ul>
</li>
<li>Detect bursts by comparing clusters across adjacent time windows:<ul>
<li>Define a burst detection criterion, such as a significant increase in the number of items within a cluster or the emergence of a new cluster with a large number of items.</li>
<li>For each pair of adjacent time windows, compare the clusters and identify those that meet the burst detection criterion.</li>
</ul>
</li>
</ol>
<p>Here’s a pseudo-code for the algorithm:</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">phpCopy code</span><br><span class="line">function preprocess_and_vectorize(data):</span><br><span class="line">    preprocessed_data = preprocess_text(data)</span><br><span class="line">    feature_vectors = create_feature_vectors(preprocessed_data)</span><br><span class="line">    return feature_vectors</span><br><span class="line"></span><br><span class="line">function cluster_data(feature_vectors):</span><br><span class="line">    clusters = apply_clustering_algorithm(feature_vectors)</span><br><span class="line">    return clusters</span><br><span class="line"></span><br><span class="line">function detect_bursts(window_clusters, burst_threshold):</span><br><span class="line">    bursts = []</span><br><span class="line">    for i in range(len(window_clusters) - 1):</span><br><span class="line">        for cluster in window_clusters[i]:</span><br><span class="line">            next_window_cluster = find_corresponding_cluster(cluster, window_clusters[i + 1])</span><br><span class="line">            if not next_window_cluster:</span><br><span class="line">                continue</span><br><span class="line">            growth = len(next_window_cluster) - len(cluster)</span><br><span class="line">            if growth &gt;= burst_threshold:</span><br><span class="line">                bursts.append((cluster, next_window_cluster))</span><br><span class="line">    return bursts</span><br><span class="line"></span><br><span class="line">data = load_data()</span><br><span class="line">window_size = ...</span><br><span class="line">step_size = ...</span><br><span class="line">burst_threshold = ...</span><br><span class="line"></span><br><span class="line">time_windows = create_time_windows(data, window_size, step_size)</span><br><span class="line">window_clusters = []</span><br><span class="line"></span><br><span class="line">for window in time_windows:</span><br><span class="line">    feature_vectors = preprocess_and_vectorize(window)</span><br><span class="line">    clusters = cluster_data(feature_vectors)</span><br><span class="line">    window_clusters.append(clusters)</span><br><span class="line"></span><br><span class="line">bursts = detect_bursts(window_clusters, burst_threshold)</span><br></pre></td></tr></table></figure>

<p>This algorithm divides the data into time windows, applies clustering within each window, and detects bursts based on changes in cluster sizes across adjacent windows. You can customize the window size, step size, clustering algorithm, and burst detection criterion based on your specific dataset and use case.</p>
<p>(b) Describe a methodology to predict stock trend prediction from social media data</p>
<p>StockNet (Deep Learning method)</p>
<p>StockNet is a hypothetical term that could refer to a network or system that aims to predict stock trends. While I’m not aware of a specific tool called “StockNet,” there are many approaches to predicting stock trends using machine learning and artificial intelligence techniques. One such approach is using deep learning models like recurrent neural networks (RNNs), long short-term memory (LSTM) networks, or convolutional neural networks (CNNs).</p>
<p>To use a deep learning model like “StockNet” to predict stock trends, follow these general steps:</p>
<ol>
<li>Data collection: Gather historical stock data, such as stock prices, trading volumes, and other relevant financial indicators. You may obtain this data from financial data providers, public financial statements, or web scraping.</li>
<li>Data preprocessing: Clean and preprocess the data to eliminate noise, handle missing values, and convert categorical data into numerical formats. This step may also involve feature engineering to create new features that may be relevant for prediction.</li>
<li>Feature scaling: Scale or normalize the features to ensure that they have similar ranges and are suitable for input into a deep learning model.</li>
<li>Train-test split: Split the dataset into training and testing sets. The training set will be used to train the model, while the testing set will be used to evaluate its performance.</li>
<li>Model selection: Choose an appropriate deep learning model based on your data and problem. Common choices include RNNs, LSTMs, and CNNs.</li>
<li>Model training: Train the selected model on the training data. This involves adjusting the model’s parameters to minimize the prediction error. You may need to experiment with different hyperparameters, such as learning rate, batch size, and the number of hidden layers.</li>
<li>Model evaluation: Evaluate the model’s performance on the testing data. Common evaluation metrics include mean squared error (MSE), mean absolute error (MAE), and R-squared.</li>
<li>Fine-tuning: If the model’s performance is unsatisfactory, fine-tune it by adjusting the hyperparameters, modifying the model architecture, or changing the features used.</li>
<li>Prediction: Once the model has been fine-tuned and performs well on the testing data, use it to predict future stock trends based on the input features.</li>
</ol>
<p>Keep in mind that predicting stock trends is inherently difficult due to the complex and dynamic nature of financial markets. No model can guarantee accurate predictions, and it is essential to manage risks and avoid relying solely on model predictions for making investment decisions.</p>
]]></content>
      <categories>
        <category>Courses</category>
      </categories>
      <tags>
        <tag>Courses</tag>
      </tags>
  </entry>
  <entry>
    <title>project_notes</title>
    <url>/2023/06/19/project-notes/</url>
    <content><![CDATA[<h1 id="Master-Dissertation"><a href="#Master-Dissertation" class="headerlink" title="Master Dissertation"></a>Master Dissertation</h1><h2 id="week1"><a href="#week1" class="headerlink" title="week1"></a>week1</h2><h3 id="Microservice-Docker-Explanation"><a href="#Microservice-Docker-Explanation" class="headerlink" title="Microservice, Docker Explanation:"></a><strong>Microservice, Docker Explanation:</strong></h3><p><strong>Service Grid</strong> and <strong>Microservice Communication</strong>: The Service Grid is an infrastructure layer that handles service-to-service communication. As the number of microservices increases, so does the complexity of communication between services. Service Grids such as Istio and Linkerd help solve this problem, but there is still much room for research and exploration, including communication efficiency, security, observability, and control.</p>
<p><strong>Container orchestration</strong> and <strong>scheduling</strong>: With the growing popularity of containerized applications, how to effectively manage and schedule these containers has become an important issue. Although Kubernetes has become the de facto standard, further research is needed on how to optimize scheduling strategies, how to save resources while ensuring performance, and how to perform container scheduling in multi-cloud environments.</p>
<p><strong>Performance</strong> and <strong>Scalability of Microservices</strong>: With the widespread adoption of microservice architectures, how to improve the performance and scalability of microservices is an important research issue. This includes how to design an efficient microservice architecture, how to optimize the performance of microservices, and how to effectively scale up and down microservices.</p>
<p><strong>Security of containers</strong> and <strong>microservices</strong>: Due to the dynamic and decentralized nature of containers and microservices, their security becomes an important research issue. This includes how to ensure the isolation of containers, how to protect the communication between microservices, and how to prevent malicious code from running in container and microservice environments, etc.</p>
<p><strong>Testing</strong> and <strong>verification of microservices</strong>: The independence and dynamic nature of microservices brings new challenges for testing and verification. How to conduct effective microservice testing, how to verify the correctness of microservices, and how to perform continuous integration and continuous deployment of microservices are all issues that need to be studied.</p>
<p><strong>Fault detection</strong> and <strong>recovery</strong>: In a distributed environment, fault detection and recovery is a very important issue. This includes how to quickly detect faults, how to accurately locate the cause of faults, and how to automatically restore services.</p>
<h3 id="How-and-why-decoupling"><a href="#How-and-why-decoupling" class="headerlink" title="How and why decoupling?"></a><strong>How and why decoupling?</strong></h3><p>Decoupling and transforming a project into a microservice architecture while containerizing it using Docker can improve system scalability, maintainability, and disaster recovery. The following are some basic steps:</p>
<ol>
<li>Determine microservice boundaries: The first step is to determine which microservices to decompose the large monolithic application into. This process requires understanding the business logic and identifying modules that can run independently and scale independently. A good microservice should be business-driven and can perform a specific business function independently.</li>
</ol>
<!---->

<ol start="2">
<li>Create inter-service communication mechanisms: In a microservice architecture, services need to communicate with each other over the network. You can choose to use REST, gRPC, or message queues for communication.</li>
</ol>
<!---->

<ol start="3">
<li>Designing data persistence: Each microservice should have its own independent database to reduce the coupling between services. But this also needs to address the issue of data consistency.</li>
</ol>
<!---->

<ol start="4">
<li>Build microservices: For each microservice, you can choose the programming language and framework that best suits the business logic of that service for development.</li>
</ol>
<!---->

<ol start="5">
<li>Create Docker containers: Pack each microservice into a Docker container. Each container contains all the dependencies and environments needed to run a microservice, which ensures that the microservice will run stably in any environment.</li>
</ol>
<!---->

<ol start="6">
<li>Orchestrate with Docker Compose or Kubernetes: These tools can help manage and deploy your Docker containers, as well as handle service discovery, load balancing, fault recovery, networking, and security.</li>
</ol>
<!---->

<ol start="7">
<li>Implement Continuous Integration and Continuous Deployment (CI&#x2F;CD): Automating builds, tests, and deployments can greatly improve development speed and software quality.</li>
</ol>
<p>The main benefits of doing so are as follows:</p>
<ol>
<li>Scalability: When the system load increases, services with higher demand can be scaled individually without the need to scale as a whole.</li>
</ol>
<!---->

<ol start="2">
<li>Maintainability: Each service runs independently, with a small code base that is easier to understand and modify.</li>
</ol>
<!---->

<ol start="3">
<li>Fault isolation: If something goes wrong with one service, it will not affect other services, reducing the risk of system failure.</li>
</ol>
<!---->

<ol start="4">
<li>Fast iteration: Each microservice can be deployed independently, making it faster to develop and bring new features online.</li>
</ol>
<!---->

<ol start="5">
<li>Technology diversity: Each microservice can choose the technology stack that best suits its business needs.</li>
</ol>
<p>Benefits from containerization: Using Docker containers simplifies the deployment process, ensures software consistency across environments, and provides better.</p>
<h3 id="Fog-computing"><a href="#Fog-computing" class="headerlink" title="Fog computing:"></a><strong>Fog computing:</strong></h3><p>Fog computing is a computing architecture in which a series of nodes receives data from IoT devices in real time. These nodes perform real-time processing of the data that they receive, with millisecond response time. The nodes periodically send analytical summary information to the cloud</p>
<h3 id="Projects-ideas"><a href="#Projects-ideas" class="headerlink" title="Projects ideas:"></a><strong>Projects ideas:</strong></h3><p><strong>Docker and distributed architecture application in cloud computing platform.</strong></p>
<p><strong>Decouple a project into microservices architecture (Monometer -&gt; microservice, use brownfield projects).</strong></p>
<p>Make sure every service we have is <strong>high cohesion, and low coupling</strong>.</p>
<p><strong>Avoid underserving</strong>. The system says no more than four calls. This ensures a moderate level of service. In addition, it is important to think about the team in terms of making the team light enough to decouple microservices from each other. From the above aspects, to avoid the problem of microservices too small.</p>
<p>Some open source manometer projects: <span style="color: rgb(65, 131, 196)"><a href="https://github.com/BroadleafCommerce/BroadleafCommerce" rel="noopener noreferrer nofollow">BroadleafCommerce</a></span>, <span style="color: rgb(65, 131, 196)"><a href="https://github.com/jhipster/generator-jhipster" rel="noopener noreferrer nofollow">https://github.com/jhipster/generator-jhipster</a></span></p>
<p>Decompose by business capability model&#x2F;Decompose by subdomain pattern (DDD).</p>
<h2 id="week2"><a href="#week2" class="headerlink" title="week2"></a>week2</h2><h3 id="Paper-review"><a href="#Paper-review" class="headerlink" title="Paper review"></a>Paper review</h3><p>Summary and baselines</p>
<p><a href="zotero://note/u/F2ET4VTB/" rel="noopener noreferrer nofollow" zhref="zotero://note/u/F2ET4VTB/" ztype="znotelink" class="internal-link">Will_edge_autoscaling</a></p>
<p><a href="zotero://note/u/LLKLWX39/" rel="noopener noreferrer nofollow" zhref="zotero://note/u/LLKLWX39/" ztype="znotelink" class="internal-link">ML-based scaling management for kube</a></p>
<p><a href="zotero://note/u/ZRBM8KGM/" rel="noopener noreferrer nofollow" zhref="zotero://note/u/ZRBM8KGM/" ztype="znotelink" class="internal-link">PBScaler: A Bottleneck-aware Autoscaling Framework for Microservice-based Applications</a></p>
<p><a href="zotero://note/u/ZJ4GRYZR/" rel="noopener noreferrer nofollow" zhref="zotero://note/u/ZJ4GRYZR/" ztype="znotelink" class="internal-link">Microscaler: Automatic Scaling for Microservices with an Online Learning Approach”</a></p>
<p><a href="zotero://note/u/NL4AQ6DY/" rel="noopener noreferrer nofollow" zhref="zotero://note/u/NL4AQ6DY/" ztype="znotelink" class="internal-link">Autopilot: workload autoscaling at Google</a></p>
<p><a href="zotero://note/u/YIAM47M4/" rel="noopener noreferrer nofollow" zhref="zotero://note/u/YIAM47M4/" ztype="znotelink" class="internal-link">Adaptive scaling of Kubernetes pods</a></p>
<p><a href="zotero://note/u/E4TSY6WJ/" rel="noopener noreferrer nofollow" zhref="zotero://note/u/E4TSY6WJ/" ztype="znotelink" class="internal-link">Proactive Autoscaling for Edge Computing Systems with Kubernetes</a></p>
<p><a href="zotero://note/u/QEET6TKX/" rel="noopener noreferrer nofollow" zhref="zotero://note/u/QEET6TKX/" ztype="znotelink" class="internal-link">SHOWAR: Right-Sizing And Efficient Scheduling of Microservices</a></p>
<h3 id="Relative-project"><a href="#Relative-project" class="headerlink" title="Relative project"></a>Relative project</h3><p><a href="https://github.com/jthomperoo/custom-pod-autoscaler">https://github.com/jthomperoo/custom-pod-autoscaler</a></p>
<p><strong>Custom Pod Autoscaler</strong></p>
<p>HPA cons: hard coded algorithm, CPA provides you flexibility in my scaling.</p>
<h2 id="Week3"><a href="#Week3" class="headerlink" title="Week3"></a>Week3</h2><p>Autopilot&#x2F; LOTUS</p>
<p>CPA</p>
<h2 id="Week4"><a href="#Week4" class="headerlink" title="Week4"></a>Week4</h2><p>PPA&#x2F;PBScaler&#x2F;LOTUS&#x2F;Autopilot</p>
<p>Let’s start with PPA</p>
<p><strong>摘要</strong></p>
<p>随着物联网和5G技术的出现，边缘计算范式以更好的可用性、延迟控制和性能发挥着越来越重要的作用。然而，现有的边缘计算应用程序的自动缩放工具不能有效地利用边缘系统的异构资源，从而为性能改进留下了空间。在这项工作中，我们为Kubernetes上的边缘计算应用程序提出了一个主动Pod Autoscaler (PPA)。提议的PPA能够使用多个用户定义&#x2F;自定义指标提前预测工作负载，并相应地扩展和缩小边缘计算应用程序。在一个cpu密集型边缘计算应用实例中，进一步对PPA进行了优化和评估。可以得出结论，所提出的PPA在资源利用效率和应用程序性能方面都优于Kubernetes默认的pod自动缩放器。文章还强调了拟议购电协议未来可能的改进。</p>
<p><strong>一</strong></p>
<p>在过去的几十年里，云计算应用在各种广泛的领域中越来越受欢迎[4,18]。云计算供应商为用户提供按需可用的大量资源，包括计算单元、存储、网络设备，甚至服务和应用程序。云计算已经被证明在商业和技术方面都是成功的，并且这种方法为许多流行的应用程序(例如Netflix, DropBox, Spotify)提供了动力[13,15]。然而，云计算存在应用程序延迟的问题，这主要受限于客户端与数据中心之间的地理距离和网络带宽[12]。因此，云计算不能完全满足对延迟敏感的应用程序(例如视频游戏流、实时数据分析)的需求。</p>
<p>边缘计算是解决传统云计算延迟问题的一种很有前途的方法[14]，它将对延迟敏感的计算和数据存储移动到靠近网络边缘的客户端位置。边缘计算具有较低的延迟、带宽占用和开销，在实现智慧城市、智能电网、智能交通等方面发挥着重要作用[11]。</p>
<p>在现实场景中，云计算和边缘计算应用程序的自动伸缩是必不可少的[3,20]。随着工作负载的变化，自动伸缩工具会动态调整资源量，以保持每个计算&#x2F;存储单元的平均工作负载稳定。自动缩放为应用程序提供了更好的容错性、高可用性、高效的能耗和成本管理。</p>
<p>对于云计算，HPA作为Kubernetes提供的本地服务被广泛使用，Kubernetes是大多数云平台上事实上的云框架[8]。HPA以CPU利用率为衡量工作负载的指标，使用式1所示的算法以响应式方式扩展云应用程序。</p>
<p>![截屏2023-07-04 18.41.15](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-04 18.41.15.png)</p>
<p>然而，对于边缘计算，自动缩放是一个更复杂的问题[19]。尽管HPA在许多云计算案例中简单有效，但它并不完全能够自动扩展边缘计算应用，原因有三个:</p>
<p>HPA不是专门为边缘计算环境设计的，不知道异构边缘资源的约束和能力;</p>
<p>HPA仅考虑CPU利用率来估计工作负载。然而，对于边缘计算应用程序，在扩展应用程序时，有关系统的其他信息(例如作业队列、I&#x2F;O、请求速率)也是必不可少的;</p>
<p>HPA是基于规则的，不可编程的，服务提供商很难定制HPA来满足他们对边缘计算应用的特定需求</p>
<p>一种很有前途的方法是为边缘计算应用程序开发一个主动的自动缩放器，该自动缩放器支持多个度量和可定制的算法。然而，开发这样的自动缩放器是具有挑战性的。从理论上讲，由于边缘资源的异质性和局限性，预测边缘系统的工作负载和扩展pod形成了一个时间序列分析和多目标优化的混合问题。实际上，从不同的来源收集多个度量标准并以统一的方式组织依赖于各种库的自定义算法是一个复杂的多框架工程问题。在这项工作中，我们提出了一个多指标支持和可定制的主动pod自动缩放器。自动扩展器能够收集多个指标，预测工作负载并提前扩展目标应用程序。此外，它允许用户自定义他们自己的扩展策略和预测模型，以更好地适应他们的应用程序。这项工作的主要贡献包括:</p>
<p><strong>(1)为自动缩放边缘计算应用引入主动工作流。</strong></p>
<p><strong>(2)在Kubernetes上实现多指标支持和可定制的自动缩放器。</strong></p>
<p><strong>(3)提供一个示例应用程序，以演示所建议的自动缩放器的性能。</strong></p>
<p>本文的其余部分组织如下。相关文献在第2节中进行了回顾。在第3节中，说明了本工作中边缘系统环境的设计。在第4节中，详细解释了所提出的自动缩放器的体系结构和算法。第5节和第6节介绍了所建议的自动缩放器的实验设计和结果。第7节总结了工作，并强调了进一步可能的改进。</p>
<p><strong>二</strong></p>
<p>考虑到HPA作为一个基准，许多研究工作已经开始探索HPA的替代方案，以用于托管在容器上的云&#x2F;边缘应用程序。在本节中，将回顾有关被动和主动自动缩放技术的相关工作。此外，我们提出的主动Pod自动缩放器的必要性和其独特的功能进行了解释。</p>
<p><strong>2.1</strong></p>
<p>2019年，Fan等人报道了一种容器系统架构，提供了更高的自动缩放效率[22]。2020年，Salman和Marko的一篇文章探讨了除了CPU利用率之外应该考虑的其他关键因素[17]。可以肯定的是，为了更好地自动扩展云系统，除了CPU利用率之外，还需要多个指标。无功自缩放器的一个主要缺点是控制延迟。虽然一旦工作负载发生变化，容器就会被扩展，但是容器的初始化或终止需要时间。</p>
<p><strong>2.2</strong></p>
<p>为了改进响应式pod自动扩展器，它有望预测工作负载并提前做出扩展决策，即主动&#x2F;预测自动扩展。2016年，Yang等人提出了一种基于时间序列分析预测容器CPU使用情况的主动自缩放算法CRUPA[9]。另一个例子来自Tian等人，他们在2017年报告了一个预测自动缩放框架[21]。为了提供更好的服务质量，提出了一种结合CPU利用率预测和服务水平协议的混合自扩展策略。机器学习模型在时间序列分析中得到了很多关注[16]，一些报道的主动自动标度器是基于机器学习模型的。2020年，Mahmoud, Imtiaz和Mohammad提出了一种基于机器学习的主动自动缩放器，它利用LSTM和多个指标来预测工作负载[6]。虽然有一些关于云系统的主动自动缩放的工作，但边缘计算系统的主动自动缩放很少。据我们所知，只有一篇文章报道了边缘系统的主动自动缩放[1]。建立了预训练的神经网络模型，并将其作为运行系统中CPU利用率的预测模型。预测的CPU指标用于估计副本的数量。表1比较了相关工作和我们提出的方法。我们提出的主动Pod自动缩放器(PPA)具有以下特点:</p>
<p>•考虑到异构资源的限制和约束，这是少数关注边缘计算应用程序自动缩放的研究之一。</p>
<p>•支持多个指标(CPU, RAM, I&#x2F;O利用率)和自定义指标来自动扩展应用程序，为工作负载估计和预测提供替代指标。尽管CPU利用率在许多情况下能够预测工作负载，但一些应用程序需要多个或特定于应用程序的指标来做出扩展决策。</p>
<p>•PPA灵活且与模型无关。与其他具有固定预测模型的主动pod自动缩放器不同，拟议的PPA支持自定义模型和多个模型框架(例如TensorFlow, statmodels等)。用户可以将自己的模型注入到PPA中，以获得适合自己应用的最佳性能。</p>
<p>•购电协议可以考虑信心因素。如果注入的模型是贝叶斯模型，对每个预测产生置信度&#x2F;不确定性估计，那么所提出的自动标度器只有在预测置信度超过预设置信度阈值时才会主动工作，否则它会被动工作</p>
<p><strong>三</strong></p>
<p>现在详细介绍了所考虑的云和边缘环境的设置。</p>
<p><strong>3.1 边缘计算的环境</strong></p>
<p>![截屏2023-07-04 19.18.26](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-04 19.18.26.png)</p>
<p>![截屏2023-07-04 19.19.38](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-04 19.19.38.png)</p>
<p>图1显示了我们为Kubernetes连接的云&#x2F;边缘计算环境编排的拓扑结构。表2介绍了系统中节点分配的资源。不同节点分配的资源有限且大小不一，而云节点拥有更强的计算能力和更大的内存资源。该系统描绘了一个典型边缘计算环境的真实世界模型。</p>
<p>![截屏2023-07-04 19.20.41](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-04 19.20.41.png)</p>
<p><strong>3.2 集群组件</strong></p>
<p>除了Kubernetes核心之外，集群还包含三个用于系统监控的逻辑组件，包括导出器、Prometheus堆栈和自动缩放器。集群的监控系统对于成功运行所建议的云&#x2F;边缘计算框架起着至关重要的作用。该系统基于Prometheus[5]，这是云计算和边缘计算环境中最流行的框架之一。不同类型的导出器负责生成不同的度量标准。在考虑的边缘计算环境中，节点导出器部署在每个节点上用于节点级指标，并为用户部署可自定义导出器以生成&#x2F;提取用户自定义指标(例如请求率，排队任务数等)作为自定义指标。普罗米修斯堆栈由三部分组成——普罗米修斯、Grafana和普罗米修斯适配器。指标由Prometheus从出口商收集，并使用Grafana进行可视化。收集到的指标也由Prometheus Adapter在标准API中公开，以便其他pod能够以统一的方式获取它们。从Prometheus Adapter，自动扩展器获取所有类型的所需指标，评估所需副本的数量，并向Kubernetes主控制面板发出扩展决策请求。Kubernetes负责处理扩展请求和在节点上调度新的pod。</p>
<p><strong>四</strong></p>
<p>在本节中，介绍了所提出的主动Pod自动缩放器的体系结构和算法。首先阐述了PPA的结构和工作流程。然后，对PPA各组成部分的详细算法进行了推导和说明。</p>
<p><strong>4.1 架构</strong></p>
<p>![截屏2023-07-04 19.32.26](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-04 19.32.26.png)</p>
<p>图2显示了提议的主动pod自动缩放器的结构。PPA由三个组件(Formulator、Evaluator和Updater)组成，在两个循环中工作(控制循环和模型更新循环)，并维护两个文件(度量历史文件和模型文件)。PPA的初始化需要将预训练的种子模型作为初始模型文件注入框架中。</p>
<p>在每个控制循环中，PPA负责使用收集到的指标扩展目标pod。Formulator从Prometheus Adapter获取原始指标，并对其进行预处理。制定的度量存储在度量历史文件中，并传递给评估者。然后，Evaluator从model file中加载模型，预测所需副本的数量，并向Kubernetes控制面板发出缩放请求。</p>
<p>在每个模型更新循环中，Updater从度量历史文件中加载训练数据，更新模型，删除度量历史文件，并将模型重新保存到模型文件中。有了Updater，用于预测的模型就可以针对新的工作负载模式不断更新。</p>
<p><strong>4.2算法</strong></p>
<p><strong>4.2.1 评估器evaluator</strong></p>
<p>算法1描述了评估器的工作原理。对于每个PPA，必须将一个关键指标设置为工作负载的估计器，注入的预测模型使用收集的指标来预测关键指标。为了从预测的关键指标中获得所需的副本数量，应该定义一个静态策略。在本工作中，使用第1节中描述的基于阈值的HPA算法作为默认的静态策略。但是，静态策略是可定制的，用户可以在PPA中注入自己的策略。</p>
<p>![截屏2023-07-04 19.41.37](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-04 19.41.37.png)</p>
<p><strong><code>model.isBayesian()</code> 是检查模型是否为贝叶斯模型的条件。贝叶斯模型是一种统计模型，它使用贝叶斯定理进行推断和预测。在这段代码中，如果模型是贝叶斯模型并且预测的置信度低于阈值，就会选择使用当前的关键度量指标而不是模型预测的结果。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Result: Number of replicas to be requested</span><br><span class="line"></span><br><span class="line">Get current_metrics, current_replicas;</span><br><span class="line"></span><br><span class="line">Set max_relicas of system;</span><br><span class="line"></span><br><span class="line">if bottleneck_check == False then</span><br><span class="line">	num_replicas = 1</span><br><span class="line">else if current_replicas &lt; max_relicas then</span><br><span class="line">	num_replicas = GA(Genetic_algorithm_init_parameters, current_metrics, current_replicas)</span><br><span class="line">else</span><br><span class="line">	num_replicas = max_relicas</span><br></pre></td></tr></table></figure>

<p>​	</p>
<p><strong>4.2.2 模型的协议</strong></p>
<p>所有满足以下协议的时间序列模型都可以注入进行指标预测:</p>
<p>(1)时间窗口大小:所有模型的时间窗口大小固定为1个单位，表明模型使用上一个回路的指标预测下一个控制回路的工作量。这是由新pod的初始化时间成本决定的，它通常需要不到一个时间间隔的控制循环。</p>
<p>(2)输入输出指标:模型的指标应按以下顺序输入[CPU, RAM，网络输入，网络输出，自定义指标]。该模型应该预测所有输入指标，但只有一个被设置为关键指标。</p>
<p><strong>4.2.3升级器的模型更新策略Model Update Policy of the Updater</strong></p>
<p>虽然Updater的工作流程是固定的，但我们提出了3种不同的策略来更新种子模型(称为模型更新策略):</p>
<p>(1)不重新训练模型:在整个执行过程中使用注入的种子模型而不更新。如果种子模型在稳定的工作负载下能够产生令人满意的结果，则无需定期更新模型，成本较大;</p>
<p>(2)从头开始重新训练模型:在每个模型更新循环中，Updater丢弃旧模型并从头开始训练具有与种子模型相同架构的新模型。在不同日子的工作负载变化很大的情况下，基于旧数据的模型不一定适合未来几天的工作负载模式;</p>
<p>(3)更新模型:使用上一个模型更新循环的数据对旧模型进行多几个epoch的再训练。在许多情况下，模式的工作负载确实会发生变化，但变化不大，并且可以将旧模型用作更新过程的起点。</p>
<p>这里我们提供了三个选项，对于不同的应用程序和不同的工作负载模式，最佳策略可能不同。</p>
<p><strong>五. 实验</strong></p>
<p>实验的目的是优化所提出的主动Pod自动缩放器的示例应用，并与HPA进行比较，验证其性能。在本节中，首先介绍示例应用程序和工作负载的生成。然后详细介绍了PPA优化和评价的实验细节。</p>
<p><strong>5.1 示例应用</strong></p>
<p>![截屏2023-07-06 12.11.29](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 12.11.29.png)</p>
<p><strong>5.1.1 拓扑图</strong></p>
<p>图3显示了托管在边缘计算集群上的示例应用程序的体系结构。示例应用程序分布在一个云和两个边缘区域中。在每个区域，都部署一些支持性的静态pod和服务，它们是固定的，不是为可扩展而设计的。只有每个区域中的worker pods才是自动缩放器要缩放的目标。</p>
<p><strong>5.1.2 工作流和作业</strong> </p>
<p>在示例应用程序中，定义了两种不同类型的任务。第一种是对长度为3000的随机数组进行排序(称为sort task)，复杂度为𝑛log𝑛;第二种是计算维数为1000 × 1000的随机矩阵的特征值(称为eigen task)，复杂度为𝑛3。所有请求都是从设备生成的，它们到达最靠近其位置的边缘的入口点。每个请求要么是排序任务，要么是特征任务。具有排序任务的任务计算成本不高，由边缘工作者处理，而具有特征任务的任务由于计算成本高而转发给云工作者。本工作中的示例应用程序是模拟典型的cpu密集型应用程序，这些应用程序在一般和科学计算中都很常见(例如天气预报、搜索算法、音频&#x2F;视频处理等)。基于示例应用的结论具有通用性。</p>
<p><strong>5.2 工作负载生成</strong></p>
<p>本工作中考虑了两种不同的工作负载，即随机存取和美国国家航空航天局(NASA)数据集。它们在下文中有描述。</p>
<p><strong>5.2.1随机访问</strong></p>
<p>如图算法2所示，Random Access的设计是为了生成随机工作负载进行优化实验。Sort和Eigen任务分别以0.9和0.1的概率生成，以模拟大多数成本低的请求在边缘处理，而成本高的任务在云中完成。通过定期使用3种不同的工作负载模式(即轻、中、重)访问应用程序，自动缩放器有望覆盖实际使用中可能出现的大多数情况。![截屏2023-07-06 12.25.27](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 12.25.27.png)</p>
<p><strong>5.2.2 NASA数据集</strong></p>
<p>NASA数据集用于模拟真实世界的访问[10]，用于评估实验。所有的访问记录都是由NASA肯尼迪航天中心的WWW服务器收集的，每个日志都包含其访问时间戳。通过累积每分钟的访问请求来预处理原始日志文件，并使用聚合的日志数量向应用程序发出请求。包含2个月记录的数据集的所有请求的综合实验集将非常耗时。</p>
<p>在这项工作中，从数据集中选择2天的子集进行实验。同时，将请求数调整到适当的规模，使峰值工作负载不超过实验边缘环境的资源限制。</p>
<p><strong>5.3 Experiments for optimization</strong></p>
<p>对PPA的三个超参数进行了优化，包括工作量预测模型、更新策略和关键指标。优化问题如式2所示。其中，𝛾为应用程序的响应时间，𝑊为浪费资源的总和，𝑀为预测模型，𝑈为模型更新策略，𝐾为关键指标Key metric，A为目标应用, Rp是分配给pod p的资源, 𝑃𝑛是在节点𝑛上托管的所有pod的集合, 𝑁是所有节点的集合。在这里，目标应用程序A是固定的，并且要优化𝑀、𝑈、𝐾以最小化𝛾和𝑊。</p>
<p>![截屏2023-07-06 13.19.08](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 13.19.08.png)</p>
<p><strong>5.3.1 预测模型优化</strong></p>
<p>针对实例应用，对不同的指标预测模型进行了比较和优化，并以自回归移动平均(ARMA)模型和长短期记忆(LSTM)模型为典型模型。</p>
<p>实验采用ARMA(1,1,1)，表示其移动平均部分阶数和自回归部分阶数均设为1，模型时间窗为1。ARMA模型的超参数是根据收集到的数据预先选择的。</p>
<p>我们使用的LSTM模型由一个50个神经元的LSTM层和一个由ReLu函数激活的全连接层[2]组成。输出层的形状被设置为5，以适应所有未来的指标。LSTM模型的损失函数为均方误差(Mean Squared Error, MSE)，优化器为Adam optimizer[7]。</p>
<p>这两个模型都使用在单个不受约束的节点上运行示例应用程序10个小时并使用Random Access生成的工作负载收集的数据进行预训练。使用这两个模型对示例应用程序进行了200分钟的自动伸缩，并比较了CPU利用率的预测值和实际值。</p>
<p><strong>5.3.2 优化Update策略</strong></p>
<p>如4.2.3节所介绍的，提出并比较了3种不同的Updater方法。在本实验中，预训练的LSTM模型作为种子模型，并将CPU利用率定义为关键指标。为了缩短实验所需的时间，将模型更新循环的时间间隔设置为1小时。示例应用程序运行200分钟，每个PPA使用不同的更新策略自动缩放，并收集CPU利用率的预测值和实际值。</p>
<p><strong>5.3.3 关键指标的优化</strong></p>
<p>在本实验中，将所有pod的请求率或CPU利用率之和作为关键指标进行比较。同样，示例应用程序运行200分钟，每个PPA使用Random Access生成的工作负载自动缩放。由于关键指标的差异，不可能将两个ppa与预测指标进行定量比较。相反，将所有请求的响应时间和由两个ppa自动缩放的系统空闲资源进行比较，以量化两个ppa的性能。</p>
<p><strong>5.4 评价实验</strong></p>
<p>利用最优超参数对优化后的PPA进行真实场景评价。PPA通过最佳配置自动缩放，应用程序可以使用缩放后的NASA数据集的工作负载运行48小时。通过比较请求的响应时间和空闲资源，量化性能。应用程序的另一次运行是使用完全相同的配置进行的，这些配置由Horizontal Pod Autoscaler自动缩放，作为PPA的基线.</p>
<p><strong>6结果与讨论</strong></p>
<p>结果将在下文中提出和讨论。首先给出超参数优化结果，然后在已部署的场景中进行评估。</p>
<p><strong>6.1预测模型优化</strong></p>
<p>两种不同模型的PPA结果如图4所示。观察结果表明，两个模型都能够捕捉到CPU利用率的趋势，而ARMA模型在拟合方面稍好一些。但从数量上看，LSTM模型预测的MSE为53240.972,ARMA模型预测的MSE为96867.631，后者要大得多。这表明，在预测CPU利用率时，ARMA模型提供了显著的变化，而<strong>LSTM模型</strong>能够产生相对更准确的预测。可以得出结论，LSTM在预测示例应用程序的CPU利用率方面优于ARMA模型。</p>
<p>![截屏2023-07-06 13.49.25](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 13.49.25.png)</p>
<p><strong>6.2优化升级策略</strong></p>
<p>图5对具有不同策略的三个ppa进行了比较。采用策略1、策略2和策略3的PPA产生的利用率预测MSE分别为64769.882、42180.437和30994.449，表明策略3在提出的模型更新策略中表现最好。我们得出的结论是，<strong>策略3</strong>在每个模型更新循环中使用新收集的指标重新训练模型，为示例应用程序提供了优于其他策略的最佳性能。</p>
<p>![截屏2023-07-06 13.59.09](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 13.59.09.png)</p>
<p><strong>6.3关键指标的优化</strong></p>
<p>在示例应用程序上比较PPA的两个关键指标，即请求率和CPU利用率。请求的响应时间和空闲资源用于定量地比较ppa的性能。图6显示了使用不同关键指标自动缩放的应用程序上请求的响应时间分布。两个分布的巨大重叠表明两个运行的响应时间非常接近。根据CPU利用率自动缩放的应用程序的平均响应时间为0.5156秒，标准偏差(STD)为0.0421，而根据请求率自动缩放的应用程序的平均响应时间为0.5157秒，标准偏差为0.420。由于时间分布没有显著差异，因此可以得出结论，在响应时间方面自动扩展示例应用程序时，两个关键指标是等效的。(这个图里面的黄线和蓝线估计是基本上重叠了)</p>
<p><img src="/../images/20230706141151279.png" alt="image-20230706141151279"></p>
<p>系统在𝑡时刻的相对空闲资源(RIR_t)(定义为公式3)用于定量地比较两个自动缩放器。具有两个关键指标的ppa的rir如图7所示。CPU请求率的平均RIR为0.317，标准差为0.161;CPU利用率的平均RIR为0.251，标准差为0.092。可以得出结论，以CPU利用率为关键指标的PPA效率更高，浪费的资源更少。此外，RIR的标准偏差较低表明，以CPU利用率为关键指标进行自动缩放时，系统更加稳定。</p>
<p>![截屏2023-07-06 14.17.32](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 14.17.32.png)</p>
<p>尽管具有不同关键指标的两个PPA为请求提供接近的响应时间，但是具有CPU利用率的PPA更节能，系统也更稳定。因此，<strong>CPU利用率</strong>是示例应用程序的最佳关键指标。</p>
<p><strong>6.4实验评价结果</strong></p>
<p>根据最优模型、关键指标和更新策略，对拟议的PPA进行5.4节所述的评估，并将PPA和HPA的性能与请求响应时间和空闲资源进行定量比较。</p>
<p><strong>6.4.1响应时间。</strong></p>
<p>图8显示了由PPA和HPA自动缩放的Sort任务的响应时间分布。HPA自动缩放的应用程序对边缘任务的平均响应时间为0.592秒，标准偏差(STD)为0.067;PPA自动缩放的应用程序的平均响应时间为0.508秒，标准偏差(STD)为0.038。PPA提供的响应时间明显小于HPA, p值小于10−3。此外，PPA提供的分布具有较小的标准差。可以看出，通过PPA自动伸缩的应用程序提供的边缘服务延迟更小，边缘系统更稳定。在特征任务中也观察到类似的结果。HPA和PPA提供的云任务的两个响应时间分布如图9所示。HPA自动缩放的应用程序对边缘任务的平均响应时间为13.382秒，标准差为1.606;PPA自动缩放的应用程序的平均响应时间为13.646秒，标准差为1.576。HPA提供的响应时间显著大于PPA，且p值小于10−3，对于Sort任务的标准差也是如此。因此，与HPA相比，PPA自动扩展的云服务具有更好的性能。</p>
<p>因此，可以得出结论，在边缘计算应用中，所提出的主动Pod Autoscaler在云服务和边缘服务方面都优于默认HPA，具有更低的延迟和更高的访问稳定性。</p>
<p>![截屏2023-07-06 14.22.45](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 14.22.45.png)</p>
<p>![截屏2023-07-06 14.23.25](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 14.23.25.png)</p>
<p><strong>6.4.2空闲资源</strong></p>
<p>图10显示了由PPA和HPA自动缩放的边缘工作节点的相对空闲CPU使用情况。HPA自动缩放的边缘工作线程平均相对空闲CPU为0.3209，标准差为0.1079;PPA自动缩放的边缘工作线程平均相对空闲CPU为0.2988,STD为0.1026。虽然两种自动缩放器的结果在视觉上是相似的，但PPA提供的相对空闲CPU明显小于PPA, p值小于10−3。因此，可以得出结论，PPA自动伸缩的应用程序的边缘工作节点比HPA自动伸缩的应用程序更有效地利用CPU资源。HPA和PPA自动伸缩的云工作节点的相对空闲CPU使用情况如图9所示。HPA自动伸缩的云工作者的平均相对空闲CPU为0.3373，标准差为0.1572;PPA自动伸缩的应用程序的平均相对空闲CPU为0.3098,STD为0.1453。HPA提供的相对空闲CPU明显大于PPA, p值小于10−3。因此，在云节点上，PPA自动伸缩的应用程序比HPA自动伸缩的应用程序浪费的CPU资源更少。综上所述，在请求响应时间和空闲资源方面，本文提出的<strong>Proactive Pod Autoscaler都优于默认的Horizontal Pod Autoscaler</strong>，为边缘计算应用带来更好的性能，获得更多的访问稳定性，并且浪费更少的资源。</p>
<p>![截屏2023-07-06 14.33.27](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-06 14.33.27.png)</p>
<p><strong>7结论与未来工作</strong></p>
<p>在这项工作中，我们提出了一种基于Kubernetes的边缘计算应用的主动pod自动缩放器(PPA)。PPA能够使用时间序列预测方法提前预测应用程序的到达工作负载，并根据需要伸缩应用程序。以cpu密集型应用程序为例，针对Kubernetes中的内置自动缩放器HPA对自动缩放器进行了优化和评估。可以得出结论，PPA能够更有效地利用资源，并为请求提供更快的响应时间。此外，所提出的自动缩放器具有高度的灵活性和可定制性，因此用户可以调整指标、预测模型和缩放策略，以更好地满足自己应用程序的需求。除了支持多个指标外，用户还可以定义自己的特定于应用程序的指标，以更好地扩展应用程序。这使得ppa能够适应各种类型的应用程序，例如实际使用中的数据密集型应用程序、IO密集型应用程序。拟议的PPA并不完美，因为它需要开发人员手动优化关键指标、模型和策略。在未来的工作中，可以通过自动化超参数优化来改进PPA。一种可能的方法可能涉及使用一组可能的指标运行应用程序，PPA的指定模块使用不同的方法自动建模收集的运行数据。然后可以使用验证技术从候选模型中选择最佳模型。通过这种方式，自动优化的PPA将更容易被开发人员部署和使用。</p>
<p><strong>PBScaler:一个基于微服务的应用程序的瓶颈感知自动伸缩框架</strong></p>
<p><strong>Introduction</strong></p>
<p>随着微服务架构的推进，越来越多的云应用从单片架构向微服务架构迁移[1]、[2]、[3]、[4]、[5]、[6]。这种新架构通过将一个单片应用程序分解为多个微服务，通过HTTP或RPC协议相互通信来减少应用程序耦合[7]。此外，每个微服务都可以由独立的团队独立开发、部署和扩展，从而实现快速的应用程序开发和迭代。然而，外部工作负载的不可预测性和微服务之间交互的复杂性会导致性能下降[8]，[9]，[10]。云提供商必须准备过多的资源来满足应用程序所有者的服务水平目标(service level objective, SLO)，这通常会造成不必要的资源浪费[11]，[12]。因此，满足SLO和最小化资源消耗之间的不平衡成为微服务中资源管理遇到的主要挑战。</p>
<p>微服务自动伸缩指的是根据工作负载变化弹性分配资源的能力[13]。通过利用微服务的弹性特性，自动扩展可以缓解资源成本和性能之间的冲突。然而，微服务的自动伸缩难以在短时间内准确地伸缩性能瓶颈(PB)。由于微服务之间通信的复杂性，PB的性能下降可能会通过消息传递传播给其他微服务[2]，导致同时出现大量异常微服务。我们通过在Google开发的开源微服务应用Online Boutique 1中向特定的微服务注入突发工作负载来证明这一点。图1显示，PB推荐中的性能下降会蔓延到上游微服务，如Checkout和Frontend。为了进一步验证准确扩展PB的重要性，我们进行了压力测试，并分别扩展了不同的微服务。如图2所示，微服务(前端)扩容异常并不能缓解SLO违规。然而，当我们确定并扩展PB推荐时，微服务应用程序的性能得到了改善。不幸的是，定位PBs通常很耗时，偶尔也会出错[14]。</p>
<p>近年来，已经提出了几种方法来在自动扩展之前识别关键的微服务。例如，Kubernetes 2的默认自动缩放器根据计算资源的静态阈值过滤微服务进行直接缩放。Yu等[15]通过计算服务功率来定义弹性缩放的边界，服务功率是第50百分位响应时间(P50)与第90百分位响应时间(P90)之比。此外，Qiu等人[4]引入了一种基于支持向量机的方法，通过分析各种尾部延迟的比率来提取关键路径。尽管这些研究缩小了自动扩展的范围，但它们仍然考虑了可能影响扩展策略的非瓶颈微服务，特别是当应用程序中大量微服务同时异常时。因此，在自动扩展之前，迫切需要精确地定位瓶颈微服务。为了平衡资源消耗和性能，现有的工作采用在线优化算法来寻找接近最优的自动缩放策略。然而，由于自动扩展的可能策略范围很广，这些方法需要大量的尝试，这对于在线应用程序来说是有问题的。例如，Train Ticket3是最大的开源微服务应用程序，由近40个微服务组成。假设每个微服务最多可以有15个副本，确定此应用程序的最佳分配策略无疑是一个np难题，因为最多有1540个可扩展选项。此外，在线优化中反馈回路的持续时间过长，难以实现模型收敛。考虑由在线优化引起的性能下降的潜在风险也很重要。图3显示了突发工作负载对MicroScaler的副本波动和延迟波动的影响[15]，MicroScaler是一种在线自动扩展方法，采用在线贝叶斯优化来寻找总成本的全局最小值。由于在线优化导致频繁的在线尝试创建副本(图3a)，导致振荡和性能下降(图3b)。因此，我们受到启发，设计了一个离线优化过程，由模拟器的反馈推动。</p>
<p>![截屏2023-07-08 15.25.06](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-08 15.25.06.png)</p>
<p>![截屏2023-07-08 15.26.32](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-08 15.26.32.png)</p>
<p>本文介绍了PBScaler，这是一个<strong>横向自动扩展框架</strong>，旨在通过识别和解决瓶颈来防止基于微服务的应用程序的性能下降。与之前的工作[11]、[15]所做的针对所有异常微服务优化资源不同，我们提出了TopoRank，一种基于拓扑势理论(TPT)的随机游走算法，用于识别性能瓶颈(PBs)。通过考虑微服务依赖关系和潜在异常，TopoRank提高了瓶颈定位的准确性和可解释性。在通过TopoRank识别PBs后，PBScaler进一步采用<strong>遗传算法</strong>来寻找接近最优的策略。为了避免过度优化引起的应用振荡，该过程离线进行，并由SLO违例预测器指导，该预测器模拟在线应用并向缩放策略提供反馈。本文的主要贡献总结如下:</p>
<p>•我们提出PBScaler，这是一个瓶颈感知自动伸缩框架，旨在防止基于微服务的应用程序中的性能下降。通过精确定位瓶颈，PBScaler可以减少不必要的扩展并加快优化过程。</p>
<p>•我们采用基于遗传算法的离线优化过程来优化资源消耗，同时避免违反SLO。此过程由SLO违规预测器指导，旨在在不中断在线应用程序的情况下在资源消耗和性能之间取得平衡。</p>
<p>•我们在Kubernetes系统中设计和实现PBScaler。为了评估其有效性，我们在两个在线环境中运行的广泛使用的微服务系统上进行了大量的真实世界和模拟工作负载注入实验。实验结果表明，PBScaler比几种最先进的弹性缩放方法性能更好。本文的其余部分组织如下。在第2节中，我们将讨论微服务的瓶颈分析和自动扩展的相关工作。在第3节中，我们详细描述了整个系统。在第4节中，我们给出了评估和实验结果。第五部分总结了我们的工作，并讨论了未来的研究方向。</p>
<p><strong>2 Related work</strong></p>
<p>随着云计算的发展，学术界和工业界提出了许多云资源(如虚拟机或容器)的自扩展方法[16]、[17]、[18]、[19]。然而，由于微服务之间错综复杂的依赖关系，微服务的自动伸缩可能要复杂得多。</p>
<p><strong>2.1 Bottleneck Analysis</strong></p>
<p>近年来，已经开发了许多用于微服务场景瓶颈分析的方法，其中大多数依赖于三种类型的数据:<strong>logs</strong>、<strong>Trace</strong>和<strong>metrics</strong>。</p>
<p>1)<strong>日志</strong>。Jia等[20]和Nandi等[21]首先从正常状态的日志中提取模板和流程，与目标日志进行匹配，过滤掉异常日志。</p>
<p>2)<strong>痕迹</strong>。Trace是一个基于事件跟踪的记录，它再现微服务之间的请求过程。一些研究[22]，[23]，[24]，[25]已经引入使用轨迹来确定瓶颈。Yu等人[22]、[23]结合频谱分析和PageRank算法在trace构建的依赖图上定位瓶颈，Mi等人[24]提出了无监督机器学习原型，学习微服务的模式，过滤异常微服务。然而，使用跟踪可能会干扰代码，并且要求操作人员对微服务的结构有深入的了解。</p>
<p>3)<strong>指标</strong>。一些方法[2]，[26]，[27]利用图随机游走算法来模拟异常的传播过程，然后通过集成度量的统计特征和微服务之间的依赖关系来找到瓶颈。此外，CauseInfer[14]和MicroCause[28]等方法侧重于用因果推理构建指标因果图，这通常涉及指标之间隐藏的间接关系。</p>
<p>由于在监控指标时很少修改工作流代码，因此为微服务收集指标通常比使用跟踪更便宜。此外，使用度量作为主要监控数据可以降低集成瓶颈分析和自动伸缩的成本，因为度量在后一种场景中被广泛使用。尽管这些方法具有优势，但大多数方法在选择异常回溯的起始点时没有偏好。相比之下，我们的方法从具有更大异常潜力的微服务开始随机漫步，加快了收敛速度并提高了瓶颈定位精度。</p>
<p><strong>2.2 Autoscaling for microservices</strong></p>
<p>现有的微服务自动伸缩方法可以分为五类。</p>
<p>**1)基于规则的启发式方法 **KHPA、Libra[29]、KHPA- a[30]和PEMA[31]基于资源阈值和特定规则管理微服务副本的数量。然而，由于不同的微服务对特定资源的敏感性不同，因此需要专业知识来支持这些不同微服务的自动伸缩。</p>
<p><strong>2)基于模型的方法</strong> 可以对微服务进行建模，以预测它们在特定配置和工作负载下的状态。排队论[32]、[33]和图神经网络(GNN)[12]常用来构建微服务的性能预测模型。</p>
<p><strong>3)基于控制理论的方法</strong> [11]，[32] 使用控制理论，SHOWAR[11]动态调整微服务副本，以纠正监控指标和阈值之间的错误。</p>
<p><strong>4)基于优化的方法</strong> 这些方法[15]、[34]在给定当前资源和工作负载的情况下，进行了大量的尝试来寻找最优策略。这些方法的关键在于缩小决策范围，加快决策进程。</p>
<p><strong>5)基于强化学习的方法</strong> 强化学习(RL)已广泛应用于微服务的资源管理。MIRAS[35]采用基于模型的RL方法进行决策，避免了真实环境的高采样复杂度。FIRM[4]利用支持向量机(SVM)识别微服务中的关键路径，并利用深度确定性策略梯度(DDPG)算法为路径上的微服务制定混合扩展策略。基于强化学习的方法需要在探索过程中不断与环境进行交互，并且无法适应动态微服务架构。</p>
<p>总之，尽管前面提到的自动缩放技术有各自的优势，但它们很少关注性能瓶颈。为非瓶颈微服务消耗计算机资源将不可避免地增加扩展成本和延长决策时间。另一方面，我们的方法侧重于定位性能瓶颈。</p>
<p><strong>3.System Design</strong></p>
<p>我们提出了PBScaler，一个以PB为中心的自动缩放控制器，用于定位PBs并优化它们的副本。如图4所示，PBScaler包括三个组件:</p>
<p>1)度量收集器<strong>Metric Collector</strong>:为了提供对应用程序状态的实时洞察，我们设计了一个度量收集器，它以固定的间隔从Prometheus4捕获并集成监视度量。</p>
<p>2)性能瓶颈分析<strong>Performance Bottleneck Analysis</strong>:在度量收集器的帮助下，该组件执行SLO违规检测和冗余检查，以识别异常行为的微服务。接下来，瓶颈定位过程将被触发以精确定位异常微服务中的PBs。</p>
<p>3)缩放决策<strong>Scaling Decision</strong>:该组件旨在使用进化算法确定PBs的最佳副本数量。最后，PBScaler生成具有优化策略的配置文件，并将其提交给kubernetes-client5, kubernetes-client5调节微服务的副本计数。</p>
<p><strong>3.1 Metric Collector</strong></p>
<p>自动伸缩系统依赖于对指标的实时访问，例如内存使用数据、系统负载和尾部延迟，以确定是否应该执行弹性伸缩以及应该在微服务应用程序中分配多少资源。与需要深入了解程序和代码注入的基于跟踪的监视器不同[7]，Metric Collector根据服务网格报告指标，以最大限度地减少对业务流的中断。如表1所示，PBScaler使用Prometheus和kube-state-metrics来收集和分类这些指标，包括<strong>响应延迟</strong>、微服务之间的<strong>调用关系</strong>、<strong>资源消耗</strong>和微服务<strong>工作负载</strong>。</p>
<p>![截屏2023-07-08 16.12.07](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-08 16.12.07.png)</p>
<p>![截屏2023-07-08 16.15.24](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-08 16.15.24.png)</p>
<p>例如，容器cpu使用秒总数是Prometheus中的一个标签，它记录了容器级别的中央处理单元(Central Processing Unit, cpu)使用情况。我们将Prometheus的监视间隔设置为5秒，并将收集到的指标数据存储在时间序列数据库中。每个微服务的P90尾部延迟被收集并用于表示应用程序的性能。调用关系暗示了微服务之间的关联，可用于构建微服务关联图。</p>
<p>服务网格Service Mesh</p>
<p>服务网格是一种基础设施，它使开发人员能够在不需要额外代码的情况下向云应用程序添加高级功能，如可观察性和流量管理。一个流行的开源服务网格实现是Istio7，旨在与Kubernetes无缝集成。当一个pod在Kubernetes中启动时，Istio在pod中启动一个特使代理来拦截网络流量，从而实现工作负载平衡和监控。</p>
<p><strong>3.2 Performance Bottleneck Analysis</strong></p>
<p>性能瓶颈分析(PBA)是一个旨在发现微服务应用程序中性能下降和资源浪费的过程，以推断当前问题的PBs。如第1节所述，通过准确定位这些瓶颈，PBA可以提高自动扩展的性能并减少过度的资源消耗。算法1描述了PBScaler中的PBA过程。</p>
<p>![截屏2023-07-09 14.19.35](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.19.35.png)</p>
<p><strong>3.2.1 SLO Violation Detection</strong></p>
<p>为了检测微服务中的异常，PBScaler使用服务水平目标(slo)与特定指标进行比较。如果微服务有大量的SLO违规，即性能下降，则被认为是异常的。如[14]、[27]所述，检测违反SLO是触发瓶颈定位的关键步骤。可以利用Metric Collector收集的调用关系来构建微服务关联图Gc。PBScaler每15秒检查Gc中所有调用边的P90尾部延迟，以及时检测性能下降。如果调用的尾部延迟超过预定的阈值(如SLO)，则调用的被调用微服务将被添加到异常微服务集中，并且将激活瓶颈本地化过程。为了考虑微服务延迟中偶尔出现的噪声，阈值设置为slox (1 + α&#x2F;2)，其中α用于调整对噪声的容忍度</p>
<p><strong>3.2.2 Redundancy Checking</strong></p>
<p>在没有性能异常的情况下，一些微服务可能会被分配比所需更多的资源。然而，仅仅通过度量来识别这样的情况是很困难的，这可能会浪费有限的硬件资源。为了避免这种情况，有必要确定哪些微服务分配了多余的资源。PBScaler使用微服务每秒的工作负载变化率来确定资源是否冗余。</p>
<p>此策略比仅依赖资源消耗更有效，因为不同的微服务对异构资源的敏感性可能不同。冗余检查背后的主要思想是采用假设检验来检测微服务当前的工作负载wi c是否显著低于其过去的工作负载(表示为wi p)。显著程度通过参数βt来调整，假设检验可以表示为:</p>
<p>![截屏2023-07-09 14.18.53](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.18.53.png)</p>
<p>为了执行假设检验，我们首先从Metric Collector获取目标微服务的当前和历史工作负载。然后我们使用单侧检验来计算p-value P。如果P不超过置信水平cl(默认设置为0.05)，我们拒绝零假设H0，并认为微服务i具有冗余资源。</p>
<p>![截屏2023-07-09 14.21.30](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.21.30.png)</p>
<p><strong>3.2.3 Bottleneck Localisation</strong></p>
<p>由于微服务应用程序中复杂的交互[36]，并不是每个异常的微服务都需要扩展。例如，图5说明了瓶颈微服务(例如，Product)的性能下降如何沿着调用链传播到它的上游微服务(例如，recommendation, Frontend和Checkout)，即使上游微服务没有过载。因此，只有瓶颈微服务必须被扩展，而其他异常微服务只是被牵连。为了精确定位瓶颈微服务，我们引入了异常潜力的概念，它聚集了给定位置上所有微服务的异常影响。由于PB被许多受其影响的异常微服务所包围，因此PB的异常潜力通常很高。我们设计了一种新的瓶颈定位算法TopoRank，该算法在随机行走中引入拓扑势理论(TPT)来计算所有异常微服务的得分，并最终输出一个排名列表(rl)。在rl中得分最高的微服务可以被识别为PBs。</p>
<p>![截屏2023-07-09 14.25.11](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.25.11.png)</p>
<p>TPT源于物理学中“场”的概念，在各种著作中被广泛应用[37]，[38]来衡量复杂网络中节点之间的相互影响。由于微服务关联图也可以被视为一个复杂的网络，我们使用TPT来评估微服务的异常潜力。具体来说，我们已经观察到，在微服务关联图Gc中，离PBs更近的微服务，即那些跳数较少的微服务，更有可能出现异常，因为它们经常频繁地直接或间接调用PBs。基于这一观察，我们使用TPT评估微服务的异常潜力。为此，我们首先通过识别异常微服务及其在Gc中的调用关系来提取异常子图Ga。然后，我们使用TPT计算异常子图Ga中微服务vi的拓扑势。</p>
<p>![截屏2023-07-09 14.26.52](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.26.52.png)</p>
<p>N为vi的上游微服务数，mj为vj的异常程度。PBScaler将异常程度定义为微服务在一个时间窗口内违反SLO的次数。dji表示从vj到vi所需的最小跳数。我们使用影响因子σ来控制微服务的影响范围。</p>
<p>然而，具有高拓扑潜在值的微服务不一定是PBs，因为异常通常沿着微服务相关图传播。因此，单纯依靠TPT诊断PBs是不够的。为了解决这个问题，PBScaler结合了个性化PageRank算法[39]来逆转异常子图Ga上的异常传播并定位PBs。设P为Ga与Pi的转移矩阵，j为异常从vi跟踪到其下游节点vj的概率。给定输出度为d的vi，标准个性化PageRank算法将Pi,j集合为:</p>
<p>![截屏2023-07-09 14.29.14](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.29.14.png)</p>
<p>这意味着该算法不会偏向于任何下游微服务。然而，这个定义没有考虑下游微服务和当前微服务异常之间的关联。因此，PBScaler通过更多地关注与上游响应时间更相关的下游微服务来调整计算。对于每个微服务vi, PBScaler收集尾部延迟序列(li)和一组度量数组Mi &#x3D; {m1, m2，···，mk}，其中mk可以被视为给定时间窗口内度量(例如，内存使用)的波动数组。PBScaler定义Pi,j取决于Mj中li与度量数组之间的Pearson相关系数的最大值:</p>
<p>![截屏2023-07-09 14.31.44](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.31.44.png)</p>
<p>个性化PageRank算法通过在有向图上随机行走来确定每个节点的受欢迎程度。然而，一些节点可能永远不会指向其他节点，导致所有节点的分数在多次迭代后趋于零。为了避免落入这个“陷阱”，应用了一个阻尼因子δ，它允许算法根据预定义的规则从这些节点跳出来。通常δ设为0.15。个性化PageRank表示如下:</p>
<p>![截屏2023-07-09 14.33.44](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.33.44.png)</p>
<p>其中v表示每个微服务节点被诊断为PB的概率。偏好向量u作为个性化规则，引导算法跳出陷阱。u的值由每个节点的异常势决定。异常潜力较大的节点优先作为算法的起始点。第k次迭代的方程可以表示为:</p>
<p>![截屏2023-07-09 14.34.19](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.34.19.png)</p>
<p>经过多轮迭代，v逐渐收敛。PBScaler然后对最终结果进行排序并生成排名列表。排名列表得分最高的前k个微服务可以被识别为PBs。TopoRank的整个过程描述为算法2。</p>
<p><strong>3.3 Scaling Decision</strong></p>
<p>给定性能瓶颈分析确定的PBs，将对PBs的副本进行缩放，以最小化应用程序的资源消耗，同时确保微服务的端到端延迟符合SLO。尽管大量的副本可以缓解性能下降问题，但它们也会消耗大量的资源。因此，必须在性能保证和资源消耗之间保持平衡。缩放决策的过程将被建模为一个约束优化问题，以实现这种平衡。</p>
<p><strong>3.3.1 Constrained Optimation Model</strong></p>
<p>我们场景中的自动缩放优化试图确定一个分配模式，该模式为每个PB分配可变数量的副本。给定n个需要缩放的PBs，我们将策略定义为集合X &#x3D; {x1, x2，···，xn}，其中xi表示分配给pbi的副本数量。在优化之前，PBs的初始副本数量可以表示为C &#x3D; {c1, c2，···，cn}。应该注意的是，PBScaler中的副本约束应该分别为按比例缩小和按比例扩大的流程定义。在扩展过程中，我们对PBs的副本数量进行了如下限制:</p>
<p>![截屏2023-07-09 14.36.59](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.36.59.png)</p>
<p>其中c^max表示给定有限的服务器资源，微服务可以扩展到的最大副本数量。在缩小过程中，副本数量的约束可以表示为:</p>
<p>![截屏2023-07-09 14.38.06](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.38.06.png)</p>
<p>在Eq.(8,就是上面这个公示)中，γ(默认值为2)表示复制减少的最大数量。这个限制是合理的，因为正如在实验中观察到的那样，大幅减少微服务副本的数量可能会导致短暂的延迟峰值。</p>
<p>缩放决策的目标是尽量减少应用程序的资源消耗，同时保持其性能。应用程序性能通常用用户更关心的SLO违规来表示。因此，应用程序性能奖励可以细化为:</p>
<p>![截屏2023-07-09 14.40.23](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.40.23.png)</p>
<p>在优化过程中，应用程序的资源消耗(如CPU和内存使用)是不可预测的。为了保守地估计资源消耗，我们考虑PB副本与可分配副本的最大数量的比率，而不是计算CPU和内存的成本。我们将资源奖励计算为:</p>
<p>![截屏2023-07-09 14.41.36](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.41.36.png)</p>
<p>我们的目标是在保证性能的同时尽量减少资源消耗。我们利用加权线性组合(WLC)方法来平衡这两个目标。最终优化目标定义为:</p>
<p>![截屏2023-07-09 14.43.20](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.43.20.png)</p>
<p>式中λ∈[0,1]。我们将λ设置为参数，以平衡应用程序性能和资源消耗。</p>
<p><strong>3.3.2 SLO Violation Predictor</strong></p>
<p>为了计算性能奖励R1，需要评估策略是否会导致在线应用程序违反SLO。一种简单的方法是直接在在线申请中执行候选策略，并等待监控系统的反馈。然而，在线应用程序中频繁缩放引起的振荡是不可避免的。另一种方法是使用历史度量数据训练评估模型，该模型可以模拟在线应用的反馈。在不与在线应用程序交互的情况下，该模型根据应用程序的当前状态预测应用程序的性能。</p>
<p>我们使用向量r来表示执行扩展策略x后每个微服务的副本数量。w是表示每个微服务当前工作负载的向量。由于瓶颈感知优化的时间成本较低，我们可以合理地假设w在此期间不会发生显著变化(参见4.2节)。给定由工作负载w和所有微服务副本r表示的应用状态，一个SLO违例预测器可以设计为:</p>
<p>![截屏2023-07-09 14.47.43](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.47.43.png)</p>
<p>其中ψ是一个二元分类模型。选择合适的分类模型的细节将在4.3节中讨论。用于训练的历史度量数据可以使用经典缩放方法(默认是Kubernetes自动缩放器)或随机方法生成。我们在3个节点(共44个CPU核和220gb RAM)上部署了一个开源微服务系统，并进行了弹性扩展。普罗米修斯以固定的时间间隔收集每个微服务的工作负载和P90尾部延迟。通过比较前端微服务的尾部延迟和SLO，可以很容易地标记每个时间间隔的监控数据。</p>
<p>![截屏2023-07-09 14.48.39](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.48.39.png)</p>
<p>Section 4.3。用于训练的历史度量数据可以使用经典缩放方法(默认是Kubernetes自动缩放器)或随机方法生成。我们在3个节点(共44个CPU核和220gb RAM)上部署了一个开源微服务系统，并进行了弹性扩展。普罗米修斯以固定的时间间隔收集每个微服务的工作负载和P90尾部延迟。通过比较前端微服务的尾部延迟和SLO，可以很容易地标记每个时间间隔的监控数据。</p>
<p><strong>3.3.3 Autoscaling Optimisation</strong></p>
<p>如第3.3.1节所述，性能和资源消耗之间的权衡可以建模为约束优化问题。为了找到接近最优的策略，PBScaler使用遗传算法(GA)来生成和优化扩展策略，以减少资源消耗，同时满足SLO要求。遗传算法通过模拟进化中的自然选择，在淘汰劣等子代的同时提高优等子代。首先，遗传算法执行随机搜索来初始化策略空间中的染色体种群，每条染色体表示优化问题的潜在策略。接下来，在每次迭代中，将选择具有高适应度的精英染色体(称为精英)进行交叉或突变以产生下一代。</p>
<p>我们场景中的自动缩放优化旨在确定一种缩放策略，该策略为每个PB分配可变数量的副本。自缩放优化过程如图6所示。一开始，PBScaler获得每个微服务当前的副本数量r和工作负载w。在性能瓶颈分析之后，PBScaler从r中识别PBs，并将它们过滤出来，得到r ‘。然后，决策者生成PBs策略的总体。由于要扩展的微服务数量会影响优化算法的速度和效果(第4.3节)，PBScaler假设只有PBs需要进行弹性扩展。换句话说，r ‘中的副本数量将保持不变。SLO违例预测器负责评估生成的策略。需要注意的是，该策略与r ‘合并，并与w一起输入到SLO违规预测器中。通过遗传算法选择优策略Xbest，并与r ‘合并，生成最终决策。</p>
<p>![截屏2023-07-09 14.41.12](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 14.41.12.png)</p>
<p>在优化阶段，决策者使用遗传算法生成并改进PB的缩放策略，如算法3所述。在每个PB的策略范围内随机生成一个种群(第1行)后，Decision Maker根据Eq.(11)估计每个策略的适应度，并存储精英(第2-3行)。在每次迭代中，遗传算法使用基于锦标赛的选择算子来挑选优秀的亲本(第6行)。通过使用两个点交叉算子和双染色体突变算子，通过重组和突变(第7-8行)产生新的后代。通过模拟自然选择，新的后代和亲本精英形成一个新的种群，进入下一个迭代(第9行)。当遗传算法达到指定的迭代次数时，Decision Maker返回适应度最高的缩放决策Xbest。</p>
<p><strong>4 Evaluation</strong></p>
<p>在本节中，我们详细介绍了自动缩放的实验场景，包括PBScaler与学术界和工业界几种最先进的自动缩放算法的比较。</p>
<p><strong>4.1 Experimental Setup</strong></p>
<p><strong>4.1.1 Microserice Platform</strong></p>
<p>实验在我们的私有云集群中进行，该集群由三台物理计算机(一个主节点和两个工作节点)组成，共有44个Intel 2.40 GHz CPU内核和220gb RAM。为了评估自动扩展，我们选择了两个开源微服务应用程序作为基准:a)在线精品8，一个由谷歌开发的基于web的电子商务演示应用程序。该系统通过10个无状态微服务和Redis缓存的协作，实现了浏览产品、将商品添加到购物车和支付处理等基本功能。b) Train Ticket9:复旦大学开发的大型开源微服务系统。Train Ticket拥有40多个微服务，并使用MongoDB和MySQL进行数据存储，可以满足各种工作流程，如在线门票浏览，预订和购买。由于集群资源的限制，我们将每个微服务限制为不超过8个副本。源代码可在Github上获得.</p>
<p><strong>4.1.2 Workload</strong></p>
<p>我们评估了PBScaler在各种流量场景下的有效性，使用了2015年3月16日Wiki-Pageviews[40]的真实维基百科工作负载，以及受Abdullah等人[41]的实验启发的五种模拟工作负载(EW1 ~ EW5)。我们将实际工作负载压缩到一个小时，并将其扩展到适合我们集群的级别。五个模拟工作负载表现出不同的模式，例如单峰、多峰、上升和下降，并且持续时间限制为20分钟。图7描述了这些工作负载的波动情况。</p>
<p><strong>4.1.3 Baseline Metrics</strong></p>
<p>我们将PBScaler与学术界和工业界的几种最先进的微服务自动扩展方法进行比较，这些方法从静态阈值、控制理论和黑盒优化的角度执行微服务的动态水平扩展。</p>
<p>Kubernetes水平Pod自动缩放(<strong>KHPA</strong>):这是Kubernetes默认的水平缩放方案。通过为特定的资源R定制阈值T (CPU使用率为默认值)，并从微服务的所有副本中聚合资源使用URi, KHPA将副本的目标数量定义为</p>
<p>![截屏2023-07-09 15.19.46](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 15.19.46.png)</p>
<p><strong>MicroScaler</strong>[15]:这是一个自动扩展工具，它使用黑盒优化算法来确定微服务的最佳副本数量。MicroScaler计算微服务的P90&#x2F;P50进行分类，然后执行贝叶斯优化的四次迭代来做出扩展决策。</p>
<p><strong>SHOWAR</strong>[11]:它是一种混合自缩放技术。我们在SHOWAR中再现了水平缩放部分，它使用PID控制理论使观察到的度量逐渐接近用户指定的阈值。在我们的实现中，我们用更常见的P90延迟替换了运行队列延迟，因为前者需要额外的eBPF工具。</p>
<p><strong>4.1.4 Experimental Parameters and Evaluation Criteria</strong></p>
<p>在我们的实验中，我们将普罗米修斯的收集间隔固定为5秒。随着实验时间和工作负载的增加，MongoDB等有状态微服务所需的数据量也会增加。最终，数据量将超过可用内存，从而需要使用磁盘存储。这种转换可能导致无法通过自动缩放来补救的性能下降。因此，我们将工作负载测试限制为无状态跟踪。在线精品店和火车票的SLO值分别设置为500毫秒和200毫秒。在SLO违例检测和冗余检查模块中，PBScaler首先将动作边界α设置为0.2，以减少噪声干扰。然后，我们根据经验将显著度β设置为0.9，以控制触发扩展的工作负载水平。对于瓶颈定位，将拓扑势的影响因子σ设为1，将rl中得分最高的top-k (k &#x3D;2)个微服务视为PBs。</p>
<p>我们选择了SLO违规率、资源消耗和响应时间来评估自缩放方法的性能。如果自动缩放方法可以减少响应时间、SLO违规率和资源消耗，则认为它更有效。我们将SLO违例率定义为端到端P90尾部延迟超过SLO的百分比。资源消耗按照[42]给出的方法计算，其中CPU价格为0.00003334$ (vCPU&#x2F;s)，内存价格为0.00001389$ (G&#x2F;s)。总资源消耗由内存成本和CPU成本相加得到。</p>
<p>![截屏2023-07-09 15.23.18](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 15.23.18.png)</p>
<p>![截屏2023-07-09 15.24.13](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 15.24.13.png)</p>
<p><strong>4.2 Performance Evaluation</strong></p>
<p>表2比较了具有不同工作负载的两个微服务应用程序中四种自动伸缩方法的SLO违反率和资源成本。None方法用作引用，不执行自动缩放操作。其结果以灰色表示，并被排除在比较之外。</p>
<p>![截屏2023-07-09 15.25.47](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 15.25.47.png)</p>
<p>一般来说，PBScaler在减少两个微服务系统中六个工作负载下的SLO违规和最小化资源开销方面优于其他竞争方法。其中，PBScaler在火车票中的SLO违规率比基线方法平均降低4.96%，资源成本平均降低0.24美元。结果表明，PBScaler可以快速、精确地对大规模微服务系统中的瓶颈微服务进行弹性扩展，从而减少了SLO违规，节省了资源。对于Online Boutique中的6个工作负载，PBScaler还在其中4个模拟工作负载中实现了最低的SLO违规，并在3个模拟工作负载中实现了最低的资源消耗。</p>
<p>图8描绘了六种工作负载下不同方法的延迟分布箱形图，探讨了每种方法对微服务系统性能的影响。可以看出，大多数自动缩放方法都可以保持延迟分布的中位数低于红色虚线(SLO)。但是，只有PBScaler进一步将第三个四分位数降低到所有工作负载的SLO以下。</p>
<p>为了评估使用PBScaler进行弹性缩放的时间成本，收集并计算了PBScaler中每个模块所需的平均时间。如表3所示，Online Boutique中所有PBScaler模块的总时间成本小于一个监控间隔(即5s)，而Train Ticket的相同度量小于两个监控间隔。由于PBA缩小了决策范围，当应用程序从Online Boutique切换到Train Ticket时，尽管微服务的数量增加了，但决策者的时间成本并没有增加太多(不超过6.6%)。然而，我们认识到随着微服务规模的增长，PBA的时间消耗会迅速增加，这将是我们未来的工作。</p>
<p>![截屏2023-07-09 15.29.10](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 15.29.10.png)</p>
<p>![截屏2023-07-09 15.29.50](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 15.29.50.png)</p>
<p><strong>4.3 Effectiveness Analysis of Components</strong></p>
<p><strong>4.3.1 Performance Comparision of Bottleneck Localization</strong></p>
<p>为了评估TopoRank算法是否能有效定位突发工作负载引起的PBs，我们通过Chaos Mesh将CPU过载、内存溢出和网络拥塞等异常注入到Online Boutique和Train Ticket中。这些异常通常是由高工作负载条件引起的。使用TopoRank算法分析度量并确定这些异常的性能瓶颈。然后将定位结果与micrororca[27]进行比较，micrororca是微服务根本原因分析的基线方法。AC@k测量前k个结果中实际PBs的精度，Avg@k是前k个结果的平均精度。这些指标的计算方法如下。A表示微服务的集合，RT@k表示排名列表中排名前k的微服务。</p>
<p>![截屏2023-07-09 15.32.15](..&#x2F;images&#x2F;:Users:joshua:Library:Application Support:typora-user-images:截屏2023-07-09 15.32.15.png)</p>
<p>图9给出了TopoRank和MicroRCA在不同微服务应用中的AC@1和Avg@5值。结果表明，TopoRank在这两个指标上都优于MicroRCA。这主要是由于TopoRank在执行个性化PageRank时考虑了异常可能性和微服务依赖关系。</p>
<p>瓶颈定位的主要目的是缩小策略空间，加快最优策略的发现。我们在PBs和所有微服务上执行遗传算法迭代，以证明瓶颈定位对优化的影响。图10描述了微服务系统下的迭代过程，并表明随着人口(Pop)的增加，pb感知策略在适应度方面明显优于适用于所有微服务的方法。该策略可以在不到5次迭代中获得较好的适应度。相比之下，涉及所有微服务的方法需要更大的种群和更多的迭代才能达到相同的适应度水平。这是由于pb感知策略帮助遗传算法精确地缩小了优化范围，加速了优解的获取。</p>
<p><strong>4.3.2 Effectiveness of the SLO Violation Predictor</strong></p>
<p>SLO违例预测器的目标是直接预测优化策略的结果，而不是等待在线应用程序的反馈。我们根据每个微服务的副本数量和工作负载来确定是否会出现性能问题。为预测任务选择合适的二分类模型至关重要。以5秒的数据收集间隔，我们在我们的集群中收集了两个数据集，包括3.1k的火车票历史采样数据集(a)和1.5k的在线精品数据集(B)。为了对这两个数据集进行训练和测试，我们采用了四种经典的机器学习方法，包括支持向量机(SVM)、随机森林(Random Forest)、多层感知器(Multilayer Perceptron)和决策树(Decision Tree)。表4给出了四种模型对SLO违规预测的准确率和召回率。根据两个数据集的效果，我们最终选择随机森林作为SLO违例预测的主要算法。</p>
<p>为了证明SLO违例预测器可以替代来自真实环境的反馈，我们将使用SLO违例预测器的PBScaler与从在线系统收集反馈的MicroScaler进行了比较。我们将突发工作负载注入Online Boutique，并仅使一个微服务异常，以消除两种方法在瓶颈定位方面的差异。如图11所示，在预测器的引导下，PBScaler的决策尝试次数和频率远低于MicroScaler。减少集群中的在线尝试将明显降低振荡的风险。</p>
<p><strong>5 Conclusion</strong></p>
<p>本文介绍了PBScaler，一个瓶颈感知自动伸缩框架，旨在防止基于微服务的应用程序的性能退化。PBScaler使用服务网格技术收集应用程序的实时性能指标，并动态构建微服务之间的关联图。为了处理由外部动态工作负载和微服务之间复杂调用引起的微服务异常，PBScaler采用基于拓扑势理论的随机游动算法TopoRank来识别瓶颈微服务。此外，PBScaler采用离线进化算法，在SLO违规预测器的指导下优化缩放策略。实验结果表明，PBScaler可以在最小化资源消耗的同时实现较低的SLO违规。在未来，我们计划从以下两个方面改进我们的工作。首先，我们将探索在细粒度资源(例如，CPU和内存)管理中使用瓶颈感知的潜力。其次，我们将探讨如何规避自扩展中有状态微服务的干扰，因为有状态微服务的性能下降可能会破坏自扩展控制器。第三，提高大规模微服务系统性能瓶颈分析的效率。</p>
<p><strong>LOTUS</strong></p>
<p>概要：边缘计算系统通常面临资源分配效率低下的问题，导致不必要的等待时间和服务质量(QoS)的降低。本文提出了一种延迟优化混合自动缩放器(LOTUS)的体系结构来解决这个问题。这是通过实施深度学习模型来预测未来的工作负载，从而优化边缘的资源使用来实现的。LOTUS主动预测资源需求，并相应地对其进行扩展，以减少总体延迟，并从最终用户的角度改进QoS。为了证明准确的工作负载预测的重要性，我们将提出的系统架构设计为部署在具有有限可用资源的分布式Kubernetes集群中。通过动态预测传入工作负载的资源需求，LOTUS可以有效地分配资源，从而减少最终用户的往返时间。索引术语:边缘计算，自动缩放，深度学习，延迟优化</p>
<p><strong>介绍</strong></p>
<p>边缘计算是一种分布式计算，它使计算资源更接近网络的边缘，数据在那里生成和使用。边缘计算的目标是减少处理数据的延迟，从而提高最终用户的服务质量(QoS)。传统上，计算资源集中在大型数据中心，当需要长距离发送数据时，这可能导致高延迟。有了边缘计算，资源分布在一个大的地理区域，允许数据在更靠近它们产生的地方进行处理。</p>
<p>然而，边缘计算的分布式特性对有效的资源分配提出了挑战。与传统数据中心相比，边缘设备通常具有有限的资源，因此优化其使用以满足QoS要求至关重要。实现这一目标的一种方法是使用自动缩放技术，这是一个动态过程，使系统能够根据当前和预期的需求自适应提供资源。通过这样做，这些技术可以帮助确保有效的资源利用和最佳的QoS级别。由于Kubernetes的流行，Kubernetes Horizontal Pod Autoscaler (HPA)是Kubernetes集群中广泛使用的管理工作负载扩展的工具[1]。它使用一个预定义的比率来根据环境的变化计算所需的pod数量，如:</p>
<p><img src="/../images/20230719200127732.png" alt="image-20230719200127732"></p>
<p>其中m_c是要优化的度量的当前值，m_d是期望值。度量可以是CPU利用率、内存利用率或自定义度量。</p>
<p>然而，这种方法并没有针对边缘计算的动态和资源受限环境进行优化。因此，它可能无法快速有效地实时响应变化。因为它只在发生更改之后才扩展资源，所以这种方法可能会增加总体往返时间(RTT)并影响性能，特别是在对时间敏感的应用程序中。</p>
<p>主动自缩放技术最近成为克服边缘被动自缩放器所面临的延迟问题的有希望的解决方案[2]。它们的目标是在工作负载生成之前对其进行预测，以便系统可以为预测的工作负载分配足够的资源。这种主动行为可以改善系统响应时间、资源利用率和应用程序性能。然而，尽管各种时间序列预测技术和机器学习算法已被用于在基于云的基础设施中实现这一目标，但缺乏对边缘计算系统的主动自动缩放技术的研究。现有文献(如[3]，[4])大多侧重于水平扩展，而不是采用混合方法，这阻碍了它们的潜在效益。</p>
<p>本文提出了一种创新的边缘主动混合自动缩放解决方案，称为延迟优化混合自动缩放(LOTUS)。我们的方法通过利用深度学习(DL)进行工作负载预测和资源分配，克服了现有自动缩放技术的局限性。它使用了一种混合缩放方法，结合了基于预测模型和算法权重的水平和垂直缩放技术。LOTUS的主要目标是通过主动预测工作负载并相应地分配资源来最小化延迟和缓解冷启动问题。通过这样做，LOTUS可以确保资源得到最佳配置，以处理预期的工作负载，并提高系统的性能。</p>
<p>LOTUS的体系结构采用了MAPE-K[10]循环，并且专门设计用于部署在分布式Kubernetes集群上，使其具有可伸缩性和灵活性，可以处理各种边缘计算资源配置。使用深度学习进行工作负载预测确保了我们方法的准确性和可靠性，使LOTUS能够准确预测工作负载变化并主动分配资源，从而在边缘实现高效和有效的自动扩展。具体而言，本文提出了以下重大贡献，这些贡献推动了边缘计算环境中自动缩放领域的发展:</p>
<p><img src="/../images/20230719230714698.png" alt="image-20230719230714698"></p>
<ol>
<li><p>一种新型的主动混合自动缩放器，利用深度学习技术优化资源分配并减少延迟。</p>
</li>
<li><p>Kubernetes平台上自动缩放器的详细实现</p>
</li>
<li><p>包括工作量建模和资源预测的定量评估。</p>
</li>
</ol>
<p>本文的其余部分组织如下。在第二节中，我们回顾了相关文献，并强调了它们的局限性。第三部分概述了系统设计，概述了其关键组件和功能。接下来，在第四节中，我们描述了方法，并提供了有关系统设计和所采用算法的详细信息。在第五节中，我们介绍了实验评估的设置。接下来是第六节，在那里我们提出了结果。然后，我们在第七节中对我们的发现进行了深入分析。最后，在第八部分，我们对本文进行了总结，并对未来的工作进行了讨论。</p>
<p>二 相关工作</p>
<p>本节探讨了最近在边缘计算环境中提出的用于自动缩放的不同技术。表一也对它们进行了总结和比较。</p>
<p>自动扩展策略可以分为被动策略和主动策略。反应式（被动）自动缩放器只是对系统和环境的变化做出“反应”，并相应地调整资源。反应式自动缩放器最常见的用途是水平Pod自动缩放器(HPA)，这是因为它是Kubernetes提供的标准自动缩放器[1]。其他例子还包括[5]、[6]、[11]。这种响应式自动缩放技术对用户定义指标的变化做出反应，导致其明显的缺点。这个缺点是变更和行动之间的时间延迟导致系统整体效率降低。这是由于pod需要时间来初始化、重新分配或终止。由于网络流量的变化是对其作出反应，而不是准确预测，因此这种时间延迟是无法消除的[4]。</p>
<p><img src="/../images/20230719231103718.png" alt="image-20230719231103718"></p>
<p>解决响应式自动缩放器所面临的时间延迟的一种常用技术是在流量在网络上生成之前预测它将是什么。这些技术的共同点是使用时间序列预测技术来预测工作负载，使用机器学习方法来估计所需的资源[8]，[12]。使用这些技术，网络可以在工作负载生成之前就拥有最佳的节点配置。如果实现正确，这些技术的好处是显而易见的，包括与响应式自动缩放相比，改进的资源利用率、更好的应用程序性能和成本优化。[8]提出的算法采用时间序列分析来预测容器的CPU使用情况，并主动调整容器的扩容。[13]中的工作提出了一种混合扩展策略，以在预测未来资源需求时平衡性能和成本。其他项目通过实施深度强化学习来推进自动扩展方法，例如[14]，旨在通过最小化响应时间和数据包丢失来最大化服务质量。</p>
<p>然而，上述方法的主要局限性在于它们是设计用于云计算平台，而不是边缘计算系统。尽管边缘计算基础设施的采用越来越多，但缺乏对边缘主动自缩放技术的研究，这可以显着提高此类系统的效率和可靠性。我们对文献的回顾表明，在边缘工作的自动缩放技术的发展仅由[4]，[9]，[15]解决。[15]提出了一种基于深度学习模型的自动扩展架构，用于水平扩展。[9]的工作使用延迟估计来垂直扩展应用程序容器。这两篇文章都只关注响应式扩展。[4]的工作使用主动Pod自动缩放器实现了时间序列预测，以提高资源利用率。结果显示效率得到了提高，但也存在一些缺点，比如预测不准确，需要考虑意外的工作负载。这些工作的另一个限制是它们只关注水平扩展，因此进一步这项工作的自然进展将是混合自动扩展的结合，以最大限度地利用可用资源。</p>
<p>表1是LOTUS与现有相关作品的比较。之前的大多数研究都强调横向自动扩展，并且仅限于基于虚拟机的云基础设施，同时使用一组受限的性能指标进行决策。相比之下，LOTUS为容器化应用程序提供了一种新的混合预测自动缩放模型，该模型依赖于一组固定的指标，并在边缘操作。它提供了一个独特的解决方案，结合了水平和垂直自动缩放技术的优点。</p>
<p><strong>三 系统设计</strong></p>
<p>本节深入研究LOTUS所采用的体系结构和算法的细节。</p>
<p><strong>A. LOTUS Architecture</strong></p>
<p>图1概述了组成LOTUS体系结构的组件及其相互连接。它还突出了系统内的数据流。LOTUS体系结构可以分为两个不同的部分。第一个是包含Kubernetes集群的边缘网络。我们故意混淆了这一部分，以解释实际环境中硬件配置的异构性质。第二部分是我们的自动缩放系统，它执行以下核心功能:</p>
<p>•<strong>请求处理</strong>。请求处理程序接收用于集群的传入请求，并随后传输它们。它包含度量评估器的细分。这个功能很简单:在发送请求之前，启动计时器，一旦接收到响应，计时器停止，并计算RTT。HTTP响应代码也被记录下来，使我们能够深入了解系统状态。该信息使我们能够通过跟踪故障错误代码来检测系统故障或超时的实例。此外，这使我们能够记录更少的常见错误代码，从而扩展了系统的整体可用性，这些错误代码可能表明系统中的特定问题。</p>
<p>•<strong>工作量建模</strong>。这是自动扩展体系结构的一个关键功能，使系统能够根据预期的工作负载需求做出如何扩展基础设施的明智决策，以及何时做出此扩展决策。该组件的输出将是对未来工作负载需求的预测，然后将用于为底层基础设施的扩展决策提供信息。LOTUS使用基于gru(门控循环单元)的时间序列模型来预测工作负载需求[16]。GRU模型用于捕获输入数据中的时间依赖性，这允许模型对未来的工作负载需求做出准确的预测。</p>
<p>•<strong>控制</strong>。此功能负责根据预测的工作负载做出扩展决策。这对LOTUS体系结构的成功至关重要，因为它决定是根据预测的工作负载水平扩展还是垂直扩展。根据接收到的工作负载预测，控制器预测所需的资源(以pod的数量为单位)，并确定是水平扩展还是垂直扩展。如果预测的工作负载表明应用程序将经历需求激增，控制器可能决定通过向集群添加更多pod来水平扩展它。这种方法确保应用程序可以通过将流量分配到工作pod来处理增加的流量负载。如果预测的pod数量与当前数量相同，则控制器假定预测的工作负载将需要更多的资源，例如CPU或内存。然后控制器决定通过向每个pod分配更多资源来垂直扩展。如果预测的工作负载表明需求下降，控制器还可以决定缩小集群的规模。值得一提的是，控制器的决策过程完全依赖于预测模型的准确性，因为它永远无法访问工作负载的实际请求计数。值得注意的是，控制器做出准确缩放决策的能力在很大程度上依赖于预测模型的准确性。由于控制器无法访问工作负载的实际请求计数数据，因此它完全依赖于预测模型生成的预测工作负载。</p>
<p>•<strong>知识存储</strong>。知识库组件的核心是一个数据存储，用于收集和存储来自系统内各种来源的相关数据。这些数据可能包括正在处理的请求数量、每个请求的处理时间、活动实例数量以及可用的系统资源(如CPU、内存和磁盘空间)等信息。知识库组件通过从体系结构中的其他组件收集信息来获取信息，这些组件依次访问知识库以实现各自的功能。</p>
<p><strong>B. LOTUS Algorithms</strong></p>
<p>工作负载建模。GRU模型被用于模拟我们在本研究中使用的两个数据集的工作量(这些将在下一节中介绍)。这些模型允许我们预测指定时间戳的HTTP请求计数。然后将此预测传递给我们的资源预测系统。</p>
<p><strong>资源预测</strong>. 最初，我们假设水平缩放，并利用线性回归pod数模型来确定预测的pod数。然后将其与当前的pod计数进行比较，如果不同，我们通过添加或删除pod来水平缩放以达到我们的新预测值。否则，将启动垂直缩放。这是因为我们的预测表明集群将需要与当前使用的pod数量相同的pod。我们首先比较之前发送到集群的请求数量以及我们对新请求的新模型预测。计算两个值之间的百分比变化。如果这个变化落在我们预定的可接受范围内，我们根据这个量调整CPU利用率。</p>
<p><strong>四 方法论</strong></p>
<p>本节概述了本研究中遵循的方法，并提供了有关LOTUS功能的详细信息。</p>
<p><strong>A.数据收集和预处理</strong></p>
<p>为了测试自动缩放系统的有效性，我们需要大量的数据作为实时使用数据。为了获得这一点，我们获得了公开可用的数据集，这些数据集以前曾在其他作品中用于此目的。具体来说，我们选取了NASA[17]和1998年世界杯网站[18]的HTTP访问请求数据。这提供了两个不同的web访问数据集，允许我们模拟系统的实际使用情况，并测试系统在实际数据上的有效性。</p>
<p>数据集1 - NASA-HTTP。NASA-HTTP数据集是1995年7月运行的NASA肯尼迪航天中心网络服务器的HTTP访问日志的集合。这些日志 记录了用户在该时间段内访问web服务器上各种资源的请求。数据集包含匿名日志，其中包括诸如每个请求的时间戳、请求的文件&#x2F;资源、返回的HTTP状态码、响应的大小以及其他相关详细信息。</p>
<p>数据集2 - 1998年世界杯(WC98)。我们介绍的第一个数据集是1998年世界杯数据集，它为1998年世界杯网站提供了大约四个月的HTTP请求(≈13亿)。数据集包含各种相关指标，包括调用计数，这些指标将用于训练我们的深度学习模型。数据集允许我们在选定的时间段或整个时间段内检查系统的行为。WC98数据集是公开可用的，尽管它時間久遠，已被广泛用于研究评估web系统的性能，由于其完整性和代表性。</p>
<p>为了处理数据，我们从两个数据集中消除了任何不完整的数据源，并对剩余数据执行最小-最大规范化。这有助于缩小我们正在处理的值的范围，这是一种成熟的深度学习模型技术。在仔细检查数据集的基础上，我们选择了60&#x2F;40分割测试和训练数据</p>
<p>数据集。我们注意到数据中存在显著差异，使用小的、非随机的分段进行测试将导致样本不具代表性。通过选择60&#x2F;40分割，我们的目标是创建代表数据总体分布的训练和测试集。这种方法可以帮助防止模型过度拟合多数类，这将对少数类的性能产生负面影响。</p>
<p><strong>B. Deep learning model for workload forecasting</strong></p>
<p>我们创建了一个PyTorch GRU模型来预测工作负载数据集。模型的输入大小为1，隐藏大小为128，输出大小为1。使用Adam优化器以0.001的学习率和均方误差(MSE)损失函数对模型进行200次训练。表2列出了模型配置。一旦对模型进行了训练，我们只需将时间戳格式的字符串传递给模型。该模型对工作负载进行预测。对于世界杯数据集，这将是预期的HTTP请求计数。与WC98数据集记录每分钟的总请求相比，NASA数据集以每个请求为基础，以最近的秒为单位存储数据。为了将GRU模型用于NASA数据集，我们将其转换为NASA数据集的每分钟请求率。这样做允许我们使用为两个数据集创建的相同的模型体系结构，因为它们现在具有相同的内容格式。选择128的隐藏大小是一个相对较大的值，可能有助于模型捕获输入和输出之间更复杂的关系。这个时间序列模型的主要问题是它依赖于有序时间。这防止了训练过程中数据的洗牌;然而，GRU模型捕获顺序数据中的时间依赖性的能力抵消了这一限制，允许模型根据先前的有序观察准确预测未来的HTTP请求计数。我们在清单1中为GRU模型的训练部分提供了伪代码，该模型采用表II中提供的值，例如criterion、optimizer，并执行一个基本的200次迭代循环来训练模型。</p>
<p><img src="/../images/20230719234729925.png" alt="image-20230719234729925"></p>
<p><img src="/../images/20230719234800039.png" alt="image-20230719234800039"></p>
<p><img src="/../images/20230719234817242.png" alt="image-20230719234817242"></p>
<p><strong>C. Resource forecasting</strong></p>
<p>我们在工作量预测的基础上使用Pod预测模型。这个PyTorch线性回归模型的目的是预测水平缩放的pod计数。模型的配置见表三。它有一个输入特性，即请求计数，和一个输出特性，即pod计数。由于我们从WC98和NASA数据集中获取相同的输入，我们只需要这个单一模型进行资源预测。我们只根据时间戳获取预测的请求计数，并使用它将线性关系映射到HPA用于水平扩展的水平pod计数。在训练过程中，使用均方误差(MSE)损失函数和随机梯度下降(SGD)优化器对模型进行100次训练，学习率为0.01。通过在可用数据上训练模型，它有望学习请求计数和pod计数之间的线性关系，然后它可以使用它对新的输入做出准确的预测。我们在清单2中提供了用于训练简单线性回归模型的伪代码。此代码分配表III中列出的值，并循环100次迭代，训练模型。</p>
<p><img src="/../images/20230719234906187.png" alt="image-20230719234906187"></p>
<p>我们提出的自动缩放器中的缩放决策机制是一种结合了水平缩放和垂直缩放的混合方法。垂直扩展机制不需要深度学习，因为它被用作请求计数变化过低而无法启动或关闭新pod的情况的备份。最初，我们通过预测pod数来假设水平pod缩放。如果预测计数与当前活动计数相同，我们将改为垂直缩放。这是通过计算以前和新的预测计数之间的百分比变化来完成的。我们在listing3中提供了缩放机制的逻辑流。如果预测的数量较高，我们假设需要更多的资源，如果较低，我们假设需要更少的资源。我们的预测模型考虑了各种因素，例如网络流量和资源利用率的变化，以预测未来的工作负载变化。这使我们的自动缩放器能够主动调整资源分配，防止启动或停止运行容器造成的延迟。我们还设置了90%的CPU使用率和至少50%的硬性限制，以防止资源过度使用或使用不足。总的来说，我们的混合自动缩放方法具有预测功能和备份垂直缩放机制，通过根据需要合并垂直缩放并根据预测的工作负载变化主动调整资源分配，改进了以前水平自动缩放器的局限性。这导致更高效和有效的资源扩展，以处理边缘计算环境中的动态工作负载变化。</p>
<p><img src="/../images/20230719234956651.png" alt="image-20230719234956651"></p>
<p><img src="/../images/20230719235123844.png" alt="image-20230719235123844"></p>
<p><strong>五 实验和评估</strong></p>
<p>在本节中，我们将描述评估LOTUS性能的设置。具体来说，我们评估了工作负载建模的准确性和系统在不同条件下的性能。</p>
<p><strong>A. Experimental setup</strong></p>
<p>图1中描述的边缘计算系统通过直接以太网连接和Microk8s服务(一种轻量级Kubernetes实现)展示了一个完全连接的拓扑。需要注意的是，这种体系结构安排是灵活的，不需要静态配置，因为它可以容纳一个节点集群。边缘网络是使用树莓派设备构建的，选择树莓派设备是因为它们的硬件限制。LOTUS体系结构是使用Python实现的，并部署在通过直接以太网链路连接到网络的笔记本电脑上。用于实验的硬件和软件组件如表4所示。</p>
<p><strong>B. Measurable objectives</strong> </p>
<p>正如前面介绍中所述，我们对自动缩放器的主要目标是通过最小化请求延迟来提高最终用户的服务质量。这是我们的关键评估指标。我们通过记录我们执行的每个测试中每个请求的RTT并计算平均值(排除异常值)来确定这个指标。我们只考虑有效请求的RTT，因为从最终用户的角度来看，只有完成有效请求所需的持续时间才是重要的。此外，我们根据均方误差损失来评估深度学习的准确性，这是评估模型准确性的公认指标[4]。我们在训练和测试阶段都使用它。与HPA相比，RTT的降低以及模型精度的几乎为零的损失将证明成功的结果。</p>
<p><strong>C. Experiments</strong></p>
<p>我们开发了两个不同的实验来评估系统在不同条件下的性能。这些测试是指数增加和指数减少的情况，在下面解释。</p>
<p><img src="/../images/20230719235641859.png" alt="image-20230719235641859"></p>
<p><img src="/../images/20230719235835235.png" alt="image-20230719235835235"></p>
<p><strong>1)指数增长压力测试:</strong> 我们需要确定LOTUS将如何适应重大的突然负载变化。为此，我们故意以一种戏剧性和突然的方式增加工作负载，以评估系统处理突发需求高峰的能力。指数增长将从最小负载开始，然后以指数方式增加对集群的请求数量。我们将这样做，直到系统崩溃，通过延迟超过阈值检测到，因此没有返回任何结果。我们将记录成功请求的数量，以查看崩溃点。指数递增算法的伪代码如清单4所示。Kubernetes API的“&#x2F;healthz”端点用于监控集群的状态。如果响应状态码表明群集不健康，则假定群集已崩溃，并返回请求号。</p>
<p><strong>2)指数下降压力测试:</strong> 该实验评估系统在面对工作量急剧下降时的弹性。指数下降的情况与指数上升的情况相反。我们将从一个恒定的高负荷开始，这个负荷要高到足以引起剧烈震动，但又不能高到足以导致坠机。然后，我们将开始以指数方式减少负载，并记录延迟时间，以查看在负载减少的情况下是否分配了太多的资源。指数递减算法的伪代码如清单5所示。</p>
<p>我们选择这些特定的实验来衡量系统对不可预见的边缘情况的反应能力。压力测试特别重要，因为它们可以帮助我们评估系统在不可预测的情况下有效适应和扩展的能力。例如，在1998年世界杯期间，比赛日的网络流量激增，但在比赛结束后迅速消退。尽管这种模式可能在某种程度上是可预测的，但确保我们的系统能够有效地处理和适应它们仍然是必不可少的。</p>
<p><strong>六 实验结果</strong></p>
<p>本节包含来自NASA和WC98数据集的工作负载预测的DL模型的实验结果，以及我们的自动缩放器测试的性能结果。所执行的测试是指数增长和减少用例测试，它们的伪代码分别显示在清单4和5中。在描述模型精度的图形中，x轴表示时间戳(以分钟为单位)，y轴表示发送到边缘网络的相应规范化请求计数。</p>
<p><strong>A.工作量建模的准确性</strong></p>
<p>图2和图3分别展示了NASA和WC98数据集的实际结果和预测结果。图2b提供了完整数据集的概述，而图2c则绘制了我们的预测模型。这些数字证明了我们模型的准确性，因为它与实际数据非常吻合。这也适用于WC98数据集，如图3a和3c所示。在整个训练阶段中，loss值在训练周期中呈现出明显的下降趋势，最终达到0.0021 (NASA)和0.0016 (WC98)。整个训练阶段损失值的稳定下降表明我们的模型随着时间的推移正在学习和改进，从而导致更准确的预测。这可以在图4中看到，我们可以看到向Epoch 100的快速收敛，其余的在Epoch 200之前提供较小的精度改进。</p>
<p><strong>B. 压力测试</strong></p>
<p>1)指数增长测试:图5显示了LOTUS和HPA在指数增长实验场景下平均10次的性能对比实验结果。该图显示了两个系统在一段时间内的性能，并显示LOTUS在整个实验过程中始终优于HPA。我们在此图中包含了3个注意点，其中我们已经确定了消除冷启动问题的好处，其中HPA发生超时，而LOTUS不受影响，以及系统之间发生性能反转的未知异常(在32个请求点)。</p>
<p>2)指数下降测试:图6显示了LOTUS和HPA在指数下降实验场景下平均10次的性能对比实验结果。该图显示了两个系统随时间的性能。我们把这张图细分为两部分。第一个标记部分强调了LOTUS在突然和强烈负载条件下有效减少往返时间。本节将演示LOTUS如何以最小的性能损失有效地处理要求苛刻的场景。第二个确定的部分对于结论性的性能评估似乎是不确定的，因为所得到的曲线相互交织，并且没有任何明显的模式来区分两个系统的性能。</p>
<p><img src="/../images/20230720000109410.png" alt="image-20230720000109410"></p>
<p><img src="/../images/20230720000134851.png" alt="image-20230720000134851"></p>
<p><img src="/../images/20230720000202222.png" alt="image-20230720000202222"></p>
<p><img src="/../images/20230720000216936.png" alt="image-20230720000216936"></p>
<p><strong>七 讨论</strong></p>
<p>本节讨论已确定的趋势和其他值得注意的观察结果。</p>
<p><strong>A.模型精度分析</strong></p>
<p>NASA和WC98的完整数据集与预测一起提供给读者，以提供额外的背景。我们的分析显示，正如两个模型的结果所表明的那样，两个数据集在特定时间间隔内预测请求计数的准确度很高。然而，经过仔细检查，我们观察到WC98数据集并不能准确预测更高水平的计数。这种限制可以归因于这样一个事实，即60%的分割包含相当多的接近零的值，从而导致较不准确的预测。特别是，这在比赛日更加明显，因为接近零的数值更为普遍。尽管存在这些限制，但预测的总体准确性是显而易见的。然而，NASA的数据集显示出略有不同的趋势，几乎所有的高结果都被准确预测，而低结果往往被低估。尽管存在局限性，但预测的总体准确性是明确的，接近于零的损失值进一步加强了这一点。此外，基于我们对完整数据集的分析，我们认为NASA数据集更适合指数用例测试。这是因为NASA数据集训练部分包含一个非常大的值，如图X中NASA数据集图所示，这在WC98数据集中是不存在的。因此，该模型可以在NASA数据集中更准确地预测更高的计数值。总的来说，我们得出结论，GRU时间序列模型非常适合预测请求计数，这是我们研究的关键发现之一。高精确度和可忽略不计的损失值进一步证实了我们的结论，并强调了GRU时间序列模型在这些数据集中预测请求计数的适用性。</p>
<p><strong>B.计算权衡和自动缩放性能</strong></p>
<p>我们使用的时间序列以分钟为单位记录了HTTP请求计数。这意味着在我们的自动缩放器的实际实现中，用于缩放的窗口大小是每分钟一次。然而，我们必须注意到，对于我们的实验测试，我们有充分的理由不能使用这个窗口大小。我们以WC98数据集为例。测试集包含大约51,000个数据条目。要准确地运行它，大约需要连续运行35天。然后必须重复多次，才能在去除异常值后获得可靠的结果。作为替代方案，我们使用数据集逐个索引执行此操作。然而，这个窗口的大小引起了一些担忧。如果我们增加预测的频率，我们可以基于动态请求变化更准确地预测资源需求。然而，这是一个权衡，这是一个自动缩放不稳定。我们越频繁地分配资源，自动缩放器和集群就会变得越不稳定。这可以由其他自动缩放器证明，除了我们的自动缩放器。例如，HPA的缺省更新时间为15秒。这意味着每隔15秒，根据HPA度量公式对度量进行评估和必要的更新。如果我们将其更新为1秒，系统将变得不稳定，因为决策是在更小且可能更不稳定的数据上做出的。此外，我们的自动缩放器有一个权衡，HPA和其他反应式自动缩放器没有。我们需要时间来训练我们的深度学习模型。我们训练了一个基于服务器访问请求的GRU时间序列模型，从中我们将请求发送到集群并记录pod计数。这些数据用于线性回归预测pods数。当我们为我们的数据集和集群硬件训练这些模型时，任何新的数据集或集群硬件重构都需要模型再训练。这是我们的预测式自动缩放器和其他反应式自动缩放器之间最大的折衷。然而，应该注意的是，对于我们的数据集，模型训练和硬件重新配置所需的时间不足减轻了这种权衡，因为数据集和硬件已经建立，这使得我们的系统的性能优势可以看到，正如我们的实验结果所示。</p>
<p><strong>C.消除“冷启动”问题</strong></p>
<p>基于图5所示的发现，我们的指数增长用例结果表明，与HPA相比，冷启动问题得到了明确的消除。这个功能是由LOTUS的主动资源分配提供的，它允许我们提前预测哪些工作负载进入系统，从而有效地消除了响应式自动伸缩方法中固有的时间间隔。LOTUS的这个优势非常有价值，特别是对于时间敏感的应用程序或类似的场景，因为它允许快速的启动时间，可以充分利用。</p>
<p><strong>D.高工作负载环境中的系统性能</strong></p>
<p>就高工作负载能力而言，与HPA相比，LOTUS表现出了明显的性能优势，如图5所示。在这个实验场景中，当HPA在1024个并发请求之后超时时，LOTUS显示RTT没有变化，这表明超时与自动伸缩机制有关，而不是物理硬件限制。此外，图6显示，在高工作负载环境中，LOTUS在达到低工作负载环境之前几乎呈线性下降。相比之下，HPA最初遵循类似的下降，但在256个同时请求时经历了明显的下降。我们假设这种下降是由于与HPA的反应性水平缩放相比，LOTUS的主动混合缩放实施了主动混合缩放，这解释了两个系统之间的差异。</p>
<p><strong>八 总结</strong></p>
<p>本研究提出了一种基于深度学习的自动缩放器架构，以实现边缘计算集群的自主缩放管理。提出的体系结构通过多个用例场景进行测试，为其有效性提供可量化的结果，并展示其实现所需的算法。进行了压力测试以检查架构在极端负载下的性能，结果表明“冷启动”问题显着减少。未来的工作可能需要将工作负载卸载到云端，扩展架构可以部署的集群范围，并实现完整的深度学习垂直扩展，而不是本研究中使用的深度学习水平和数学垂直扩展。</p>
<p>SHOWAR</p>
<p>PBS</p>
<p><strong>摘要</strong>–在具有动态工作负载的云应用程序中，自动扩展对于确保最佳性能和资源利用率至关重要。然而，由于工作负载模式的多样性和微服务之间复杂的交互，传统的自动扩展技术通常不再适用于基于微服务的应用。具体来说，性能异常会通过交互传播，导致大量微服务异常，从而难以确定根本的性能瓶颈（PB）并制定适当的扩展策略。此外，为了平衡资源消耗和性能，现有的基于在线优化算法的主流方法需要多次迭代，从而导致振荡，提高了性能下降的可能性。为了解决这些问题，我们提出了 PBScaler，这是一个瓶颈感知自动伸缩框架，旨在防止基于微服务的应用出现性能下降。PBScaler 的关键在于定位 PB。因此，我们提出了 TopoRank，一种基于拓扑潜力的新型随机行走算法，以减少不必要的扩展。通过将 TopoRank 与离线性能感知优化算法相结合，PBScaler 在不中断在线应用的情况下优化了副本管理。综合实验证明，PBScaler 在缓解性能问题的同时有效节约资源，其性能优于现有的最先进方法。</p>
<p><strong>1 介绍</strong></p>
<p>随着微服务架构的发展，越来越多的云应用正在从单体架构向微服务架构迁移[1], [2], [3], [4], [5], [6]。这种新架构将单体应用分解成多个微服务，这些微服务通过 HTTP 或 RPC 协议相互通信，从而降低了应用耦合度[7]。此外，每个微服务都可以由不同的团队独立开发、部署和扩展，从而实现快速的应用程序开发和迭代。然而，外部工作负载的不可预测性和微服务之间交互的复杂性会导致性能下降 [8]、[9]、[10]。云提供商必须准备过多的资源来满足应用程序所有者的服务级别目标（SLO），这通常会造成不必要的资源浪费[11]，[12]。因此，满足 SLO 与尽量减少资源消耗之间的不平衡成为微服务资源管理面临的主要挑战。</p>
<p>微服务自动扩展 微服务自动扩展指的是根据工作负载变化弹性分配资源的能力[13]。通过利用微服务的弹性特性，自动伸缩可以缓解资源成本与性能之间的冲突。然而，微服务的自动扩展在短时间内难以准确扩展性能瓶颈（PB）。由于微服务间通信的复杂性，一个 PB 的性能下降可能会通过消息传递传播到其他微服务[2]，导致大量微服务同时出现异常。我们通过向谷歌开发的开源微服务应用程序在线精品 1 中的特定微服务注入突发工作负载来证明这一点。图 1 显示，PB Recommend 中的性能下降会蔓延到上游微服务，如 Checkout 和 Frontend。为了进一步验证精确扩展 PB 的重要性，我们进行了压力测试，并分别扩展了不同的微服务。如图 2 所示，微服务（Frontend）的异常扩展无法缓解 SLO 违规情况。但是，当我们识别并扩展 PB 建议时，微服务应用的性能得到了改善。遗憾的是，定位 PB 通常很耗时，而且偶尔会出错[14]。</p>
<p>近年来，人们提出了几种在自动扩展前识别关键微服务的方法。例如，Kubernetes 2 的默认自动分级器会根据计算资源的静态阈值过滤微服务以进行直接分级。Yu 等人[15]通过计算服务功率（即第 50 百分位响应时间（P50）与第 90 百分位响应时间（P90）之比）定义了弹性扩展的边界。此外，Qiu 等人[4] 引入了一种基于 SVM 的方法，通过分析各种尾部延迟的比率来提取关键路径。虽然这些研究缩小了自动缩放的范围，但它们仍然考虑到了可能影响缩放策略的非瓶颈微服务，尤其是当应用程序中的大量微服务同时出现异常时。因此，迫切需要在自动扩展前准确定位瓶颈微服务。</p>
<p><img src="/../images/:Users:joshua:Library:Containers:com.tencent.xinWeChat:Data:Library:Caches:com.tencent.xinWeChat:2.0b4.0.9:1d8e23a23092b73811c1b93f8a731484:dragImgTmp:WeChatf5eed04d852c27554c8fbd8d22d8efc1.jpg" alt="WeChatf5eed04d852c27554c8fbd8d22d8efc1"></p>
<p><img src="/../images/20230806213009944.png" alt="image-20230806213009944"></p>
<p>为了平衡资源消耗和性能，现有研究采用了在线优化算法来寻找接近最优的自动缩放策略。然而，由于自动伸缩的可能策略种类繁多，这些方法需要大量的尝试，这对在线应用来说是个问题。例如，火车票3 是最大的开源微服务应用，由近 40 个微服务组成。假设每个微服务最多可以有 15 个副本，那么为该应用确定最优分配策略无疑是一个 NP 难问题，因为最多有 1540 种扩展选择。此外，在线优化中的反馈循环持续时间太长，无法实现模型收敛。此外，还必须考虑在线优化导致性能下降的潜在风险。图 3 展示了突发工作负载对 MicroScaler [15] 的副本波动和延迟波动的影响，MicroScaler 是一种在线自动缩放方法，采用了在线贝叶斯优化，以找到总成本的全局最小值。在线优化造成的频繁在线尝试创建副本（图 3a）导致了振荡和性能下降（图 3b）。因此，我们受到启发，设计了一种离线优化流程，由模拟器提供反馈。</p>
<p>本文介绍了 PBScaler，这是一个水平自动扩展框架，旨在通过识别和解决瓶颈问题，防止基于微服务的应用出现性能下降。我们没有像以前的工作[11]、[15]那样为所有异常微服务优化资源，而是提出了基于拓扑势理论（TPT）的随机行走算法 TopoRank，以识别性能瓶颈（PB）。TopoRank 考虑了微服务依赖性和异常可能性，提高了瓶颈定位的准确性和可解释性。通过 TopoRank 确定 PB 后，PBScaler 会进一步采用遗传算法找到近乎最优的策略。为避免过度优化造成应用振荡，该过程采用离线方式，并由 SLO 违反预测器提供指导，该预测器可模拟在线应用并为扩展策略提供反馈。本文的主要贡献概述如下：</p>
<ul>
<li>我们提出的 PBScaler 是一个瓶颈感知自动扩展框架，旨在防止基于微服务的应用程序性能下降。通过精确定位瓶颈，PBScaler 可以减少不必要的扩展并加快优化过程。</li>
<li>我们采用基于遗传算法的离线优化流程来优化资源消耗，同时避免违反 SLO。该过程由 SLO 违规预测器指导，旨在实现资源消耗与性能之间的平衡，同时又不影响在线应用。</li>
<li>我们在 Kubernetes 系统中设计并实施了 PBScaler。为了评估其有效性，我们在在线环境中运行的两个广泛使用的微服务系统上进行了大量的真实工作负载注入和模拟工作负载注入实验。实验结果表明，PBScaler 的性能优于几种最先进的弹性扩展方法。</li>
</ul>
<p>本文接下来的内容安排如下。第 2 节，我们将讨论有关微服务瓶颈分析和自动扩展的相关工作。第 3 节，我们将详细介绍整个系统。第 4 节介绍评估和实验结果。第 5 节总结了我们的工作并讨论了未来的研究方向。</p>
<p><strong>2 相关工作</strong> </p>
<p>随着云计算的发展，学术界和工业界提出了许多针对虚拟机或容器等云资源的自动扩展方法[16], [17], [18], [19]。然而，由于微服务之间错综复杂的依赖关系，微服务的自动伸缩可能要复杂得多。</p>
<p>性能瓶颈分析（也称为根本原因分析）是快速定位导致微服务性能下降的瓶颈的有效方法，从而减少自动扩展所需的时间和精力。在本节中，我们将分析有关微服务瓶颈分析和自动扩展的相关工作。</p>
<p><strong>2.1 瓶颈分析</strong> </p>
<p>近年来，微服务场景中的瓶颈分析方法层出不穷，其中大多数都依赖于三类数据：日志、跟踪和度量。1) 日志。Jia 等人[20]和 Nandi 等人[21]首先从正常状态日志中提取模板和流量，将其与目标日志进行匹配，然后过滤掉异常日志。2) 跟踪。跟踪是一种基于事件跟踪的记录，它再现了微服务之间的请求过程。有几项研究[22]、[23]、[24]、[25]介绍了如何利用跟踪来找出瓶颈。Yu 等人[22]、[23]通过结合频谱分析和 PageRank 算法，在痕迹构建的依赖图上定位瓶颈，而 Mi 等人[24]提出了一种无监督机器学习原型，用于学习微服务的模式并过滤掉异常微服务。不过，使用痕迹可能会对代码造成干扰，而且要求操作员对微服务的结构有深入的了解。3) 指标。一些方法[2]、[26]、[27]利用图随机漫步算法来模拟异常的传播过程，然后通过整合指标的统计特征和微服务之间的依赖关系来找到瓶颈。此外，CauseInfer [14] 和 MicroCause [28] 等方法侧重于通过因果推理构建指标因果关系图，这通常涉及指标之间隐藏的间接关系。</p>
<p>由于在监控指标时很少修改工作流代码，因此为微服务收集指标的成本通常比使用跟踪更低。此外，使用指标作为主要监控数据可以降低整合瓶颈分析和自动扩展的成本，因为指标在后一种情况中被广泛使用。尽管这些方法都有优势，但大多数方法在选择异常回溯的起点时都没有偏好。相比之下，我们的方法从具有更大异常潜力的微服务开始随机回溯，从而加快了收敛速度，提高了瓶颈定位的准确性。</p>
<p>2.2 微服务的自动扩展 微服务的现有自动扩展方法可分为五类。1) 基于规则的启发式方法。KHPA、Libra[29]、KHPA-A[30]和 PEMA[31]根据资源阈值和特定规则管理微服务副本的数量。然而，由于不同的微服务对特定资源的敏感度不同，因此需要专家知识来支持这些不同微服务的自动扩展。2) 基于模型的方法。微服务可以通过建模来预测其在特定配置和工作负载下的状态。排队理论[32]、[33]和图神经网络（GNN）[12]常用于为微服务建立性能预测模型。3) 基于控制论的方法[11]、[32]。SHOWAR [11]利用控制论动态调整微服务副本，以纠正监控指标与阈值之间的误差。4) 基于优化的方法。这些方法[15]、[34]进行了大量尝试，以在现有资源和工作负载的情况下找到最优策略。这些方法的关键在于缩小决策范围以加快进程。5) 基于 RL 的方法。强化学习（RL）已广泛应用于微服务的资源管理。MIRAS [35] 采用基于模型的 RL 方法进行决策，以避免真实环境的高采样复杂性。FIRM[4]利用支持向量机（SVM）识别微服务中的关键路径，并利用深度确定性策略梯度（DDPG）算法为路径上的微服务制定混合扩展策略。基于 RL 的方法在探索过程中需要不断与环境交互，无法适应动态的微服务架构。总之，虽然上述自动扩展技术各有优势，但它们很少关注性能瓶颈。为无瓶颈的微服务消耗计算机资源势必会增加扩展成本，延长决策时间。而我们的方法则侧重于定位性能瓶颈。</p>
<p><strong>3 SYSTEM DESIGN</strong></p>
<p>我们提出的 PBScaler 是一种以 PB 为中心的自动扩展控制器，用于定位 PB 并为其优化副本。如图 4 所示，PBScaler 由三个部分组成： 1) 指标收集器： 为了实时了解应用程序的状态，我们设计了一个指标收集器，以固定的时间间隔捕获并整合来自 Prometheus4 的监控指标。2) 性能瓶颈分析： 在指标收集器的协助下，该组件可执行 SLO 违规检测和冗余检查，以识别存在异常行为的微服务。接下来，将触发瓶颈定位流程，找出异常微服务中的 PB。3) 扩展决策： 该组件旨在使用进化算法确定 PB 的最佳副本数量。最后，PBScaler 会生成具有优化策略的配置文件，并将其提交给 kubernetes-client5，从而控制微服务的副本数量。</p>
<p><strong>3.1 指标收集器</strong> </p>
<p>自动伸缩系统依赖于对内存使用数据、系统负载和尾部延迟等指标的实时访问，以确定是否应执行弹性伸缩，以及应在微服务应用程序中分配多少资源。与需要深入了解程序和代码注入的基于跟踪的监控器[7]不同，指标收集器根据服务网格报告指标，以最大限度地减少对业务流的干扰。如表 1 所示，PBScaler 使用 Prometheus 和 kube-statemetrics 来收集和分类这些指标，包括响应延迟、微服务之间的调用关系、资源消耗和微服务工作量。<br>例如，容器 cpu 使用率秒总数是 Prometheus 中的一个标签，它记录了容器级别的中央处理器（CPU）使用情况。我们将 Prometheus 的监控间隔设为 5 秒，并将收集到的指标数据存储在时间序列数据库中。我们收集每个微服务的 P90 尾端延迟，并用它来表示应用程序的性能。调用关系意味着微服务之间的关联，可用于构建微服务关联图。服务网格。服务网格是一种基础设施，它能让开发人员为云应用添加可观察性和流量管理等高级功能，而不需要额外的代码。Istio7 是一种流行的开源服务网格实现，旨在与 Kubernetes 无缝集成。当 pod 在 Kubernetes 中启动时，Istio 会在 pod 中启动一个特使代理来拦截网络流量，从而实现工作负载平衡和监控。</p>
<p><img src="/../images/20230806214133416.png" alt="image-20230806214133416"></p>
<p><strong>3.2 Performance Bottleneck Analysis</strong></p>
<p>性能瓶颈分析（PBA）是一个旨在发现微服务应用程序中性能下降和资源浪费的过程，从而推断出当前问题的瓶颈。正如第 1 节所述，通过准确定位这些瓶颈，PBA 可以提高自动缩放的性能并减少过多的资源消耗。PBScaler 中的 PBA 流程如算法 1 所示。</p>
<p><strong>3.2.1 SLO Violation Detection</strong></p>
<p>为了检测微服务的异常情况，PBScaler 使用服务级别目标（SLO）与特定指标进行比较。如果微服务多次违反 SLO，即性能下降，就会被视为异常。正如文献[14]和[27]所述，检测 SLO 违规行为是触发瓶颈定位的关键一步。度量收集器收集的调用关系可用于构建微服务关联图 Gc。PBScaler 每 15 秒检查一次 Gc 中所有调用边的 P90 尾延迟，以便及时发现性能下降。如果某个调用的尾延迟超过了预定阈值（如 SLO），则该调用所调用的微服务将被添加到异常微服务（S）集合中，并启动瓶颈定位流程。为了考虑微服务延迟中偶尔出现的噪音，阈值设定为 SLO×(1 + α 2 )，其中 α 用于调整对噪音的容忍度。</p>
<p><strong>3.2.2 Redundancy Checking</strong></p>
<p>在没有出现性能异常的情况下，一些微服务可能会被分配超过所需的资源。但是，仅通过度量很难识别这种情况，可能会导致浪费有限的硬件资源。为了避免这种情况，必须确定哪些微服务分配了过多的资源。PBScaler 使用微服务每秒的工作负载变化率来确定资源是否多余。这种策略比仅依赖资源消耗更有效，因为不同的微服务对异构资源的敏感度可能不同。冗余检查的主要思路是利用假设检验来检测微服务当前的工作量 wi c 是否显著低于其过去的工作量（表示为 wi p）。显著程度由参数 β 调整，假设检验可表述为：</p>
<p><img src="/../images/20230806214341493.png" alt="image-20230806214341493"></p>
<p>为进行假设检验，我们首先从度量收集器中获取目标微服务的当前和历史工作量。如果 P 不超过置信水平 cl（默认设置为 0.05），我们就拒绝零假设 H0，并认为微服务 i 存在冗余资源。</p>
<p><img src="/../images/20230806214622937.png" alt="image-20230806214622937"></p>
<p><img src="/../images/20230806214640121.png" alt="image-20230806214640121"></p>
<p><img src="/../images/20230806214731025.png" alt="image-20230806214731025"></p>
<p><strong>3.2.3 Bottleneck Localization</strong> </p>
<p>由于微服务应用程序中复杂的交互[36]，并不是每个异常的微服务都需要扩展。例如，图5说明了瓶颈微服务(例如，Product)的性能下降如何沿着调用链传播到它的上游微服务(例如，recommendation, Frontend和Checkout)，即使上游微服务没有过载。因此，只有瓶颈微服务必须被扩展，而其他异常微服务只是被牵连。为了精确定位瓶颈微服务，我们引入了异常潜力的概念，它聚集了给定位置上所有微服务的异常影响。由于PB被许多受其影响的异常微服务所包围，因此PB的异常潜力通常很高。我们设计了一种新的瓶颈定位算法TopoRank，该算法在随机行走中引入拓扑势理论(TPT)来计算所有异常微服务的得分，并最终输出一个排名列表(rl)。在rl中得分最高的微服务可以被识别为PBs。</p>
<p>TPT源于物理学中“场”的概念，在各种著作中被广泛应用[37]，[38]来衡量复杂网络中节点之间的相互影响。由于微服务关联图也可以被视为一个复杂的网络，我们使用TPT来评估微服务的异常潜力。具体来说，我们已经观察到，在微服务关联图Gc中，离PBs更近的微服务，即那些跳数较少的微服务，更有可能出现异常，因为它们经常频繁地直接或间接调用PBs。基于这一观察，我们使用TPT评估微服务的异常潜力。为此，我们首先通过识别异常微服务及其在Gc中的调用关系来提取异常子图Ga。然后，我们使用TPT计算异常子图Ga中微服务vi的拓扑势。</p>
<p><img src="/../images/20230806214903865.png" alt="image-20230806214903865"></p>
<p>其中，N 代表 vi 的上游微服务数量，mj 代表 vj 的异常度。PBScaler 将异常度定义为某个微服务在某个时间窗口内违反 SLO 的次数。dji 表示从 vj 到 vi 所需的最小跳数。我们使用影响因子 σ 来控制微服务的影响范围。</p>
<p>然而，拓扑潜能值高的微服务并不一定是 PB，因为异常通常会沿着微服务相关图传播。因此，仅仅依靠 TPT 不足以诊断 PB。为了解决这个问题，PBScaler 采用了个性化 PageRank 算法 [39]，以逆转异常子图 Ga 上的异常传播并定位 PB。假设 P 是 Ga 的转换矩阵，Pi,j 是异常从 vi 跟踪到其下游节点 vj 的概率。给定外度为 d 的 vi，标准个性化 PageRank 算法将 Pi,j 设为</p>
<p><img src="/../images/20230806222701017.png" alt="image-20230806222701017"></p>
<p>这意味着算法不会偏向任何下游微服务。然而，这一定义没有考虑到下游微服务与当前微服务异常之间的关联。因此，PBScaler 会调整计算方法，更多地关注指标与上游响应时间更相关的下游微服务。对于每个微服务 vi，PBScaler 都会收集一个尾部延迟序列（li）和一组度量数组 Mi &#x3D; {m1, m2, - - , mk}，其中 mk 可视为给定时间窗口内度量数组（如内存使用率）的波动数组。PBScaler 的定义是，Pi,j 取决于 li 与 Mj 中度量数组之间皮尔逊相关系数的最大值：</p>
<p><img src="/../images/20230806222836755.png" alt="image-20230806222836755"></p>
<p>个性化PageRank算法通过在有向图上随机行走来确定每个节点的受欢迎程度。然而，一些节点可能永远不会指向其他节点，导致所有节点的分数在多次迭代后趋于零。为了避免落入这个“陷阱”，应用了一个阻尼因子δ，它允许算法根据预定义的规则从这些节点跳出来。通常δ设为0.15。个性化PageRank表示如下:</p>
<p><img src="/../images/20230806222945683.png" alt="image-20230806222945683"></p>
<p>其中v表示每个微服务节点被诊断为PB的概率。偏好向量u作为个性化规则，引导算法跳出陷阱。u的值由每个节点的异常势决定。异常潜力较大的节点优先作为算法的起始点。第k次迭代的方程可以表示为:</p>
<p><img src="/../images/20230806223009004.png" alt="image-20230806223009004"></p>
<p>经过多轮迭代，v逐渐收敛。PBScaler然后对最终结果进行排序并生成排名列表。排名列表得分最高的前k个微服务可以被识别为PBs。TopoRank的整个过程描述为算法2。</p>
<p><strong>3.3 Scaling Decision</strong></p>
<p>给定性能瓶颈分析确定的PBs，将对PBs的副本进行缩放，以最小化应用程序的资源消耗，同时确保微服务的端到端延迟符合SLO。尽管大量的副本可以缓解性能下降问题，但它们也会消耗大量的资源。因此，必须在性能保证和资源消耗之间保持平衡。缩放决策的过程将被建模为一个约束优化问题，以实现这种平衡。</p>
<p><strong>3.3.1 Constrained Optimization Model</strong></p>
<p>我们场景中的自动缩放优化试图确定一个分配模式，该模式为每个PB分配可变数量的副本。给定n个需要缩放的PBs，我们将策略定义为集合X &#x3D; {x1, x2，···，xn}，其中xi表示分配给pbi的副本数量。在优化之前，PBs的初始副本数量可以表示为C &#x3D; {c1, c2，···，cn}。应该注意的是，PBScaler中的副本约束应该分别为按比例缩小和按比例扩大的流程定义。在扩展过程中，我们对PBs的副本数量进行了如下限制:</p>
<p>![image-20230807104353754](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104353754.png)</p>
<p>其中cmax表示在给定有限服务器资源的情况下，微服务可以扩展到的最大副本数量。在缩小过程中，副本数量的约束可以表示为:</p>
<p>![image-20230807104407933](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104407933.png)</p>
<p>在Eq.(8)中，γ(默认值为2)表示复制减少的最大数量。这个限制是合理的，因为正如在实验中观察到的那样，大幅减少微服务副本的数量可能会导致短暂的延迟峰值。缩放决策的目标是尽量减少应用程序的资源消耗，同时保持其性能。应用程序性能通常用用户更关心的SLO违规来表示。因此，应用程序性能奖励可以细化为:</p>
<p>![image-20230807104422677](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104422677.png)</p>
<p>在优化过程中，应用程序的资源消耗(如CPU和内存使用)是不可预测的。为了保守估计资源消耗，</p>
<p>![image-20230807104445308](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104445308.png)</p>
<p>我们考虑的是PB副本与可分配副本的最大数量的比率，而不是计算CPU和内存的成本。我们将资源奖励计算为:</p>
<p>![image-20230807104458060](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104458060.png)</p>
<p>我们的目标是在保证性能的同时尽量减少资源消耗。我们利用加权线性组合(WLC)方法来平衡这两个目标。最终优化目标定义为:</p>
<p>![image-20230807104511351](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104511351.png)</p>
<p>式中λ∈[0,1]。我们将λ设置为参数，以平衡应用程序性能和资源消耗。</p>
<p><strong>3.3.2 SLO Violation Predictor</strong></p>
<p>为了计算性能奖励R1，需要评估策略是否会导致在线应用程序违反SLO。一种简单的方法是直接在在线申请中执行候选策略，并等待监控系统的反馈。然而，在线应用程序中频繁缩放引起的振荡是不可避免的。另一种方法是使用历史度量数据训练评估模型，该模型可以模拟在线应用的反馈。在不与在线应用程序交互的情况下，该模型根据应用程序的当前状态预测应用程序的性能。我们使用向量r来表示执行扩展策略x后每个微服务的副本数量。w是表示每个微服务当前工作负载的向量。由于瓶颈感知优化的时间成本较低，我们可以合理地假设w在此期间不会发生显著变化(参见4.2节)。给定由工作负载w和所有微服务副本r表示的应用状态，一个SLO违例预测器可以设计为:</p>
<p>![image-20230807104548241](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104548241.png)</p>
<p>其中ψ是一个二元分类模型。选择合适的分类模型的细节将在4.3节中讨论。用于训练的历史度量数据可以使用经典缩放方法(默认是Kubernetes自动缩放器)或随机方法生成。我们在3个节点(共44个CPU核和220gb RAM)上部署了一个开源微服务系统，并进行了弹性扩展。普罗米修斯以固定的时间间隔收集每个微服务的工作负载和P90尾部延迟。通过比较前端微服务的尾部延迟和SLO，可以很容易地标记每个时间间隔的监控数据。</p>
<p>![image-20230807104631365](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104631365.png)</p>
<p><strong>3.3.3 Autocaling Optimization</strong> </p>
<p>如第3.3.1节所述，性能和资源消耗之间的权衡可以建模为约束优化问题。为了找到接近最优的策略，PBScaler使用遗传算法(GA)来生成和优化扩展策略，以减少资源消耗，同时满足SLO要求。遗传算法通过模拟进化中的自然选择，在淘汰劣等子代的同时提高优等子代。首先，遗传算法执行随机搜索来初始化策略空间中的染色体种群，每条染色体表示优化问题的潜在策略。接下来，在每次迭代中，将选择具有高适应度的精英染色体(称为精英)进行交叉或突变以产生下一代。</p>
<p>我们场景中的自动缩放优化旨在确定一种缩放策略，该策略为每个PB分配可变数量的副本。自缩放优化过程如图6所示。一开始，PBScaler获得每个微服务当前的副本数量r和工作负载w。在性能瓶颈分析之后，PBScaler从r中识别PBs，并将它们过滤出来，得到r ‘。然后，决策者生成PBs策略的总体。由于要扩展的微服务数量会影响优化算法的速度和效果(第4.3节)，PBScaler假设只有PBs需要进行弹性扩展。换句话说，r ‘中的副本数量将保持不变。SLO违例预测器负责评估生成的策略。需要注意的是，该策略与r ‘合并，并与w一起输入到SLO违规预测器中。通过遗传算法选择优策略Xbest，并与r ‘合并，生成最终决策。</p>
<p>![image-20230807104720146](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807104720146.png)</p>
<p>从r中识别出PBs然后过滤出来得到r ‘然后，决策者生成PBs策略的总体。由于要扩展的微服务数量会影响优化算法的速度和效果(第4.3节)，PBScaler假设只有PBs需要进行弹性扩展。换句话说，r ‘中的副本数量将保持不变。SLO违例预测器负责评估生成的策略。需要注意的是，该策略与r ‘合并，并与w一起输入到SLO违规预测器中。通过遗传算法选择优策略Xbest，并与r ‘合并，生成最终决策。在优化阶段，决策者使用遗传算法生成并改进PB的缩放策略，如算法3所述。在每个PB的策略范围内随机生成一个种群(第1行)后，Decision Maker根据Eq.(11)估计每个策略的适应度，并存储精英(第2-3行)。在每次迭代中，遗传算法使用基于锦标赛的选择算子来挑选优秀的亲本(第6行)。通过使用两个点交叉算子和双染色体突变算子，通过重组和突变(第7-8行)产生新的后代。通过模拟自然选择，新的后代和亲本精英形成一个新的种群，进入下一个迭代(第9行)。当遗传算法达到指定的迭代次数时，Decision Maker返回适应度最高的缩放决策Xbest。</p>
<p><strong>4 EVALUATIONS</strong></p>
<p>在本节中，我们详细介绍了自动缩放的实验场景，包括PBScaler与学术界和工业界几种最先进的自动缩放算法的比较。</p>
<p><strong>4.1 Experimental</strong> </p>
<p><strong>Setup 4.1.1 Microservice Platform</strong> </p>
<p>实验在我们的私有云集群中进行，该集群由三台物理计算机(一个主节点和两个工作节点)组成，共有44个Intel 2.40 GHz CPU内核和220gb RAM。为了评估自动扩展，我们选择了两个开源微服务应用程序作为基准:a)在线精品8，一个由谷歌开发的基于web的电子商务演示应用程序。该系统通过10个无状态微服务和Redis缓存的协作，实现了浏览产品、将商品添加到购物车和支付处理等基本功能。b) Train Ticket9:复旦大学开发的大型开源微服务系统。Train Ticket拥有40多个微服务，并使用MongoDB和MySQL进行数据存储，可以满足各种工作流程，如在线门票浏览，预订和购买。由于集群资源的限制，我们将每个微服务限制为不超过8个副本。源代码可在Github10上获得</p>
<p><strong>4.1.2 Workload</strong></p>
<p>我们评估了PBScaler在各种流量场景下的有效性，使用了2015年3月16日Wiki-Pageviews[40]的真实维基百科工作负载，以及受Abdullah等人[41]的实验启发的五种模拟工作负载(EW1 ~ EW5)。我们将实际工作负载压缩到一个小时，并将其扩展到适合我们集群的级别。五个模拟工作负载表现出不同的模式，例如单峰、多峰、上升和下降，并且持续时间限制为20分钟。图7描述了这些工作负载的波动情况。</p>
<p><strong>4.1.3 Baseline Methods</strong></p>
<p>我们将PBScaler与学术界和工业界的几种最先进的微服务自动扩展方法进行比较，这些方法从静态阈值、控制理论和黑盒优化的角度执行微服务的动态水平扩展。</p>
<p>•Kubernetes水平Pod自动缩放(KHPA):这是Kubernetes默认的水平缩放方案。通过为某个资源R定制阈值T(默认为CPU使用率)，并从微服务的所有副本中聚合资源使用U R i, KHPA将副本的目标数量定义为n &#x3D; d∑i∈ActiveP ods U R i &#x2F; T e。</p>
<p>•MicroScaler[15]:这是一个自动扩展工具，它使用黑盒优化算法来确定微服务的最佳副本数量。MicroScaler计算微服务的P90&#x2F;P50进行分类，然后执行贝叶斯优化的四次迭代来做出扩展决策。</p>
<p>•SHOWAR[11]:它是一种混合自动缩放技术。我们在SHOWAR中再现了水平缩放部分，它使用PID控制理论使观察到的度量逐渐接近用户指定的阈值。在我们的实现中，我们用更常见的P90延迟替换了运行队列延迟，因为前者需要额外的eBPF工具</p>
<p><strong>4.1.4 Experimental Parameters and Evaluation Criteria</strong> </p>
<p>在我们的实验中，我们将普罗米修斯的收集间隔固定为5秒。随着实验时间和工作负载的增加，MongoDB等有状态微服务所需的数据量也会增加。最终，数据量将超过可用内存，从而需要使用磁盘存储。这种转换可能导致无法通过自动缩放来补救的性能下降。因此，我们将工作负载测试限制为无状态跟踪。在线精品店和火车票的SLO值分别设置为500毫秒和200毫秒。在SLO违例检测和冗余检查模块中，PBScaler首先将动作边界α设置为0.2，以减少噪声干扰。然后，我们根据经验将显著度β设置为0.9，以控制触发扩展的工作负载水平。对于瓶颈定位，将拓扑势的影响因子σ设为1，将rl中得分最高的top-k (k &#x3D;2)个微服务视为PBs。我们选择了SLO违规率、资源消耗和响应时间来评估自缩放方法的性能。如果自动缩放方法可以减少响应时间、SLO违规率和资源消耗，则认为它更有效。我们将SLO违例率定义为端到端P90尾部延迟超过SLO的百分比。资源消耗按照[42]给出的方法计算，其中CPU价格为0.00003334$ (vCPU&#x2F;s)，内存价格为0.00001389$ (G&#x2F;s)。总资源消耗由内存成本和CPU成本相加得到。</p>
<p>![image-20230807105023233](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807105023233.png)</p>
<p>![image-20230807105039422](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807105039422.png)</p>
<p><strong>4.2 Performance Evaluation</strong> </p>
<p>表2比较了具有不同工作负载的两个微服务应用程序中四种自动伸缩方法的SLO违反率和资源成本。None方法用作引用，不执行自动缩放操作。其结果以灰色表示，并被排除在比较之外。一般来说，PBScaler在减少两个微服务系统中六个工作负载下的SLO违规和最小化资源开销方面优于其他竞争方法。其中，PBScaler在火车票中的SLO违规率比基线方法平均降低4.96%，资源成本平均降低0.24美元。结果表明，PBScaler可以快速、精确地对大规模微服务系统中的瓶颈微服务进行弹性扩展，从而减少了SLO违规，节省了资源。对于Online Boutique中的6个工作负载，PBScaler还在其中4个模拟工作负载中实现了最低的SLO违规，并在3个模拟工作负载中实现了最低的资源消耗。图8描绘了六种工作负载下不同方法的延迟分布箱形图，探讨了每种方法对微服务系统性能的影响。可以看出，大多数自动缩放方法都可以保持延迟分布的中位数低于红色虚线(SLO)。但是，只有PBScaler进一步将第三个四分位数降低到所有工作负载的SLO以下。为了评估使用PBScaler进行弹性缩放的时间成本，收集并计算了PBScaler中每个模块所需的平均时间。如表3所示，Online Boutique中所有PBScaler模块的总时间成本小于一个监控间隔(即5s)，而Train Ticket的相同度量小于两个监控间隔。由于PBA缩小了决策范围，当应用程序从Online Boutique切换到Train Ticket时，尽管微服务的数量增加了，但决策者的时间成本并没有增加太多(不超过6.6%)。然而，我们认识到随着微服务规模的增长，PBA的时间消耗会迅速增加，这将是我们未来的工作。</p>
<p><strong>4.3 Effectiveness Analysis of Components</strong><br><strong>4.3.1 Performance Comparision of Bottleneck Localization</strong> </p>
<p>![image-20230807105214554](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807105214554.png)</p>
<p>![image-20230807105227225](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807105227225.png)</p>
<p>为了评估TopoRank算法是否能有效定位突发工作负载引起的PBs，我们通过Chaos Mesh将CPU过载、内存溢出和网络拥塞等异常注入到Online Boutique和Train Ticket中。这些异常通常是由高工作负载条件引起的。使用TopoRank算法分析度量并确定这些异常的性能瓶颈。然后将定位结果与micrororca[27]进行比较，micrororca是微服务根本原因分析的基线方法。AC@k测量前k个结果中实际PBs的精度，Avg@k是前k个结果的平均精度。这些指标的计算方法如下。</p>
<p>![image-20230807105148687](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20230807105148687.png)</p>
<p>其中A表示微服务集合，RT @k表示排名前k的微服务。图9给出了TopoRank和MicroRCA在不同微服务应用中的AC@1和Avg@5值。结果表明，TopoRank在这两个指标上都优于MicroRCA。这主要是由于TopoRank在执行个性化PageRank时考虑了异常可能性和微服务依赖关系。</p>
<p>瓶颈定位的主要目的是缩小策略空间，加快最优策略的发现。我们在PBs和所有微服务上执行遗传算法迭代，以证明瓶颈定位对优化的影响。图10描述了微服务系统下的迭代过程，并表明随着人口(Pop)的增加，pb感知策略在适应度方面明显优于适用于所有微服务的方法。该策略可以在不到5次迭代中获得较好的适应度。相比之下，涉及所有微服务的方法需要更大的种群和更多的迭代才能达到相同的适应度水平。这是由于pb感知策略帮助遗传算法精确地缩小了优化范围，加速了优解的获取。</p>
<p><strong>4.3.2 Effectiveness of the SLO Violation Predictor</strong> </p>
<p>SLO违例预测器的目标是直接预测优化策略的结果，而不是等待在线应用程序的反馈。我们根据每个微服务的副本数量和工作负载来确定是否会出现性能问题。为预测任务选择合适的二分类模型至关重要。以5秒的数据收集间隔，我们在我们的集群中收集了两个数据集，包括3.1k的火车票历史采样数据集(a)和1.5k的在线精品数据集(B)。为了对这两个数据集进行训练和测试，我们采用了四种经典的机器学习方法，包括支持向量机(SVM)、随机森林(Random Forest)、多层感知器(Multilayer Perceptron)和决策树(Decision Tree)。表4给出了四种模型对SLO违规预测的准确率和召回率。根据两个数据集的效果，我们最终选择随机森林作为SLO违例预测的主要算法。为了证明SLO违例预测器可以替代来自真实环境的反馈，我们将使用SLO违例预测器的PBScaler与从在线系统收集反馈的MicroScaler进行了比较。我们将突发工作负载注入Online Boutique，并仅使一个微服务异常，以消除两种方法在瓶颈定位方面的差异。如图11所示，在预测器的引导下，PBScaler的决策尝试次数和频率远低于MicroScaler。减少集群中的在线尝试将明显降低振荡的风险。</p>
<p><strong>5 CONCLUSIONS</strong> </p>
<p>本文介绍了PBScaler，一个瓶颈感知自动伸缩框架，旨在防止基于微服务的应用程序的性能退化。PBScaler使用服务网格技术收集应用程序的实时性能指标，并动态构建微服务之间的关联图。为了处理由外部动态工作负载和微服务之间复杂调用引起的微服务异常，PBScaler采用基于拓扑势理论的随机游动算法TopoRank来识别瓶颈微服务。此外，PBScaler采用离线进化算法，在SLO违规预测器的指导下优化缩放策略。实验结果表明，PBScaler可以在最小化资源消耗的同时实现较低的SLO违规。</p>
<p>在未来，我们计划从以下两个方面改进我们的工作。首先，我们将探索在细粒度资源(例如，CPU和内存)管理中使用瓶颈感知的潜力。其次，我们将探讨如何规避自扩展中有状态微服务的干扰，因为有状态微服务的性能下降可能会破坏自扩展控制器。第三，提高大规模微服务系统性能瓶颈分析的效率。</p>
]]></content>
      <categories>
        <category>Courses</category>
      </categories>
      <tags>
        <tag>Courses</tag>
      </tags>
  </entry>
  <entry>
    <title>forensics</title>
    <url>/2023/04/20/forensics/</url>
    <content><![CDATA[<p>5080 UofG</p>
<p>[TOC]</p>
<h1 id="Revision-and-Reflection"><a href="#Revision-and-Reflection" class="headerlink" title="Revision and Reflection:"></a>Revision and Reflection:</h1><ol>
<li><h2 id="Raphael-Aerospace"><a href="#Raphael-Aerospace" class="headerlink" title="Raphael Aerospace"></a>Raphael Aerospace</h2></li>
</ol>
<p>The fictional Raphael Aerospace is a leading multinational, specialising in software engineering for defense systems. The organisation has seized a laptop from one of its employees during a routine search that occurs at the entry and exit point to its North America campus. The company is concerned that the laptop contains sensitive source code. The employee has refused to speak or cooperate with the organisation since the laptop was seized. The digital investigation team believes the laptop is password protected, employs software-based full-disk encryption and has been seized in sleep mode. The laptop has highly integrated components to achieve a ‘slim-line’ profile and potentially has a Trusted Platform Module (TPM). The investigation team needs to acquire the keys associated with decryption and encryption of hard disk contents.</p>
<p><strong>a).  Outline the SIX states of the Advanced Configuration and Power Interface (ACPI) and argue the relevancy to software-based full-disk encryption for each state.</strong></p>
<p>The Advanced Configuration and Power Interface (ACPI) is a specification that defines power management and system configuration for computers. It establishes different power states, which play a significant role in the energy consumption and performance of a device. These power states are relevant to software-based full-disk encryption, as they can impact the security and accessibility of encrypted data. The six ACPI power states are:</p>
<ol>
<li>G0 (S0) - Working State: In this state, the system is fully powered on and operational. The CPU is executing instructions, and all peripherals are active. In the context of full-disk encryption, this state is when the system is most vulnerable to attacks. However, it’s also the state in which encryption and decryption processes can be performed.</li>
<li>G1 (S1-S4) - Sleeping States: There are four different sleep states, S1 to S4, with S1 being the lightest sleep and S4 the deepest sleep state. As the sleep state deepens, more components are powered down, and the system consumes less power. Full-disk encryption keys are typically stored in RAM or the TPM. In sleep states, the encryption keys remain in memory, making it possible to access encrypted data without re-entering the password. However, these states also increase the risk of cold boot attacks, where attackers can extract the keys from RAM or TPM if they can gain physical access to the machine.</li>
<li>G2 (S5) - Soft Off State: In this state, the system is powered off, but some components may still receive power to support features like Wake-on-LAN. The encryption keys are not present in memory, so an attacker cannot extract them. However, encrypted data on the disk remains secure, and a password is required to access the system upon startup.</li>
<li>G3 - Mechanical Off State: The system is completely powered off, and no components receive power. In this state, the encryption keys are not present in memory, and the encrypted data is secure. To access the data, the user must power on the system and enter the password.</li>
<li>S4 - Hibernate State: In this state, the system’s state is saved to the hard drive before powering down. The encryption keys are not present in memory, making the data secure. However, the system will require the password upon waking from hibernation to access the encrypted data.</li>
<li>C0-C3 - Processor Power States: These are the power states of the CPU itself, with C0 being the fully operational state and C3 being the deepest sleep state. These states are less relevant to full-disk encryption, as they primarily affect the CPU’s power consumption and performance. However, the encryption and decryption processes may be slower in deeper sleep states due to reduced CPU performance.</li>
</ol>
<p>In summary, ACPI power states have varying degrees of relevancy to software-based full-disk encryption. The Working State (G0) and Sleeping States (G1) are the most relevant, as they impact the security and accessibility of encrypted data. The Soft Off State (G2), Mechanical Off State (G3), Hibernate State (S4), and Processor Power States (C0-C3) are less directly relevant but may still influence the security of encrypted data in certain situations.</p>
<p><strong>b). Evaluate and describe THREE potential approaches to recover the keys associated with software-based full-disk encryption and argue for the optimal approach in the given context.</strong></p>
<p>There are several potential approaches to recover the keys associated with software-based full-disk encryption (FDE). Here are three possible methods:</p>
<ol>
<li>Brute-force attack: This approach involves systematically trying every possible combination of characters to find the correct encryption key or password. Given enough time and computational resources, a brute-force attack will eventually succeed.</li>
</ol>
<p>Pros:</p>
<ul>
<li>Guaranteed to find the correct key or password eventually.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Requires a significant amount of time and computational power, making it inefficient.</li>
<li>May be ineffective against long, complex passwords or strong encryption algorithms.</li>
</ul>
<ol>
<li>Dictionary attack: This method involves using a pre-compiled list of words or phrases (a “dictionary”) to attempt to recover the encryption key or password. Dictionary attacks are faster than brute-force attacks since they rely on a smaller set of possibilities, usually based on known common passwords or phrases.</li>
</ol>
<p>Pros:</p>
<ul>
<li>Faster than brute-force attacks.</li>
<li>Effective against weak passwords or phrases.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Less effective against strong, unique passwords or phrases.</li>
<li>Relies on the quality of the dictionary used.</li>
</ul>
<ol>
<li>Cryptanalysis attack: This approach involves analyzing the encrypted data or the encryption algorithm itself to discover weaknesses or flaws that can be exploited to recover the encryption key. This method often requires deep knowledge of cryptography and a thorough understanding of the specific encryption algorithm used.</li>
</ol>
<p>Pros:</p>
<ul>
<li>Can be more efficient than brute-force or dictionary attacks.</li>
<li>Exploits weaknesses or flaws in the encryption algorithm itself, potentially making it more successful.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Requires extensive knowledge and expertise in cryptography.</li>
<li>May not be successful if the encryption algorithm is well-designed and without significant weaknesses.</li>
</ul>
<p>In the given context, the optimal approach to recover the keys associated with software-based full-disk encryption would depend on several factors, such as the strength of the encryption algorithm, the complexity of the password, and the available resources (time and computational power).</p>
<p>If the encryption algorithm is known to have weaknesses or flaws, a cryptanalysis attack could be the most efficient method to recover the keys. However, this approach requires a high level of expertise in cryptography.</p>
<p>In cases where the password is known to be weak or likely to be found in a dictionary, a dictionary attack would be the preferred approach, as it is faster and more efficient than brute-force attacks.</p>
<p>If no information about the password or encryption algorithm’s weaknesses is available, a brute-force attack could be the only viable option. However, this method may be time-consuming and resource-intensive.</p>
<p>Ultimately, the choice of the optimal approach will depend on the specific circumstances and the available resources. In many cases, a combination of these approaches may be required to successfully recover the keys associated with software-based full-disk encryption.</p>
<p><strong>c). Raphael Aerospace is a British company, but the laptop was seized at the North American campus. The employee is a United Kingdom (UK) citizen and is concerned about the laws regarding software-based full-disk encryption in the United States (US). The employee believes that the UK will be a more favorable jurisdiction from the perspective of being forced to reveal any keys or passwords associated with encryption. Contrast the UK and US legal perspectives regards compelled decryption, speculate on the optimal jurisdiction in the given context.</strong></p>
<p>The legal perspectives on compelled decryption differ between the United States (US) and the United Kingdom (UK). Here is a brief overview of the legal stances in both jurisdictions:</p>
<p>United States (US): In the US, the Fifth Amendment to the Constitution protects individuals from self-incrimination. This has been interpreted by some courts as providing protection against being forced to reveal encryption keys or passwords, as doing so could be seen as self-incrimination. However, the interpretation of the Fifth Amendment in the context of compelled decryption is not uniform across all courts, and some have ruled that individuals can be compelled to provide decryption keys or passwords under certain circumstances.</p>
<p>United Kingdom (UK): In the UK, the Regulation of Investigatory Powers Act 2000 (RIPA) governs the legal framework surrounding encryption and compelled decryption. Under RIPA, individuals can be legally compelled to provide encryption keys or passwords to law enforcement authorities when ordered to do so by a court. Failure to comply with such an order can result in severe penalties, including imprisonment.</p>
<p>In the given context, the employee’s belief that the UK might be a more favorable jurisdiction from the perspective of being forced to reveal encryption keys or passwords might be misguided. The UK’s legal framework, as established by RIPA, clearly allows for compelled decryption under certain circumstances, whereas the US legal system provides some degree of protection against self-incrimination through the Fifth Amendment.</p>
<p>However, it is important to note that the specific circumstances of the case and the legal interpretations of the relevant laws may vary, leading to different outcomes in each jurisdiction. The optimal jurisdiction would depend on various factors, including the details of the case and the stance of the courts involved.</p>
<p>In conclusion, while the US legal system may offer more protection against compelled decryption than the UK, there are no guarantees, and the optimal jurisdiction would depend on the specific circumstances and the courts involved. The employee should seek legal counsel to better understand their rights and potential risks in both jurisdictions.</p>
<ol start="2">
<li><h2 id="BCO-Case"><a href="#BCO-Case" class="headerlink" title="BCO Case"></a>BCO Case</h2></li>
</ol>
<p>The fictional United States (US) Borders and Customs Office (BCO) wants to strengthen border controls. The BCO wants to ensure rigorous checks are possible at the border to ensure illegal digital content does not come across the border on physical devices. The BCO is particularly concerned that such files are hidden in unallocated space on drives. The BCO want a rapid process that can confirm a target file or traces of a target file are present on a suspected system. The suspected system can then be kept for further, deeper analysis. Argue an appropriate file carving technique and outline an implementation for the given context.</p>
<p><strong>a). In the given context, the BCO aims to quickly identify whether a target file or traces of it are present on a suspected system, particularly in unallocated space on drives. An appropriate technique for this purpose is file carving.</strong></p>
<p>In the given context, the BCO aims to quickly identify whether a target file or traces of it are present on a suspected system, particularly in unallocated space on drives. An appropriate technique for this purpose is file carving. Among the file carving techniques, Hash Based Carving is a suitable choice for the BCO’s requirements.</p>
<p>Hash Based Carving involves creating hash values of known target files and comparing them to the hash values of data blocks in the unallocated space of a drive. This technique is fast and can efficiently identify complete or partial matches of target files on a suspected system.</p>
<p>The implementation of Hash Based Carving for the BCO’s context can be outlined as follows:</p>
<p>Preparation: Compile a list of known target files that the BCO is concerned about. Calculate the hash values for these files and store them in a database.</p>
<p>Drive imaging: At the border, if a suspicious device is identified, create a forensically sound image of the drive to avoid tampering with the original evidence.</p>
<p>Data extraction: Extract data blocks from the unallocated space of the drive image. Divide the extracted data into fixed-size blocks, which will be used for hash comparison.</p>
<p>Hash comparison: Calculate hash values for each data block extracted from the unallocated space. Compare these hash values with the hash values of the known target files stored in the database.</p>
<p>Identification: If a match is found between the hash values, it indicates that the target file or traces of it are present on the suspected system. In such cases, the system can be retained for further, deeper analysis.</p>
<p>Hash Based Carving allows the BCO to rapidly check devices at the border for illegal digital content, enabling them to focus on suspicious systems for more in-depth investigation. This technique not only minimizes false positives but also helps streamline the process of detecting and preventing the transportation of illegal digital content across the border.</p>
<p><strong>b). The BCO want to reduce the number of false positives as this can result in unnecessary workload and delays at the border. Evaluate your proposed approach in (a), indicate potential causes of false positives and argue how they can be addressed.</strong></p>
<p>The proposed approach in (a) is Hash Based Carving. While it is a fast and efficient method to identify target files or their traces, it is not without potential causes of false positives. Here, we’ll evaluate the approach, highlight the possible reasons for false positives, and suggest ways to address them.</p>
<p>Potential causes of false positives:</p>
<p>Hash collisions: Although rare, hash collisions can occur when two different data blocks result in the same hash value. In such cases, the carving tool might falsely identify a non-target file as a target file, leading to false positives.</p>
<p>Partial matches: Hash Based Carving can detect partial matches of target files. However, there might be instances where the partial matches are unrelated to the target files, thus causing false positives.</p>
<p>Addressing false positives:</p>
<p>Utilize multiple hash algorithms: To minimize the chances of hash collisions, the BCO can use multiple hash algorithms (such as SHA-256, SHA-3, or others) and perform a comparison based on a combination of hash values. This approach significantly reduces the likelihood of false positives due to hash collisions.</p>
<p>Verify file headers and footers: In addition to hash comparison, the BCO can implement a secondary check for file headers and footers to ensure that the identified files are indeed the target files. By verifying the unique file signatures of known target files, the BCO can further minimize false positives.</p>
<p>Threshold-based matching: To address false positives due to partial matches, the BCO can set a threshold value for the level of similarity required for a match. By refining the matching criteria, the BCO can filter out unrelated partial matches, thereby reducing false positives.</p>
<p>By addressing these potential causes of false positives, the BCO can enhance the efficiency of the Hash Based Carving approach, ensuring a more accurate and streamlined process at the border. This will minimize unnecessary workload and delays, allowing the BCO to focus on genuine cases that require deeper analysis.</p>
<p><strong>c). The BCO also want to ensure the legality of the approach. The BCO want to ensure the approach does not require a specific search warrant, as this would impact on the speed and efficiency of the approach in terms of border control. Argue the potential legal concerns and outline how they may be addressed in any implementation for the given context.</strong></p>
<p>Potential legal concerns:</p>
<ol>
<li>Privacy rights: Conducting a file carving process on a suspected system may raise concerns about an individual’s right to privacy, as it involves searching and potentially extracting personal and private information without their consent.</li>
<li>Search and seizure laws: Depending on the jurisdiction, searching an individual’s digital device without a specific search warrant could potentially violate search and seizure laws, which generally require law enforcement to obtain a warrant before conducting a search that infringes on an individual’s privacy.</li>
<li>Chain of custody: Ensuring the integrity and admissibility of any digital evidence obtained through file carving in a court of law requires maintaining a proper chain of custody. This involves documenting every step of the evidence handling process, from the initial search to the final analysis.</li>
</ol>
<p>Ways to address legal concerns:</p>
<ol>
<li>Establish clear policies and guidelines: Develop and implement clear policies and guidelines for border agents to follow when conducting file carving or other digital forensic searches. These guidelines should outline the circumstances under which such searches are permissible, the extent of the search, and the steps to be followed to ensure legal compliance.</li>
<li>Train border agents: Provide regular training for border agents on the legal aspects of digital forensics and the proper procedures for conducting file carving and other digital searches. This can help minimize the risk of violating privacy rights and search and seizure laws.</li>
<li>Obtain appropriate authorization: While the BCO aims to avoid the need for specific search warrants, it is essential to obtain the necessary legal authorization to conduct file carving searches. This could involve establishing a reasonable suspicion or probable cause before conducting a search, depending on the jurisdiction’s requirements.</li>
<li>Implement a tiered search approach: To minimize potential privacy intrusions, consider implementing a tiered search approach that starts with less invasive techniques (such as basic keyword searches) and only escalates to more intrusive methods like file carving when there’s a reasonable basis for suspicion.</li>
<li>Maintain proper documentation: Ensure that a proper chain of custody is maintained throughout the entire digital forensics process. This includes documenting every step of the evidence handling process, from the initial search to the final analysis, to ensure the admissibility of any evidence obtained in a court of law.</li>
</ol>
<p>Ultimately, it is crucial for the BCO to consult with legal experts to develop a compliant and legally defensible approach to file carving and other digital forensic techniques at the border. This can help ensure that the method is both effective in identifying illegal digital content and respecting individual privacy rights and due process requirements.</p>
<ol start="3">
<li><h2 id="Conway-Energy-Case"><a href="#Conway-Energy-Case" class="headerlink" title="Conway Energy Case"></a><strong>Conway Energy Case</strong></h2></li>
</ol>
<p>Conway Energy is a large enterprise with many customers. The company recently discovered that an employee generated letters demanding missed payments from hundreds of customers. The employee used a variant of a standard company letter and altered it to instruct recipients to make payment into their bank account. The employee then lodged the letters with the corporate file store for automatic dispatch. The technical team state the letters can be retrieved, but have concerns as the corporate file store contains millions of documents and letters. The company legal and management team have approved an investigation by the technical team to extract the hundreds of generated letters. The technical team have uncovered a template for the fraudulent standard letter on a corporate workstation. The technical team have altered the letter to include a known affected customer name and address. The technical team then generated a hash of the file, but were unable to identify a match in the file store.</p>
<p><strong>a). The management team are concerned that evidence discovered during the internal investigation may eventually be presented in court. The management team are confident the fraudulent standard letter has been seized legally with appropriate authority. However, the management team want to ensure the discovered standard letter is admissible evidence in court. Evaluate and argue if the uncovered fraudulent letter is admissible evidence to a court of law in the given context.</strong> </p>
<p>The use of scientifically derived and proven methods towards the preservation, collection, validation, identification, analysis, interpretation and presentation of digital evidence derived from digital sources for the purposes of facilitating or furthering the reconstruction of events found to be criminal or helping to  anticipate the unauthorised actions shown to be disruptive to planned operations</p>
<p>Admissibility depends upon several factors: (1) authenticity, (2) relevancy, and (3) competency. </p>
<p>In the context of the discovered fraudulent standard letter, the following factors can be considered:</p>
<ol>
<li>Relevance: <em>The term relevancy</em> means that the information must reasonably tend to prove or disprove any matter in issue. The question or test involved is, “Does the evidence aid the court in answering the question before it?”. The fraudulent letter is directly related to the case at hand, as it demonstrates the employee’s actions to create and distribute the letters demanding missed payments. It is likely to be considered relevant evidence.</li>
<li>Reliability: The technical team must be able to demonstrate that the letter was discovered through a reliable and consistent process, and that the investigation methods were accurate and thorough. Proper documentation of the investigation process, such as the steps taken to identify the fraudulent letter, can help establish its reliability.</li>
<li>Authenticity: The term <em>authenticity</em> refers to the genuine character of the evidence. The court will want to ensure that the discovered letter is indeed the fraudulent standard letter created by the employee. The technical team should be prepared to provide evidence that confirms the letter’s authenticity, such as metadata, timestamps, and any other identifying information. A proper chain of custody should also be maintained to document the handling, storage, and transfer of the letter.</li>
<li>Competency: <em>Competent</em> as used to describe evidence means that the evidence is relevant and not barred by any exclusionary rule. The competency of the evidence in Conway Energy’s case will depend on the technical team’s qualifications and expertise, the methods and techniques used in the investigation, proper documentation and record-keeping, and compliance with legal and procedural requirements. Ensuring these factors are addressed will increase the likelihood of the evidence being considered competent and admissible in court.</li>
</ol>
<p><strong>b). The technical team have uncovered more fraudulent letters, but hashes of each do not match any in the corporate file store. Upon closer inspection the technical team have determined that the employee has inserted words with the font colour set to white. The words are effectively ‘hidden to visual inspection as they are not easily observable. The technical team have generated a definitive list of the hidden words present in the fraudulent letters. The technical team are unconvinced that generating a hash of each fraudulent letter is an effective route. The technical team need to utilise a hashing approach that is able to identify homologous patterns between the known fraudulent letters and those in the file store. Devise and explain an effective hashing approach in the given context.</strong></p>
<p>Since the traditional hashing approach does not seem to be effective in identifying the fraudulent letters, the technical team can explore alternative hashing techniques that focus on content-based similarity rather than exact file matches. One such approach is known as <strong>locality-sensitive hashing (LSH)</strong>.</p>
<p>Locality-sensitive hashing is a technique used to identify similar documents by generating hashes that have a higher probability of colliding when the documents are similar. This approach is more effective in identifying homologous patterns between the known fraudulent letters and those in the file store.</p>
<p>Here’s a possible approach to implementing LSH in this context:</p>
<ol>
<li>Preprocess the documents: Convert all the documents in the corporate file store and the known fraudulent letters to plain text, including the hidden white text, to ensure a consistent format for comparison.</li>
<li>Tokenize and create document vectors: Break the text of each document into tokens (e.g., words or phrases) and represent each document as a high-dimensional vector using techniques like term frequency-inverse document frequency (TF-IDF) or word embeddings. This process converts the documents into a suitable format for LSH.</li>
<li>Implement locality-sensitive hashing: Apply an LSH algorithm to the document vectors. The algorithm will generate similar hashes for documents with similar content, making it easier to identify the fraudulent letters with homologous patterns in the file store.</li>
<li>Set a similarity threshold: Determine an appropriate similarity threshold to identify potential matches. This threshold will depend on the specific LSH algorithm used and the desired balance between precision and recall.</li>
<li>Compare and flag potential matches: Compare the LSH hashes of the known fraudulent letters with those in the corporate file store. Flag any documents with hashes that exceed the set similarity threshold for further investigation.</li>
<li>Verify flagged documents: Manually review the flagged documents to ensure they are indeed fraudulent letters and not false positives. Make note of any discrepancies or issues to further refine the LSH algorithm or similarity threshold, if necessary.</li>
<li>Preserve evidence and implement preventive measures: Once the fraudulent letters have been identified and extracted, preserve the evidence and consider implementing additional security measures to prevent similar incidents in the future.</li>
</ol>
<p>By employing locality-sensitive hashing, the technical team can identify fraudulent letters with similar content patterns, even when the exact file hashes do not match. This approach should be more effective in detecting the hidden white text and other subtle alterations made by the employee.</p>
<p><strong>CTPH:</strong></p>
<ol>
<li>Preprocess the documents: Convert all the documents in the corporate file store and the known fraudulent letters to plain text, including the hidden white text, to ensure a consistent format for comparison.</li>
<li>Apply CTPH algorithm: Implement a CTPH algorithm, such as ssdeep, to generate fuzzy hash values for each document. The algorithm will create hashes that are similar for documents with similar content.</li>
<li>Set a similarity threshold: Determine an appropriate similarity threshold for comparing the generated fuzzy hashes. This threshold will depend on the desired balance between precision and recall in identifying similar documents.</li>
<li>Compare and flag potential matches: Compare the fuzzy hashes of the known fraudulent letters with those in the corporate file store. Flag any documents with hashes that exceed the set similarity threshold for further investigation.</li>
<li>Verify flagged documents: Manually review the flagged documents to ensure they are indeed fraudulent letters and not false positives. Make note of any discrepancies or issues to further refine the CTPH algorithm or similarity threshold, if necessary.</li>
<li>Preserve evidence and implement preventive measures: Once the fraudulent letters have been identified and extracted, preserve the evidence and consider implementing additional security measures to prevent similar incidents in the future.</li>
</ol>
<p>By employing CTPH, the technical team can identify fraudulent letters with similar content patterns, even when there are subtle differences such as the hidden white text. This approach should be more effective in detecting the homologous patterns between the known fraudulent letters and those in the file store compared to traditional hashing methods.</p>
<p><strong>c). The technical team are concerned that the hashing approach devised in (b) may not be appropriate in the given context. Identify potential concerns with the hashing approach devised in (b) for the given context.</strong></p>
<ol>
<li>Sensitivity to small changes: Although CTPH is designed to detect similar files, it may not always be sensitive enough to detect subtle differences, such as the hidden white text used in the fraudulent letters. This could lead to false negatives, where the technical team fails to identify some fraudulent letters.</li>
<li>False positives: CTPH can sometimes produce false positives, where non-fraudulent documents are flagged as potentially fraudulent due to similarity in content or structure. This could result in the technical team spending time and resources on manually reviewing non-fraudulent documents.</li>
<li>Scalability: Given that the corporate file store contains millions of documents, comparing the fuzzy hashes of the known fraudulent letters with those in the file store could be computationally expensive and time-consuming.</li>
<li>Accuracy: The accuracy of CTPH in identifying fraudulent letters depends on the chosen similarity threshold. Setting an appropriate threshold can be challenging, as a high threshold might result in false negatives, while a low threshold could lead to false positives.</li>
<li>Legal admissibility: There may be concerns about the legal admissibility of the evidence gathered using CTPH, as it relies on similarity rather than exact matches. The court may require additional validation or proof that the flagged documents are indeed fraudulent.</li>
</ol>
<p>Given these concerns, the technical team should carefully consider whether the CTPH approach is appropriate for their specific context. They may need to explore alternative methods, such as advanced text analytics or machine learning techniques, to more accurately and efficiently identify the fraudulent letters in the file store. Additionally, the technical team should consult with legal professionals to ensure the chosen approach meets the requirements for evidence admissibility in court.</p>
<p><strong>However, if we use LSH,</strong></p>
<p>Using locality-sensitive hashing (LSH) as your hash algorithm could be a suitable alternative for Conway Energy’s case, as LSH is designed to identify similar documents by generating hashes that have a higher probability of colliding when the documents are similar. This approach can be more effective in identifying homologous patterns between the known fraudulent letters and those in the file store.</p>
<p>Still we need to consider the potential problems of LSH:</p>
<p>Locality-sensitive hashing (LSH) is a powerful technique for identifying similar documents, but it comes with some potential concerns that should be considered in the context of the Conway Energy case:</p>
<ol>
<li>False positives: LSH can produce false positives, where non-fraudulent documents are flagged as potentially fraudulent due to similarity in content or structure. This can lead to spending additional time and resources on manual review of non-fraudulent documents.</li>
<li>False negatives: Depending on the chosen similarity threshold and LSH algorithm, LSH can also produce false negatives, where fraudulent documents are not flagged due to insufficient similarity in their LSH hashes. This can result in missing important evidence.</li>
<li>Scalability: LSH requires a considerable amount of computation and storage, especially when dealing with large datasets like Conway Energy’s corporate file store. This can lead to increased processing time and resource requirements.</li>
<li>Parameter selection: LSH algorithms often have several parameters that need to be fine-tuned, such as the similarity threshold, the number of hash functions, and the number of hash tables. Selecting appropriate parameters can be challenging and may require empirical testing and validation.</li>
<li>Preprocessing and feature extraction: LSH relies on converting documents into high-dimensional vectors, which may require considerable preprocessing and feature extraction, such as tokenization, stemming, and text vectorization using techniques like TF-IDF or word embeddings. This can be computationally expensive and may introduce additional complexity.</li>
<li>Legal admissibility: Similar to CTPH, there may be concerns about the legal admissibility of the evidence gathered using LSH, as it relies on similarity rather than exact matches. The court may require additional validation or proof that the flagged documents are indeed fraudulent.</li>
</ol>
<p>Given these potential concerns, the technical team should carefully consider whether the LSH approach is appropriate for their specific context. They may need to explore alternative methods or combine LSH with other techniques to improve accuracy, efficiency, and legal admissibility. Additionally, the technical team should consult with legal professionals to ensure the chosen approach meets the requirements for evidence admissibility in court.</p>
<ol start="4">
<li><h2 id="Laputa-University-Case"><a href="#Laputa-University-Case" class="headerlink" title="Laputa University Case"></a>Laputa University Case</h2></li>
</ol>
<p>The University of Laputa replaces computer systems for staff every five years. The management team have been informed by research staff that some systems have been replaced without sufficient notice and as a result important files have been lost. The management team have also been informed that some systems are being sold through various online auction websites, rather than being recycled.</p>
<p>The management team suspects a member of the systems support team has been selling the systems via online auction websites. The management team have authorised the digital investigations team to purchase several systems from online auction websites that they suspect have come from the institution. The management team have also authorised the digital investigation team to utilise appropriate data recovery techniques to recover files.</p>
<p><strong>a). The digital investigations team want to recover any previous Personal Storage Table (PST) files from many of the systems they have purchased from online auction websites. The digital investigations team believe such a file, in general, will not be heavily fragmented due to the numerous approaches adopted by modern file systems. Argue whether the position of the digital investigations team is accurate.</strong></p>
<p>The digital investigations team’s position that Personal Storage Table (PST) files, in general, will not be heavily fragmented due to the numerous approaches adopted by modern file systems is mostly accurate. However, some factors can still contribute to the fragmentation of PST files, even on modern file systems.</p>
<p>Modern file systems, such as NTFS, HFS+, and ext4, are designed to minimize fragmentation by using various allocation strategies and techniques. These file systems attempt to keep related data blocks close together and allocate new blocks in a way that minimizes fragmentation. As a result, the overall fragmentation of files on these file systems tends to be less severe compared to older file systems like FAT.</p>
<p>However, PST files, which are used by Microsoft Outlook to store email messages, contacts, and other data, can still become fragmented under certain conditions:</p>
<p>Large file sizes: PST files can grow quite large over time, especially if users have many emails and attachments. Large files can be more susceptible to fragmentation as they are more likely to be allocated in non-contiguous blocks.</p>
<p>Frequent updates: PST files are updated frequently as new emails are received, sent, or deleted. These updates can lead to fragmentation as the file system may need to allocate new blocks to accommodate the changes in file size and content.</p>
<p>Insufficient free space: If there is insufficient free space available on the storage device, it may be challenging for the file system to allocate contiguous blocks for new or updated data, resulting in fragmentation.</p>
<p>Multiple concurrent users: In a shared environment, multiple users might be accessing and modifying different files simultaneously. This can create a higher likelihood of fragmentation as the file system attempts to allocate blocks for various files concurrently.</p>
<p>While modern file systems are better at managing fragmentation, it is still essential for the digital investigations team to consider the factors mentioned above when attempting to recover PST files from the purchased systems. Fragmentation can affect the ease and success of the data recovery process, and the team may need to employ specialized data recovery tools or techniques to recover fragmented PST files effectively.</p>
<p><strong>b). The digital investigations team eventually assume the PST files they want to extract from the purchased systems are likely to comprise of more than two fragments and the relevant clusters are not necessarily in sequence. Devise and justify a carving approach to recover a single file in the given context. Highlight any limitations or constraints in the proposed solution.</strong></p>
<p>In the given context, the digital investigations team can employ a carving approach that combines signature-based carving and file system metadata analysis to recover the fragmented PST files. This approach involves the following steps:</p>
<ol>
<li>Signature-based carving: Scan the storage device for known file signatures or magic numbers associated with PST files. This process can help identify the starting point of each PST file fragment. Common magic numbers for PST files include <code>!BDN</code> for Outlook 97-2002 and <code>!BD0</code> for Outlook 2003 and later.</li>
<li>File system metadata analysis: Analyze the file system metadata to gather information about the allocation and location of clusters associated with PST files. This can help identify the correct sequence of fragmented clusters and uncover additional fragments that may not have been detected through signature-based carving.</li>
<li>Cluster chaining: Once the starting points of the file fragments and their metadata are identified, attempt to reconstruct the file by chaining the clusters in the correct order based on their allocation in the file system. This can be done using specialized data recovery tools or custom-built scripts.</li>
<li>File validation: After the PST file has been reconstructed, validate its integrity by checking its internal structure and attempting to open it using a compatible email client or PST viewer. This step helps ensure that the recovered file is complete and functional.</li>
<li>Iterative refinement: If the initial reconstruction is unsuccessful, refine the carving approach by adjusting parameters, such as the search window for signature-based carving or the cluster allocation strategy. Repeat the process until a successful recovery is achieved or it becomes clear that the file cannot be recovered.</li>
</ol>
<p>Limitations and constraints of the proposed solution:</p>
<ol>
<li>Incomplete recovery: The carving approach may not always be successful in recovering the entire PST file, particularly if some fragments are missing or corrupted.</li>
<li>Time-consuming: This process can be time-consuming, especially when dealing with large PST files or complex fragmentation patterns.</li>
<li>False positives: Signature-based carving can sometimes produce false positives, where unrelated data is mistakenly identified as part of the PST file.</li>
<li>Expertise required: The proposed carving approach requires a certain level of expertise in data recovery and file system analysis, as well as access to specialized tools or custom scripts.</li>
</ol>
<p>Despite these limitations, the proposed carving approach should provide the digital investigations team with a robust method for recovering fragmented PST files from the purchased systems. The team may need to iterate and refine the approach as necessary to maximize the chances of successful file recovery.</p>
<p><strong>c). The digital investigations team have since learned that they need to recover several PST files from each system, not just a single PST file. The digital investigations team have decided that the speed of recovery of the multiple files is more important than the accuracy of recovery. Devise a carving approach to recover multiple files in the given context. Highlight any limitations or constraints in the proposed solution.</strong></p>
<p>In the given context, where the speed of recovery is more important than accuracy, the digital investigations team can employ a streamlined carving approach to recover multiple PST files from each system. This approach involves the following steps:</p>
<ol>
<li>Signature-based carving: Perform a bulk scan of the storage device for known file signatures or magic numbers associated with PST files (e.g., <code>!BDN</code> for Outlook 97-2002 and <code>!BD0</code> for Outlook 2003 and later). This process helps identify the starting point of each PST file fragment.</li>
<li>File size estimation: Estimate the size of each PST file based on the distance between consecutive file signatures. This can help in the quick recovery of files without needing extensive file system metadata analysis.</li>
<li>File extraction: Extract the identified file fragments based on the estimated size and signature locations. This step may involve some level of over-extraction or under-extraction to ensure that complete files are recovered, at the expense of potential inaccuracies.</li>
<li>File validation (optional): If time permits, validate the integrity of the recovered PST files by checking their internal structure and attempting to open them using a compatible email client or PST viewer. This step can help identify any major issues with the recovered files.</li>
</ol>
<p>Limitations and constraints of the proposed solution:</p>
<ol>
<li>Inaccurate recovery: By prioritizing speed over accuracy, the carving approach may result in inaccurately recovered PST files, with potentially missing or corrupted data.</li>
<li>False positives: Signature-based carving can produce false positives, where unrelated data is mistakenly identified as part of the PST file. This may lead to the recovery of irrelevant or incomplete files.</li>
<li>File fragmentation: This approach does not account for fragmented files, which may result in incomplete recovery of some PST files.</li>
<li>File validation: Skipping or minimizing the file validation step can increase the risk of recovering unusable or corrupted files.</li>
<li>Expertise required: The proposed carving approach requires a certain level of expertise in data recovery and the ability to quickly analyze and adapt to the specific storage device’s conditions.</li>
</ol>
<p>Despite these limitations, the proposed carving approach should provide the digital investigations team with a faster method for recovering multiple PST files from the purchased systems. The team may need to accept the trade-off between speed and accuracy, understanding that some of the recovered files may be incomplete or corrupted.</p>
<p><strong>d). The digital investigations team have recovered the PST file from one of the systems purchased online with the revelation that the PST does not belong to any researcher or member of the staff at the University of Laputa. The digital investigations team actually suspect the file might belong to another university. The digital investigations team have decided to investigate the system further to identify the specific individual. Argue whether the actions of the digital investigation team are appropriate in the given context.</strong></p>
<p>In the given context, the actions of the digital investigations team can be seen as both appropriate and inappropriate, depending on the objectives and the ethical considerations involved.</p>
<p>Arguments for the appropriateness of the digital investigations team’s actions:</p>
<ol>
<li>Prevent potential misuse of data: The recovery of a PST file that does not belong to any researcher or staff member at the University of Laputa raises concerns about the potential misuse of the data contained within it. Investigating the system further could help the team understand how this file ended up on the system and prevent any potential misuse of the information.</li>
<li>Uphold data privacy and security: Universities are responsible for protecting the privacy and security of personal and sensitive information. Investigating the origin of the unknown PST file and identifying the individual it belongs to could help the team ensure that the university is upholding its data protection obligations.</li>
</ol>
<p>Arguments against the appropriateness of the digital investigations team’s actions:</p>
<ol>
<li>Privacy concerns: Investigating the contents of a PST file that does not belong to a member of the University of Laputa could be seen as an invasion of privacy. The team should consider the ethical implications of accessing someone else’s personal data without their consent.</li>
<li>Legal considerations: The digital investigations team should be aware of any legal implications associated with accessing and analyzing data that does not belong to their institution. There might be laws and regulations that govern the handling of such data, and the team should ensure they are acting within the legal framework.</li>
<li>Scope of investigation: The primary objective of the investigation was to determine whether a member of the systems support team was selling university-owned systems online. The discovery of a PST file that does not belong to any researcher or staff member may not be directly relevant to this objective. The team should consider whether further investigation of the file falls within the scope of their initial mandate.</li>
</ol>
<p>In conclusion, the actions of the digital investigations team can be considered appropriate if they are conducted within legal and ethical boundaries and if they serve a legitimate purpose, such as protecting data privacy and security. However, the team should carefully weigh the potential risks and implications of their actions, ensuring they do not infringe upon the privacy rights of individuals or act outside the scope of their initial investigation.</p>
<h1 id="Sample-exam-paper-2020"><a href="#Sample-exam-paper-2020" class="headerlink" title="Sample exam paper 2020"></a>Sample exam paper 2020</h1><ol>
<li><h2 id="Lime-Legal-Case"><a href="#Lime-Legal-Case" class="headerlink" title="Lime Legal Case"></a>Lime Legal Case</h2></li>
</ol>
<p>The management team for Lime Legal, a large legal firm that conducts numerous digital investigations, has decided to develop its own hash function for use in digital investigations. The management team has commissioned a specialised software developer to design and implement the hash function. The specialised software developer states that compression is an important requirement for a hash function.</p>
<p><strong>a). Argue for another TWO important requirements for a hash function in the given  context. (approximately 200 words)</strong></p>
<p>要想要设计一个哈希算法，需要满足以下几点要求：</p>
<ol>
<li>从哈希值不能反向推导出原始数据（哈希算法更多算是一种单向加密算法）。</li>
<li>对输入数据敏感，输入数据只要改变 1 bit，那么最终得到的哈希值也要不同。</li>
<li>冲突的概率要小，即对于不同的原始数据，哈希值相同的概率非常小。</li>
<li>哈希算法的执行效率要高，针对较长的文本，也能快速计算出哈希值。</li>
</ol>
<p>While compression is indeed an important requirement for a hash function, there are two other crucial requirements that must be considered for Lime Legal’s digital investigations: security and performance.</p>
<p>Firstly, security is paramount for a hash function in the context of digital investigations. A secure hash function needs to exhibit several properties, including collision resistance, preimage resistance, and second preimage resistance. Collision resistance ensures that it is computationally infeasible to find two distinct inputs that map to the same hash output, which is crucial to maintain the integrity of the evidence. Preimage resistance makes it difficult to find an input for a given hash output, while second preimage resistance ensures that it is hard to find a different input with the same hash output as an existing input. These security properties are essential for Lime Legal’s work as they ensure the reliability and trustworthiness of the digital evidence in legal proceedings.</p>
<p>Secondly, performance is another key requirement for a hash function in digital investigations. Lime Legal’s work likely involves processing large volumes of data in a timely manner. As such, the hash function must be efficient in terms of computational and memory requirements. A fast and resource-efficient hash function will not only minimize the time spent on processing the data but also reduce the likelihood of bottlenecks in the investigation process. This enables Lime Legal to provide more effective and timely services to their clients.</p>
<p>In conclusion, besides compression, security and performance are two essential requirements for a hash function in the context of Lime Legal’s digital investigations. Ensuring a secure and efficient hash function will not only maintain the integrity of digital evidence but also enhance the effectiveness of the firm’s investigative processes.</p>
<p><strong>b). The specialised software developer states that elements of the bespoke hash  function will rely upon some internal initial values and constants. The  specialised software developer states that these values and constants will be generated using a sophisticated and secret algorithm. The specialised software  developer informs the management team that the initial values and constants  will be made public along with the design and implementation details, but the  algorithm to generate them will be kept secret and managed by the company.  Argue whether the approach favoured by the specialised software developer is  appropriate in the given context.(approximately 400 words)</strong></p>
<p>One of the primary concerns is the lack of transparency in the process. In the field of cryptography, it is widely accepted that security should rely on the <strong>strength of the algorithm</strong> rather than the secrecy of its design. This principle is known as <strong>Kerckhoffs’s principle</strong>. By keeping the algorithm for generating initial values and constants secret, Lime Legal risks undermining the trust and credibility of their hash function. Digital evidence generated using a hash function with undisclosed components may face challenges in legal proceedings, as opposing parties could question its integrity.</p>
<p>Additionally, the secrecy of the algorithm prevents independent verification and analysis by the broader cryptographic community. Peer review and open scrutiny are essential to establishing the security and reliability of cryptographic algorithms. Closed-source designs may contain unintentional flaws or vulnerabilities that would otherwise be identified and resolved through a transparent review process.</p>
<p>Furthermore, the reliance on a secret algorithm for generating initial values and constants introduces the possibility of a single point of failure. If the secret algorithm is compromised, the entire hash function could be rendered insecure, potentially jeopardizing ongoing and past investigations.</p>
<p>In conclusion, the approach favored by the specialized software developer is not appropriate in the given context. Lime Legal should consider adhering to established cryptographic principles and industry best practices, which emphasize transparency, open scrutiny, and independent verification to ensure the credibility and robustness of their bespoke hash function.</p>
<p><strong>c). The specialised software developer is not entirely sure how to design the bespoke hash function. Devise a potential hash function that exhibits a Merkle-Damgård construction, highlight and argue the importance of any core components. (approximately 400 words)</strong></p>
<p><strong>d). The management team want to employ the use of the bespoke hash function to identify unauthorised files on employee smartphones and laptops. The specialised software developer states they can develop a system that can be used to rapidly inspect employee smartphones and laptops as part of random security searches as employees leave campus. A member of the management team is concerned that such a process may violate the privacy of the employee and some employees may feel targeted. Argue whether the approach favoured by the management team is appropriate  in the given context.(approximately 250 words)</strong></p>
<ol start="2">
<li><h2 id="Orange-Entertainment"><a href="#Orange-Entertainment" class="headerlink" title="Orange Entertainment"></a>Orange Entertainment</h2></li>
</ol>
<p>The management team for Orange Entertainment want to recover files from a Microsoft Windows 10 workstation that have been destroyed by a disgruntled employee. The management team believe the employee destroyed the files as they had been manipulating them for their own gain over several months. The management team have authorised the systems support team to recover the files as part of their investigation. The systems support team have allocated trainees Bill and Ben to lead the investigation and recover the files.</p>
<p><strong>a). Ben has identified ShadowExplorer as a useful tool to recover files from the Microsoft Windows 10 workstation.Discuss TWO relevant features of the ShadowExplorer tool and argue the relevance in the given context. (approximately 200 words)</strong></p>
<p>ShadowExplorer is a valuable tool for recovering lost or damaged files, offering two key features that make it particularly relevant for the Orange Entertainment management team’s investigation.</p>
<ol>
<li>Access to Shadow Copies: Since it is a Windows OS, One of the primary features of ShadowExplorer is its ability to access and browse through the shadow copies of files created by the Windows Volume Shadow Copy Service (VSS) on Windows. These shadow copies act as snapshots of the files and their respective states at different points in time. In the context of Orange Entertainment’s investigation, this feature is crucial as it allows Bill and Ben to potentially recover earlier versions of the manipulated files. By restoring these earlier versions, the management team can gain insight into the disgruntled employee’s actions and better understand the extent of the manipulation.</li>
<li>User-friendly interface: ShadowExplorer’s intuitive and user-friendly interface is another important feature that makes it suitable for the investigation. The tool presents a familiar Explorer-like interface, enabling Bill and Ben to easily navigate through the shadow copies and locate the relevant files. This ease of use will help streamline the recovery process, allowing the trainees to efficiently identify and restore the destroyed files. Furthermore, since both Bill and Ben are trainees, the simplicity of the tool will make it easier for them to learn and utilize in their investigation, reducing the chances of making mistakes during the recovery process.</li>
</ol>
<p>In summary, ShadowExplorer’s ability to access shadow copies and its user-friendly interface make it an ideal tool for Bill and Ben to recover the destroyed files, providing Orange Entertainment’s management team with the information they need to assess the situation and address the employee’s misconduct.</p>
<p><strong>b. Bill has decided to use ShadowExplorer on the employee workstation in-situ, but Ben is concerned if such an approach is appropriate. Ben also suggests the pair should at least take some simple notes of their actions, Bill argues it is not necessary. Critique the differing positions of Bill and Ben in the given context.(approximately 300 words)</strong></p>
<p>Bill’s decision to use ShadowExplorer directly on the employee workstation in-situ might seem efficient and time-saving; however, Ben’s concerns are valid, particularly in the context of an investigation where preserving evidence and maintaining a clear chain of custody is crucial.</p>
<p>Using ShadowExplorer in-situ poses <strong>several risks</strong>. First, the process might inadvertently alter the state of the workstation, potentially corrupting or overwriting evidence. Such modifications can jeopardize the <strong>integrity of the investigation</strong> and might also <strong>impact the legal admissibility of the evidence</strong>, should the management team decide to pursue legal action against the disgruntled employee. Instead, it is more appropriate to <strong>create a forensic image</strong> of the hard drive and work on a copy of that image to ensure the original data remains unaltered.</p>
<p>Second, working directly on the employee workstation increases the risk of <strong>accidental data loss or damage</strong>, especially given that both Bill and Ben are trainees. Utilizing a forensic copy provides a <strong>safety net</strong>, allowing them to <strong>revert</strong> to the original state if any mistakes are made during the recovery process <strong>(investigation revertiable)</strong>.</p>
<p>Regarding the documentation of their actions, Ben’s suggestion to take simple notes is actually a necessary step in a proper investigation. Maintaining detailed records of their actions, tools used, and findings is essential for several reasons:</p>
<ol>
<li>Accountability: Documenting the investigation process ensures that all actions taken can be justified and reviewed, which helps maintain the credibility and integrity of the investigation.</li>
<li>Reproducibility: Detailed notes allow others, including senior team members or external experts, to review and reproduce the steps taken in the investigation if needed, helping to validate the findings.</li>
<li>Legal purposes: Should the case go to court, proper documentation is vital for establishing the chain of custody and proving the legitimacy of the evidence obtained.</li>
</ol>
<p>In conclusion, Ben’s concerns about using ShadowExplorer in-situ and the need for documentation are valid. Adopting a more cautious approach that preserves the integrity of the evidence and maintains a clear record of their actions will not only improve the quality of the investigation but also ensure that the recovered data can be used effectively in any potential legal proceedings.</p>
<h1 id="2019-Sample-Paper"><a href="#2019-Sample-Paper" class="headerlink" title="2019 Sample Paper"></a>2019 Sample Paper</h1><h2 id="1-Janus-in-BBFS"><a href="#1-Janus-in-BBFS" class="headerlink" title="1. Janus in BBFS"></a>1. Janus in BBFS</h2><p>Janus is a software engineer for Bill and Ben Financial Services (BBFS). Janus has concerns about algorithms that unfairly disadvantage business customers. Janus has raised it with his line manager, but she was disinterested in his concerns. Janus decides to effectively smuggle elements of source code and associated documents outside the organisation using an external disk.</p>
<p><strong>(a) Janus is aware that the company utilises forensic techniques to identify encrypted files on external disks taken outside the organisation. Janus decides to smuggle the data via an external disk using steganography.Contrast steganography with cryptography and argue for steganography in the given context.[4]</strong></p>
<p>Steganography and cryptography are two distinct techniques used for protecting and concealing data. While both methods have their applications, steganography might be more suitable for Janus’s situation due to its ability to hide information within other data.</p>
<p>Steganography involves concealing information within another file or data stream, such as an image, audio, or video file, in such a way that it is virtually undetectable to an observer. The information is embedded in the carrier file without changing its perceptible characteristics, making it difficult to identify the presence of hidden data. This technique allows for the secret transfer of information, as the carrier file appears innocuous and attracts little suspicion.</p>
<p>Cryptography, on the other hand, focuses on encrypting data to make it unreadable and incomprehensible to unauthorized parties. While cryptography protects the contents of a message, it does not hide the fact that encrypted data exists. Encrypted files can draw attention and raise suspicion, potentially leading to further investigation.</p>
<p>In the given context, steganography might be more suitable for Janus’s needs. Since BBFS uses forensic techniques to identify encrypted files, using cryptography to protect the data on an external disk could raise red flags and make it more likely for Janus’s actions to be discovered. Steganography, however, would allow Janus to hide the source code and documents within seemingly harmless files, avoiding detection by BBFS’s security measures. By employing steganography, Janus can minimize the risk of his actions being discovered while still smuggling the data out of the organization.</p>
<p><strong>(b) Janus has decided to use the Bit Plane Complexity Segmentation (BPCS) algorithm to ensure high-capacity use of vessel images. Janus wants to ensure that insertion of the payload will not result in images that are vulnerable to human visualinspection. Janus plans to use several holiday images in Pure Binary Coding (PBC) with many ‘noisy’ qualities, e.g. sand and rain. Explain THREE operations of the BPCS algorithm to ensure the payload is effectively hidden in the given context.[9]</strong></p>
<p><strong>BPCS-隐写术（Bit-Plane Complexity Segmentation steganography）是</strong><a href="https://en.wikipedia.org/wiki/File_camouflage">数字隐写术</a>的一种。</p>
<p>数字隐写术可以通过将机密数据（即秘密文件）嵌入到一些称为“容器数据”的媒体数据中来非常安全地隐藏它们。容器数据也称为“承运人、封面或虚拟数据”。在 BPCS 隐写术中，<a href="https://en.wikipedia.org/wiki/24-bit_color">真彩色</a>图像（即<a href="https://en.wikipedia.org/wiki/24-bit_color">24 位彩色</a>图像）主要用于血管数据。实际中的嵌入操作是用机密数据替换血管图像<a href="https://en.wikipedia.org/wiki/Bit_plane">位平面</a>上的“复杂区域” 。BPCS-隐写术最重要的方面是嵌入容量非常大。与仅使用最不重要的数据位的简单图像隐写术相比，因此（对于<a href="https://en.wikipedia.org/wiki/24-bit_color">24 位颜色</a>图像）只能嵌入相当于总大小 1&#x2F;8 的数据，而 BPCS 隐写术使用多个位平面，因此可以嵌入更多的数据，尽管这取决于单个图像。对于“正常”图像，在图像退化变得明显之前，大约 50% 的数据可能可以用秘密数据替换。</p>
<p>比特平面复杂度分割（BPCS）算法是一种有效的隐写术方法，用于在图像中隐藏数据，特别是那些具有 “噪音 “性质的图像。在Janus的案例中，使用带有沙子和雨水的假日图像对BPCS隐写术是有利的。以下是BPCS算法的三个关键操作，有助于确保有效地隐藏有效载荷：</p>
<p>分解为位平面： BPCS算法首先将容器图像分解为一系列的位平面。每个比特平面代表了图像二进制表示法中的不同重要性水平。例如，最重要的位（MSB）平面包含最高的对比度信息，而最不重要的位（LSB）平面包含最低的对比度信息。通过以这种方式分解图像，BPCS可以操作对比度较低、”噪音较大 “的位平面来嵌入有效载荷，而不会对图像造成明显的变化。</p>
<p>复杂度计算和分割： BPCS通过计算不同值（0或1）的接壤像素对的比例来评估每个位面段的复杂性。如果一个片段的复杂性超过了预定的阈值，它就被认为是 “有噪声 “的，适合嵌入有效载荷。在Janus的案例中，使用带有沙子和雨水的图像增加了可用于数据隐藏的复杂片段的数量。这有助于确保有效载荷被很好地隐藏起来，难以被人类的视觉检查所发现。</p>
<p>自适应的数据嵌入： BPCS将有效载荷嵌入到上一步确定的复杂片段中。通过根据其复杂性自适应地选择合适的片段，BPCS确保嵌入的数据不会对图像造成明显的变化。该算法以保持图像的整体复杂性的方式，用有效载荷数据替换原始的复杂片段。这种自适应的嵌入过程对于在给定的环境中有效地隐藏有效载荷至关重要，因为它减少了通过视觉检查发现的风险。</p>
<p>通过使用BPCS算法，Janus可以利用假日图像的噪声特性来有效地隐藏有效载荷。分解为位平面，复杂度计算和分割，以及自适应数据嵌入操作共同作用，确保隐藏的数据难以被发现，同时对图像的视觉质量影响最小。</p>
<p><strong>(c) Janus is planning on implementing the BPCS algorithm on his workstation as to ensure he can embed payload data in the vessel images.Devise a simple BPCS algorithm to embed payload data in vessel images.[6]</strong></p>
<p>A simple BPCS algorithm for embedding payload data in vessel images can be broken down into the following steps:</p>
<ol>
<li>Image Preparation: Convert the vessel image to a suitable format, such as a lossless format like PNG or BMP, to prevent compression artifacts from affecting the steganography process. Resize the image if necessary to accommodate the payload data.</li>
<li>Bit Plane Decomposition: Decompose the vessel image into a series of bit planes. Separate the image into its color channels (e.g., red, green, and blue) and represent each channel using binary values. Then, create bit planes for each level of significance, from the most significant bit (MSB) to the least significant bit (LSB).</li>
<li>Payload Preparation: Convert the payload data into binary format. You may consider compressing and encrypting the data beforehand to further protect and optimize the payload.</li>
<li>Complexity Calculation and Segmentation: Evaluate the complexity of each bit plane segment by calculating the proportion of bordering pixel pairs with different values (0 or 1). If a segment’s complexity surpasses a predefined threshold, it is considered ‘noisy’ and suitable for embedding the payload.</li>
<li>Adaptive Data Embedding: Iterate through the noisy segments identified in the previous step, and embed the payload data by replacing the original complex segments. Ensure that the embedding process maintains the overall complexity of the image to avoid arousing suspicion.</li>
<li>Image Reconstruction: Reassemble the modified bit planes into their respective color channels, and then combine the channels to create the final stego-image. Save the stego-image in a lossless format to preserve the embedded data.</li>
<li>Payload Extraction: To extract the payload data from the stego-image, reverse the process by decomposing the stego-image into bit planes, identifying the noisy segments where the payload data was embedded, and reconstructing the original payload data from the binary values stored in those segments.</li>
</ol>
<p>By following these steps, Janus can implement a simple BPCS algorithm to effectively embed payload data in vessel images. The use of noisy segments for data embedding makes the hidden information difficult to detect through visual inspection, providing a level of security for the concealed data.</p>
<p><strong>(d) Janus is concerned that inspection techniques will reveal use of the steganography approach. Janus is concerned he will be legally required to reveal the devised algorithm in (c) to relevant authorities under the (UK) Regulation of Investigatory Powers Act 2000 (RIPA).Argue whether Janus would be required to reveal the devised algorithm in (c) under the (UK) Regulation of Investigatory Powers Act 2000 (RIPA).[4]</strong></p>
<p>While I am not a legal expert, I can provide some general information on the matter. The Regulation of Investigatory Powers Act 2000 (RIPA) in the UK provides a legal framework for the use of investigatory powers by authorities, including the interception of communications, acquisition of communications data, and the use of covert human intelligence sources, among others.</p>
<p>Under Part III of RIPA, authorities may legally demand the disclosure of protected information, which includes encrypted data or keys necessary to decrypt the information. If served with a notice under RIPA, individuals or organizations are required to provide the requested information or assistance, or face penalties for non-compliance.</p>
<p>In the case of Janus, if the relevant authorities become aware of his use of steganography and suspect that he has hidden sensitive or illegal information within the images, they may issue a notice under RIPA, requiring Janus to disclose the hidden data or provide the necessary means to access it. This could potentially include revealing the BPCS algorithm devised in (c).</p>
<p>However, RIPA notices are typically issued when there is a justified need for access to the protected information, such as in cases of national security, crime prevention, or public safety concerns. Whether Janus would be required to reveal the devised algorithm under RIPA would depend on the specific circumstances of his case and whether the authorities deem it necessary to obtain the hidden data for a lawful purpose.</p>
<p>It is essential for Janus to consider the legal implications of his actions and consult with a legal professional if he has concerns regarding the use of steganography and potential requirements under RIPA.</p>
<h2 id="2-Pagli-and-Antonellis"><a href="#2-Pagli-and-Antonellis" class="headerlink" title="2. Pagli and Antonellis"></a>2. Pagli and Antonellis</h2><p>Pagli and Antonellis are novice cyber system forensic investigators and have started a small start-up business. The pair have invested in two, basic laptop computers. The pair have been contracted by a large company to investigate an employee workstation. The company has multiple workstations, comprising of basic components, e.g. limited processing capabilities. The company management are particularly interested in specific Microsoft Word documents. The company state the workstations do not make use of any anti-forensics techniques, e.g. full-disk encryption.</p>
<p><strong>(a) Pagli and Antonellis have recovered the files of particular interest to company management but have discovered the files are encrypted and protected by unknown passwords. The pair are concerned that the passwords are sophisticated and cannot be easily determined. Pagli argues that the Distributed Network Attack (DNA) software tool from AccessData could be valuable.Describe TWO technical approaches employed by Distributed Network Attack(DNA) tool and argue the relevance in the given context[6]</strong></p>
<p>The Distributed Network Attack (DNA) tool from AccessData is designed to assist in recovering passwords for encrypted files by leveraging the power of distributed computing. In the given context, where Pagli and Antonellis have recovered encrypted Microsoft Word documents with unknown passwords, DNA could be a valuable tool to help them gain access to the files. Here are two technical approaches employed by the DNA tool and their relevance in this context:</p>
<ol>
<li>Brute-force attack: DNA can perform a brute-force attack, which involves systematically attempting every possible password combination until the correct one is found. Brute-force attacks can be time-consuming, especially if the password is long and complex. However, DNA’s distributed computing capabilities allow it to harness the processing power of multiple computers, including the company’s workstations, to expedite the password recovery process. This distributed approach makes it more feasible to crack sophisticated passwords within a reasonable time frame, increasing the likelihood of success for Pagli and Antonellis.</li>
<li>Dictionary attack: Another approach employed by DNA is the dictionary attack. This method involves using a precompiled list of words, phrases, or known passwords (a dictionary) to attempt to guess the password. DNA can also utilize rules-based variations, such as common substitutions or character additions, to further expand the list of potential passwords. Dictionary attacks are generally faster than brute-force attacks, as they focus on more likely password candidates. In the given context, this approach could be relevant if the employee used a password based on a dictionary word, a common phrase, or a known pattern.</li>
</ol>
<p>In conclusion, the Distributed Network Attack tool could be valuable for Pagli and Antonellis in their efforts to recover the passwords for the encrypted Microsoft Word documents. By employing both brute-force and dictionary attacks, while utilizing distributed computing resources, DNA increases the chances of successfully cracking the passwords, even if they are sophisticated. This would ultimately help Pagli and Antonellis fulfill their contract and provide the company management with access to the files of interest.</p>
<p><strong>(b) Antonellis argues that the pair cannot afford to invest in Distributed Network Attack (DNA) software as resources are limited. Pagli argues that tool would be invaluable to the current case. Antonellis argues the pair should use a combination of command line tools and tailored scripts.Compare and contrast the tools suggested by Pagli and Antonellis and argue for the optimal approach in the given context.[8]</strong></p>
<p>Both the Distributed Network Attack (DNA) software and a combination of command line tools and tailored scripts have their merits and drawbacks in the given context. Here, we will compare and contrast these approaches and argue for the optimal solution for Pagli and Antonellis.</p>
<p>Distributed Network Attack (DNA) software: Pros:</p>
<ol>
<li>Comprehensive and user-friendly: DNA is a dedicated tool designed for password recovery, with built-in features and functionality that simplify the process for users.</li>
<li>Distributed computing: DNA leverages the power of multiple computers to speed up the password recovery process, making it more efficient for cracking complex passwords.</li>
<li>Multiple attack strategies: DNA supports both brute-force and dictionary attacks, offering a versatile approach to password recovery.</li>
</ol>
<p>Cons:</p>
<ol>
<li>Cost: DNA may be expensive, particularly for a small start-up with limited resources.</li>
<li>Overkill for simple cases: DNA’s advanced capabilities may not be necessary if the target password is weak or follows a predictable pattern.</li>
</ol>
<p>Command line tools and tailored scripts: Pros:</p>
<ol>
<li>Cost-effective: Using open-source command line tools and custom scripts can be more budget-friendly, as there is no need to invest in expensive software.</li>
<li>Flexibility: Tailored scripts can be customized to the specific needs of the case, allowing Pagli and Antonellis to adapt their approach as required.</li>
</ol>
<p>Cons:</p>
<ol>
<li>Time-consuming setup: Developing and configuring custom scripts and tools may require a significant investment of time and expertise.</li>
<li>Limited scalability: The performance of command line tools and scripts may be constrained by the available hardware resources, making it less suitable for cracking complex passwords in a timely manner.</li>
</ol>
<p>In the given context, the optimal approach depends on several factors, including the available budget, time constraints, and the complexity of the passwords. If Pagli and Antonellis believe that the encrypted files are of high importance and the passwords are likely to be sophisticated, investing in the DNA software could prove invaluable for its speed, efficiency, and user-friendly features. The distributed computing capabilities and the support for multiple attack strategies can significantly increase the chances of success.</p>
<p>However, if the pair’s budget is truly limited and they possess the technical expertise to develop custom scripts, using command line tools and tailored scripts may be a more cost-effective alternative. This approach would allow them to retain control over the process and adapt their strategy to the specific case.</p>
<p>Ultimately, the optimal approach will depend on the pair’s assessment of the case’s importance, the potential value of the encrypted files, and their available resources. It is crucial for Pagli and Antonellis to weigh the pros and cons of each option carefully before deciding on the best course of action.</p>
<h1 id="Terminology-amp-Jargons"><a href="#Terminology-amp-Jargons" class="headerlink" title="Terminology&amp;Jargons:"></a>Terminology&amp;Jargons:</h1><p><strong>FDE:</strong> </p>
<p>Full Disk Encryption (FDE) is an encryption technology implemented on hard disk drives or solid state drives. It protects all data stored on the disk, including operating system, program files, user data, etc. Its main purpose is to ensure that sensitive data on the disk cannot be deciphered in case of unauthorized access.</p>
<p><strong>File Carving:</strong> </p>
<p>File carving is a process used in [computer forensics](<a href="https://www.infosecinstitute.com/courses/computer-forensics-boot-camp/?utm_source=resources&amp;utm_medium=infosec">https://www.infosecinstitute.com/courses/computer-forensics-boot-camp/?utm_source=resources&amp;utm_medium=infosec</a> network&amp;utm_campaign&#x3D;course pricing&amp;utm_content&#x3D;hyperlink) to extract data from a disk drive or other storage device without the assistance of the file system that originality created the file. </p>
<p><strong>Unallocated area:</strong> </p>
<p>Unallocated space refers to the area of the drive which no longer holds any file information as indicated by the file system structures like the file table. </p>
<p><strong>Ip:</strong>  </p>
<p>investigative process.</p>
<p><strong>DFI</strong>(Digital forensics investigation): </p>
<p>investigate the tool of crime and subject of crime.</p>
<p><strong>Hash</strong>:</p>
<p>哈希算法是指将任意长度的二进制值串映射为固定长度的二进制值串。原始数据经过映射之后得到的二进制值串就是哈希值。</p>
<p><strong>MD5加密原理步骤</strong>:</p>
<p>​	<strong>a). 填充，将其长度填充为512的整数倍:</strong></p>
<p>​	填充的方法如下：</p>
<p>​	<strong>1)</strong> 在信息的后面填充一个1和无数个0，直到满足上面的条件时才停止用0对信息的填充。</p>
<p>​	<strong>2)</strong> 在这个结果后面附加一个以64位二进制表示的填充前信息长度（单位为Bit），如果二</p>
<p>​	进制表示的填充前信息长度超过64位，则取低64位。</p>
<p>​	经过这两步的处理，信息的位长&#x3D;N<em>512+448+64&#x3D;(N+1）</em>512，即长度恰好是512的整数倍。这样做的原因是为满足后面处理中对信息长度的要求。</p>
<p>​	<strong>b). 初始化变量</strong></p>
<p>​	初始的128位值为初试链接变量，这些参数用于第一轮的运算，以大端<a href="https://link.zhihu.com/?target=https://baike.baidu.com/item/%E5%AD%97%E8%8A%82%E5%BA%8F">字节序</a>来表示，他们分别为： 				  A&#x3D;0x01234567，B&#x3D;0x89ABCDEF，C&#x3D;0xFEDCBA98，D&#x3D;0x76543210。</p>
<p>​	（每一个变量给出的数值是高字节存于内存低地址，低字节存于内存高地址，即大端字节序。在程序中变量A、	B、C、D的值分别为0x67452301，0xEFCDAB89，0x98BADCFE，0x10325476）</p>
<p>​	<strong>c).处理分组数据</strong></p>
<p>​	每一分组的算法流程如下：</p>
<p>​	第一分组需要将上面四个链接变量复制到另外四个变量中：A到a，B到b，C到c，D到d。从第二分组开始的变量	为上一分组的运算结果，即A &#x3D; a， B &#x3D; b， C &#x3D; c， D &#x3D; d。</p>
<p>​	主循环有四轮（MD4只有三轮），每轮循环都很相似。第一轮进行16次操作。每次操作对a、b、c和d中的其中	三个作一次非线性函数运算，然后将所得结果加上第四个变量，文本的一个子分组和一个常数。再将所得结果	向左<strong>环移</strong>一个不定的数，并加上a、b、c或d中之一。最后用该结果取代a、b、c或d中之一。</p>
<p>​	以下是每次操作中用到的四个非线性函数（每轮一个）。</p>
<p>​	F( X ,Y ,Z ) &#x3D; ( X &amp; Y ) | ( (~X) &amp; Z )</p>
<p>​	G( X ,Y ,Z ) &#x3D; ( X &amp; Z ) | ( Y &amp; (~Z) )</p>
<p>​	H( X ,Y ,Z ) &#x3D;X ^ Y ^ Z</p>
<p>​	I( X ,Y ,Z ) &#x3D;Y ^ ( X | (~Z) )</p>
<p>​	（&amp;是与（And），|是或（Or），~是非（Not），^是异或（Xor））</p>
<hr>
<p><strong>Merkle–Damgård</strong></p>
<p>Merkle–Damgård结构简称为MD结构，主要用在hash算法中抵御碰撞攻击。这个结构是一些优秀的hash算法，比如MD5,SHA-1和SHA-2的基础。今天给大家讲解一下这个MD结构和对他进行的长度延展攻击。</p>
<p><strong>Steps</strong>:</p>
<p><strong>Padding</strong></p>
<p>MD结构首先对输入消息进行填充，让消息变成固定长度的整数倍（比如512或者1024）。这是因为压缩算法是不能对任意长度的消息进行处理的，所以在处理之前必须进行填充。在原始数据的尾部添上1000…然后加上原始消息长度的2进制值使其长度变为512或1024的整数倍;<strong>使用额外的block</strong>，额外的使用一个block往往有点浪费，一个更加节约空间的做法就是，如果填充到最后一个block的0中有住够的空间的话，那么可以消息的长度放在那里。</p>
<p><strong>Compress</strong></p>
<p>完成padding之后就可以进行compress了。消息被分成了很多个block，最开始的初始化向量和第一个block进行f操作，得到了的结果再和第二个block进行操作，如此循环进行，最终得到了最后的结果。</p>
<p><img src="/../images/v2-43958e721f4c71625fde28962a327e3b_720w.webp" alt="MD Structure"></p>
<p><strong>长度延展攻击</strong></p>
<p>MD结构，是将消息分成一个一个的block，前一个block 运算出来的值会跟下一个block再次进行运算，这种结构可以很方便的进行长度延展攻击。前提是我们需要知道原消息的长度。在密码学中长度延展攻击就是指攻击者通过已知的hash(message1)和message1的长度，从而能够知道hash（message1‖message2）的值。其中‖ 表示的是连接符。并且攻击性并需要知道message1到底是什么。</p>
<p><strong>Wide pipe</strong></p>
<p>为了避免长度延展攻击，我们可以对MD结构进行一些变形。</p>
<p><img src="/../images/v2-7bcc1f1e64f49a021592e673c80f205a_720w.webp" alt="Wide pipe"></p>
<p>wide pipe和MD的流程基本上是一致的，不同的是生成的中间临时的加密后的消息长度是最终生成消息长度的两倍。</p>
<p>这也就是为什么上图中会有两个初始向量IV1 和 IV2。假如最终的结果长度是n的话，那么在中间生成的结果的长度就是2n。我们需要在最后的final 这一步中，将2n长度的数据缩减为n长度的数据。</p>
<p><strong>Fast wide pipe</strong></p>
<p>SHA-512&#x2F;224 和 SHA-512&#x2F;256 只是简单的丢弃掉一半数据。</p>
<p>还有一种比wide pipe更快的算法叫做fast wide pipe：</p>
<p><img src="/../images/v2-38067688fe25a216016a8819756dd105_r.jpg" alt="Fast wide pipe"></p>
<p>和wide pipe不同的是，它的主要思想是将前一个链接值的一半转发给XOR，然后将其与压缩函数的输出进行XOR。</p>
<p><strong>SLACK SPACE:</strong></p>
<p>Slack space occurs when a file can not be efficiently <strong>compartmentalised into file systems containers</strong>.</p>
<p>Feature: effectively containers are not going to be completely full, there is some <strong>slack space</strong>.</p>
<p>Example: consider file that is 59 bytes in size, that is allocated a 2048 byte cluster - the remaining 1989 bytes are considered slack space.</p>
<p>Potential for slack space to contain interesting data or data from previous files.</p>
<p>Data may exist between the end of the allocated file data and the sector.</p>
<p>Data may also exist between the sectors within the cluster that are not allocated data.</p>
<p>Interesting data may also exist in the sectors within the cluster.</p>
<p>an important aspect of slack space is that it is <strong>allocated</strong> space, it not unallocated. </p>
<p><strong>Sector and Cluster:</strong></p>
<p>In computer file systems, a sector is the smallest unit of storage on a disk. A cluster is a group of sectors that are treated as a single unit of storage. Sector is a fixed-size, contiguous block of storage space on the disk, typically ranging from 512 bytes to 4096 bytes, depending on the disk format. Clusters are used to allocate disk space for files, and they are typically much larger than sectors, ranging from a few sectors to several kilobytes in size, depending on the file system and disk size.</p>
<p><strong>FIRST AVAILABLE:</strong></p>
<p>in terms of forensics, recovery of deleted data will likely be more fruitful near the end of the file system.</p>
<p><strong>NEXT AVAILABLE:</strong></p>
<p>in terms of forensics, recovery of deleted data may be more balanced in comparison. </p>
<p><strong>BEST FIT:</strong></p>
<p>recall, the file itself may grow and data can become scattered across the system.</p>
<p><img src="/../images/byte_groups.png" alt="bytegroupings"></p>
<p><strong>FRAGMENTATION</strong></p>
<p>• systems become fragmented as files are deleted, added and altered. </p>
<p>• file considered fragmented when its containers are not consecutive, but are rather scattered across the storage device.</p>
<p>• fragmentation typically occurs due to <strong>alteration</strong> of files, <strong>low disk space</strong> and specific approaches.</p>
<p>• fragmentation of files is relatively uncommon in modern systems.</p>
<p>• modern operating systems are effective at avoiding fragmentation as this affords faster reading and writing.</p>
<p>• disk space has became less of a concern, suggesting that fragmentation is more likely on relatively smaller disks.</p>
<p>• researchers argue fragmented files are more likely of interest to investigators.</p>
<p><strong>FILE EXTENSION FRAGMENTATION:</strong></p>
<p>• different fragmentation rates are observed for different file types.<br>• temporary and logs files are often fragmented as they grow over system lifetime.<br>• movie, image, document and personal organisation information are often highly fragment.<br>• arguably such files are more pertinent to investigation than benign system files</p>
<p><strong>HIGH FRAGMENTATION:</strong></p>
<p>• there are some files that are highly fragmented, potentially into more than 100 or over 1000 fragments.</p>
<p>• such fragments are typically associated with large system updates or patches</p>
<p><strong>FILE CARVING:</strong></p>
<p>• process of <strong>reconstructing files based on structure and</strong> <strong>content</strong>, instead of meta-data.</p>
<p>• typically used to recover data from <strong>unallocated space</strong> on the disk as indicated by the file system.</p>
<p>• useful for <strong>data recovery when the device itself has been damaged</strong>, e.g. hard disk.</p>
<p>• valuable in <strong>forensics when specific files have been deleted</strong>, e.g. data still present in sectors</p>
<p>• may not recognise the file system used or even trust the file system itself.</p>
<p>• early file carver approaches relied on <strong>magic numbers</strong> to discover and recover files.</p>
<p>• limitation is that the file craver would recover continuous data unsure that it is actually valid or properly associated with the file</p>
<p><strong>Chanllenges:</strong></p>
<ol>
<li><p>the initial challenge is to identify the files that are to be carved from the image itself.</p>
</li>
<li><p>process must exist that ensures the files are actually intact.</p>
</li>
<li><p>files then need to be carved or extracted from the image.</p>
</li>
</ol>
<p><strong>LIMITATIONS:</strong></p>
<p>• problem is that unless clusters are contiguous can be difficult to recover file.</p>
<p>• even if associated clusters are recovered, difficult to validated file is what is expected.</p>
<p><strong>Hex Carving:</strong></p>
<p>在进行Hex Carving时，分析师需要寻找特定的十六进制签名（也称为文件头和文件尾），这些签名是文件类型的特征，例如JPEG图片、PDF文档等。一旦找到这些签名，就可以从存储介质上提取相应的数据块，并将其恢复为完整的文件。</p>
<p><strong>Bitfragment Gap Carving(BGC):</strong></p>
<p><strong>Steps:</strong></p>
<p>• initial step is to determine the header and footer of the file.<br>• process the clusters between the header and footer to confirm the contents of the container files.<br>• perform the computationally expensive step of validating each cluster.<br>• Know bh and bz, start with g &#x3D; 1 and grow until each fragment validates</p>
<p><strong>Limitation:</strong></p>
<p>• approach works when the file is bi-fragmented, anymore fragments it will not work.</p>
<p>• corrupted or lost clusters will result in the worse case performance.</p>
<p>• approach works for files that have structure that can actually be validated and&#x2F;or decoded.</p>
<p>• not always possible to trust validation and&#x2F;or decoding approach.</p>
<p>• approach struggles with large gaps.</p>
<p>Bitfragment Gap Carving (BGC) 旨在克服传统的 Hex Carving 方法在面对破碎文件时的局限性。在某些情况下，文件在存储介质上可能是分散的，这意味着文件的各个部分可能不是连续存储的。</p>
<p>BGC 通过在存储介质中搜索特定的文件片段（称为比特片段）来解决这个问题，而不是仅搜索文件头和文件尾。这些文件片段可能包含文件的重要信息，如内容、元数据等。在确定了这些比特片段之后，BGC 将尝试将它们重新组合成一个完整的文件。</p>
<p>BGC 的一个关键优势是它可以在不了解文件系统的情况下恢复分散的文件，这使得它在处理损坏的文件系统或恢复被删除的文件时非常有用。然而，BGC 也存在一些挑战，例如需要开发针对特定文件类型的比特片段签名、可能出现误报以及需要处理大量的比特片段组合。</p>
<p>​	<strong>Do we think it is wise to carve out the fragments  between the header and footer?</strong></p>
<p>在使用 Bitfragment Gap Carving（BGC）方法时，在文件头和文件尾之间提取文件片段通常是有意义的。这是因为在某些情况下，文件的各个部分可能是分散存储的，而不是连续存储的。这意味着文件头和文件尾之间可能存在其他文件片段，这些片段包含文件的重要信息，如内容、元数据等。</p>
<p>​	<strong>What else do we typically know about the files were interested in?</strong></p>
<p>在使用 Bitfragment Gap Carving（BGC）方法时，我们通常需要了解一些关于感兴趣文件的信息，以提高恢复的成功率和准确性。以下是在 BGC 中可能需要了解的文件相关信息：</p>
<ol>
<li>文件类型：了解目标文件的类型有助于确定特定的文件片段签名。例如，JPEG 图像、PDF 文档和 Microsoft Word 文件等具有不同的文件结构和特征。了解文件类型有助于缩小搜索范围并提高恢复效果。</li>
<li>文件片段签名：针对特定文件类型，需要了解其比特片段签名，以便在存储介质上搜索和识别文件片段。这些签名可能包括文件头、文件尾以及其他特征信息，如元数据、内容标记等。</li>
<li>文件大小：如果可能的话，了解文件的大致大小可以帮助估算文件片段的数量和潜在位置。这可以提高搜索效率并减少误报。</li>
<li>存储设备和文件系统信息：了解所使用的存储设备（如硬盘、USB 闪存驱动器等）和文件系统（如 NTFS、FAT32、ext4 等）可能有助于确定文件分散的程度和方式，以及优化 BGC 方法。</li>
<li>数据删除或损坏的原因：了解数据丢失或损坏的原因（如意外删除、硬盘损坏、恶意软件攻击等）可能有助于确定最佳的恢复策略。</li>
</ol>
<p>​	<strong>If we have determined the header and footers, plus container structure - what else could we do?</strong></p>
<ol>
<li>分析文件内部结构：了解特定文件类型的内部结构有助于识别并提取更多相关的比特片段。这包括文件的元数据、编码方式、标记和其他特征信息。掌握这些信息可以帮助更准确地搜索和识别文件片段。</li>
<li>优化搜索策略：根据已知的文件头、文件尾和容器结构，优化搜索策略以提高效率。这可能包括限制搜索范围、调整搜索参数，或者根据已知的文件大小信息预测文件片段的潜在位置。</li>
<li>验证恢复结果：在提取和重新组合文件片段后，仔细检查恢复结果以确保准确性和完整性。这可能包括验证文件的元数据、内容和内部结构。如果发现问题，可以返回到搜索和提取阶段，尝试使用不同的参数和策略。</li>
<li>结合其他恢复技术：在某些情况下，BGC 方法可能无法完全恢复文件。这时，可以尝试结合其他文件恢复技术和工具，如 Hex Carving、文件系统分析等，以提高恢复结果的准确性和完整性。</li>
<li>优化和学习：通过不断地学习和优化比特片段签名、搜索策略和参数设置，可以提高 BGC 方法的性能。在实践中，分析师可能需要面对各种不同的文件类型和存储设备，因此需要不断地调整和优化方法以适应不同的情况。</li>
</ol>
<p><strong>Theoretical Graph Carving:</strong></p>
<p>THEORETICAL GRAPH CARVING </p>
<p>• need to determine the clusters that are adjacent to each other. </p>
<p>• approach is to determine the correct ordering is to weight fragment pairs. </p>
<p>• use function to generate a weight for each pair of clusters, select the heaviest pairing.</p>
<p>• ideal permutation is that where the sum of the ordering is maximum. </p>
<p>• determining the path is the same as finding maximum weight Hamiltonian path in a complete graph</p>
<p><strong>Graph Carving:</strong></p>
<p>• Hamiltonian path approach does not consider the situation where we have multiple files.</p>
<p>• Problem can be reconsidered as <em>k</em>-vertex disjointed path problem.</p>
<p>• Where we consider <em>k</em> as the number of files, identified from the number of headers.</p>
<p>• Disjointed path problem if we consider that each cluster only belongs to one file.</p>
<p>​	PARALLEL UNIQUE PATH(PUP):</p>
<p><strong>Hash Carving:</strong></p>
<p>哈希雕刻的工作流程分为以下几个步骤：</p>
<ol>
<li>确定已知文件的哈希值：通过使用独立于磁盘镜像或文件系统的工具，计算已知文件的哈希值，并记录下来。</li>
<li>扫描磁盘镜像或文件系统：使用哈希雕刻工具扫描磁盘镜像或文件系统，并计算每个数据块的哈希值。</li>
<li>匹配哈希值：将扫描到的每个数据块的哈希值与已知文件的哈希值进行比较。如果匹配成功，则说明该数据块可能包含被删除文件的内容。</li>
<li>恢复文件内容：对于匹配成功的数据块，使用哈希雕刻工具将其提取出来，并尝试恢复被删除文件的内容。</li>
<li>验证数据完整性：对于已恢复的文件，应该进行数据完整性验证，以确保文件的完整性和可靠性。</li>
</ol>
<p>需要注意的是，哈希雕刻可能会产生虚假匹配或错误的结果，因此需要对结果进行进一步的验证和分析。同时，在进行哈希雕刻时，也需要考虑数据隐私和法律规定，以确保取证过程的合法性和证据的可靠性。</p>
<p>**Non-probative block test:**（非证据块测试）</p>
<p>是指在数字取证中使用的一种测试方法，用于排除磁盘镜像或文件系统中的非证据块，以减少后续分析的时间和资源消耗。</p>
<p>在数字取证中，非证据块通常是指不包含有效数据或与案件无关的数据块，如操作系统的空闲块、已删除的文件块等。非证据块测试可以通过计算每个数据块的哈希值，并与已知的非证据块哈希值进行比较，以快速识别和排除这些非证据块。这可以大大减少后续分析的时间和资源消耗，并有助于集中分析有价值的证据数据。</p>
<p>需要注意的是，非证据块测试并不能保证100%的准确性，可能会产生误判或漏判的情况。因此，在数字取证中，还需要结合其他分析方法和工具，进行综合分析和验证，以确保取证结果的准确性和可靠性。</p>
<p><strong>Magic numbers:</strong></p>
<p>In the context of computer file formats, a magic number is a sequence of bytes that identifies the format of a file. It is called a “magic number” because it is often used like a magic spell to identify the file format, much like a spell might be used to identify a person or object.</p>
]]></content>
      <categories>
        <category>Courses</category>
      </categories>
      <tags>
        <tag>Courses</tag>
      </tags>
  </entry>
</search>
