<!DOCTYPE html>


<html lang="en">
  

    <head>
      <meta charset="utf-8" />
        
      <meta name="description" content="joshua" />
      
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>SDN |  Mingwei’s Blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/UoG.svg" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    <link rel="alternate" href="/atom.xml" title="Mingwei’s Blog" type="application/atom+xml">
</head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-SDN"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  SDN
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/11/19/SDN/" class="article-date">
  <time datetime="2023-11-19T13:19:09.000Z" itemprop="datePublished">2023-11-19</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/Tech/">Tech</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> Word count:</span>
            <span class="post-count">4.6k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> Reading time≈</span>
            <span class="post-count">28 min</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="SDN-Learning"><a href="#SDN-Learning" class="headerlink" title="SDN Learning"></a>SDN Learning</h1><h2 id="SDN-x2F-VNF-Satellite-Experiment"><a href="#SDN-x2F-VNF-Satellite-Experiment" class="headerlink" title="SDN&#x2F;VNF Satellite Experiment"></a>SDN&#x2F;VNF Satellite Experiment</h2><h3 id="Environment-Set-Up"><a href="#Environment-Set-Up" class="headerlink" title="Environment Set Up"></a>Environment Set Up</h3><p>Ubuntu network bug</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ip <span class="built_in">link</span> <span class="built_in">set</span> enp0s1 up</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo dhclient enp0s1</span><br><span class="line"></span><br><span class="line">sudo ip addr add [Your-IPv4-Address]/[Subnet-Mask] dev enp0s1</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl restart NetworkManager</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sudo systemctl restart networking</span><br></pre></td></tr></table></figure>



<h4 id="Controller-OpenDaylight"><a href="#Controller-OpenDaylight" class="headerlink" title="Controller (OpenDaylight)"></a>Controller (OpenDaylight)</h4><ol>
<li>Prepare the operating system</li>
<li>Install the Java JRE</li>
<li>Set JAVA_HOME</li>
<li>Download the OpenDaylight Zip</li>
<li>Unzip OpenDaylight</li>
<li>Start OpenDaylight</li>
<li>Bonus: Where did DLUX go?</li>
</ol>
<h5 id="1-Prepare-Operating-System"><a href="#1-Prepare-Operating-System" class="headerlink" title="1. Prepare Operating System"></a>1. Prepare Operating System</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y update</span><br><span class="line">sudo apt-get -y install unzip</span><br></pre></td></tr></table></figure>

<h5 id="2-Install-the-Java-JRE"><a href="#2-Install-the-Java-JRE" class="headerlink" title="2. Install the Java JRE"></a>2. Install the Java JRE</h5><p>OpenDaylight runs on Java platform</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get -y install openjdk-11-jre</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config java</span><br></pre></td></tr></table></figure>

<p>Please select Java 11 as your default java environment</p>
<h5 id="3-Set-JAVA-HOME"><a href="#3-Set-JAVA-HOME" class="headerlink" title="3. Set JAVA_HOME"></a>3. Set JAVA_HOME</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> -l /etc/alternatives/java</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;export JAVA_HOME=/usr/lib/jvm/java-17-openjdk-arm64&#x27;</span> &gt;&gt; ~/.bashrc</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> ~/.bashrc</span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$JAVA_HOME</span></span><br></pre></td></tr></table></figure>

<p>echo ‘export JAVA_HOME&#x3D;&#x2F;usr&#x2F;lib&#x2F;jvm&#x2F;java-11-openjdk-arm64’ &gt;&gt; ~&#x2F;.bashrc</p>
<h5 id="4-Download-the-OpenDaylight-Zip-Archive"><a href="#4-Download-the-OpenDaylight-Zip-Archive" class="headerlink" title="4. Download the OpenDaylight Zip Archive"></a>4. Download the OpenDaylight Zip Archive</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XGET -O https://nexus.opendaylight.org/content/repositories/opendaylight.release/org/opendaylight/integration/karaf/0.16.1/karaf-0.16.1.zip</span><br></pre></td></tr></table></figure>



<h5 id="5-Install-OpenDaylight"><a href="#5-Install-OpenDaylight" class="headerlink" title="5. Install OpenDaylight"></a>5. Install OpenDaylight</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ unzip karaf-0.16.1.zip </span><br></pre></td></tr></table></figure>



<h5 id="6-Start-OpenDaylight"><a href="#6-Start-OpenDaylight" class="headerlink" title="6. Start OpenDaylight"></a>6. Start OpenDaylight</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/karaf </span><br></pre></td></tr></table></figure>

<figure class="highlight scss"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">opendaylight-user<span class="keyword">@root</span>&gt;<span class="attribute">feature</span>:list</span><br></pre></td></tr></table></figure>



<h5 id="7-Bonus-What-happened-to-DLUX"><a href="#7-Bonus-What-happened-to-DLUX" class="headerlink" title="7. Bonus: What happened to DLUX?"></a>7. Bonus: What happened to DLUX?</h5><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl <span class="operator">-</span>O https:<span class="operator">/</span><span class="operator">/</span>nexus.opendaylight.org<span class="operator">/</span>content<span class="operator">/</span>repositories<span class="operator">/</span>opendaylight.release<span class="operator">/</span>org<span class="operator">/</span>opendaylight<span class="operator">/</span>integration<span class="operator">/</span>karaf<span class="operator">/</span><span class="number">0.8</span><span class="number">.4</span><span class="operator">/</span>karaf<span class="number">-0.8</span><span class="number">.4</span>.zip</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip karaf-<span class="number">0.8</span><span class="number">.4</span>.<span class="built_in">zip</span> </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/karaf </span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-<span class="keyword">get</span> install openjdk<span class="number">-8</span>-jre</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-alternatives --config java</span><br></pre></td></tr></table></figure>

<p>select Java 8</p>
<h3 id="RYU-controller"><a href="#RYU-controller" class="headerlink" title="RYU controller"></a>RYU controller</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ryu-manager simple_switch_13.py</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --custom topology.py --topo mytopo --controller=remote,ip=127.0.0.1,port=6653</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mn --topo=single,3 --mac --controller=remote,ip=127.0.0.1,port=6653 --switch ovsk,protocols=OpenFlow13</span><br></pre></td></tr></table></figure>



<p>s1 &#x3D; net.addSwitch(‘s1’, cls &#x3D; OVSKernelSwitch, dpid&#x3D; ‘0000000000000001’)</p>
<p>sh ovs-vsctl show</p>
<p>dpctl dump-flows</p>
<p>dpctl del-flows</p>
<p>dpctl add-flow in_port&#x3D;1,actions&#x3D;output:2</p>
<p>dpctl add-flow in_port&#x3D;2,actions&#x3D;output:1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">h1 <span class="built_in">cat</span> /tmp/iperf_client_1.<span class="built_in">log</span></span><br><span class="line"></span><br><span class="line">h1 <span class="built_in">cat</span> /tmp/iperf.log</span><br><span class="line"></span><br><span class="line">h1 scp /tmp/iperf_client_h1.<span class="built_in">log</span> limingwei@192.168.64.5:/home/limingwei/Desktop/mydir/tmp</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">h49 hping3 --flood --syn --rand-source h3</span><br><span class="line"></span><br><span class="line"><span class="built_in">cp</span> /tmp/iperf*.<span class="built_in">log</span> /home/limingwei/Desktop/mydir/tmp_flooding/</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>![image-20240110101757590](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20240110101757590.png)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --<span class="built_in">link</span> tc,bw=10,delay=10ms</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">h1 iperf -s</span><br><span class="line"></span><br><span class="line">h2 iperf -c 10.0.0.1 -i 1 -t 10</span><br></pre></td></tr></table></figure>



<p>Add flow rules for based l2 addresses</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=02:89:c4:04:33:36, action=1&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=3a:f4:85:86:30:c3, action=2&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=d2:5e:c6:63:ef:af, action=3&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=ff:ff:ff:ff:ff:ff, action=flood&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="SDN-course"><a href="#SDN-course" class="headerlink" title="SDN course"></a>SDN course</h2><p><strong>ToR Switch:</strong> </p>
<p>Top-of-Rack Switching (ToR) is <strong>a type of network infrastructure that uses network switches to connect servers and other devices in the same rack</strong>. This type of switching allows for faster data transfer between devices and improved performance.</p>
<p>Create a topology with three hosts:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mn --topo single,3 --mac --controller default</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ovs-ofctl dump-flows s1</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">mn --topo single,3 --mac --controller remote</span><br><span class="line"></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;in_port=2,ip, nw_dst=192.168.1.0/24,action=output:3&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;in_port=3,ip, nw_dst=192.168.1.0/24,action=output:2&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#2</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 arp,actions=flood</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> &#123;1..3&#125;; <span class="keyword">do</span> sudo ovs-ofctl add-flow s1 ip,nw_dst=10.0.0.<span class="variable">$i</span>,actions=output:<span class="variable">$i</span>;<span class="keyword">done</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#3</span></span><br><span class="line">h1 ifconfig |grep -i ether</span><br><span class="line">h2 ifconfig |grep -i ether</span><br><span class="line">h3 ifconfig |grep -i ether</span><br><span class="line"></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=00:00:00:00:00:01, action=1&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=00:00:00:00:00:02, action=2&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=00:00:00:00:00:03, action=3&quot;</span></span><br><span class="line">sudo ovs-ofctl add-flow s1 <span class="string">&quot;dl_dst=ff:ff:ff:ff:ff:ff, action=flood&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Lab-4"><a href="#Lab-4" class="headerlink" title="Lab 4"></a>Lab 4</h3><h4 id="Create-the-topology"><a href="#Create-the-topology" class="headerlink" title="Create the topology"></a>Create the topology</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --topo=single,3 --mac --controller=remote,ip=127.0.0.1,port=6653 --switch ovsk,protocols=OpenFlow13</span><br></pre></td></tr></table></figure>

<p>specify for the ons-ofctl as well which OpenFlow version to use, for instance.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mininet&gt; sh sudo ovs−ofctl −O OpenFlow13 dump−flows s1</span><br><span class="line"></span><br><span class="line">sh sudo watch -n1 <span class="string">&#x27;ovs-ofctl -O OpenFlow13 dump-flows s1&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>Learning_switch.py</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event,dpset</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> MAIN_DISPATCHER, CONFIG_DISPATCHER</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet, ethernet, ether_types</span><br><span class="line"><span class="keyword">import</span> logging <span class="keyword">as</span> log</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleSwitch13</span>(app_manager.RyuApp):</span><br><span class="line">    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleSwitch13,self).__init__(*args, **kwargs)</span><br><span class="line">        log.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;%(levelname)s:%(message)s&#x27;</span>,level=log.DEBUG)</span><br><span class="line">        log.info(<span class="string">&quot;Controller is up and running&quot;</span>)</span><br><span class="line">        self.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        datapath = ev.msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        log.info(<span class="string">&quot;Switch connected with datapath ID: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(datapath.<span class="built_in">id</span>))</span><br><span class="line">        <span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line">        actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line">                                          ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line">        self.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,</span><br><span class="line">                                             actions)]</span><br><span class="line">        <span class="keyword">if</span> buffer_id:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line">                                    priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>,</span><br><span class="line">                                    instructions=inst)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line">                                    <span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line">        datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self,ev</span>):</span><br><span class="line">        msg = ev.msg</span><br><span class="line">        datapath = msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        pkt = packet.Packet(msg.data)</span><br><span class="line">        eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;PacketIn received: \n&quot;</span></span><br><span class="line">                         <span class="string">&quot;Switch: &#123;&#125;\n&quot;</span></span><br><span class="line">                         <span class="string">&quot;in_port: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(datapath.<span class="built_in">id</span>,in_port))</span><br><span class="line"></span><br><span class="line">        dst = eth.dst</span><br><span class="line">        src = eth.src</span><br><span class="line"></span><br><span class="line">        dpid = <span class="built_in">format</span>(datapath.<span class="built_in">id</span>, <span class="string">&quot;d&quot;</span>).zfill(<span class="number">16</span>)</span><br><span class="line">        self.mac_to_port.setdefault(dpid,&#123;&#125;)</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;packet in %s %s %s %s&quot;</span>, dpid, src, dst, in_port)</span><br><span class="line"></span><br><span class="line">        self.mac_to_port[dpid][src] = in_port</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> dst <span class="keyword">in</span> self.mac_to_port[dpid]:</span><br><span class="line">            out_port = self.mac_to_port[dpid][dst]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out_port = ofproto.OFPP_FLOOD</span><br><span class="line"></span><br><span class="line">        actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> out_port != ofproto.OFP_NO_BUFFER:</span><br><span class="line">            <span class="keyword">match</span> = parser.OFPMatch(in_port = in_port, eth_dst = dst, eth_src = src)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> msg.buffer_id != ofproto.OFP_NO_BUFFER:</span><br><span class="line">                self.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions, msg.buffer_id)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.add_flow(datapath,<span class="number">1</span>,<span class="keyword">match</span>,actions)</span><br><span class="line">        data = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> msg.buffer_id == ofproto.OFP_NO_BUFFER:</span><br><span class="line">            data = msg.data</span><br><span class="line">        out = parser.OFPPacketOut(datapath = datapath, buffer_id = msg.buffer_id, in_port = in_port, actions = actions, data = data)</span><br><span class="line">        datapath.send_msg(out)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h3 id="Lab-5"><a href="#Lab-5" class="headerlink" title="Lab 5"></a>Lab 5</h3><h4 id="LLDP"><a href="#LLDP" class="headerlink" title="LLDP:"></a><strong>LLDP:</strong></h4><p>Features: Vendor independent&#x2F;agonostic</p>
<p>LLDP messages are periodically sent by <strong>switches</strong> by default. A flow rule should be installed into all switches’ flow tables to match on these specific LLDP packets and send them towards the controller as a Packet-In message.</p>
<p>Insert a matching following flow rule into each switch’s flow table:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ovs-ofctl -O Openflow13 add-flow &lt;switch_name&gt; priority=65535, dl_type=0x88cc, actions=CONTROLLER:65535</span><br></pre></td></tr></table></figure>

<p>Ryu can also do the job for us by starting our controoler application by extending the command with the following argument:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo ryu-manager learning_switch.py --observe-links</span><br></pre></td></tr></table></figure>



<h4 id="Topology-discovery"><a href="#Topology-discovery" class="headerlink" title="Topology discovery"></a><strong>Topology discovery</strong></h4><p>Ryu controller provides ryu.topology, which is a switch and link discovery module providing API calls for accessing host, switch, and link data. In order to access it, import the following libraries into our controller application.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event</span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link, get_host</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self.topology api app = self <span class="comment"># put this into the constructor of the ryu controller</span></span><br></pre></td></tr></table></figure>

<p>Whenever we want to get the latest topology information, we can use the 3 imported functions:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get switch list</span></span><br><span class="line">switch_list = get_switch(self.topology_api-app, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#get links and their endpoints</span></span><br><span class="line">link_list = get_link(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#get hosts if there is any</span></span><br><span class="line">hosts_list = get_host(self.topology_api_app, <span class="literal">None</span>)</span><br></pre></td></tr></table></figure>

<p>In each case, the topology.api returns lists of objects with a variable number of accessible properties:</p>
<p><strong>Link object</strong>: it describes a connection between a given pair of switches. The source and target of a link is a Port object that can be accessed by link.src and link.dst, respectively. A Port object further contains relevant information such as the datapath identifier (dpid), name of the interface (name), MAC address of that interface (hw_addr), port identifier (port_no), etc. For example, the source data path identifier of a link and the port id, where it is connected to, is accessible by link.src.dpid and link.src.port_no, respectively.</p>
<p><strong>Switch</strong> object: it contains the datapath object per second, and as many Port objects as it has.</p>
<p><strong>Host</strong> object: it contains its MAC address (host.mac), IPv4 and IPv6 addresses (host.ipv4 and host.ipv6) and a  Port object, again, describing which switch it is connected to (e.g., host.port.dpid, host.port.port_no)</p>
<h4 id="Lab-5-Task-1"><a href="#Lab-5-Task-1" class="headerlink" title="Lab 5 Task 1"></a><strong>Lab 5 Task 1</strong></h4><p>Modify the controller application (learning_switch) as follows:</p>
<ul>
<li>Create a function called update_topology_data() that prints out the topology information managed by the topology.api (prettify the output for a more comprehensive view)</li>
</ul>
<p>![image-20240214160149193](&#x2F;Users&#x2F;joshua&#x2F;Library&#x2F;Application Support&#x2F;typora-user-images&#x2F;image-20240214160149193.png)</p>
<ul>
<li>Each time a new switch connects to the controller, or a host is discovered call update_topoloy_data().</li>
<li>As LLDP messages are also sent to the controller and they also contain source and destination MAC addresses, modify your Packet-In handler to ignore these LLDP packets!</li>
</ul>
<p>​		Hint: To easily match on LLDP packets import the following libraries</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#for LLDP packet types</span></span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_CFM</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_LLDP</span><br></pre></td></tr></table></figure>

<ul>
<li>At least two switches need to exist in the topology in order to obtain link information from Ryu’s API.</li>
</ul>
<p><strong>Solution</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> lldp</span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event, dpset</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> MAIN_DISPATCHER, CONFIG_DISPATCHER</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event</span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link, get_host</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet, ethernet, ether_types</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_CFM</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_LLDP</span><br><span class="line"><span class="keyword">import</span> logging <span class="keyword">as</span> log</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleSwitch13</span>(app_manager.RyuApp):</span><br><span class="line">    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleSwitch13, self).__init__(*args, **kwargs)</span><br><span class="line">        log.basicConfig(<span class="built_in">format</span>=<span class="string">&#x27;%(levelname)s:%(message)s&#x27;</span>, level=log.DEBUG)</span><br><span class="line">        log.info(<span class="string">&quot;Controller is up and running&quot;</span>)</span><br><span class="line">        self.topology_api_app = self</span><br><span class="line">        self.mac_to_port = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        datapath = ev.msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        log.info(<span class="string">&quot;Switch connected with datapath ID: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(datapath.<span class="built_in">id</span>))</span><br><span class="line">        <span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line">        actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line">                                          ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line">        self.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line">        self.update_topology_data()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,</span><br><span class="line">                                             actions)]</span><br><span class="line">        <span class="keyword">if</span> buffer_id:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line">                                    priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>,</span><br><span class="line">                                    instructions=inst)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line">                                    <span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line">        datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_topology_data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># get switch list</span></span><br><span class="line">        switch_list = get_switch(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># get links and their endpoints</span></span><br><span class="line">        links_list = get_link(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        <span class="comment"># get hosts if there is any</span></span><br><span class="line">        hosts_list = get_host(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        self.logger.info(<span class="string">&quot;Switches:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> switch <span class="keyword">in</span> switch_list:</span><br><span class="line">            self.logger.info(<span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(switch.dp.<span class="built_in">id</span>))</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;\nLinks:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">            source = <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(link.src.dpid)</span><br><span class="line">            source_port = link.src.port_no</span><br><span class="line">            target = <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(link.dst.dpid)</span><br><span class="line">            target_port = link.dst.port_no</span><br><span class="line">            self.logger.info(<span class="string">&quot;&#123;&#125;(port:&#123;&#125;)&lt;----&gt;(port:&#123;&#125;)&#123;&#125;&quot;</span>.<span class="built_in">format</span>(source, source_port, target_port, target))</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;Hosts:&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> hosts_list:</span><br><span class="line">            <span class="keyword">for</span> host <span class="keyword">in</span> hosts_list:</span><br><span class="line">                name = <span class="string">&quot;h&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.mac.replace(<span class="string">&#x27;:&#x27;</span>, <span class="string">&#x27;&#x27;</span>)[-<span class="number">6</span>:])  <span class="comment"># Using part of MAC for host identifier</span></span><br><span class="line">                self.logger.info(<span class="string">&quot;&#123;&#125;:\n\tip4:&#123;&#125;&quot;</span></span><br><span class="line">                                 <span class="string">&quot;\n\tip6:&#123;&#125;&quot;</span></span><br><span class="line">                                 <span class="string">&quot;\n\tmac=&#123;&#125;&quot;</span>  <span class="comment"># Added equal sign here</span></span><br><span class="line">                                 <span class="string">&quot;\n\tconnected to:s&#123;&#125;&quot;</span></span><br><span class="line">                                 <span class="string">&quot;\n\tport_no:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(name,</span><br><span class="line">                                                         host.ipv4 <span class="keyword">if</span> host.ipv4 <span class="keyword">else</span> <span class="string">&quot;None&quot;</span>,</span><br><span class="line">                                                         host.ipv6 <span class="keyword">if</span> host.ipv6 <span class="keyword">else</span> <span class="string">&quot;None&quot;</span>,</span><br><span class="line">                                                         host.mac,</span><br><span class="line">                                                         host.port.dpid,</span><br><span class="line">                                                         host.port.port_no))</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        msg = ev.msg</span><br><span class="line">        datapath = msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        pkt = packet.Packet(msg.data)</span><br><span class="line">        eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> eth.ethertype <span class="keyword">in</span> (ETH_TYPE_LLDP, ETH_TYPE_CFM):</span><br><span class="line">            <span class="comment"># Ignore LLDP and CFM packets but update the topology</span></span><br><span class="line">            self.update_topology_data()</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;PacketIn received: \n&quot;</span></span><br><span class="line">                     <span class="string">&quot;Switch: &#123;&#125;\n&quot;</span></span><br><span class="line">                     <span class="string">&quot;in_port: &#123;&#125;\n&quot;</span>.<span class="built_in">format</span>(datapath.<span class="built_in">id</span>, in_port))</span><br><span class="line"></span><br><span class="line">        dst = eth.dst</span><br><span class="line">        src = eth.src</span><br><span class="line"></span><br><span class="line">        dpid = <span class="built_in">format</span>(datapath.<span class="built_in">id</span>, <span class="string">&quot;d&quot;</span>).zfill(<span class="number">16</span>)</span><br><span class="line">        self.mac_to_port.setdefault(dpid, &#123;&#125;)</span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;packet in %s %s %s %s&quot;</span>, dpid, src, dst, in_port)</span><br><span class="line"></span><br><span class="line">        self.mac_to_port[dpid][src] = in_port</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> dst <span class="keyword">in</span> self.mac_to_port[dpid]:</span><br><span class="line">            out_port = self.mac_to_port[dpid][dst]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            out_port = ofproto.OFPP_FLOOD</span><br><span class="line"></span><br><span class="line">        actions = [parser.OFPActionOutput(out_port)]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> out_port != ofproto.OFP_NO_BUFFER:</span><br><span class="line">            <span class="keyword">match</span> = parser.OFPMatch(in_port=in_port, eth_dst=dst, eth_src=src)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> msg.buffer_id != ofproto.OFP_NO_BUFFER:</span><br><span class="line">                self.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions, msg.buffer_id)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.add_flow(datapath, <span class="number">1</span>, <span class="keyword">match</span>, actions)</span><br><span class="line">        data = <span class="literal">None</span></span><br><span class="line">        <span class="keyword">if</span> msg.buffer_id == ofproto.OFP_NO_BUFFER:</span><br><span class="line">            data = msg.data</span><br><span class="line">        out = parser.OFPPacketOut(datapath=datapath, buffer_id=msg.buffer_id, in_port=in_port, actions=actions, data=data)</span><br><span class="line">        datapath.send_msg(out)</span><br><span class="line">        self.update_topology_data()</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li><p>Call this function in the connection and the Packet-In handlers.</p>
</li>
<li><p>In our Packet-In handler we should only execute the learning switch-related code when the packets are not LLDP packets:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> pkt_eth.ethertype <span class="keyword">in</span> (ETH_TYPE_LLDP,ETH_TYPE_CFM):</span><br><span class="line">  <span class="comment"># LLDP packets will not be processed, we just update the topology</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Find-paths-run-algorithms-optimize-routing"><a href="#Find-paths-run-algorithms-optimize-routing" class="headerlink" title="Find paths, run algorithms, optimize routing"></a>Find paths, run algorithms, optimize routing</h4><p>By means of the topology.api, we have become able to query topology-related information, such as switches, hosts and links among them. In order to run graph algorithms, e.g., find shortest paths among nodes, recalculate path in case of failure, we need to create a network graph. The good thing about graphs is that the concepts and terminology are naturally intuitive, basically graphs describe structures that map relations between objects. Obiects are called nodes and the connection among them are termed as edges. A graph can be directed or undirected based on the orientation of the edges. Making an edge undirected also implies that is is bi-directional, i.e., A &lt;-&gt; B &#x3D; B &lt;-&gt; A. If a graph is directed, then the order and direction of edges do matter, ie., A -&gt; B !&#x3D;  B -&gt; A.</p>
<p>The edegs can also have weights indicating, for instance, the distance between two nodes.</p>
<p><strong>NetworkX - Basics</strong></p>
<p>NetworkX is the most popular Python library to create, manipulate and analyse graphs. Some of its features are:</p>
<ul>
<li>Data structures for graphs, digraphs, and multigraphs</li>
<li>Many standard graph algorithms</li>
<li>Nodes can be “anything” (e.g., text, images, XML records)</li>
<li>Edges can hold arbitrary data (e.g., weights, time-series)</li>
<li>Additional benefits from Python include fast prototyping, easy to teach, and multi-platform</li>
</ul>
<p>The provided Mininet VM already has networks installed, however in order to reinstall it issue the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo pip install networkx</span><br></pre></td></tr></table></figure>

<p>Exploring NetworkX library and creating a simple Graph object can be done as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line">G = nx.Graph()</span><br></pre></td></tr></table></figure>

<p>In order to add 2 nodes (identified by Integer numbers) to the graph and connect them with an edge, try the following:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">G.add_node(<span class="number">1</span>)</span><br><span class="line">G.add_node(<span class="number">2</span>)</span><br><span class="line">G.add_edge(<span class="number">1</span>,<span class="number">2</span>)</span><br></pre></td></tr></table></figure>

<p>The following non-comprehensive list summarizeds some fundamental function calls:</p>
<ul>
<li>G.add_nodes_from(list_of_nodes): Add a list of nodes to the graph</li>
<li>G.remove_node(node): Remove node <strong>node</strong> from the graph</li>
<li>G.node[node]: Get node <strong>node</strong> from the graph</li>
<li>G.add_edges_from(lists_of_edges): Add a list of edges (defined by source-destination pairs) to the graph</li>
<li>G.remove_edge(edge): Remove edge <strong>edge</strong> from the graph</li>
<li>G.edge[src] [dst]: Get an edge between nodes src and dst from the graph</li>
</ul>
<p>You might notice that nodes and edges are not spefified as NetworkX objects. This leaves you free to use meaningful items as nodes and edges. The most common choices are numbers or strings, but a node can be any hashable object (except None). Furthermore, we can also add attributes to graphs, nodes and edges, such as weights, labels, colours or whatever Python object you like. For instance, we can define bandwidth and latecncy attributes for the links:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">G.add_edge(<span class="number">1</span>,<span class="number">2</span>, bandwidth=<span class="number">25</span>,latency=<span class="number">5</span>)</span><br></pre></td></tr></table></figure>

<p>NetworkX - Algorithms</p>
<p>Network provides many graph algorithms, e.g., connectivity, cliques, clustering, independent set, average node&#x2F;edge degree, however from all of them we will use the simple and shortest path algorithms. The nx. shortest-path (G, src, dst) function computes the shortest path in graph G between source node src and destination node dst. Additionally, we can set a forth parameter weight, where we can indicate to use that edge attribute as the edge weight. The following example prints out the shortest path as a list from node 1 towards node 3 in graph G.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(nx.shortest_path(G, source = <span class="number">0</span>, target = <span class="number">4</span>))</span><br></pre></td></tr></table></figure>



<h2 id="Lab-6"><a href="#Lab-6" class="headerlink" title="Lab 6"></a>Lab 6</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo mn --custom my_topo.py --topo mytopo --controller=remote,ip=127.0.0.1,port=6653 --switch ovsk,protocols=OpenFlow13</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> ryu.base <span class="keyword">import</span> app_manager</span><br><span class="line"><span class="keyword">from</span> ryu.controller <span class="keyword">import</span> ofp_event</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> CONFIG_DISPATCHER, MAIN_DISPATCHER</span><br><span class="line"><span class="keyword">from</span> ryu.controller.handler <span class="keyword">import</span> set_ev_cls</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto <span class="keyword">import</span> ofproto_v1_3</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> packet</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> ethernet</span><br><span class="line"><span class="keyword">from</span> ryu.lib.packet <span class="keyword">import</span> ether_types</span><br><span class="line"><span class="keyword">import</span> logging <span class="keyword">as</span> log</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_CFM</span><br><span class="line"><span class="keyword">from</span> ryu.ofproto.ether <span class="keyword">import</span> ETH_TYPE_LLDP</span><br><span class="line"></span><br><span class="line"><span class="comment"># Graph manipulation library</span></span><br><span class="line"><span class="keyword">import</span> networkx <span class="keyword">as</span> nx</span><br><span class="line"></span><br><span class="line"><span class="comment"># Fetch topology information</span></span><br><span class="line"><span class="keyword">from</span> ryu.topology <span class="keyword">import</span> event</span><br><span class="line"><span class="keyword">from</span> ryu.topology.api <span class="keyword">import</span> get_switch, get_link, get_host</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SimpleSwitch13</span>(app_manager.RyuApp):</span><br><span class="line">    OFP_VERSIONS = [ofproto_v1_3.OFP_VERSION]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, *args, **kwargs</span>):</span><br><span class="line">        <span class="built_in">super</span>(SimpleSwitch13, self).__init__(*args, **kwargs)</span><br><span class="line">        self.mac_to_port = &#123;&#125;</span><br><span class="line">        self.G = nx.Graph()</span><br><span class="line">        self.shortest_paths = <span class="built_in">dict</span>()</span><br><span class="line">        </span><br><span class="line">        <span class="comment"># necessary to enable the topology monitoring functionality</span></span><br><span class="line">        self.topology_api_app = self</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPSwitchFeatures, CONFIG_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">switch_features_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        datapath = ev.msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> = parser.OFPMatch()</span><br><span class="line">        actions = [parser.OFPActionOutput(ofproto.OFPP_CONTROLLER,</span><br><span class="line">                                          ofproto.OFPCML_NO_BUFFER)]</span><br><span class="line">        self.add_flow(datapath, <span class="number">0</span>, <span class="keyword">match</span>, actions)</span><br><span class="line">        self.update_topology_data()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">add_flow</span>(<span class="params">self, datapath, priority, <span class="keyword">match</span>, actions, buffer_id=<span class="literal">None</span></span>):</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line"></span><br><span class="line">        inst = [parser.OFPInstructionActions(ofproto.OFPIT_APPLY_ACTIONS,</span><br><span class="line">                                             actions)]</span><br><span class="line">        <span class="keyword">if</span> buffer_id:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, buffer_id=buffer_id,</span><br><span class="line">                                    priority=priority, <span class="keyword">match</span>=<span class="keyword">match</span>,</span><br><span class="line">                                    instructions=inst)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            mod = parser.OFPFlowMod(datapath=datapath, priority=priority,</span><br><span class="line">                                    <span class="keyword">match</span>=<span class="keyword">match</span>, instructions=inst)</span><br><span class="line">        datapath.send_msg(mod)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @set_ev_cls(<span class="params">ofp_event.EventOFPPacketIn, MAIN_DISPATCHER</span>)</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">_packet_in_handler</span>(<span class="params">self, ev</span>):</span><br><span class="line">        <span class="comment"># If you hit this you might want to increase</span></span><br><span class="line">        <span class="comment"># the &quot;miss_send_length&quot; of your switch</span></span><br><span class="line">        <span class="keyword">if</span> ev.msg.msg_len &lt; ev.msg.total_len:</span><br><span class="line">            self.logger.debug(<span class="string">&quot;packet truncated: only %s of %s bytes&quot;</span>,</span><br><span class="line">                              ev.msg.msg_len, ev.msg.total_len)</span><br><span class="line">        msg = ev.msg</span><br><span class="line">        datapath = msg.datapath</span><br><span class="line">        ofproto = datapath.ofproto</span><br><span class="line">        parser = datapath.ofproto_parser</span><br><span class="line">        in_port = msg.<span class="keyword">match</span>[<span class="string">&#x27;in_port&#x27;</span>]</span><br><span class="line"></span><br><span class="line">        pkt = packet.Packet(msg.data)</span><br><span class="line">        eth = pkt.get_protocols(ethernet.ethernet)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> eth.ethertype <span class="keyword">in</span> (ETH_TYPE_LLDP, ETH_TYPE_CFM):</span><br><span class="line">            <span class="comment"># ignore lldp packet</span></span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        self.update_topology_data()</span><br><span class="line">            </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">update_topology_data</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="comment"># Get lists for switches, links, and hosts</span></span><br><span class="line">        switch_list = get_switch(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        links_list = get_link(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line">        hosts_list = get_host(self.topology_api_app, <span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        self.logger.info(<span class="string">&quot;Switches:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> switch <span class="keyword">in</span> switch_list:</span><br><span class="line">            <span class="built_in">print</span>(switch)</span><br><span class="line">            switch_name=<span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(switch.dp.<span class="built_in">id</span>)</span><br><span class="line">            self.logger.info(switch_name)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">            <span class="comment"># add switches to graph with preset attribute names</span></span><br><span class="line">            <span class="comment"># define a recent_port data dictionary as an attribute for the</span></span><br><span class="line">            <span class="comment"># swithes - it will be updated in each case</span></span><br><span class="line">            <span class="comment"># a new port comes up</span></span><br><span class="line">            self.G.add_node(</span><br><span class="line">                switch_name,</span><br><span class="line">                name=switch_name,</span><br><span class="line">                dp=switch.dp,</span><br><span class="line">                port=switch.ports</span><br><span class="line">                )</span><br><span class="line">                </span><br><span class="line">                </span><br><span class="line">        self.logger.info(<span class="string">&quot;\nLinks:&quot;</span>)</span><br><span class="line">        <span class="keyword">for</span> link <span class="keyword">in</span> links_list:</span><br><span class="line">            <span class="built_in">print</span>(link)</span><br><span class="line">            source = <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(link.src.dpid)</span><br><span class="line">            source_port = link.src.port_no</span><br><span class="line">            target = <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(link.dst.dpid)</span><br><span class="line">            target_port = link.dst.port_no</span><br><span class="line">            self.logger.info(<span class="string">&quot;&#123;&#125;(port:&#123;&#125;) &lt;---&gt; (port:&#123;&#125;)&#123;&#125;&quot;</span>.<span class="built_in">format</span>(source,source_port,target_port,target))</span><br><span class="line">            <span class="comment"># networkx links in Graph() are not differentiated by source and destination, so a link and its data become</span></span><br><span class="line">            <span class="comment"># updated when add_edge is called with the source and destination swapped</span></span><br><span class="line">            self.G.add_edge(source, target,</span><br><span class="line">                                  src_dpid=source, src_port=link.src.port_no,</span><br><span class="line">                                  dst_dpid=target, dst_port=link.dst.port_no)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        self.logger.info(<span class="string">&quot;Hosts:\n&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> hosts_list:</span><br><span class="line">            <span class="keyword">for</span> host <span class="keyword">in</span> hosts_list:</span><br><span class="line">                <span class="comment"># assemble name according to mac</span></span><br><span class="line">                host_name=<span class="string">&quot;h&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.mac.split(<span class="string">&quot;:&quot;</span>)[<span class="number">5</span>][<span class="number">1</span>])</span><br><span class="line">                <span class="built_in">print</span>(host_name)</span><br><span class="line">                last_byte_hex = host.mac.split(<span class="string">&quot;:&quot;</span>)[<span class="number">5</span>]</span><br><span class="line">                last_byte_int = <span class="built_in">int</span>(last_byte_hex, <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> last_byte_int == <span class="number">0</span>:</span><br><span class="line">                  last_byte_int = <span class="number">1</span></span><br><span class="line">                <span class="keyword">elif</span> last_byte_int &gt; <span class="number">254</span>:</span><br><span class="line">                  last_byte_int = <span class="number">254</span></span><br><span class="line"></span><br><span class="line">                host.ipv4 = <span class="string">&quot;10.0.0.&#123;&#125;&quot;</span>.<span class="built_in">format</span>(last_byte_int)</span><br><span class="line">                self.logger.info(<span class="string">&quot;&#123;&#125;:\n\tip4:&#123;&#125;&quot;</span></span><br><span class="line">                        <span class="string">&quot;\n\tip6:&#123;&#125;&quot;</span></span><br><span class="line">                        <span class="string">&quot;\n\tmac:&#123;&#125;&quot;</span></span><br><span class="line">                        <span class="string">&quot;\n\tconnected to:s&#123;&#125;&quot;</span></span><br><span class="line">                        <span class="string">&quot;\n\tport_no:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(</span><br><span class="line">                               host_name,</span><br><span class="line">                               host.ipv4,</span><br><span class="line">                               host.ipv6,</span><br><span class="line">                               host.mac,</span><br><span class="line">                               host.port.dpid,</span><br><span class="line">                               host.port.port_no</span><br><span class="line">                           )</span><br><span class="line">                       )</span><br><span class="line">            </span><br><span class="line">                </span><br><span class="line">                self.G.add_node(</span><br><span class="line">                                host_name,</span><br><span class="line">                                name=host_name,</span><br><span class="line">                                ipv4=host.ipv4,</span><br><span class="line">                                ipv6=host.ipv6,</span><br><span class="line">                                mac=host.mac,</span><br><span class="line">                                connected_to=<span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.port.dpid),</span><br><span class="line">                                port_no=host.port.port_no)</span><br><span class="line">                <span class="comment"># add corresponding links to the graph</span></span><br><span class="line">                self.G.add_edge(host_name,</span><br><span class="line">                                <span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.port.dpid),</span><br><span class="line">                                dst_port=host.port.port_no,</span><br><span class="line">                                dst_dpid=<span class="string">&quot;s&#123;&#125;&quot;</span>.<span class="built_in">format</span>(host.port.dpid))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">                </span><br><span class="line">        <span class="comment"># update shortest paths</span></span><br><span class="line">        self.calculate_all_pair_shortest_paths()</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Shortest Paths:\n&#123;&#125;&quot;</span>.<span class="built_in">format</span>(self.shortest_paths))</span><br><span class="line">        self.install_shortest_paths_flow_rules()</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_shortest_paths</span>(<span class="params">self,src,dst</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        This function returns all shortest paths between the given source and destination node</span></span><br><span class="line"><span class="string">        :param src: String - the source node&#x27;s name</span></span><br><span class="line"><span class="string">        :param dst: String - the destination node&#x27;s name</span></span><br><span class="line"><span class="string">        :return: list of lists</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> src <span class="keyword">not</span> <span class="keyword">in</span> self.G.nodes() <span class="keyword">or</span> dst <span class="keyword">not</span> <span class="keyword">in</span> self.G.nodes():</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line">        paths = <span class="built_in">list</span>()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            all_sp = nx.all_shortest_paths(self.G, src, dst)</span><br><span class="line">            <span class="keyword">for</span> path <span class="keyword">in</span> all_sp:</span><br><span class="line">                paths.append(path)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">except</span> nx.NetworkXNoPath:  <span class="comment"># no path between src and dst</span></span><br><span class="line">            log.info(<span class="string">&quot;No path between &#123;&#125; and &#123;&#125;&quot;</span>.<span class="built_in">format</span>(src, dst))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> paths</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">calculate_all_pair_shortest_paths</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        This function calculates all shortest paths for all source and destinations</span></span><br><span class="line"><span class="string">        Note: NetworkX also have similar function (all_pairs_shortest_path(G[, cutoff])), </span></span><br><span class="line"><span class="string">        however that only gives one shortest path for a given (source,destination) pair</span></span><br><span class="line"><span class="string">        :return: dictionary of dictionary of list of lists, e.g., h1:&#123;h2:[[h1,s1,h2],[h1,s2,h2]]&#125;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        all_paths = <span class="built_in">dict</span>()</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> self.G.nodes():</span><br><span class="line">            <span class="keyword">if</span> n.startswith(<span class="string">&#x27;h&#x27;</span>): <span class="comment">#only hosts are relevant</span></span><br><span class="line">                all_paths[n] = <span class="built_in">dict</span>()</span><br><span class="line">                <span class="keyword">for</span> m <span class="keyword">in</span> self.G.nodes():</span><br><span class="line">                    <span class="keyword">if</span> m.startswith(<span class="string">&#x27;h&#x27;</span>):</span><br><span class="line">                        <span class="keyword">if</span> n == m:</span><br><span class="line">                            <span class="keyword">continue</span></span><br><span class="line">                        all_paths[n][m] = self.calculate_shortest_paths(n, m)</span><br><span class="line"></span><br><span class="line">        self.shortest_paths = all_paths</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">install_flow_rule_for_chain_link</span>(<span class="params">self, chain_link, chain_prev, chain_next, source_ip, destination_ip</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        This function installs matching flow rules on source_ip and destination_ip in switch</span></span><br><span class="line"><span class="string">        chain_link and outputs packets on ports that are connected to its upstream (chain_prev)</span></span><br><span class="line"><span class="string">        and downstream (chain_next) nodes, respectively.</span></span><br><span class="line"><span class="string">        According to the chain_prev and chain_next, it gets the link/port number information</span></span><br><span class="line"><span class="string">        from the graph that stores them</span></span><br><span class="line"><span class="string">        :param chain_link: String - the name of the chain_link</span></span><br><span class="line"><span class="string">        :param chain_prev: String - the name of the previous switch</span></span><br><span class="line"><span class="string">        :param chain_next: String - the name of the next switch</span></span><br><span class="line"><span class="string">        :param source_ip: tuple(String,String) - source host IP address and netmask for the upstream</span></span><br><span class="line"><span class="string">        :param destination_ip: tuple(String,String) - the destination IP address and netmask for the downstream</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">        datapath = self.G.nodes[chain_link][<span class="string">&#x27;dp&#x27;</span>]</span><br><span class="line">        ofp = datapath.ofproto</span><br><span class="line">        ofp_parser = datapath.ofproto_parser</span><br><span class="line">        match_source_ip = ofp_parser.OFPMatch(eth_type=<span class="number">0x0800</span>, ipv4_dst=source_ip)</span><br><span class="line">        match_destination_ip = ofp_parser.OFPMatch(eth_type=<span class="number">0x0800</span>, ipv4_dst=destination_ip)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- upstream</span></span><br><span class="line">        <span class="comment"># get edge_data</span></span><br><span class="line">        edge = self.G[chain_link][chain_prev]</span><br><span class="line">        <span class="built_in">print</span> (<span class="string">&quot;upstream edge: &quot;</span>, edge)</span><br><span class="line">        <span class="keyword">if</span> edge[<span class="string">&#x27;dst_dpid&#x27;</span>] == chain_link:</span><br><span class="line">            <span class="comment"># if prev is a host, then it is always the case that edge[&#x27;dst_port&#x27;] stores the port number</span></span><br><span class="line">            out_port = edge[<span class="string">&#x27;dst_port&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># if prev is a switch, then it might be the src_dpid</span></span><br><span class="line">            out_port = edge[<span class="string">&#x27;src_port&#x27;</span>]</span><br><span class="line">        actions = [ofp_parser.OFPActionOutput(out_port, <span class="number">0</span>)]</span><br><span class="line">        inst = [ofp_parser.OFPInstructionActions(ofp.OFPIT_APPLY_ACTIONS, actions)]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;install flow rule for SIP &#123;&#125; - DIP &#123;&#125; at &#123;&#125; to forward packet on port &#123;&#125;&quot;</span>.</span><br><span class="line">                 <span class="built_in">format</span>(source_ip, destination_ip, chain_link, out_port))</span><br><span class="line">        self.send_flow_mod(datapath, <span class="literal">None</span>, <span class="keyword">match</span>=match_source_ip, inst=inst)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># --- downstream</span></span><br><span class="line">        <span class="comment"># get edge_data</span></span><br><span class="line">        edge = self.G[chain_link][chain_next]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;downstream edge: &quot;</span>, edge)</span><br><span class="line">        <span class="keyword">if</span> edge[<span class="string">&#x27;dst_dpid&#x27;</span>] == chain_link:</span><br><span class="line">            <span class="comment"># if next is a host, then it is always the case that edge[&#x27;dst_port&#x27;] stores the port number</span></span><br><span class="line">            out_port = edge[<span class="string">&#x27;dst_port&#x27;</span>]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># if next is a switch, then it might be the src_dpid</span></span><br><span class="line">            out_port = edge[<span class="string">&#x27;src_port&#x27;</span>]</span><br><span class="line">        actions = [ofp_parser.OFPActionOutput(out_port, <span class="number">0</span>)]</span><br><span class="line">        inst = [ofp_parser.OFPInstructionActions(ofp.OFPIT_APPLY_ACTIONS, actions)]</span><br><span class="line">        log.info(<span class="string">&quot;install flow rule for SIP &#123;&#125; - DIP &#123;&#125; at &#123;&#125; to forward packet on port &#123;&#125;&quot;</span>.</span><br><span class="line">                 <span class="built_in">format</span>(source_ip, destination_ip, chain_link, out_port))</span><br><span class="line">        self.send_flow_mod(datapath, <span class="literal">None</span>, <span class="keyword">match</span>=match_destination_ip, inst=inst)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">install_shortest_paths_flow_rules</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        This function will install flow rules according to the shortest paths</span></span><br><span class="line"><span class="string">        :return:</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        paths = self.shortest_paths</span><br><span class="line">        <span class="comment"># paths looks like &#123;h1:&#123;h2:[[path1],[path2]]&#125;&#125; &lt;- EXAMPLE</span></span><br><span class="line">        <span class="keyword">if</span> paths:</span><br><span class="line">            <span class="keyword">for</span> source <span class="keyword">in</span> paths:  <span class="comment"># source = h1</span></span><br><span class="line">                source_host = self.G.nodes[source]</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Source host: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(source_host))</span><br><span class="line">                source_ip = (source_host[<span class="string">&#x27;ipv4&#x27;</span>], <span class="string">&#x27;255.255.255.255&#x27;</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;Source ip: &#123;&#125;&quot;</span>.<span class="built_in">format</span>(source_ip))</span><br><span class="line"></span><br><span class="line">                <span class="comment"># self.log.info(paths[source])  # paths[source] = &#123;h2: [[path1],[path2]]</span></span><br><span class="line">                <span class="keyword">for</span> p <span class="keyword">in</span> paths[source]:  <span class="comment"># p = h2</span></span><br><span class="line">                    destination_host = self.G.nodes[p]</span><br><span class="line">                    destination_ip = (destination_host[<span class="string">&#x27;ipv4&#x27;</span>], <span class="string">&#x27;255.255.255.255&#x27;</span>)</span><br><span class="line">                    <span class="keyword">if</span> paths[source][p]:</span><br><span class="line">                        <span class="keyword">for</span> path_num, j <span class="keyword">in</span> <span class="built_in">enumerate</span>(</span><br><span class="line">                                paths[source][p]):  <span class="comment"># paths[source][p] = [[path1],[path2]], j = one path from paths</span></span><br><span class="line">                            <span class="comment"># install the first rule always!</span></span><br><span class="line">                            individual_path = j</span><br><span class="line">                            <span class="keyword">if</span> individual_path:</span><br><span class="line">                                <span class="keyword">for</span> num, sw <span class="keyword">in</span> <span class="built_in">enumerate</span>(individual_path):</span><br><span class="line">                                    <span class="comment"># print sw</span></span><br><span class="line">                                    <span class="keyword">if</span> sw.startswith(<span class="string">&#x27;h&#x27;</span>):</span><br><span class="line">                                        <span class="comment"># it&#x27;s a host, skip (this will also prevent running out of indexes in both direction (see below))</span></span><br><span class="line">                                        <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">                                    prev = individual_path[num - <span class="number">1</span>]</span><br><span class="line">                                    current = individual_path[num]</span><br><span class="line">                                    <span class="built_in">next</span> = individual_path[num + <span class="number">1</span>]</span><br><span class="line">                                    self.install_flow_rule_for_chain_link(current, prev, <span class="built_in">next</span>, source_ip, destination_ip)</span><br><span class="line">                                    <span class="comment"># break</span></span><br><span class="line">                                    </span><br><span class="line">                                    </span><br><span class="line">        </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">send_flow_mod</span>(<span class="params">self, datapath, msg, **args</span>):</span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Sending a flow_mod to the given switch</span></span><br><span class="line"><span class="string">        :param datapath: Datapath - datapath of the switch</span></span><br><span class="line"><span class="string">        :param msg: PacketIn message</span></span><br><span class="line"><span class="string">        :param args: cookie=0, table=0, cookie_mask=0,idle_timeout=0,hard_timeout=0,priority=100,buffer_id=OFP_NO_BUFFER,</span></span><br><span class="line"><span class="string">                    mod_type= OFPFC_ADD, match=OFPMatch(in_port=1,broadcast_eth_dst),</span></span><br><span class="line"><span class="string">                    inst=OFPInstructionActions(apply action,OFPActionOutput(2)),</span></span><br><span class="line"><span class="string">        :return: nothing</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        ofp = datapath.ofproto</span><br><span class="line">        ofp_parser = datapath.ofproto_parser</span><br><span class="line">        table_id = args.get(<span class="string">&#x27;table&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">        cookie = args.get(<span class="string">&#x27;cookie&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        cookie_mask = args.get(<span class="string">&#x27;cookie_mask&#x27;</span>,<span class="number">0</span>)</span><br><span class="line">        idle_timeout = args.get(<span class="string">&#x27;idle_timeout&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        hard_timeout = args.get(<span class="string">&#x27;hard_timeout&#x27;</span>, <span class="number">0</span>)</span><br><span class="line">        priority = args.get(<span class="string">&#x27;priority&#x27;</span>, <span class="number">100</span>)</span><br><span class="line">        <span class="keyword">if</span> msg:</span><br><span class="line">            buffer_id = args.get(<span class="string">&#x27;buffer_id&#x27;</span>, msg.buffer_id)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            buffer_id=ofp.OFP_NO_BUFFER</span><br><span class="line"></span><br><span class="line">        mod_type = args.get(<span class="string">&#x27;mod_type&#x27;</span>, ofp.OFPFC_ADD)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="keyword">match</span> = args.get(<span class="string">&#x27;match&#x27;</span>,ofp_parser.OFPMatch(in_port=<span class="number">1</span>, eth_dst=<span class="string">&#x27;ff:ff:ff:ff:ff:ff&#x27;</span>))</span><br><span class="line">        inst = args.get(<span class="string">&#x27;inst&#x27;</span>,</span><br><span class="line">                        [ofp_parser.OFPInstructionActions(</span><br><span class="line">                                ofp.OFPIT_APPLY_ACTIONS,</span><br><span class="line">                                [ofp_parser.OFPActionOutput(<span class="number">2</span>)])])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        flowmod = ofp_parser.OFPFlowMod(datapath, cookie, cookie_mask,</span><br><span class="line">                                    table_id, mod_type,</span><br><span class="line">                                    idle_timeout, hard_timeout,</span><br><span class="line">                                    priority, buffer_id,</span><br><span class="line">                                    ofp.OFPP_ANY, ofp.OFPG_ANY,</span><br><span class="line">                                    ofp.OFPFF_SEND_FLOW_REM,</span><br><span class="line">                                    <span class="keyword">match</span>, inst)</span><br><span class="line"></span><br><span class="line"><span class="comment">#        log.info(&quot;Sending flowmod:\n &#123;&#125;&quot;.format(flowmod))</span></span><br><span class="line">        datapath.send_msg(flowmod)</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
      <div id="reword-out">
        <div id="reward-btn">
          Donate
        </div>
      </div>
      
    </div>
    

    <!-- copyright -->
    
    <div class="declare">
      <ul class="post-copyright">
        <li>
          <i class="ri-copyright-line"></i>
          <strong>Copyright： </strong>
          
          Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source.
          
        </li>
      </ul>
    </div>
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        Share
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2023/11/19/SDN/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/tech/" rel="tag">tech</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
      <a href="/2024/02/22/Satellite/" class="article-nav-link">
        <strong class="article-nav-caption">Previous Post</strong>
        <div class="article-nav-title">
          
            (no title)
          
        </div>
      </a>
    
    
      <a href="/2023/09/26/network/" class="article-nav-link">
        <strong class="article-nav-caption">Next Post</strong>
        <div class="article-nav-title">Network</div>
      </a>
    
  </nav>

  
   
    
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2021-2024
        <i class="ri-heart-fill heart_icon"></i> Mingwei Li
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
        
        <span>
  <span><i class="ri-user-3-fill"></i>Visitors:<span id="busuanzi_value_site_uv"></span></span>
  <span class="division">|</span>
  <span><i class="ri-eye-fill"></i>Views:<span id="busuanzi_value_page_pv"></span></span>
</span>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
        <script type="text/javascript" src='https://s9.cnzz.com/z_stat.php?id=1278069914&amp;web_id=1278069914'></script>
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/UofG.png" alt="Mingwei’s Blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">Home</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/CV">Personal</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">Archives</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">Categories</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">Tags</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/travel">Travel</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="Search">
        <i class="ri-search-line"></i>
      </a>
      
      
      <a class="nav-item-link" target="_blank" href="/atom.xml" title="RSS Feed">
        <i class="ri-rss-line"></i>
      </a>
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i>Buy me a bottle of beer please~</p>
  <div class="reward-box">
    
    <div class="reward-item">
      <img class="reward-img" src="/images/alipay.jpg">
      <span class="reward-type">支付宝</span>
    </div>
    
    
    <div class="reward-item">
      <img class="reward-img" src="/images/wechat.jpg">
      <span class="reward-type">微信</span>
    </div>
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->
 
<script src="/js/busuanzi-2.3.pure.min.js"></script>
 
<!-- ClickLove -->
 
<script src="/js/clickLove.js"></script>
 
<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>